(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[4346],{"./ts/components/CallManager.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CallRequestNeeded:()=>CallRequestNeeded,GroupCallSafetyNumberChanged:()=>GroupCallSafetyNumberChanged,NoCall:()=>NoCall,OngoingDirectCall:()=>OngoingDirectCall,OngoingGroupCall:()=>OngoingGroupCall,RingingDirectCall:()=>RingingDirectCall,RingingGroupCall:()=>RingingGroupCall,__namedExportsOrder:()=>__namedExportsOrder,default:()=>CallManager_stories});var react=__webpack_require__("./node_modules/react/index.js"),esm=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),dist=__webpack_require__("./node_modules/@storybook/addon-knobs/dist/index.js"),noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),Colors=__webpack_require__("./ts/types/Colors.ts"),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),Intl=__webpack_require__("./ts/components/Intl.tsx"),ContactName=__webpack_require__("./ts/components/conversation/ContactName.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function CallNeedPermissionScreen(_ref){var conversation=_ref.conversation,i18n=_ref.i18n,close=_ref.close,title=conversation.title||i18n("icu:unknownContact"),autoCloseAtRef=(0,react.useRef)(Date.now()+1e4);return(0,react.useEffect)((function(){var timeout=setTimeout(close,autoCloseAtRef.current-Date.now());return clearTimeout.bind(null,timeout)}),[autoCloseAtRef,close]),(0,jsx_runtime.jsxs)("div",{className:"module-call-need-permission-screen",children:[(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest:conversation.acceptedMessageRequest,avatarPath:conversation.avatarPath,badge:void 0,color:conversation.color||Colors.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe:conversation.isMe,phoneNumber:conversation.phoneNumber,profileName:conversation.profileName,title:conversation.title,sharedGroupNames:conversation.sharedGroupNames,size:Avatar.DZ.EIGHTY}),(0,jsx_runtime.jsx)("p",{className:"module-call-need-permission-screen__text",children:(0,jsx_runtime.jsx)(Intl.R,{i18n,id:"icu:callNeedPermission",components:{title:(0,jsx_runtime.jsx)(ContactName.K,{title})}})}),(0,jsx_runtime.jsx)("button",{type:"button",className:"module-call-need-permission-screen__button",onClick:function(){close()},children:i18n("icu:close")})]})}CallNeedPermissionScreen.displayName="CallNeedPermissionScreen";var CallScreen=__webpack_require__("./ts/components/CallScreen.tsx"),CallingLobby=__webpack_require__("./ts/components/CallingLobby.tsx"),CallingParticipantsList=__webpack_require__("./ts/components/CallingParticipantsList.tsx"),CallingSelectPresentingSourcesModal=__webpack_require__("./ts/components/CallingSelectPresentingSourcesModal.tsx"),CallingPip=__webpack_require__("./ts/components/CallingPip.tsx"),IncomingCallBar=__webpack_require__("./ts/components/IncomingCallBar.tsx"),SafetyNumberChangeDialog=__webpack_require__("./ts/components/SafetyNumberChangeDialog.tsx"),Calling=__webpack_require__("./ts/types/Calling.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ActiveCallManager(_ref){var isCallFull,showCallLobby,groupMembers,activeCall=_ref.activeCall,availableCameras=_ref.availableCameras,cancelCall=_ref.cancelCall,closeNeedPermissionScreen=_ref.closeNeedPermissionScreen,hangUpActiveCall=_ref.hangUpActiveCall,i18n=_ref.i18n,isGroupCallOutboundRingEnabled=_ref.isGroupCallOutboundRingEnabled,keyChangeOk=_ref.keyChangeOk,getGroupCallVideoFrameSource=_ref.getGroupCallVideoFrameSource,getPreferredBadge=_ref.getPreferredBadge,getPresentingSources=_ref.getPresentingSources,me=_ref.me,openSystemPreferencesAction=_ref.openSystemPreferencesAction,renderDeviceSelection=_ref.renderDeviceSelection,renderSafetyNumberViewer=_ref.renderSafetyNumberViewer,setGroupCallVideoRequest=_ref.setGroupCallVideoRequest,setLocalAudio=_ref.setLocalAudio,setLocalPreview=_ref.setLocalPreview,setLocalVideo=_ref.setLocalVideo,setPresenting=_ref.setPresenting,setRendererCanvas=_ref.setRendererCanvas,setOutgoingRing=_ref.setOutgoingRing,startCall=_ref.startCall,switchToPresentationView=_ref.switchToPresentationView,switchFromPresentationView=_ref.switchFromPresentationView,theme=_ref.theme,toggleParticipants=_ref.toggleParticipants,togglePip=_ref.togglePip,toggleScreenRecordingPermissionsDialog=_ref.toggleScreenRecordingPermissionsDialog,toggleSettings=_ref.toggleSettings,toggleSpeakerView=_ref.toggleSpeakerView,pauseVoiceNotePlayer=_ref.pauseVoiceNotePlayer,conversation=activeCall.conversation,hasLocalAudio=activeCall.hasLocalAudio,hasLocalVideo=activeCall.hasLocalVideo,joinedAt=activeCall.joinedAt,peekedParticipants=activeCall.peekedParticipants,pip=activeCall.pip,presentingSourcesAvailable=activeCall.presentingSourcesAvailable,settingsDialogOpen=activeCall.settingsDialogOpen,showParticipantsList=activeCall.showParticipantsList,outgoingRing=activeCall.outgoingRing,cancelActiveCall=(0,react.useCallback)((function(){cancelCall({conversationId:conversation.id})}),[cancelCall,conversation.id]),joinActiveCall=(0,react.useCallback)((function(){pauseVoiceNotePlayer(),startCall({callMode:activeCall.callMode,conversationId:conversation.id,hasLocalAudio,hasLocalVideo})}),[startCall,activeCall.callMode,conversation.id,hasLocalAudio,hasLocalVideo,pauseVoiceNotePlayer]),getGroupCallVideoFrameSourceForActiveCall=(0,react.useCallback)((function(demuxId){return getGroupCallVideoFrameSource(conversation.id,demuxId)}),[getGroupCallVideoFrameSource,conversation.id]),setGroupCallVideoRequestForConversation=(0,react.useCallback)((function(resolutions,speakerHeight){setGroupCallVideoRequest({conversationId:conversation.id,resolutions,speakerHeight})}),[setGroupCallVideoRequest,conversation.id]),onSafetyNumberDialogCancel=(0,react.useCallback)((function(){hangUpActiveCall("safety number dialog cancel")}),[hangUpActiveCall]),isConvoTooBigToRing=!1;switch(activeCall.callMode){case Calling.L6.Direct:var callState=activeCall.callState,callEndedReason=activeCall.callEndedReason;if(callState===Calling.OX.Ended&&callEndedReason===Calling.KQ.RemoteHangupNeedPermission)return(0,jsx_runtime.jsx)(CallNeedPermissionScreen,{close:closeNeedPermissionScreen,conversation,i18n});showCallLobby=!callState,isCallFull=!1,groupMembers=void 0;break;case Calling.L6.Group:showCallLobby=activeCall.joinState!==Calling.GT.Joined,isCallFull=activeCall.deviceCount>=activeCall.maxDevices,isConvoTooBigToRing=activeCall.isConversationTooBigToRing,groupMembers=activeCall.groupMembers;break;default:throw(0,missingCaseError.b)(activeCall)}if(showCallLobby)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CallingLobby.H,{availableCameras,conversation,groupMembers,hasLocalAudio,hasLocalVideo,i18n,isGroupCall:activeCall.callMode===Calling.L6.Group,isGroupCallOutboundRingEnabled,isCallFull,isConversationTooBigToRing:isConvoTooBigToRing,me,onCallCanceled:cancelActiveCall,onJoinCall:joinActiveCall,outgoingRing,peekedParticipants,setLocalPreview,setLocalAudio,setLocalVideo,setOutgoingRing,showParticipantsList,toggleParticipants,toggleSettings}),settingsDialogOpen&&renderDeviceSelection(),showParticipantsList&&activeCall.callMode===Calling.L6.Group?(0,jsx_runtime.jsx)(CallingParticipantsList.L,{i18n,onClose:toggleParticipants,ourUuid:me.uuid,participants:peekedParticipants}):null]});if(pip)return(0,jsx_runtime.jsx)(CallingPip.V,{activeCall,getGroupCallVideoFrameSource:getGroupCallVideoFrameSourceForActiveCall,hangUpActiveCall,hasLocalVideo,i18n,setGroupCallVideoRequest:setGroupCallVideoRequestForConversation,setLocalPreview,setRendererCanvas,switchToPresentationView,switchFromPresentationView,togglePip});var groupCallParticipantsForParticipantsList=activeCall.callMode===Calling.L6.Group?[].concat(_toConsumableArray(activeCall.remoteParticipants.map((function(participant){return Object.assign({},participant,{hasRemoteAudio:participant.hasRemoteAudio,hasRemoteVideo:participant.hasRemoteVideo,presenting:participant.presenting})}))),[Object.assign({},me,{hasRemoteAudio:hasLocalAudio,hasRemoteVideo:hasLocalVideo,presenting:Boolean(activeCall.presentingSource)})]):[];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CallScreen.N,{activeCall,getPresentingSources,getGroupCallVideoFrameSource:getGroupCallVideoFrameSourceForActiveCall,groupMembers,hangUpActiveCall,i18n,joinedAt,me,openSystemPreferencesAction,setGroupCallVideoRequest:setGroupCallVideoRequestForConversation,setLocalPreview,setRendererCanvas,setLocalAudio,setLocalVideo,setPresenting,stickyControls:showParticipantsList,switchToPresentationView,switchFromPresentationView,toggleScreenRecordingPermissionsDialog,toggleParticipants,togglePip,toggleSettings,toggleSpeakerView}),presentingSourcesAvailable&&presentingSourcesAvailable.length?(0,jsx_runtime.jsx)(CallingSelectPresentingSourcesModal.k,{i18n,presentingSourcesAvailable,setPresenting}):null,settingsDialogOpen&&renderDeviceSelection(),showParticipantsList&&activeCall.callMode===Calling.L6.Group?(0,jsx_runtime.jsx)(CallingParticipantsList.L,{i18n,onClose:toggleParticipants,ourUuid:me.uuid,participants:groupCallParticipantsForParticipantsList}):null,activeCall.callMode===Calling.L6.Group&&activeCall.conversationsWithSafetyNumberChanges.length?(0,jsx_runtime.jsx)(SafetyNumberChangeDialog.m,{confirmText:i18n("icu:continueCall"),contacts:[{story:void 0,contacts:activeCall.conversationsWithSafetyNumberChanges}],getPreferredBadge,i18n,onCancel:onSafetyNumberDialogCancel,onConfirm:function(){keyChangeOk({conversationId:activeCall.conversation.id})},renderSafetyNumber:renderSafetyNumberViewer,theme}):null]})}function CallManager(props){var acceptCall=props.acceptCall,activeCall=props.activeCall,bounceAppIconStart=props.bounceAppIconStart,bounceAppIconStop=props.bounceAppIconStop,declineCall=props.declineCall,i18n=props.i18n,incomingCall=props.incomingCall,notifyForCall=props.notifyForCall,playRingtone=props.playRingtone,stopRingtone=props.stopRingtone,setIsCallActive=props.setIsCallActive,setOutgoingRing=props.setOutgoingRing,isCallActive=Boolean(activeCall);(0,react.useEffect)((function(){setIsCallActive(isCallActive)}),[isCallActive,setIsCallActive]);var shouldRing=function getShouldRing(_ref2){var activeCall=_ref2.activeCall,incomingCall=_ref2.incomingCall,isConversationTooBigToRing=_ref2.isConversationTooBigToRing;if(incomingCall)return!isConversationTooBigToRing&&!activeCall;if(!activeCall)return!1;switch(activeCall.callMode){case Calling.L6.Direct:return activeCall.callState===Calling.OX.Prering||activeCall.callState===Calling.OX.Ringing;case Calling.L6.Group:return activeCall.outgoingRing&&(activeCall.connectionState===Calling.mB.Connecting||activeCall.connectionState===Calling.mB.Connected)&&activeCall.joinState!==Calling.GT.NotJoined&&!activeCall.remoteParticipants.length&&(activeCall.conversation.sortedGroupMembers||[]).length>=2;default:throw(0,missingCaseError.b)(activeCall)}}(props);(0,react.useEffect)((function(){return shouldRing?(playRingtone(),function(){stopRingtone()}):(stopRingtone(),noop_default())}),[shouldRing,playRingtone,stopRingtone]);var mightBeRingingOutgoingGroupCall=(null==activeCall?void 0:activeCall.callMode)===Calling.L6.Group&&activeCall.outgoingRing&&activeCall.joinState!==Calling.GT.NotJoined;return(0,react.useEffect)((function(){if(!mightBeRingingOutgoingGroupCall)return noop_default();var timeout=setTimeout((function(){setOutgoingRing(!1)}),6e4);return function(){clearTimeout(timeout)}}),[mightBeRingingOutgoingGroupCall,setOutgoingRing]),activeCall?(0,jsx_runtime.jsx)(ActiveCallManager,Object.assign({},props,{activeCall})):incomingCall?(0,jsx_runtime.jsx)(IncomingCallBar.C,Object.assign({acceptCall,bounceAppIconStart,bounceAppIconStop,declineCall,i18n,notifyForCall},incomingCall)):null}var getDefaultConversation=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),fakeGetGroupCallVideoFrameSource=__webpack_require__("./ts/test-both/helpers/fakeGetGroupCallVideoFrameSource.ts"),setupI18n=__webpack_require__("./ts/util/setupI18n.ts"),messages=__webpack_require__("./_locales/en/messages.json"),Util=__webpack_require__("./ts/types/Util.ts"),Stories=__webpack_require__("./ts/types/Stories.ts"),i18n=(0,setupI18n.E5)("en",messages),getConversation=function(){return(0,getDefaultConversation.E$)({id:"3051234567",avatarPath:void 0,color:(0,dist.select)("Callee color",Colors.sj,"ultramarine"),title:(0,dist.text)("Callee Title","Rick Sanchez"),name:(0,dist.text)("Callee Name","Rick Sanchez"),phoneNumber:"3051234567",profileName:"Rick Sanchez",markedUnread:!1,type:"direct",lastUpdated:Date.now()})},getCommonActiveCallData=function(){return{conversation:getConversation(),joinedAt:Date.now(),hasLocalAudio:(0,dist.boolean)("hasLocalAudio",!0),hasLocalVideo:(0,dist.boolean)("hasLocalVideo",!1),localAudioLevel:(0,dist.select)("localAudioLevel",[0,.5,1],0),viewMode:(0,dist.select)("viewMode",[Calling.pC.Grid,Calling.pC.Presentation,Calling.pC.Speaker],Calling.pC.Grid),outgoingRing:(0,dist.boolean)("outgoingRing",!0),pip:(0,dist.boolean)("pip",!1),settingsDialogOpen:(0,dist.boolean)("settingsDialogOpen",!1),showParticipantsList:(0,dist.boolean)("showParticipantsList",!1)}},createProps=function(){var storyProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},storyProps,{availableCameras:[],acceptCall:(0,esm.action)("accept-call"),bounceAppIconStart:(0,esm.action)("bounce-app-icon-start"),bounceAppIconStop:(0,esm.action)("bounce-app-icon-stop"),cancelCall:(0,esm.action)("cancel-call"),closeNeedPermissionScreen:(0,esm.action)("close-need-permission-screen"),declineCall:(0,esm.action)("decline-call"),getGroupCallVideoFrameSource:function(_,demuxId){return(0,fakeGetGroupCallVideoFrameSource.x)(demuxId)},getPreferredBadge:function(){},getPresentingSources:(0,esm.action)("get-presenting-sources"),hangUpActiveCall:(0,esm.action)("hang-up-active-call"),i18n,isGroupCallOutboundRingEnabled:!0,keyChangeOk:(0,esm.action)("key-change-ok"),me:Object.assign({},(0,getDefaultConversation.E$)({color:(0,dist.select)("Caller color",Colors.sj,"ultramarine"),title:(0,dist.text)("Caller Title","Morty Smith")}),{uuid:"cb0dd0c8-7393-41e9-a0aa-d631c4109541"}),notifyForCall:(0,esm.action)("notify-for-call"),openSystemPreferencesAction:(0,esm.action)("open-system-preferences-action"),playRingtone:(0,esm.action)("play-ringtone"),renderDeviceSelection:function(){return(0,jsx_runtime.jsx)("div",{})},renderSafetyNumberViewer:function(_){return(0,jsx_runtime.jsx)("div",{})},setGroupCallVideoRequest:(0,esm.action)("set-group-call-video-request"),setIsCallActive:(0,esm.action)("set-is-call-active"),setLocalAudio:(0,esm.action)("set-local-audio"),setLocalPreview:(0,esm.action)("set-local-preview"),setLocalVideo:(0,esm.action)("set-local-video"),setPresenting:(0,esm.action)("toggle-presenting"),setRendererCanvas:(0,esm.action)("set-renderer-canvas"),setOutgoingRing:(0,esm.action)("set-outgoing-ring"),startCall:(0,esm.action)("start-call"),stopRingtone:(0,esm.action)("stop-ringtone"),switchToPresentationView:(0,esm.action)("switch-to-presentation-view"),switchFromPresentationView:(0,esm.action)("switch-from-presentation-view"),theme:Util.f8.light,toggleParticipants:(0,esm.action)("toggle-participants"),togglePip:(0,esm.action)("toggle-pip"),toggleScreenRecordingPermissionsDialog:(0,esm.action)("toggle-screen-recording-permissions-dialog"),toggleSettings:(0,esm.action)("toggle-settings"),toggleSpeakerView:(0,esm.action)("toggle-speaker-view"),isConversationTooBigToRing:!1,pauseVoiceNotePlayer:(0,esm.action)("pause-audio-player")})};const CallManager_stories={title:"Components/CallManager"};function NoCall(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps()))}function OngoingDirectCall(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({activeCall:Object.assign({},getCommonActiveCallData(),{callMode:Calling.L6.Direct,callState:Calling.OX.Accepted,peekedParticipants:[],remoteParticipants:[{hasRemoteVideo:!0,presenting:!1,title:"Remy"}]})})))}function OngoingGroupCall(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({activeCall:Object.assign({},getCommonActiveCallData(),{callMode:Calling.L6.Group,connectionState:Calling.mB.Connected,conversationsWithSafetyNumberChanges:[],deviceCount:0,joinState:Calling.GT.Joined,maxDevices:5,groupMembers:[],isConversationTooBigToRing:!1,peekedParticipants:[],remoteParticipants:[],remoteAudioLevels:new Map})})))}function RingingDirectCall(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({incomingCall:{callMode:Calling.L6.Direct,conversation:getConversation(),isVideoCall:!0}})))}function RingingGroupCall(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({incomingCall:{callMode:Calling.L6.Group,conversation:Object.assign({},getConversation(),{type:"group",title:"Tahoe Trip",acknowledgedGroupNameCollisions:{},storySendMode:Stories.vW.IfActive}),otherMembersRung:[{firstName:"Morty",title:"Morty Smith"},{firstName:"Summer",title:"Summer Smith"}],ringer:{firstName:"Rick",title:"Rick Sanchez"}}})))}function CallRequestNeeded(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({activeCall:Object.assign({},getCommonActiveCallData(),{callEndedReason:Calling.KQ.RemoteHangupNeedPermission,callMode:Calling.L6.Direct,callState:Calling.OX.Accepted,peekedParticipants:[],remoteParticipants:[{hasRemoteVideo:!0,presenting:!1,title:"Mike"}]})})))}function GroupCallSafetyNumberChanged(){return(0,jsx_runtime.jsx)(CallManager,Object.assign({},createProps({activeCall:Object.assign({},getCommonActiveCallData(),{callMode:Calling.L6.Group,connectionState:Calling.mB.Connected,conversationsWithSafetyNumberChanges:[Object.assign({},(0,getDefaultConversation.E$)({title:"Aaron"}))],deviceCount:0,joinState:Calling.GT.Joined,maxDevices:5,groupMembers:[],isConversationTooBigToRing:!1,peekedParticipants:[],remoteParticipants:[],remoteAudioLevels:new Map})})))}NoCall.displayName="NoCall",OngoingDirectCall.displayName="OngoingDirectCall",OngoingGroupCall.displayName="OngoingGroupCall",RingingDirectCall.displayName="RingingDirectCall",RingingDirectCall.story={name:"Ringing (direct call)"},RingingGroupCall.displayName="RingingGroupCall",RingingGroupCall.story={name:"Ringing (group call)"},CallRequestNeeded.displayName="CallRequestNeeded",GroupCallSafetyNumberChanged.displayName="GroupCallSafetyNumberChanged",GroupCallSafetyNumberChanged.story={name:"Group call - Safety Number Changed"};var __namedExportsOrder=["NoCall","OngoingDirectCall","OngoingGroupCall","RingingDirectCall","RingingGroupCall","CallRequestNeeded","GroupCallSafetyNumberChanged"]},"./ts/components/CallingLobby.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>CallingLobby});var react=__webpack_require__("./node_modules/react/index.js"),focus_trap_react=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),focus_trap_react_default=__webpack_require__.n(focus_trap_react),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),CallingButton=__webpack_require__("./ts/components/CallingButton.tsx"),Tooltip=__webpack_require__("./ts/components/Tooltip.tsx"),CallBackgroundBlur=__webpack_require__("./ts/components/CallBackgroundBlur.tsx"),CallingHeader=__webpack_require__("./ts/components/CallingHeader.tsx"),CallingToast=__webpack_require__("./ts/components/CallingToast.tsx"),CallingPreCallInfo=__webpack_require__("./ts/components/CallingPreCallInfo.tsx"),noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),Button=__webpack_require__("./ts/components/Button.tsx"),Spinner=__webpack_require__("./ts/components/Spinner.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var CallingLobbyJoinButtonVariant;function CallingLobbyJoinButton(_ref){var disabled=_ref.disabled,i18n=_ref.i18n,onClick=_ref.onClick,variant=_ref.variant,_useState2=_slicedToArray((0,react.useState)(),2),width=_useState2[0],setWidth=_useState2[1],_useState4=_slicedToArray((0,react.useState)(),2),height=_useState4[0],setHeight=_useState4[1],childrenByVariant={[CallingLobbyJoinButtonVariant.CallIsFull]:i18n("icu:calling__call-is-full"),[CallingLobbyJoinButtonVariant.Loading]:(0,jsx_runtime.jsx)(Spinner.$j,{svgSize:"small"}),[CallingLobbyJoinButtonVariant.Join]:i18n("icu:calling__join"),[CallingLobbyJoinButtonVariant.Start]:i18n("icu:calling__start")};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Boolean(width&&height)&&(0,jsx_runtime.jsx)(Button.zx,{className:"module-CallingLobbyJoinButton",disabled,onClick,style:{width,height},tabIndex:0,variant:Button.Wu.Calling,children:childrenByVariant[variant]}),(0,jsx_runtime.jsx)("div",{style:{visibility:"hidden",position:"fixed",left:-9999,top:-9999},children:Object.values(CallingLobbyJoinButtonVariant).map((function(candidateVariant){return(0,jsx_runtime.jsx)(Button.zx,{className:"module-CallingLobbyJoinButton",variant:Button.Wu.Calling,onClick:noop_default(),ref:function(button){if(button){var _button$getBoundingCl=button.getBoundingClientRect(),variantWidth=_button$getBoundingCl.width,variantHeight=_button$getBoundingCl.height;setWidth((function(){var previousWidth=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.ceil(Math.max(previousWidth,variantWidth+48))})),setHeight((function(){var previousHeight=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.ceil(Math.max(previousHeight,variantHeight+12))}))}},children:childrenByVariant[candidateVariant]},candidateVariant)}))})]})}function useIsOnline_slicedToArray(arr,i){return function useIsOnline_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useIsOnline_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useIsOnline_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useIsOnline_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useIsOnline_arrayLikeToArray(o,minLen)}(arr,i)||function useIsOnline_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useIsOnline_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(CallingLobbyJoinButtonVariant){CallingLobbyJoinButtonVariant.CallIsFull="CallIsFull",CallingLobbyJoinButtonVariant.Join="Join",CallingLobbyJoinButtonVariant.Loading="Loading",CallingLobbyJoinButtonVariant.Start="Start"}(CallingLobbyJoinButtonVariant||(CallingLobbyJoinButtonVariant={}));var keyboardLayout=__webpack_require__("./ts/services/keyboardLayout.ts");function CallingLobby_slicedToArray(arr,i){return function CallingLobby_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function CallingLobby_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function CallingLobby_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return CallingLobby_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CallingLobby_arrayLikeToArray(o,minLen)}(arr,i)||function CallingLobby_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CallingLobby_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CallingLobby(_ref){var availableCameras=_ref.availableCameras,conversation=_ref.conversation,groupMembers=_ref.groupMembers,hasLocalAudio=_ref.hasLocalAudio,hasLocalVideo=_ref.hasLocalVideo,i18n=_ref.i18n,_ref$isGroupCall=_ref.isGroupCall,isGroupCall=void 0!==_ref$isGroupCall&&_ref$isGroupCall,isGroupCallOutboundRingEnabled=_ref.isGroupCallOutboundRingEnabled,_ref$isCallFull=_ref.isCallFull,isCallFull=void 0!==_ref$isCallFull&&_ref$isCallFull,isConversationTooBigToRing=_ref.isConversationTooBigToRing,me=_ref.me,onCallCanceled=_ref.onCallCanceled,onJoinCall=_ref.onJoinCall,peekedParticipants=_ref.peekedParticipants,setLocalAudio=_ref.setLocalAudio,setLocalPreview=_ref.setLocalPreview,setLocalVideo=_ref.setLocalVideo,setOutgoingRing=_ref.setOutgoingRing,showParticipantsList=_ref.showParticipantsList,toggleParticipants=_ref.toggleParticipants,toggleSettings=_ref.toggleSettings,outgoingRing=_ref.outgoingRing,_React$useState2=CallingLobby_slicedToArray(react.useState(!hasLocalAudio),2),isMutedToastVisible=_React$useState2[0],setIsMutedToastVisible=_React$useState2[1];react.useEffect((function(){if(isMutedToastVisible){var timeout=setTimeout((function(){setIsMutedToastVisible(!1)}),CallingToast.q);return function(){clearTimeout(timeout)}}}),[isMutedToastVisible]);var localVideoRef=react.useRef(null),shouldShowLocalVideo=hasLocalVideo&&availableCameras.length>0,toggleAudio=react.useCallback((function(){setLocalAudio({enabled:!hasLocalAudio})}),[hasLocalAudio,setLocalAudio]),toggleVideo=react.useCallback((function(){setLocalVideo({enabled:!hasLocalVideo})}),[hasLocalVideo,setLocalVideo]),toggleOutgoingRing=react.useCallback((function(){setOutgoingRing(!outgoingRing)}),[outgoingRing,setOutgoingRing]);react.useEffect((function(){return setLocalPreview({element:localVideoRef}),function(){setLocalPreview({element:void 0})}}),[setLocalPreview]),react.useEffect((function(){function handleKeyDown(event){var eventHandled=!1,key=keyboardLayout.P(event);!event.shiftKey||"V"!==key&&"v"!==key?!event.shiftKey||"M"!==key&&"m"!==key||(toggleAudio(),eventHandled=!0):(toggleVideo(),eventHandled=!0),eventHandled&&(event.preventDefault(),event.stopPropagation())}return document.addEventListener("keydown",handleKeyDown),function(){document.removeEventListener("keydown",handleKeyDown)}}),[toggleVideo,toggleAudio]);var preCallInfoRingMode,ringButtonType,isOnline=function useIsOnline(){var _useState2=useIsOnline_slicedToArray((0,react.useState)(navigator.onLine),2),isOnline=_useState2[0],setIsOnline=_useState2[1];return(0,react.useEffect)((function(){var update=function(){setIsOnline(navigator.onLine)};return update(),window.addEventListener("offline",update),window.addEventListener("online",update),function(){window.removeEventListener("offline",update),window.removeEventListener("online",update)}}),[]),isOnline}(),_React$useState4=CallingLobby_slicedToArray(react.useState(!1),2),isCallConnecting=_React$useState4[0],setIsCallConnecting=_React$useState4[1],videoButtonType=hasLocalVideo?CallingButton.h.VIDEO_ON:0===availableCameras.length?CallingButton.h.VIDEO_DISABLED:CallingButton.h.VIDEO_OFF,audioButtonType=hasLocalAudio?CallingButton.h.AUDIO_ON:CallingButton.h.AUDIO_OFF,isRingButtonVisible=isGroupCall&&isGroupCallOutboundRingEnabled&&0===peekedParticipants.length&&(groupMembers||[]).length>1;preCallInfoRingMode=isGroupCall?outgoingRing&&!isConversationTooBigToRing?CallingPreCallInfo.A.WillRing:CallingPreCallInfo.A.WillNotRing:CallingPreCallInfo.A.WillRing,ringButtonType=isRingButtonVisible?isConversationTooBigToRing?CallingButton.h.RING_DISABLED:outgoingRing?CallingButton.h.RING_ON:CallingButton.h.RING_OFF:CallingButton.h.RING_DISABLED;var callingLobbyJoinButtonVariant,canJoin=!isCallFull&&!isCallConnecting&&isOnline;return callingLobbyJoinButtonVariant=isCallFull?CallingLobbyJoinButtonVariant.CallIsFull:isCallConnecting?CallingLobbyJoinButtonVariant.Loading:peekedParticipants.length?CallingLobbyJoinButtonVariant.Join:CallingLobbyJoinButtonVariant.Start,(0,jsx_runtime.jsx)(focus_trap_react_default(),{children:(0,jsx_runtime.jsxs)("div",{className:"module-calling__container",children:[shouldShowLocalVideo?(0,jsx_runtime.jsx)("video",{className:"module-CallingLobby__local-preview module-CallingLobby__local-preview--camera-is-on",ref:localVideoRef,autoPlay:!0}):(0,jsx_runtime.jsx)(CallBackgroundBlur.L,{className:"module-CallingLobby__local-preview module-CallingLobby__local-preview--camera-is-off",avatarPath:me.avatarPath,color:me.color}),(0,jsx_runtime.jsx)(CallingToast.o,{isVisible:isMutedToastVisible,onClick:function(){return setIsMutedToastVisible(!1)},children:i18n("icu:calling__lobby-automatically-muted-because-there-are-a-lot-of-people")}),(0,jsx_runtime.jsx)(CallingHeader.X,{i18n,isGroupCall,participantCount:peekedParticipants.length,showParticipantsList,toggleParticipants,toggleSettings,onCancel:onCallCanceled}),(0,jsx_runtime.jsx)(CallingPreCallInfo.e,{conversation,groupMembers,i18n,isCallFull,me,peekedParticipants,ringMode:preCallInfoRingMode}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-CallingLobby__camera-is-off","module-CallingLobby__camera-is-off--"+(shouldShowLocalVideo?"invisible":"visible")),children:i18n("icu:calling__your-video-is-off")}),(0,jsx_runtime.jsxs)("div",{className:"module-calling__buttons module-calling__buttons--inline",children:[(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:videoButtonType,i18n,onClick:toggleVideo,tooltipDirection:Tooltip.TQ.Top}),(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:audioButtonType,i18n,onClick:toggleAudio,tooltipDirection:Tooltip.TQ.Top}),(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:ringButtonType,i18n,isVisible:isRingButtonVisible,onClick:toggleOutgoingRing,tooltipDirection:Tooltip.TQ.Top})]}),(0,jsx_runtime.jsx)(CallingLobbyJoinButton,{disabled:!canJoin,i18n,onClick:function(){setIsCallConnecting(!0),onJoinCall()},variant:callingLobbyJoinButtonVariant})]})})}CallingLobby.displayName="CallingLobby"},"./ts/components/CallingParticipantsList.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{L:()=>CallingParticipantsList});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-dom/index.js"),focus_trap_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),focus_trap_react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(focus_trap_react__WEBPACK_IMPORTED_MODULE_2__),_Avatar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Avatar.tsx"),_conversation_ContactName__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/conversation/ContactName.tsx"),_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/InContactsIcon.tsx"),_util_sortByTitle__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/sortByTitle.ts"),_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/isInSystemContacts.ts"),_ModalHost__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/ModalHost.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var CallingParticipantsList=react__WEBPACK_IMPORTED_MODULE_0__.memo((function CallingParticipantsListInner(_ref){var _useContext,i18n=_ref.i18n,onClose=_ref.onClose,ourUuid=_ref.ourUuid,participants=_ref.participants,_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_0__.useState(null),2),root=_React$useState2[0],setRoot=_React$useState2[1],modalContainer=null!==(_useContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_ModalHost__WEBPACK_IMPORTED_MODULE_6__.p))&&void 0!==_useContext?_useContext:document.body,sortedParticipants=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return(0,_util_sortByTitle__WEBPACK_IMPORTED_MODULE_8__.m)(participants)}),[participants]);react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){var div=document.createElement("div");return modalContainer.appendChild(div),setRoot(div),function(){modalContainer.removeChild(div),setRoot(null)}}),[modalContainer]);var handleCancel=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(e){e.target===e.currentTarget&&onClose()}),[onClose]);return root?(0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(focus_trap_react__WEBPACK_IMPORTED_MODULE_2___default(),{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"module-calling-participants-list__overlay",onClick:handleCancel,role:"presentation",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:"module-calling-participants-list",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:"module-calling-participants-list__header",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:"module-calling-participants-list__title",children:[!participants.length&&i18n("icu:calling__in-this-call--zero"),1===participants.length&&i18n("icu:calling__in-this-call--one"),participants.length>1&&i18n("icu:calling__in-this-call--many",{people:String(participants.length)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("button",{type:"button",className:"module-calling-participants-list__close",onClick:onClose,tabIndex:0,"aria-label":i18n("icu:close")})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("ul",{className:"module-calling-participants-list__list",children:sortedParticipants.map((function(participant,index){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("li",{className:"module-calling-participants-list__contact",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_3__.qE,{acceptedMessageRequest:participant.acceptedMessageRequest,avatarPath:participant.avatarPath,badge:void 0,color:participant.color,conversationType:"direct",i18n,isMe:participant.isMe,profileName:participant.profileName,title:participant.title,sharedGroupNames:participant.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_3__.DZ.THIRTY_TWO}),ourUuid&&participant.uuid===ourUuid?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("span",{className:"module-calling-participants-list__name",children:i18n("icu:you")}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_conversation_ContactName__WEBPACK_IMPORTED_MODULE_4__.K,{module:"module-calling-participants-list__name",title:participant.title}),(0,_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_9__.H)(participant)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("span",{children:[" ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__.C,{className:"module-calling-participants-list__contact-icon",i18n})]}):null]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{children:[!1===participant.hasRemoteAudio?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("span",{className:"module-calling-participants-list__muted--audio"}):null,!1===participant.hasRemoteVideo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("span",{className:"module-calling-participants-list__muted--video"}):null,participant.presenting?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("span",{className:"module-calling-participants-list__presenting"}):null]})]},index)}))})]})})}),root):null}))},"./ts/components/CallingPip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{V:()=>CallingPip});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),debounce=__webpack_require__("./node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce),minBy=__webpack_require__("./node_modules/lodash/minBy.js"),minBy_default=__webpack_require__.n(minBy),react=__webpack_require__("./node_modules/react/index.js"),maxBy=__webpack_require__("./node_modules/lodash/maxBy.js"),maxBy_default=__webpack_require__.n(maxBy),clamp=__webpack_require__("./node_modules/lodash/clamp.js"),clamp_default=__webpack_require__.n(clamp),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),CallBackgroundBlur=__webpack_require__("./ts/components/CallBackgroundBlur.tsx"),DirectCallRemoteParticipant=__webpack_require__("./ts/components/DirectCallRemoteParticipant.tsx"),GroupCallRemoteParticipant=__webpack_require__("./ts/components/GroupCallRemoteParticipant.tsx"),Calling=__webpack_require__("./ts/types/Calling.ts"),Colors=__webpack_require__("./ts/types/Colors.ts"),useGetCallingFrameBuffer=__webpack_require__("./ts/calling/useGetCallingFrameBuffer.ts"),constants=__webpack_require__("./ts/calling/constants.ts"),usePageVisibility=__webpack_require__("./ts/hooks/usePageVisibility.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts"),nonRenderedRemoteParticipant=__webpack_require__("./ts/util/ringrtc/nonRenderedRemoteParticipant.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function NoVideo(_ref){var activeCall=_ref.activeCall,i18n=_ref.i18n,_activeCall$conversat=activeCall.conversation,acceptedMessageRequest=_activeCall$conversat.acceptedMessageRequest,avatarPath=_activeCall$conversat.avatarPath,color=_activeCall$conversat.color,isMe=_activeCall$conversat.isMe,phoneNumber=_activeCall$conversat.phoneNumber,profileName=_activeCall$conversat.profileName,sharedGroupNames=_activeCall$conversat.sharedGroupNames,title=_activeCall$conversat.title;return(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(CallBackgroundBlur.L,{avatarPath,color,children:(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--avatar",children:(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:color||Colors.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe,phoneNumber,profileName,title,size:Avatar.DZ.FORTY_EIGHT,sharedGroupNames})})})})}function CallingPipRemoteVideo(_ref2){var activeCall=_ref2.activeCall,getGroupCallVideoFrameSource=_ref2.getGroupCallVideoFrameSource,i18n=_ref2.i18n,setGroupCallVideoRequest=_ref2.setGroupCallVideoRequest,setRendererCanvas=_ref2.setRendererCanvas,conversation=activeCall.conversation,getGroupCallFrameBuffer=(0,useGetCallingFrameBuffer.b)(),isPageVisible=(0,usePageVisibility.d)(),activeGroupCallSpeaker=(0,react.useMemo)((function(){if(activeCall.callMode===Calling.L6.Group)return maxBy_default()(activeCall.remoteParticipants,(function(participant){return participant.presenting?1/0:participant.speakerTime||-1/0}))}),[activeCall.callMode,activeCall.remoteParticipants]);switch((0,react.useEffect)((function(){activeCall.callMode===Calling.L6.Group&&(isPageVisible?setGroupCallVideoRequest(activeCall.remoteParticipants.map((function(participant){return participant===activeGroupCallSpeaker?{demuxId:participant.demuxId,width:clamp_default()(Math.floor(120*participant.videoAspectRatio),1,constants.up),height:120}:(0,nonRenderedRemoteParticipant.M)(participant)})),120):setGroupCallVideoRequest(activeCall.remoteParticipants.map(nonRenderedRemoteParticipant.M),0))}),[activeCall.callMode,activeCall.remoteParticipants,activeGroupCallSpeaker,isPageVisible,setGroupCallVideoRequest]),activeCall.callMode){case Calling.L6.Direct:var hasRemoteVideo=activeCall.remoteParticipants[0].hasRemoteVideo;return hasRemoteVideo?(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(DirectCallRemoteParticipant.e,{conversation,hasRemoteVideo,i18n,setRendererCanvas})}):(0,jsx_runtime.jsx)(NoVideo,{activeCall,i18n});case Calling.L6.Group:return activeGroupCallSpeaker?(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(GroupCallRemoteParticipant.B,{getFrameBuffer:getGroupCallFrameBuffer,getGroupCallVideoFrameSource,i18n,isInPip:!0,remoteParticipant:activeGroupCallSpeaker,remoteParticipantsCount:activeCall.remoteParticipants.length,isActiveSpeakerInSpeakerView:!1})}):(0,jsx_runtime.jsx)(NoVideo,{activeCall,i18n});default:throw(0,missingCaseError.b)(activeCall)}}NoVideo.displayName="NoVideo";var PositionMode,useActivateSpeakerViewOnPresenting=__webpack_require__("./ts/hooks/useActivateSpeakerViewOnPresenting.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(PositionMode){PositionMode[PositionMode.BeingDragged=0]="BeingDragged",PositionMode[PositionMode.SnapToBottom=1]="SnapToBottom",PositionMode[PositionMode.SnapToLeft=2]="SnapToLeft",PositionMode[PositionMode.SnapToRight=3]="SnapToRight",PositionMode[PositionMode.SnapToTop=4]="SnapToTop"}(PositionMode||(PositionMode={}));function CallingPip(_ref){var activeCall=_ref.activeCall,getGroupCallVideoFrameSource=_ref.getGroupCallVideoFrameSource,hangUpActiveCall=_ref.hangUpActiveCall,hasLocalVideo=_ref.hasLocalVideo,i18n=_ref.i18n,setGroupCallVideoRequest=_ref.setGroupCallVideoRequest,setLocalPreview=_ref.setLocalPreview,setRendererCanvas=_ref.setRendererCanvas,switchToPresentationView=_ref.switchToPresentationView,switchFromPresentationView=_ref.switchFromPresentationView,togglePip=_ref.togglePip,videoContainerRef=react.useRef(null),localVideoRef=react.useRef(null),_React$useState2=_slicedToArray(react.useState(window.innerWidth),2),windowWidth=_React$useState2[0],setWindowWidth=_React$useState2[1],_React$useState4=_slicedToArray(react.useState(window.innerHeight),2),windowHeight=_React$useState4[0],setWindowHeight=_React$useState4[1],_React$useState6=_slicedToArray(react.useState({mode:PositionMode.SnapToRight,offsetY:56}),2),positionState=_React$useState6[0],setPositionState=_React$useState6[1];(0,useActivateSpeakerViewOnPresenting.G)({remoteParticipants:activeCall.remoteParticipants,switchToPresentationView,switchFromPresentationView}),react.useEffect((function(){setLocalPreview({element:localVideoRef})}),[setLocalPreview]);var hangUp=react.useCallback((function(){hangUpActiveCall("pip button click")}),[hangUpActiveCall]),handleMouseMove=react.useCallback((function(ev){positionState.mode===PositionMode.BeingDragged&&setPositionState((function(oldState){return Object.assign({},oldState,{mouseX:ev.clientX,mouseY:ev.clientY})}))}),[positionState]),handleMouseUp=react.useCallback((function(){if(positionState.mode===PositionMode.BeingDragged){var mouseX=positionState.mouseX,mouseY=positionState.mouseY,dragOffsetX=positionState.dragOffsetX,dragOffsetY=positionState.dragOffsetY,_window=window,innerHeight=_window.innerHeight,innerWidth=_window.innerWidth,offsetX=mouseX-dragOffsetX,offsetY=mouseY-dragOffsetY,snapCandidates=[{mode:PositionMode.SnapToLeft,distanceToEdge:offsetX},{mode:PositionMode.SnapToRight,distanceToEdge:innerWidth-(offsetX+120)},{mode:PositionMode.SnapToTop,distanceToEdge:offsetY-56},{mode:PositionMode.SnapToBottom,distanceToEdge:innerHeight-(offsetY+156)}],snapTo=minBy_default()(snapCandidates,(function(candidate){return candidate.distanceToEdge}))||snapCandidates[0];switch(snapTo.mode){case PositionMode.SnapToLeft:case PositionMode.SnapToRight:setPositionState({mode:snapTo.mode,offsetY});break;case PositionMode.SnapToTop:case PositionMode.SnapToBottom:setPositionState({mode:snapTo.mode,offsetX});break;default:throw(0,missingCaseError.b)(snapTo.mode)}}}),[positionState,setPositionState]);react.useEffect((function(){return positionState.mode===PositionMode.BeingDragged?(document.addEventListener("mousemove",handleMouseMove,!1),document.addEventListener("mouseup",handleMouseUp,!1),function(){document.removeEventListener("mouseup",handleMouseUp,!1),document.removeEventListener("mousemove",handleMouseMove,!1)}):noop_default()}),[positionState.mode,handleMouseMove,handleMouseUp]),react.useEffect((function(){var handleWindowResize=debounce_default()((function(){setWindowWidth(window.innerWidth),setWindowHeight(window.innerHeight)}),100,{maxWait:3e3});return window.addEventListener("resize",handleWindowResize,!1),function(){window.removeEventListener("resize",handleWindowResize,!1)}}),[]);var _React$useMemo2=_slicedToArray(react.useMemo((function(){switch(positionState.mode){case PositionMode.BeingDragged:return[positionState.mouseX-positionState.dragOffsetX,positionState.mouseY-positionState.dragOffsetY];case PositionMode.SnapToLeft:return[8,Math.min(positionState.offsetY,windowHeight-8-156)];case PositionMode.SnapToRight:return[windowWidth-8-120,Math.min(positionState.offsetY,windowHeight-8-156)];case PositionMode.SnapToTop:return[Math.min(positionState.offsetX,windowWidth-8-120),64];case PositionMode.SnapToBottom:return[Math.min(positionState.offsetX,windowWidth-8-120),windowHeight-8-156];default:throw(0,missingCaseError.b)(positionState)}}),[windowWidth,windowHeight,positionState]),2),translateX=_React$useMemo2[0],translateY=_React$useMemo2[1];return(0,jsx_runtime.jsxs)("div",{className:"module-calling-pip",onMouseDown:function(ev){var node=videoContainerRef.current;if(node){var rect=node.getBoundingClientRect(),dragOffsetX=ev.clientX-rect.left,dragOffsetY=ev.clientY-rect.top;setPositionState({mode:PositionMode.BeingDragged,mouseX:ev.clientX,mouseY:ev.clientY,dragOffsetX,dragOffsetY})}},ref:videoContainerRef,style:{cursor:positionState.mode===PositionMode.BeingDragged?"-webkit-grabbing":"-webkit-grab",transform:`translate3d(${translateX}px,calc(${translateY}px - var(--titlebar-height)), 0)`,transition:positionState.mode===PositionMode.BeingDragged?"none":"transform ease-out 300ms"},children:[(0,jsx_runtime.jsx)(CallingPipRemoteVideo,{activeCall,getGroupCallVideoFrameSource,i18n,setRendererCanvas,setGroupCallVideoRequest}),hasLocalVideo?(0,jsx_runtime.jsx)("video",{className:"module-calling-pip__video--local",ref:localVideoRef,autoPlay:!0}):null,(0,jsx_runtime.jsxs)("div",{className:"module-calling-pip__actions",children:[(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:calling__hangup"),className:"module-calling-pip__button--hangup",onClick:hangUp,type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:calling__pip--off"),className:"module-calling-pip__button--pip",onClick:togglePip,type:"button",children:(0,jsx_runtime.jsx)("div",{})})]})]})}CallingPip.displayName="CallingPip"},"./ts/components/CallingSelectPresentingSourcesModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{k:()=>CallingSelectPresentingSourcesModal});var lodash_groupBy__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/groupBy.js"),lodash_groupBy__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_groupBy__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),_Button__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Button.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/Modal.tsx"),_util_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/theme.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Source(_ref){var onSourceClick=_ref.onSourceClick,source=_ref.source,sourceToPresent=_ref.sourceToPresent;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("button",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()({"module-CallingSelectPresentingSourcesModal__source":!0,"module-CallingSelectPresentingSourcesModal__source--selected":(null==sourceToPresent?void 0:sourceToPresent.id)===source.id}),onClick:function(){onSourceClick({id:source.id,name:source.name})},type:"button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("img",{alt:source.name,className:"module-CallingSelectPresentingSourcesModal__name--screenshot",src:source.thumbnail}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"module-CallingSelectPresentingSourcesModal__name--container",children:[source.appIcon?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("img",{alt:source.name,className:"module-CallingSelectPresentingSourcesModal__name--icon",height:16,src:source.appIcon,width:16}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"module-CallingSelectPresentingSourcesModal__name--text",children:source.name})]})]},source.id)}function CallingSelectPresentingSourcesModal(_ref2){var _sources$true,_sources$false,i18n=_ref2.i18n,presentingSourcesAvailable=_ref2.presentingSourcesAvailable,setPresenting=_ref2.setPresenting,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),2),sourceToPresent=_useState2[0],setSourceToPresent=_useState2[1];if(!presentingSourcesAvailable.length)throw new Error("No sources available for presenting");var sources=lodash_groupBy__WEBPACK_IMPORTED_MODULE_0___default()(presentingSourcesAvailable,(function(source){return source.isScreen})),footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_3__.zx,{onClick:function(){return setPresenting()},variant:_Button__WEBPACK_IMPORTED_MODULE_3__.Wu.Secondary,children:i18n("icu:cancel")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_3__.zx,{disabled:!sourceToPresent,onClick:function(){return setPresenting(sourceToPresent)},children:i18n("icu:calling__SelectPresentingSourcesModal--confirm")})]});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_Modal__WEBPACK_IMPORTED_MODULE_4__.u_,{modalName:"CallingSelectPresentingSourcesModal",hasXButton:!0,i18n,moduleClassName:"module-CallingSelectPresentingSourcesModal",onClose:function(){setPresenting()},theme:_util_theme__WEBPACK_IMPORTED_MODULE_5__.Q.Dark,title:i18n("icu:calling__SelectPresentingSourcesModal--title"),modalFooter:footer,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-CallingSelectPresentingSourcesModal__title",children:i18n("icu:calling__SelectPresentingSourcesModal--entireScreen")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-CallingSelectPresentingSourcesModal__sources",children:(null!==(_sources$true=sources.true)&&void 0!==_sources$true?_sources$true:[]).map((function(source){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(Source,{onSourceClick:function(selectedSource){return setSourceToPresent(selectedSource)},source,sourceToPresent},source.id)}))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-CallingSelectPresentingSourcesModal__title",children:i18n("icu:calling__SelectPresentingSourcesModal--window")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-CallingSelectPresentingSourcesModal__sources",children:(null!==(_sources$false=sources.false)&&void 0!==_sources$false?_sources$false:[]).map((function(source){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(Source,{onSourceClick:function(selectedSource){return setSourceToPresent(selectedSource)},source,sourceToPresent},source.id)}))})]})}Source.displayName="Source",CallingSelectPresentingSourcesModal.displayName="CallingSelectPresentingSourcesModal"},"./ts/components/ContextMenu.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{x:()=>ContextMenu});var closeCurrentOpenContextMenu,lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),react_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-dom/index.js"),classnames__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_3__),react_popper__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react-popper/lib/esm/usePopper.js"),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/getClassNamesFor.ts"),_util_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/theme.ts"),_util_handleOutsideClick__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/util/handleOutsideClick.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function generateVirtualElement(x,y){return{getBoundingClientRect:function(){return new DOMRect(x,y)}}}function ContextMenu(_ref){var ariaLabel=_ref.ariaLabel,children=_ref.children,i18n=_ref.i18n,menuOptions=_ref.menuOptions,moduleClassName=_ref.moduleClassName,onClick=_ref.onClick,onMenuShowingChanged=_ref.onMenuShowingChanged,popperOptions=_ref.popperOptions,portalToRoot=_ref.portalToRoot,theme=_ref.theme,title=_ref.title,value=_ref.value,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),2),isMenuShowing=_useState2[0],setIsMenuShowing=_useState2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),2),focusedIndex=_useState4[0],setFocusedIndex=_useState4[1],_useState6=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),2),popperElement=_useState6[0],setPopperElement=_useState6[1],virtualElement=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(generateVirtualElement(0,0)),_useState8=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),2),referenceElement=_useState8[0],setReferenceElement=_useState8[1],_usePopper=(0,react_popper__WEBPACK_IMPORTED_MODULE_8__.D)(virtualElement.current,popperElement,Object.assign({placement:"top-start",strategy:"fixed"},popperOptions)),styles=_usePopper.styles,attributes=_usePopper.attributes;(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){onMenuShowingChanged&&onMenuShowingChanged(isMenuShowing)}),[isMenuShowing,onMenuShowingChanged]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){return isMenuShowing?(0,_util_handleOutsideClick__WEBPACK_IMPORTED_MODULE_6__.p)((function(){return setIsMenuShowing(!1),closeCurrentOpenContextMenu=void 0,!0}),{containerElements:[referenceElement,popperElement],name:"ContextMenu"}):lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}),[isMenuShowing,referenceElement,popperElement]);var _React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(null),2),portalNode=_React$useState2[0],setPortalNode=_React$useState2[1];(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){if(!portalToRoot||!isMenuShowing)return lodash_noop__WEBPACK_IMPORTED_MODULE_0___default();var div=document.createElement("div");return document.body.appendChild(div),setPortalNode(div),function(){document.body.removeChild(div)}}),[portalToRoot,isMenuShowing]);var _step,handleKeyDown=function(ev){if(("Enter"===ev.key||"Space"===ev.key)&&!isMenuShowing){var _closeCurrentOpenCont;if(null===(_closeCurrentOpenCont=closeCurrentOpenContextMenu)||void 0===_closeCurrentOpenCont||_closeCurrentOpenCont(),closeCurrentOpenContextMenu=function(){return setIsMenuShowing(!1)},referenceElement){var box=referenceElement.getBoundingClientRect();virtualElement.current=generateVirtualElement(box.x,box.y)}setIsMenuShowing(!0),setFocusedIndex(0),ev.preventDefault(),ev.stopPropagation()}if(isMenuShowing){if("ArrowDown"===ev.key||"Tab"===ev.key){var currFocusedIndex=focusedIndex||0,nextFocusedIndex=currFocusedIndex>=menuOptions.length-1?0:currFocusedIndex+1;setFocusedIndex(nextFocusedIndex),ev.stopPropagation(),ev.preventDefault()}if("ArrowUp"===ev.key){var _currFocusedIndex=focusedIndex||0,_nextFocusedIndex=0===_currFocusedIndex?menuOptions.length-1:_currFocusedIndex-1;setFocusedIndex(_nextFocusedIndex),ev.stopPropagation(),ev.preventDefault()}if("Enter"===ev.key){if(void 0!==focusedIndex){var focusedOption=menuOptions[focusedIndex];focusedOption.onClick(focusedOption.value)}setIsMenuShowing(!1),closeCurrentOpenContextMenu=void 0,ev.stopPropagation(),ev.preventDefault()}"Escape"===ev.key&&(setIsMenuShowing(!1),closeCurrentOpenContextMenu=void 0,ev.stopPropagation(),ev.preventDefault())}},handleClick=function(ev){var _closeCurrentOpenCont2;null===(_closeCurrentOpenCont2=closeCurrentOpenContextMenu)||void 0===_closeCurrentOpenCont2||_closeCurrentOpenCont2(),closeCurrentOpenContextMenu=function(){return setIsMenuShowing(!1)},virtualElement.current=generateVirtualElement(ev.clientX,ev.clientY),setIsMenuShowing(!0),ev.stopPropagation(),ev.preventDefault()},getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_4__.h)("ContextMenu",moduleClassName),optionElements=new Array,_loop=function(index,option){var previous=menuOptions[index-1];previous&&previous.group!==option.group&&optionElements.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:getClassName("__divider")},`${option.label}-divider`));optionElements.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("button",{"aria-label":option.label,className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(getClassName("__option"),focusedIndex===index?getClassName("__option--focused"):void 0),type:"button",onClick:function(ev){ev.preventDefault(),ev.stopPropagation(),option.onClick(option.value),setIsMenuShowing(!1),closeCurrentOpenContextMenu=void 0},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:getClassName("__option--container"),children:[option.icon&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(getClassName("__option--icon"),option.icon)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:getClassName("__option--title"),children:option.label}),option.description&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:getClassName("__option--description"),children:option.description})]})]}),void 0!==value&&void 0!==option.value&&value===option.value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:getClassName("__option--selected")}):null]},option.label))},_iterator=function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(menuOptions.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){var _ref3=_slicedToArray(_step.value,2);_loop(_ref3[0],_ref3[1])}}catch(err){_iterator.e(err)}finally{_iterator.f()}var menuNode=isMenuShowing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:theme?(0,_util_theme__WEBPACK_IMPORTED_MODULE_5__.j)(theme):void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",Object.assign({className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(getClassName("__popper"),1===menuOptions.length?getClassName("__popper--single-item"):void 0),ref:setPopperElement,style:styles.popper},attributes.popper,{children:[title&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:getClassName("__title"),children:title}),optionElements]}))}):void 0;return"function"==typeof children?children({openMenu:onClick||handleClick,onKeyDown:handleKeyDown,isMenuShowing,ref:setReferenceElement,menuNode}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(getClassName("__container"),theme?(0,_util_theme__WEBPACK_IMPORTED_MODULE_5__.j)(theme):void 0),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("button",{"aria-label":ariaLabel||i18n("icu:ContextMenu--button"),className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(getClassName("__button"),isMenuShowing?getClassName("__button--active"):void 0),onClick:onClick||handleClick,onContextMenu:handleClick,onKeyDown:handleKeyDown,ref:setReferenceElement,type:"button",children}),portalNode?(0,react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal)(menuNode,portalNode):menuNode]})}},"./ts/components/InContactsIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>InContactsIcon});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_Tooltip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Tooltip.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function InContactsIcon(props){var className=props.className,i18n=props.i18n,tooltipContainerRef=props.tooltipContainerRef;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Tooltip__WEBPACK_IMPORTED_MODULE_2__.u,{content:i18n("icu:contactInAddressBook"),popperModifiers:[{name:"preventOverflow",options:{boundary:(null==tooltipContainerRef?void 0:tooltipContainerRef.current)||void 0}}],children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{"aria-label":i18n("icu:contactInAddressBook"),className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-in-contacts-icon__icon",className),role:"img",tabIndex:0})})}InContactsIcon.displayName="InContactsIcon"},"./ts/components/IncomingCallBar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>IncomingCallBar});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_Avatar__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/Avatar.tsx"),_Tooltip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Tooltip.tsx"),_Intl__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Intl.tsx"),_util_theme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/theme.ts"),_util_callingGetParticipantName__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/util/callingGetParticipantName.ts"),_conversation_ContactName__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/conversation/ContactName.tsx"),_types_Colors__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/types/Colors.ts"),_types_Calling__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/types/Calling.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./ts/util/missingCaseError.ts"),_hooks_useKeyboardShortcuts__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/hooks/useKeyboardShortcuts.tsx"),_UserText__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CallButton(_ref){var classSuffix=_ref.classSuffix,onClick=_ref.onClick,tabIndex=_ref.tabIndex,tooltipContent=_ref.tooltipContent;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Tooltip__WEBPACK_IMPORTED_MODULE_2__.u,{content:tooltipContent,theme:_util_theme__WEBPACK_IMPORTED_MODULE_4__.Q.Dark,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("button",{"aria-label":tooltipContent,className:`IncomingCallBar__button IncomingCallBar__button--${classSuffix}`,onClick,tabIndex,type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{})})})}function GroupCallMessage(_ref2){var i18n=_ref2.i18n,otherMembersRung=_ref2.otherMembersRung,ringer=_ref2.ringer,_otherMembersRung$sli2=_slicedToArray(otherMembersRung.slice(0,2).map((function(member){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_9__.a,{text:(0,_util_callingGetParticipantName__WEBPACK_IMPORTED_MODULE_11__.y)(member)})})),2),first=_otherMembersRung$sli2[0],second=_otherMembersRung$sli2[1],ringerNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_9__.a,{text:(0,_util_callingGetParticipantName__WEBPACK_IMPORTED_MODULE_11__.y)(ringer)});switch(otherMembersRung.length){case 0:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_3__.R,{id:"icu:incomingGroupCall__ringing-you",i18n,components:{ringer:ringerNode}});case 1:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_3__.R,{id:"icu:incomingGroupCall__ringing-1-other",i18n,components:{ringer:ringerNode,otherMember:first}});case 2:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_3__.R,{id:"icu:incomingGroupCall__ringing-2-others",i18n,components:{ringer:ringerNode,first,second}});case 3:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_3__.R,{id:"icu:incomingGroupCall__ringing-3-others",i18n,components:{ringer:ringerNode,first,second}});default:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_3__.R,{id:"icu:incomingGroupCall__ringing-many",i18n,components:{ringer:ringerNode,first,second,remaining:otherMembersRung.length-2}})}}function IncomingCallBar(props){var isVideoCall,headerNode,messageNode,acceptCall=props.acceptCall,bounceAppIconStart=props.bounceAppIconStart,bounceAppIconStop=props.bounceAppIconStop,conversation=props.conversation,declineCall=props.declineCall,i18n=props.i18n,notifyForCall=props.notifyForCall,conversationId=conversation.id,acceptedMessageRequest=conversation.acceptedMessageRequest,avatarPath=conversation.avatarPath,color=conversation.color,isMe=conversation.isMe,phoneNumber=conversation.phoneNumber,profileName=conversation.profileName,sharedGroupNames=conversation.sharedGroupNames,title=conversation.title,conversationType=conversation.type;switch(props.callMode){case _types_Calling__WEBPACK_IMPORTED_MODULE_7__.L6.Direct:isVideoCall=props.isVideoCall,headerNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_conversation_ContactName__WEBPACK_IMPORTED_MODULE_5__.K,{title}),messageNode=i18n(isVideoCall?"icu:incomingVideoCall":"icu:incomingAudioCall");break;case _types_Calling__WEBPACK_IMPORTED_MODULE_7__.L6.Group:var otherMembersRung=props.otherMembersRung,ringer=props.ringer;isVideoCall=!0,headerNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_9__.a,{text:title}),messageNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(GroupCallMessage,{i18n,otherMembersRung,ringer});break;default:throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_12__.b)(props)}var initialTitleRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(title);(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){var initialTitle=initialTitleRef.current;notifyForCall(initialTitle,isVideoCall)}),[isVideoCall,notifyForCall]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){return bounceAppIconStart(),function(){bounceAppIconStop()}}),[bounceAppIconStart,bounceAppIconStop]);var acceptVideoCall=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){isVideoCall&&acceptCall({conversationId,asVideoCall:!0})}),[isVideoCall,acceptCall,conversationId]),acceptAudioCall=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){acceptCall({conversationId,asVideoCall:!1})}),[acceptCall,conversationId]),declineIncomingCall=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){declineCall({conversationId})}),[conversationId,declineCall]),incomingCallShortcuts=(0,_hooks_useKeyboardShortcuts__WEBPACK_IMPORTED_MODULE_8__.oN)(acceptAudioCall,acceptVideoCall,declineIncomingCall);return(0,_hooks_useKeyboardShortcuts__WEBPACK_IMPORTED_MODULE_8__.aL)(incomingCallShortcuts),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"IncomingCallBar__container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"IncomingCallBar__bar",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"IncomingCallBar__conversation",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"IncomingCallBar__conversation--avatar",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_1__.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:color||_types_Colors__WEBPACK_IMPORTED_MODULE_6__.sj[0],noteToSelf:!1,conversationType,i18n,isMe,phoneNumber,profileName,title,sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_1__.DZ.FORTY_EIGHT})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"IncomingCallBar__conversation--name",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"IncomingCallBar__conversation--name-header",children:headerNode}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{dir:"auto",className:"IncomingCallBar__conversation--message-text",children:messageNode})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"IncomingCallBar__actions",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(CallButton,{classSuffix:"decline",onClick:declineIncomingCall,tabIndex:0,tooltipContent:i18n("icu:declineCall")}),isVideoCall?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(CallButton,{classSuffix:"accept-video-as-audio",onClick:acceptAudioCall,tabIndex:0,tooltipContent:i18n("icu:acceptCallWithoutVideo")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(CallButton,{classSuffix:"accept-video",onClick:acceptVideoCall,tabIndex:0,tooltipContent:i18n("icu:acceptCall")})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(CallButton,{classSuffix:"accept-audio",onClick:acceptAudioCall,tabIndex:0,tooltipContent:i18n("icu:acceptCall")})]})]})})}CallButton.displayName="CallButton",IncomingCallBar.displayName="IncomingCallBar"},"./ts/components/SafetyNumberChangeDialog.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{m:()=>SafetyNumberChangeDialog});var SafetyNumberChangeSource,DialogState,lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),_Avatar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Avatar.tsx"),_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/InContactsIcon.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Modal.tsx"),_types_Util__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/types/Util.ts"),_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./ts/util/isInSystemContacts.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./ts/util/missingCaseError.ts"),_ContextMenu__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/components/ContextMenu.tsx"),_util_theme__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/theme.ts"),_util_isNotNil__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./ts/util/isNotNil.ts"),_types_Stories__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/types/Stories.ts"),_UserText__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SafetyNumberChangeDialog(_ref){var confirmText=_ref.confirmText,contacts=_ref.contacts,getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,onCancel=_ref.onCancel,onConfirm=_ref.onConfirm,removeFromStory=_ref.removeFromStory,renderSafetyNumber=_ref.renderSafetyNumber,theme=_ref.theme,totalCount=contacts.reduce((function(count,item){return count+item.contacts.length}),0),allVerified=contacts.every((function(item){return item.contacts.every((function(contact){return contact.isVerified}))})),_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(function getStartingDialogState(count){return 0===count?DialogState.ExplicitReviewComplete:function doesRequireExplicitReviewMode(count){return count>5}(count)?DialogState.ExplicitReviewNeeded:DialogState.StartingInReview}(totalCount)),2),dialogState=_React$useState2[0],setDialogState=_React$useState2[1],_React$useState4=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(void 0),2),selectedContact=_React$useState4[0],setSelectedContact=_React$useState4[1],cancelButtonRef=react__WEBPACK_IMPORTED_MODULE_1__.createRef();react__WEBPACK_IMPORTED_MODULE_1__.useEffect((function(){cancelButtonRef&&cancelButtonRef.current&&cancelButtonRef.current.focus()}),[cancelButtonRef,contacts]),react__WEBPACK_IMPORTED_MODULE_1__.useEffect((function(){dialogState!==DialogState.ExplicitReviewStep||0!==totalCount&&!allVerified||setDialogState(DialogState.ExplicitReviewComplete)}),[allVerified,dialogState,setDialogState,totalCount]);var _text,text,onClose=selectedContact?function(){setSelectedContact(void 0)}:onCancel;if(selectedContact)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_6__.u_,{modalName:"SafetyNumberChangeDialog",hasXButton:!0,i18n,onClose,children:renderSafetyNumber({contactID:selectedContact.id,onClose})});if(dialogState===DialogState.StartingInReview||dialogState===DialogState.ExplicitReviewStep)return _text=dialogState===DialogState.ExplicitReviewStep?i18n("icu:safetyNumberChangeDialog_done"):allVerified||0===totalCount?confirmText||i18n("icu:safetyNumberChangeDialog_send"):confirmText||i18n("icu:sendAnyway"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.reviewing",actions:[{action:function(){dialogState===DialogState.ExplicitReviewStep?setDialogState(DialogState.ExplicitReviewComplete):onConfirm()},text:_text,style:"affirmative"}],hasXButton:!0,i18n,moduleClassName:"module-SafetyNumberChangeDialog__confirm-dialog",noMouseClose:!0,onCancel:onClose,onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__shield-icon"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__title",children:i18n("icu:safetyNumberChanges")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__message",children:i18n("icu:safetyNumberChangeDialog__message")}),contacts.map((function(section){var _section$story;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactSection,{section,getPreferredBadge,i18n,removeFromStory,setSelectedContact,theme},(null===(_section$story=section.story)||void 0===_section$story?void 0:_section$story.name)||"default")}))]},"SafetyNumberChangeDialog.reviewing");if(dialogState===DialogState.ExplicitReviewNeeded)text=confirmText||i18n("icu:sendAnyway");else{if(dialogState!==DialogState.ExplicitReviewComplete)throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_13__.b)(dialogState);text=confirmText||i18n("icu:safetyNumberChangeDialog_send")}var actions=[{action:onConfirm,text,style:"affirmative"}];return dialogState===DialogState.ExplicitReviewNeeded&&actions.unshift({action:function(){return setDialogState(DialogState.ExplicitReviewStep)},text:i18n("icu:safetyNumberChangeDialog__review")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.manyContacts",actions,hasXButton:!0,i18n,moduleClassName:"module-SafetyNumberChangeDialog__confirm-dialog",noMouseClose:!0,noDefaultCancelButton:dialogState===DialogState.ExplicitReviewNeeded,onCancel:onClose,onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__shield-icon"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__title",children:i18n("icu:safetyNumberChanges")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("module-SafetyNumberChangeDialog__message",dialogState===DialogState.ExplicitReviewComplete?"module-SafetyNumberChangeDialog__message--narrow":void 0),children:dialogState===DialogState.ExplicitReviewNeeded?i18n("icu:safetyNumberChangeDialog__many-contacts",{count:totalCount}):i18n("icu:safetyNumberChangeDialog__post-review")})]},"SafetyNumberChangeDialog.manyContacts")}function ContactSection(_ref2){var section=_ref2.section,getPreferredBadge=_ref2.getPreferredBadge,i18n=_ref2.i18n,removeFromStory=_ref2.removeFromStory,setSelectedContact=_ref2.setSelectedContact,theme=_ref2.theme;if(0===section.contacts.length)return null;if(!section.story)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("ul",{className:"module-SafetyNumberChangeDialog__contacts",children:section.contacts.map((function(contact){var shouldShowNumber=Boolean(contact.name||contact.profileName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactRow,{contact,getPreferredBadge,i18n,removeFromStory,setSelectedContact,shouldShowNumber,theme},contact.id)}))});var distributionId=section.story.distributionId,uuids=section.contacts.map((function(contact){return contact.uuid})).filter(_util_isNotNil__WEBPACK_IMPORTED_MODULE_14__.D),sectionName=distributionId===_types_Stories__WEBPACK_IMPORTED_MODULE_10__.qn?i18n("icu:Stories__mine"):section.story.name;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__section",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__row__story-name",children:sectionName}),distributionId&&removeFromStory&&uuids.length>1&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(SectionButtonWithMenu,{ariaLabel:i18n("icu:safetyNumberChangeDialog__actions-story",{story:sectionName}),i18n,memberCount:uuids.length,storyName:sectionName,theme,removeFromStory:function(){removeFromStory(distributionId,uuids)}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("ul",{className:"module-SafetyNumberChangeDialog__contacts",children:section.contacts.map((function(contact){var shouldShowNumber=Boolean(contact.name||contact.profileName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactRow,{contact,distributionId,getPreferredBadge,i18n,removeFromStory,setSelectedContact,shouldShowNumber,theme},contact.id)}))})]})}function SectionButtonWithMenu(_ref3){var ariaLabel=_ref3.ariaLabel,i18n=_ref3.i18n,removeFromStory=_ref3.removeFromStory,storyName=_ref3.storyName,memberCount=_ref3.memberCount,theme=_ref3.theme,_React$useState6=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(!1),2),isConfirming=_React$useState6[0],setIsConfirming=_React$useState6[1];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ContextMenu__WEBPACK_IMPORTED_MODULE_8__.x,{ariaLabel,i18n,menuOptions:[{icon:"module-SafetyNumberChangeDialog__menu-icon--delete",label:i18n("icu:safetyNumberChangeDialog__remove-all"),onClick:function(){return setIsConfirming(!0)}}],moduleClassName:"module-SafetyNumberChangeDialog__row__chevron",theme:theme===_types_Util__WEBPACK_IMPORTED_MODULE_7__.f8.dark?_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Dark:_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Light}),isConfirming&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.confirm-remove-all",actions:[{action:function(){removeFromStory(),setIsConfirming(!1)},text:i18n("icu:safetyNumberChangeDialog__remove-all"),style:"affirmative"}],i18n,noMouseClose:!0,onCancel:function(){return setIsConfirming(!1)},onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:i18n("icu:safetyNumberChangeDialog__confirm-remove-all",{story:storyName,count:memberCount})},"SafetyNumberChangeDialog.confirm-remove-all")]})}function ContactRow(_ref4){var contact=_ref4.contact,distributionId=_ref4.distributionId,getPreferredBadge=_ref4.getPreferredBadge,i18n=_ref4.i18n,removeFromStory=_ref4.removeFromStory,setSelectedContact=_ref4.setSelectedContact,shouldShowNumber=_ref4.shouldShowNumber,theme=_ref4.theme,uuid=contact.uuid;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("li",{className:"module-SafetyNumberChangeDialog__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_3__.qE,{acceptedMessageRequest:contact.acceptedMessageRequest,avatarPath:contact.avatarPath,badge:getPreferredBadge(contact.badges),color:contact.color,conversationType:"direct",i18n,isMe:contact.isMe,phoneNumber:contact.phoneNumber,profileName:contact.profileName,theme,title:contact.title,sharedGroupNames:contact.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_3__.DZ.THIRTY_TWO,unblurredAvatarPath:contact.unblurredAvatarPath}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--wrapper",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--name",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_11__.a,{text:contact.title}),(0,_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_15__.H)(contact)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("span",{children:[" ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__.C,{i18n})]})]}),shouldShowNumber||contact.isVerified?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--subtitle",children:[shouldShowNumber&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:contact.phoneNumber}),shouldShowNumber&&contact.isVerified&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:" · "}),contact.isVerified&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:i18n("icu:verified")})]}):null]}),distributionId&&removeFromStory&&uuid?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(RowButtonWithMenu,{ariaLabel:i18n("icu:safetyNumberChangeDialog__actions-contact",{contact:contact.title}),i18n,theme,removeFromStory:function(){return removeFromStory(distributionId,[uuid])},verifyContact:function(){return setSelectedContact(contact)}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("button",{className:"module-SafetyNumberChangeDialog__row__view",onClick:function(){setSelectedContact(contact)},tabIndex:0,type:"button",children:i18n("icu:view")})]},contact.id)}function RowButtonWithMenu(_ref5){var ariaLabel=_ref5.ariaLabel,i18n=_ref5.i18n,removeFromStory=_ref5.removeFromStory,verifyContact=_ref5.verifyContact,theme=_ref5.theme;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ContextMenu__WEBPACK_IMPORTED_MODULE_8__.x,{ariaLabel,i18n,menuOptions:[{icon:"module-SafetyNumberChangeDialog__menu-icon--verify",label:i18n("icu:safetyNumberChangeDialog__verify-number"),onClick:verifyContact},{icon:"module-SafetyNumberChangeDialog__menu-icon--delete",label:i18n("icu:safetyNumberChangeDialog__remove"),onClick:removeFromStory}],moduleClassName:"module-SafetyNumberChangeDialog__row__chevron",theme:theme===_types_Util__WEBPACK_IMPORTED_MODULE_7__.f8.dark?_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Dark:_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Light})}!function(SafetyNumberChangeSource){SafetyNumberChangeSource.Calling="Calling",SafetyNumberChangeSource.MessageSend="MessageSend",SafetyNumberChangeSource.Story="Story"}(SafetyNumberChangeSource||(SafetyNumberChangeSource={})),function(DialogState){DialogState.StartingInReview="StartingInReview",DialogState.ExplicitReviewNeeded="ExplicitReviewNeeded",DialogState.ExplicitReviewStep="ExplicitReviewStep",DialogState.ExplicitReviewComplete="ExplicitReviewComplete"}(DialogState||(DialogState={})),SafetyNumberChangeDialog.displayName="SafetyNumberChangeDialog",ContactSection.displayName="ContactSection",ContactRow.displayName="ContactRow",RowButtonWithMenu.displayName="RowButtonWithMenu"},"./ts/util/isInSystemContacts.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>isInSystemContacts});var isInSystemContacts=function(_ref){var type=_ref.type,name=_ref.name,systemGivenName=_ref.systemGivenName,systemFamilyName=_ref.systemFamilyName;return!("direct"!==type&&"private"!==type||"string"!=typeof name&&"string"!=typeof systemGivenName&&"string"!=typeof systemFamilyName)}},"./ts/util/isNotNil.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function isNotNil(value){return null!=value}__webpack_require__.d(__webpack_exports__,{D:()=>isNotNil})},"./ts/util/sortByTitle.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function sortByTitle(arr){return _toConsumableArray(arr).sort((function(a,b){return a.title.localeCompare(b.title)}))}__webpack_require__.d(__webpack_exports__,{m:()=>sortByTitle})},"./node_modules/lodash/_baseLt.js":module=>{module.exports=function baseLt(value,other){return value<other}},"./node_modules/lodash/minBy.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseExtremum=__webpack_require__("./node_modules/lodash/_baseExtremum.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),baseLt=__webpack_require__("./node_modules/lodash/_baseLt.js");module.exports=function minBy(array,iteratee){return array&&array.length?baseExtremum(array,baseIteratee(iteratee,2),baseLt):void 0}}}]);