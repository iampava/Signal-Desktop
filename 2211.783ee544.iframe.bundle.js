(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[2211],{"./ts/components/Alert.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>Alert});__webpack_require__("./node_modules/react/index.js");var _Button__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/Button.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Modal.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Alert(_ref){var body=_ref.body,i18n=_ref.i18n,onClose=_ref.onClose,theme=_ref.theme,title=_ref.title;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_2__.u_,{i18n,modalFooter:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_1__.zx,{onClick:onClose,children:i18n("icu:Confirmation--confirm")}),modalName:"Alert",onClose,theme,title,children:body})}Alert.displayName="Alert"},"./ts/components/SendStoryModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>SendStoryModal});var SendStoryPage,lodash_sortBy__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/sortBy.js"),lodash_sortBy__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_sortBy__WEBPACK_IMPORTED_MODULE_0__),lodash_noop__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),_SearchInput__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/SearchInput.tsx"),_util_filterAndSortConversations__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/filterAndSortConversations.ts"),_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/StoriesSettingsModal.tsx"),_Alert__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Alert.tsx"),_Avatar__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/components/Avatar.tsx"),_Button__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/components/Button.tsx"),_Checkbox__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/components/Checkbox.tsx"),_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),_ContextMenu__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/components/ContextMenu.tsx"),_types_Stories__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./ts/types/Stories.ts"),_Modal__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./ts/components/Modal.tsx"),_StoryDistributionListName__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./ts/components/StoryDistributionListName.tsx"),_util_theme__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./ts/util/theme.ts"),_util_isNotNil__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./ts/util/isNotNil.ts"),_StoryImage__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./ts/components/StoryImage.tsx"),_hooks_useConfirmDiscard__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./ts/hooks/useConfirmDiscard.tsx"),_util_getStoryBackground__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./ts/util/getStoryBackground.ts"),_types_VisualAttachment__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./ts/types/VisualAttachment.ts"),_UserText__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(SendStoryPage){SendStoryPage.ChooseGroups="ChooseGroups",SendStoryPage.EditingDistributionList="EditingDistributionList",SendStoryPage.SendStory="SendStory",SendStoryPage.SetMyStoriesPrivacy="SetMyStoriesPrivacy"}(SendStoryPage||(SendStoryPage={}));var Page=Object.assign({},SendStoryPage,_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.T3);function getListMemberUuids(list,signalConnections){var memberUuids=list.members.map((function(_ref){return _ref.uuid})).filter(_util_isNotNil__WEBPACK_IMPORTED_MODULE_21__.D);if(list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn&&list.isBlockList){var excludeUuids=new Set(memberUuids);return signalConnections.map((function(conversation){return conversation.uuid})).filter(_util_isNotNil__WEBPACK_IMPORTED_MODULE_21__.D).filter((function(uuid){return!excludeUuids.has(uuid)}))}return memberUuids}function SendStoryModal(_ref2){var draftAttachment=_ref2.draftAttachment,candidateConversations=_ref2.candidateConversations,distributionLists=_ref2.distributionLists,getPreferredBadge=_ref2.getPreferredBadge,groupConversations=_ref2.groupConversations,groupStories=_ref2.groupStories,hasFirstStoryPostExperience=_ref2.hasFirstStoryPostExperience,i18n=_ref2.i18n,me=_ref2.me,ourConversationId=_ref2.ourConversationId,onClose=_ref2.onClose,onDeleteList=_ref2.onDeleteList,onDistributionListCreated=_ref2.onDistributionListCreated,onHideMyStoriesFrom=_ref2.onHideMyStoriesFrom,onRemoveMembers=_ref2.onRemoveMembers,onRepliesNReactionsChanged=_ref2.onRepliesNReactionsChanged,onSelectedStoryList=_ref2.onSelectedStoryList,onSend=_ref2.onSend,onViewersUpdated=_ref2.onViewersUpdated,setMyStoriesToAllSignalConnections=_ref2.setMyStoriesToAllSignalConnections,signalConnections=_ref2.signalConnections,toggleGroupsForStorySend=_ref2.toggleGroupsForStorySend,mostRecentActiveStoryTimestampByGroupOrDistributionList=_ref2.mostRecentActiveStoryTimestampByGroupOrDistributionList,toggleSignalConnectionsModal=_ref2.toggleSignalConnectionsModal,onMediaPlaybackStart=_ref2.onMediaPlaybackStart,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(Page.SendStory),2),page=_useState2[0],setPage=_useState2[1],_useConfirmDiscard2=_slicedToArray((0,_hooks_useConfirmDiscard__WEBPACK_IMPORTED_MODULE_17__.N)(i18n),2),confirmDiscardModal=_useConfirmDiscard2[0],confirmDiscardIf=_useConfirmDiscard2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(new Set),2),selectedListIds=_useState4[0],setSelectedListIds=_useState4[1],_useState6=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(new Set),2),selectedGroupIds=_useState6[0],setSelectedGroupIds=_useState6[1],selectedStoryNames=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)((function(){return distributionLists.filter((function(list){return selectedListIds.has(list.id)})).map((function(list){return list.name})).concat(groupStories.filter((function(group){return selectedGroupIds.has(group.id)})).map((function(group){return group.title})))}),[distributionLists,groupStories,selectedGroupIds,selectedListIds]),_useState8=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(""),2),searchTerm=_useState8[0],setSearchTerm=_useState8[1],_useState10=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)((0,_util_filterAndSortConversations__WEBPACK_IMPORTED_MODULE_4__.x)(groupConversations,searchTerm,void 0)),2),filteredConversations=_useState10[0],setFilteredConversations=_useState10[1],normalizedSearchTerm=searchTerm.trim();(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((function(){var timeout=setTimeout((function(){setFilteredConversations((0,_util_filterAndSortConversations__WEBPACK_IMPORTED_MODULE_4__.x)(groupConversations,normalizedSearchTerm,void 0))}),200);return function(){clearTimeout(timeout)}}),[groupConversations,normalizedSearchTerm,setFilteredConversations]);var _useState12=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(new Set),2),chosenGroupIds=_useState12[0],setChosenGroupIds=_useState12[1],chosenGroupNames=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)((function(){return filteredConversations.filter((function(group){return chosenGroupIds.has(group.id)})).map((function(group){return group.title}))}),[filteredConversations,chosenGroupIds]),_useState14=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)([]),2),selectedContacts=_useState14[0],setSelectedContacts=_useState14[1],_useState16=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(!1),2),hasAnnouncementsOnlyAlert=_useState16[0],setHasAnnouncementsOnlyAlert=_useState16[1],_useState18=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(),2),confirmRemoveGroupId=_useState18[0],setConfirmRemoveGroupId=_useState18[1],_useState20=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(),2),confirmDeleteList=_useState20[0],setConfirmDeleteList=_useState20[1],_useState22=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(),2),listIdToEdit=_useState22[0],setListIdToEdit=_useState22[1];(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((function(){setPage(listIdToEdit?Page.EditingDistributionList:Page.SendStory)}),[listIdToEdit]);var selectedNames,listToEdit=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)((function(){if(listIdToEdit)return distributionLists.find((function(list){return list.id===listIdToEdit}))}),[distributionLists,listIdToEdit]),ogMyStories=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)((function(){return distributionLists.find((function(list){return list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn}))}),[distributionLists]),initialMyStories=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)((function(){var _ogMyStories$isBlockL;return{allowsReplies:!0,id:_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn,name:i18n("icu:Stories__mine"),isBlockList:null===(_ogMyStories$isBlockL=null==ogMyStories?void 0:ogMyStories.isBlockList)||void 0===_ogMyStories$isBlockL||_ogMyStories$isBlockL,members:(null==ogMyStories?void 0:ogMyStories.members)||[]}}),[i18n,ogMyStories]),_useState24=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(initialMyStories),2),stagedMyStories=_useState24[0],setStagedMyStories=_useState24[1];selectedNames=page===Page.ChooseGroups?chosenGroupNames.join(", "):selectedStoryNames.map((function(listName){return(0,_types_Stories__WEBPACK_IMPORTED_MODULE_12__.HH)(i18n,listName,listName)})).join(", ");var _useState26=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(void 0),2),objectUrl=_useState26[0],setObjectUrl=_useState26[1];(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((function(){var url;return draftAttachment.url?setObjectUrl(draftAttachment.url):draftAttachment.data&&(url=(0,_types_VisualAttachment__WEBPACK_IMPORTED_MODULE_18__.UR)(draftAttachment.data,draftAttachment.contentType),setObjectUrl(url)),function(){url&&(0,_types_VisualAttachment__WEBPACK_IMPORTED_MODULE_18__.qg)(url)}}),[setObjectUrl,draftAttachment]);var modal,modalCommonProps={hasXButton:!0,i18n};if(page===Page.SetMyStoriesPrivacy){var footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_8__.zx,{onClick:function(){return setPage(Page.SendStory)},variant:_Button__WEBPACK_IMPORTED_MODULE_8__.Wu.Secondary,children:i18n("icu:cancel")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_8__.zx,{onClick:function(){var uuids=stagedMyStories.members.map((function(convo){return convo.uuid})).filter(_util_isNotNil__WEBPACK_IMPORTED_MODULE_21__.D);stagedMyStories.isBlockList?stagedMyStories.members.length?onHideMyStoriesFrom(uuids):setMyStoriesToAllSignalConnections():onViewersUpdated(_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn,uuids),setSelectedContacts([]),setPage(Page.SendStory)},variant:_Button__WEBPACK_IMPORTED_MODULE_8__.Wu.Primary,children:i18n("icu:save")})]})]});modal=function(handleClose){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_13__.P2,Object.assign({modalName:"SendStoryModal__my-stories-privacy",title:i18n("icu:SendStoryModal__my-stories-privacy"),modalFooter:footer,onClose:handleClose},modalCommonProps,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.zQ,{hasDisclaimerAbove:!0,i18n,kind:"privacy",myStories:stagedMyStories,signalConnectionsCount:signalConnections.length,onClickExclude:function(){var nextSelectedContacts=stagedMyStories.members;stagedMyStories.isBlockList||(setStagedMyStories((function(myStories){return Object.assign({},myStories,{isBlockList:!0,members:[]})})),nextSelectedContacts=[]),setSelectedContacts(nextSelectedContacts),setPage(Page.HideStoryFrom)},onClickOnlyShareWith:function(){stagedMyStories.isBlockList?setStagedMyStories((function(myStories){return Object.assign({},myStories,{isBlockList:!1,members:[]})})):setSelectedContacts(stagedMyStories.members),setPage(Page.AddViewer)},setSelectedContacts,setMyStoriesToAllSignalConnections:function(){setStagedMyStories((function(myStories){return Object.assign({},myStories,{isBlockList:!0,members:[]})})),setSelectedContacts([])},toggleSignalConnectionsModal})}))}}else if(page===Page.EditingDistributionList&&listToEdit)modal=function(handleClose){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.p1,{getPreferredBadge,i18n,listToEdit,signalConnectionsCount:signalConnections.length,onRemoveMembers,onRepliesNReactionsChanged,setConfirmDeleteList,setMyStoriesToAllSignalConnections,setPage,setSelectedContacts,toggleSignalConnectionsModal,onBackButtonClick:function(){return confirmDiscardIf(selectedContacts.length>0,(function(){return setListIdToEdit(void 0)}))},onClose:handleClose})};else if(page===Page.ChooseViewers||page===Page.NameStory||page===Page.AddViewer||page===Page.HideStoryFrom)modal=function(handleClose){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.lq,{candidateConversations,getPreferredBadge,i18n,onCreateList:async function(name,uuids){var newDistributionListId=await onDistributionListCreated(name,uuids);setSelectedContacts([]),setSelectedListIds((function(listIds){return new Set([].concat(_toConsumableArray(listIds),[newDistributionListId]))})),setPage(Page.SendStory)},onViewersUpdated:function(uuids){if(listIdToEdit&&page===Page.AddViewer)onViewersUpdated(listIdToEdit,uuids),setPage(Page.EditingDistributionList);else if(page===Page.ChooseViewers)setPage(Page.NameStory);else if(listIdToEdit&&page===Page.HideStoryFrom)onHideMyStoriesFrom(uuids),setPage(Page.SendStory);else if(page===Page.HideStoryFrom||page===Page.AddViewer){var uuidsSet=new Set(uuids),members=candidateConversations.filter((function(convo){return!!convo.uuid&&uuidsSet.has(convo.uuid)}));setStagedMyStories((function(myStories){return Object.assign({},myStories,{members})})),setPage(Page.SetMyStoriesPrivacy)}else setPage(Page.SendStory)},page,onClose:handleClose,onBackButtonClick:function(){return confirmDiscardIf(selectedContacts.length>0,(function(){listIdToEdit?page===Page.AddViewer||page===Page.HideStoryFrom||page===Page.ChooseViewers?setPage(Page.EditingDistributionList):setListIdToEdit(void 0):page===Page.HideStoryFrom||page===Page.AddViewer?(setSelectedContacts([]),setStagedMyStories(initialMyStories),setPage(Page.SetMyStoriesPrivacy)):page===Page.ChooseViewers?(setSelectedContacts([]),setPage(Page.SendStory)):page===Page.NameStory&&setPage(Page.ChooseViewers)}))},selectedContacts,setSelectedContacts})};else if(page===Page.ChooseGroups){var _footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__selected-lists",children:selectedNames}),selectedNames.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("button",{"aria-label":i18n("icu:ok"),className:"SendStoryModal__ok",disabled:!chosenGroupIds.size,onClick:async function(){await toggleGroupsForStorySend(Array.from(chosenGroupIds)),setChosenGroupIds(new Set),setSelectedGroupIds(chosenGroupIds),setPage(Page.SendStory)},type:"button"})]});modal=function(handleClose){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_Modal__WEBPACK_IMPORTED_MODULE_13__.P2,Object.assign({modalName:"SendStoryModal__choose-groups",title:i18n("icu:SendStoryModal__choose-groups"),moduleClassName:"SendStoryModal",modalFooter:_footer,onClose:handleClose},modalCommonProps,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_SearchInput__WEBPACK_IMPORTED_MODULE_3__.M,{disabled:0===groupConversations.length,i18n,placeholder:i18n("icu:contactSearchPlaceholder"),moduleClassName:"StoriesSettingsModal__search",onChange:function(event){setSearchTerm(event.target.value)},value:searchTerm}),filteredConversations.length?filteredConversations.map((function(group){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Checkbox__WEBPACK_IMPORTED_MODULE_9__.X,{checked:chosenGroupIds.has(group.id),label:group.title,moduleClassName:"SendStoryModal__distribution-list",name:"SendStoryModal__distribution-list",onChange:function(value){!group.announcementsOnly||group.areWeAdmin?setChosenGroupIds((function(groupIds){return value?groupIds.add(group.id):groupIds.delete(group.id),new Set(_toConsumableArray(groupIds))})):setHasAnnouncementsOnlyAlert(!0)},children:function(_ref3){var id=_ref3.id,checkboxNode=_ref3.checkboxNode;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("label",{className:"SendStoryModal__distribution-list__label",htmlFor:id,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_7__.qE,{acceptedMessageRequest:group.acceptedMessageRequest,avatarPath:group.avatarPath,badge:void 0,color:group.color,conversationType:group.type,i18n,isMe:!1,sharedGroupNames:[],size:_Avatar__WEBPACK_IMPORTED_MODULE_7__.DZ.THIRTY_TWO,title:group.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"SendStoryModal__distribution-list__info",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__distribution-list__name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_19__.a,{text:group.title})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__distribution-list__description",children:i18n("icu:ConversationHero--members",{count:group.membersCount})})]})]}),checkboxNode]})}},group.id)})):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"module-ForwardMessageModal__no-candidate-contacts",children:i18n("icu:noGroupsFound")})]}))}}else{var _footer2=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__selected-lists",children:selectedNames}),selectedNames.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("button",{"aria-label":i18n("icu:SendStoryModal__send"),className:"SendStoryModal__send",disabled:!selectedListIds.size&&!selectedGroupIds.size,onClick:function(){onSend(Array.from(selectedListIds),Array.from(selectedGroupIds))},type:"button"})]}),attachment=Object.assign({},draftAttachment,{url:objectUrl}),fullList=lodash_sortBy__WEBPACK_IMPORTED_MODULE_0___default()([].concat(_toConsumableArray(groupStories),_toConsumableArray(distributionLists)),(function(listOrGroup){var _mostRecentActiveStor;return listOrGroup.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn?Number.NEGATIVE_INFINITY:-1*(null!==(_mostRecentActiveStor=mostRecentActiveStoryTimestampByGroupOrDistributionList[listOrGroup.id])&&void 0!==_mostRecentActiveStor?_mostRecentActiveStor:0)}));modal=function(handleClose){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_Modal__WEBPACK_IMPORTED_MODULE_13__.P2,Object.assign({modalName:"SendStoryModal__title",title:i18n("icu:SendStoryModal__title"),moduleClassName:"SendStoryModal",modalFooter:_footer2,onClose:handleClose},modalCommonProps,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__story-preview",style:{backgroundImage:(0,_util_getStoryBackground__WEBPACK_IMPORTED_MODULE_22__.t_)(attachment)},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_StoryImage__WEBPACK_IMPORTED_MODULE_16__.s,{i18n,firstName:i18n("icu:you"),queueStoryDownload:lodash_noop__WEBPACK_IMPORTED_MODULE_1___default(),storyId:"story-id",label:"label",moduleClassName:"SendStoryModal__story",attachment,onMediaPlaybackStart})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"SendStoryModal__top-bar",children:[i18n("icu:stories"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ContextMenu__WEBPACK_IMPORTED_MODULE_11__.x,{"aria-label":i18n("icu:SendStoryModal__new"),i18n,menuOptions:[{label:i18n("icu:SendStoryModal__new-custom--title"),description:i18n("icu:SendStoryModal__new-custom--description"),icon:"SendStoryModal__icon--custom",onClick:function(){return setPage(Page.ChooseViewers)}},{label:i18n("icu:SendStoryModal__new-group--title"),description:i18n("icu:SendStoryModal__new-group--description"),icon:"SendStoryModal__icon--group",onClick:function(){return setPage(Page.ChooseGroups)}}],moduleClassName:"SendStoryModal__new-story",popperOptions:{placement:"bottom",strategy:"absolute"},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,children:function(_ref7){var openMenu=_ref7.openMenu,onKeyDown=_ref7.onKeyDown,ref=_ref7.ref,menuNode=_ref7.menuNode;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_8__.zx,{ref,className:"SendStoryModal__new-story__button",variant:_Button__WEBPACK_IMPORTED_MODULE_8__.Wu.Secondary,size:_Button__WEBPACK_IMPORTED_MODULE_8__.qE.Small,onClick:openMenu,onKeyDown,children:i18n("icu:SendStoryModal__new")}),menuNode]})}})]}),fullList.map((function(listOrGroup){return"type"in listOrGroup?(group=listOrGroup,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Checkbox__WEBPACK_IMPORTED_MODULE_9__.X,{checked:selectedGroupIds.has(group.id),label:group.title,moduleClassName:"SendStoryModal__distribution-list",name:"SendStoryModal__distribution-list",onChange:function(value){group.memberships&&(!group.announcementsOnly||group.areWeAdmin?(setSelectedGroupIds((function(groupIds){return value?groupIds.add(group.id):groupIds.delete(group.id),new Set(_toConsumableArray(groupIds))})),value&&onSelectedStoryList({conversationId:group.id,distributionId:void 0,uuids:group.memberships.map((function(_ref5){return _ref5.uuid}))})):setHasAnnouncementsOnlyAlert(!0))},children:function(_ref6){var id=_ref6.id,checkboxNode=_ref6.checkboxNode;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ContextMenu__WEBPACK_IMPORTED_MODULE_11__.x,{i18n,menuOptions:[{label:i18n("icu:SendStoryModal__delete-story"),icon:"SendStoryModal__icon--delete",onClick:function(){return setConfirmRemoveGroupId(group.id)}}],moduleClassName:"SendStoryModal__distribution-list-context",onClick:lodash_noop__WEBPACK_IMPORTED_MODULE_1___default(),popperOptions:{placement:"bottom",strategy:"absolute"},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("label",{className:"SendStoryModal__distribution-list__label",htmlFor:id,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_7__.qE,{acceptedMessageRequest:group.acceptedMessageRequest,avatarPath:group.avatarPath,badge:void 0,color:group.color,conversationType:group.type,i18n,isMe:!1,sharedGroupNames:[],size:_Avatar__WEBPACK_IMPORTED_MODULE_7__.DZ.THIRTY_TWO,storyRing:group.hasStories,title:group.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"SendStoryModal__distribution-list__info",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__distribution-list__name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_19__.a,{text:group.title})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"SendStoryModal__distribution-list__description",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:i18n("icu:SendStoryModal__group-story")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:" · "}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:i18n("icu:ConversationHero--members",{count:group.membersCount})})]})]})]}),checkboxNode]})}},group.id)):(list=listOrGroup,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Checkbox__WEBPACK_IMPORTED_MODULE_9__.X,{checked:selectedListIds.has(list.id),label:(0,_types_Stories__WEBPACK_IMPORTED_MODULE_12__.HH)(i18n,list.id,list.name),moduleClassName:"SendStoryModal__distribution-list",name:"SendStoryModal__distribution-list",onChange:function(value){list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn&&hasFirstStoryPostExperience&&value?setPage(Page.SetMyStoriesPrivacy):(setSelectedListIds((function(listIds){return value?listIds.add(list.id):listIds.delete(list.id),new Set(_toConsumableArray(listIds))})),value&&ourConversationId&&onSelectedStoryList({conversationId:ourConversationId,distributionId:list.id,uuids:getListMemberUuids(list,signalConnections)}))},children:function(_ref4){var id=_ref4.id,checkboxNode=_ref4.checkboxNode;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ContextMenu__WEBPACK_IMPORTED_MODULE_11__.x,{i18n,menuOptions:list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn?[{label:i18n("icu:StoriesSettings__context-menu"),icon:"SendStoryModal__icon--delete",onClick:function(){return setListIdToEdit(list.id)}}]:[{label:i18n("icu:StoriesSettings__context-menu"),icon:"SendStoryModal__icon--settings",onClick:function(){return setListIdToEdit(list.id)}},{label:i18n("icu:SendStoryModal__delete-story"),icon:"SendStoryModal__icon--delete",onClick:function(){return setConfirmDeleteList(list)}}],moduleClassName:"SendStoryModal__distribution-list-context",onClick:lodash_noop__WEBPACK_IMPORTED_MODULE_1___default(),popperOptions:{placement:"bottom",strategy:"absolute"},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("label",{className:"SendStoryModal__distribution-list__label",htmlFor:id,children:[list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_7__.qE,{acceptedMessageRequest:me.acceptedMessageRequest,avatarPath:me.avatarPath,badge:void 0,color:me.color,conversationType:me.type,i18n,isMe:!0,sharedGroupNames:me.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_7__.DZ.THIRTY_TWO,storyRing:void 0,title:me.title}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"StoriesSettingsModal__list__avatar--custom"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"SendStoryModal__distribution-list__info",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__distribution-list__name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_StoryDistributionListName__WEBPACK_IMPORTED_MODULE_14__.e,{i18n,id:list.id,name:list.name})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"SendStoryModal__distribution-list__description",children:hasFirstStoryPostExperience&&list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn?i18n("icu:SendStoryModal__choose-who-can-view"):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:list.id===_types_Stories__WEBPACK_IMPORTED_MODULE_12__.qn?(0,_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.Ac)(list,i18n):i18n("icu:SendStoryModal__custom-story")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:" · "}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span",{className:"SendStoryModal__rtl-span",children:list.isBlockList&&list.members.length>0?i18n("icu:SendStoryModal__excluded",{count:list.members.length}):(0,_StoriesSettingsModal__WEBPACK_IMPORTED_MODULE_5__.O7)(list,i18n,signalConnections)})]})})]})]}),checkboxNode]})}},list.id));var list,group}))]}))}}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.Fragment,{children:[!confirmDiscardModal&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_13__.wo,{modalName:"SendStoryModal",theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,onClose:function(){return confirmDiscardIf(selectedContacts.length>0,onClose)},children:modal}),hasAnnouncementsOnlyAlert&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_Alert__WEBPACK_IMPORTED_MODULE_6__.b,{body:i18n("icu:SendStoryModal__announcements-only"),i18n,onClose:function(){return setHasAnnouncementsOnlyAlert(!1)},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark}),confirmRemoveGroupId&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_10__.U,{dialogName:"SendStoryModal.confirmRemoveGroupId",actions:[{action:function(){toggleGroupsForStorySend([confirmRemoveGroupId]),setConfirmRemoveGroupId(void 0)},style:"negative",text:i18n("icu:delete")}],i18n,onClose:function(){setConfirmRemoveGroupId(void 0)},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,children:i18n("icu:SendStoryModal__confirm-remove-group")}),confirmDeleteList&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_10__.U,{dialogName:"SendStoryModal.confirmDeleteList",actions:[{action:function(){onDeleteList(confirmDeleteList.id),setConfirmDeleteList(void 0)},style:"negative",text:i18n("icu:delete")}],i18n,onClose:function(){setConfirmDeleteList(void 0)},theme:_util_theme__WEBPACK_IMPORTED_MODULE_15__.Q.Dark,children:i18n("icu:StoriesSettings__delete-list--confirm",{name:confirmDeleteList.name})}),confirmDiscardModal]})}},"./ts/components/StoryImage.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{s:()=>StoryImage});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_blurhash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-blurhash/es/index.js"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_TextAttachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/TextAttachment.tsx"),_types_Util__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/Util.ts"),_types_Attachment__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/types/Attachment.ts"),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/getClassNamesFor.ts"),_util_GoogleChrome__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/GoogleChrome.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function StoryImage(_ref){var _attachment$thumbnail,attachment=_ref.attachment,children=_ref.children,firstName=_ref.firstName,i18n=_ref.i18n,isMe=_ref.isMe,isMuted=_ref.isMuted,isPaused=_ref.isPaused,isThumbnail=_ref.isThumbnail,label=_ref.label,moduleClassName=_ref.moduleClassName,queueStoryDownload=_ref.queueStoryDownload,storyId=_ref.storyId,onMediaPlaybackStart=_ref.onMediaPlaybackStart,shouldDownloadAttachment=!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.TG)(attachment)&&!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.XN)(attachment)||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.AR)(attachment),_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),2),hasImgError=_useState2[0],setHasImgError=_useState2[1],videoRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);if((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){shouldDownloadAttachment&&queueStoryDownload(storyId)}),[queueStoryDownload,shouldDownloadAttachment,storyId]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){videoRef.current&&(isPaused?videoRef.current.pause():(onMediaPlaybackStart(),videoRef.current.play()))}),[isPaused,onMediaPlaybackStart]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){setHasImgError(!1)}),[null==attachment?void 0:attachment.url,null==attachment||null===(_attachment$thumbnail=attachment.thumbnail)||void 0===_attachment$thumbnail?void 0:_attachment$thumbnail.url]),!attachment)return null;var storyElement,overlay,hasError=hasImgError||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.uw)(attachment),isPending=Boolean(attachment.pending)&&!attachment.textAttachment&&!hasError,isNotReadyToShow=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.AR)(attachment)||isPending||hasError,isSupportedVideo=(0,_util_GoogleChrome__WEBPACK_IMPORTED_MODULE_8__.eq)(attachment.contentType),getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_7__.h)("StoryImage",moduleClassName);if(attachment.textAttachment)storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_TextAttachment__WEBPACK_IMPORTED_MODULE_4__.S,{i18n,isThumbnail,textAttachment:attachment.textAttachment});else if(isNotReadyToShow)storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:attachment.blurHash||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.d0)(_types_Util__WEBPACK_IMPORTED_MODULE_5__.f8.dark),height:attachment.height,width:attachment.width});else if(!isThumbnail&&isSupportedVideo){var shouldLoop=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.DQ)(attachment?[attachment]:void 0);storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("video",{autoPlay:!0,className:getClassName("__image"),controls:!1,loop:shouldLoop,muted:isMuted,ref:videoRef,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("source",{src:attachment.url})},attachment.url)}else storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("img",{alt:label,className:getClassName("__image"),onError:function(){return setHasImgError(!0)},src:isThumbnail&&attachment.thumbnail?attachment.thumbnail.url:attachment.url});if(isPending)overlay=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__overlay-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__spinner-bubble",title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{moduleClassName:"StoryImage__spinner",svgSize:"small"})})});else if(hasError){var content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__error"});isThumbnail||(content=isMe?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:i18n("icu:StoryImage__error--you")}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:i18n("icu:StoryImage__error2",{name:firstName})})),overlay=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__overlay-container",children:content})}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName(""),isThumbnail?getClassName("--thumbnail"):void 0),children:[storyElement,overlay,children]})}StoryImage.displayName="StoryImage"},"./ts/types/VisualAttachment.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{UR:()=>makeObjectUrl,pz:()=>getImageDimensions,qg:()=>revokeObjectUrl});__webpack_require__("./node_modules/blueimp-load-image/js/index.js");var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/errors.ts");__webpack_require__("./ts/types/MIME.ts"),__webpack_require__("./ts/util/assert.ts"),__webpack_require__("./ts/util/canvasToBlob.ts");function getImageDimensions(_ref){var objectUrl=_ref.objectUrl,logger=_ref.logger;return new Promise((function(resolve,reject){var image=document.createElement("img");image.addEventListener("load",(function(){resolve({height:image.naturalHeight,width:image.naturalWidth})})),image.addEventListener("error",(function(error){logger.error("getImageDimensions error",(0,_errors__WEBPACK_IMPORTED_MODULE_1__.G)(error)),reject(error)})),image.src=objectUrl}))}function makeObjectUrl(data,contentType){var blob=new Blob([data],{type:contentType});return URL.createObjectURL(blob)}function revokeObjectUrl(objectUrl){URL.revokeObjectURL(objectUrl)}},"./node_modules/lodash/_unescapeHtmlChar.js":(module,__unused_webpack_exports,__webpack_require__)=>{var unescapeHtmlChar=__webpack_require__("./node_modules/lodash/_basePropertyOf.js")({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});module.exports=unescapeHtmlChar},"./node_modules/lodash/unescape.js":(module,__unused_webpack_exports,__webpack_require__)=>{var toString=__webpack_require__("./node_modules/lodash/toString.js"),unescapeHtmlChar=__webpack_require__("./node_modules/lodash/_unescapeHtmlChar.js"),reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reHasEscapedHtml=RegExp(reEscapedHtml.source);module.exports=function unescape(string){return(string=toString(string))&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}},"./node_modules/react-textarea-autosize/dist/react-textarea-autosize.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _extends(){return _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}__webpack_require__.d(__webpack_exports__,{Z:()=>react_textarea_autosize_browser_esm});var react=__webpack_require__("./node_modules/react/index.js");const use_isomorphic_layout_effect_browser_esm=react.useLayoutEffect;var updateRef=function updateRef(ref,value){"function"!=typeof ref?ref.current=value:ref(value)};const use_composed_ref_esm=function useComposedRef(libRef,userRef){var prevUserRef=(0,react.useRef)();return(0,react.useCallback)((function(instance){libRef.current=instance,prevUserRef.current&&updateRef(prevUserRef.current,null),prevUserRef.current=userRef,userRef&&updateRef(userRef,instance)}),[userRef])};var HIDDEN_TEXTAREA_STYLE={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},forceHiddenStyles=function forceHiddenStyles(node){Object.keys(HIDDEN_TEXTAREA_STYLE).forEach((function(key){node.style.setProperty(key,HIDDEN_TEXTAREA_STYLE[key],"important")}))},hiddenTextarea=null;var noop=function noop(){},SIZING_STYLE=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],isIE=!!document.documentElement.currentStyle,useWindowResizeListener=function useWindowResizeListener(listener){var latestListener=function useLatest(value){var ref=react.useRef(value);return use_isomorphic_layout_effect_browser_esm((function(){ref.current=value})),ref}(listener);(0,react.useLayoutEffect)((function(){var handler=function handler(event){latestListener.current(event)};return window.addEventListener("resize",handler),function(){window.removeEventListener("resize",handler)}}),[])},TextareaAutosize=function TextareaAutosize(_ref,userRef){var cacheMeasurements=_ref.cacheMeasurements,maxRows=_ref.maxRows,minRows=_ref.minRows,_ref$onChange=_ref.onChange,onChange=void 0===_ref$onChange?noop:_ref$onChange,_ref$onHeightChange=_ref.onHeightChange,onHeightChange=void 0===_ref$onHeightChange?noop:_ref$onHeightChange,props=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(_ref,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var isControlled=void 0!==props.value,libRef=(0,react.useRef)(null),ref=use_composed_ref_esm(libRef,userRef),heightRef=(0,react.useRef)(0),measurementsCacheRef=(0,react.useRef)(),resizeTextarea=function resizeTextarea(){var node=libRef.current,nodeSizingData=cacheMeasurements&&measurementsCacheRef.current?measurementsCacheRef.current:function getSizingData(node){var style=window.getComputedStyle(node);if(null===style)return null;var sizingStyle=function pick(props,obj){return props.reduce((function(acc,prop){return acc[prop]=obj[prop],acc}),{})}(SIZING_STYLE,style),boxSizing=sizingStyle.boxSizing;return""===boxSizing?null:(isIE&&"border-box"===boxSizing&&(sizingStyle.width=parseFloat(sizingStyle.width)+parseFloat(sizingStyle.borderRightWidth)+parseFloat(sizingStyle.borderLeftWidth)+parseFloat(sizingStyle.paddingRight)+parseFloat(sizingStyle.paddingLeft)+"px"),{sizingStyle,paddingSize:parseFloat(sizingStyle.paddingBottom)+parseFloat(sizingStyle.paddingTop),borderSize:parseFloat(sizingStyle.borderBottomWidth)+parseFloat(sizingStyle.borderTopWidth)})}(node);if(nodeSizingData){measurementsCacheRef.current=nodeSizingData;var _calculateNodeHeight=function calculateNodeHeight(sizingData,value,minRows,maxRows){void 0===minRows&&(minRows=1),void 0===maxRows&&(maxRows=1/0),hiddenTextarea||((hiddenTextarea=document.createElement("textarea")).setAttribute("tabindex","-1"),hiddenTextarea.setAttribute("aria-hidden","true"),forceHiddenStyles(hiddenTextarea)),null===hiddenTextarea.parentNode&&document.body.appendChild(hiddenTextarea);var paddingSize=sizingData.paddingSize,borderSize=sizingData.borderSize,sizingStyle=sizingData.sizingStyle,boxSizing=sizingStyle.boxSizing;Object.keys(sizingStyle).forEach((function(_key){var key=_key;hiddenTextarea.style[key]=sizingStyle[key]})),forceHiddenStyles(hiddenTextarea),hiddenTextarea.value=value;var height=function getHeight(node,sizingData){var height=node.scrollHeight;return"border-box"===sizingData.sizingStyle.boxSizing?height+sizingData.borderSize:height-sizingData.paddingSize}(hiddenTextarea,sizingData);hiddenTextarea.value="x";var rowHeight=hiddenTextarea.scrollHeight-paddingSize,minHeight=rowHeight*minRows;"border-box"===boxSizing&&(minHeight=minHeight+paddingSize+borderSize),height=Math.max(minHeight,height);var maxHeight=rowHeight*maxRows;return"border-box"===boxSizing&&(maxHeight=maxHeight+paddingSize+borderSize),[height=Math.min(maxHeight,height),rowHeight]}(nodeSizingData,node.value||node.placeholder||"x",minRows,maxRows),height=_calculateNodeHeight[0],rowHeight=_calculateNodeHeight[1];heightRef.current!==height&&(heightRef.current=height,node.style.setProperty("height",height+"px","important"),onHeightChange(height,{rowHeight}))}};return(0,react.useLayoutEffect)(resizeTextarea),useWindowResizeListener(resizeTextarea),(0,react.createElement)("textarea",_extends({},props,{onChange:function handleChange(event){isControlled||resizeTextarea(),onChange(event)},ref}))};const react_textarea_autosize_browser_esm=(0,react.forwardRef)(TextareaAutosize)}}]);