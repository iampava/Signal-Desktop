"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[221],{"./ts/components/StoryCreator.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,FirstTime:()=>FirstTime,LinkPreview:()=>StoryCreator_stories_LinkPreview,Sending:()=>Sending,__namedExportsOrder:()=>__namedExportsOrder,default:()=>StoryCreator_stories});var LinkPreviewApplied,TextStyle,TextBackground,react=__webpack_require__("./node_modules/react/index.js"),messages=__webpack_require__("./_locales/en/messages.json"),has=__webpack_require__("./node_modules/lodash/has.js"),has_default=__webpack_require__.n(has),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),MIME=__webpack_require__("./ts/types/MIME.ts"),Attachment=__webpack_require__("./ts/types/Attachment.ts"),SendStoryModal=__webpack_require__("./ts/components/SendStoryModal.tsx"),MediaEditor=__webpack_require__("./ts/components/MediaEditor.tsx"),noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),focus_trap_react=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),focus_trap_react_default=__webpack_require__.n(focus_trap_react),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),usePopper=__webpack_require__("./node_modules/react-popper/lib/esm/usePopper.js"),Button=__webpack_require__("./ts/components/Button.tsx"),ContextMenu=__webpack_require__("./ts/components/ContextMenu.tsx"),EmojiButton=__webpack_require__("./ts/components/emoji/EmojiButton.tsx"),LinkPreview=__webpack_require__("./ts/types/LinkPreview.ts"),Input=__webpack_require__("./ts/components/Input.tsx"),Slider=__webpack_require__("./ts/components/Slider.tsx"),StoryLinkPreview=__webpack_require__("./ts/components/StoryLinkPreview.tsx"),TextAttachment=__webpack_require__("./ts/components/TextAttachment.tsx"),theme=__webpack_require__("./ts/util/theme.ts"),color=__webpack_require__("./ts/mediaEditor/util/color.ts"),getStoryBackground=__webpack_require__("./ts/util/getStoryBackground.ts"),lib=__webpack_require__("./ts/components/emoji/lib.ts"),objectMap=__webpack_require__("./ts/util/objectMap.ts"),handleOutsideClick=__webpack_require__("./ts/util/handleOutsideClick.ts"),ConfirmDiscardDialog=__webpack_require__("./ts/components/ConfirmDiscardDialog.tsx"),Spinner=__webpack_require__("./ts/components/Spinner.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(LinkPreviewApplied){LinkPreviewApplied.None="None",LinkPreviewApplied.Automatic="Automatic",LinkPreviewApplied.Manual="Manual"}(LinkPreviewApplied||(LinkPreviewApplied={})),function(TextStyle){TextStyle[TextStyle.Default=0]="Default",TextStyle[TextStyle.Regular=1]="Regular",TextStyle[TextStyle.Bold=2]="Bold",TextStyle[TextStyle.Serif=3]="Serif",TextStyle[TextStyle.Script=4]="Script",TextStyle[TextStyle.Condensed=5]="Condensed"}(TextStyle||(TextStyle={})),function(TextBackground){TextBackground[TextBackground.None=0]="None",TextBackground[TextBackground.Background=1]="Background",TextBackground[TextBackground.Inverse=2]="Inverse"}(TextBackground||(TextBackground={}));var BackgroundStyle={BG1:{color:4285041620},BG2:{color:4287006657},BG3:{color:4290019212},BG4:{color:4287205768},BG5:{color:4283667331},BG6:{angle:180,startColor:4279871994,endColor:4294951785},BG7:{angle:180,startColor:4282660824,endColor:4294938254},BG8:{angle:180,startColor:4278206532,endColor:4287871076}};function getBackground(bgStyle){return has_default()(bgStyle,"color")?{color:get_default()(bgStyle,"color")}:{gradient:{angle:get_default()(bgStyle,"angle"),startColor:get_default()(bgStyle,"startColor"),endColor:get_default()(bgStyle,"endColor")}}}function getBgButtonAriaLabel(i18n,textBackground){return textBackground===TextBackground.Background?i18n("icu:StoryCreator__text-bg--background"):textBackground===TextBackground.Inverse?i18n("icu:StoryCreator__text-bg--inverse"):i18n("icu:StoryCreator__text-bg--none")}function TextStoryCreator(_ref){var debouncedMaybeGrabLinkPreview=_ref.debouncedMaybeGrabLinkPreview,i18n=_ref.i18n,isSending=_ref.isSending,linkPreview=_ref.linkPreview,onClose=_ref.onClose,onDone=_ref.onDone,onSetSkinTone=_ref.onSetSkinTone,onUseEmoji=_ref.onUseEmoji,recentEmojis=_ref.recentEmojis,skinTone=_ref.skinTone,_useState2=_slicedToArray((0,react.useState)(!1),2),showConfirmDiscardModal=_useState2[0],setShowConfirmDiscardModal=_useState2[1],onTryClose=(0,react.useCallback)((function(){setShowConfirmDiscardModal(!0)}),[setShowConfirmDiscardModal]),_useState4=_slicedToArray((0,react.useState)(!1),2),isEditingText=_useState4[0],setIsEditingText=_useState4[1],_useState6=_slicedToArray((0,react.useState)(BackgroundStyle.BG1),2),selectedBackground=_useState6[0],setSelectedBackground=_useState6[1],_useState8=_slicedToArray((0,react.useState)(TextStyle.Regular),2),textStyle=_useState8[0],setTextStyle=_useState8[1],_useState10=_slicedToArray((0,react.useState)(TextBackground.None),2),textBackground=_useState10[0],setTextBackground=_useState10[1],_useState12=_slicedToArray((0,react.useState)(100),2),sliderValue=_useState12[0],setSliderValue=_useState12[1],_useState14=_slicedToArray((0,react.useState)(""),2),text=_useState14[0],setText=_useState14[1],_useState16=_slicedToArray((0,react.useState)(!1),2),isColorPickerShowing=_useState16[0],setIsColorPickerShowing=_useState16[1],_useState18=_slicedToArray((0,react.useState)(null),2),colorPickerPopperButtonRef=_useState18[0],setColorPickerPopperButtonRef=_useState18[1],_useState20=_slicedToArray((0,react.useState)(null),2),colorPickerPopperRef=_useState20[0],setColorPickerPopperRef=_useState20[1],colorPickerPopper=(0,usePopper.D)(colorPickerPopperButtonRef,colorPickerPopperRef,{modifiers:[{name:"arrow"}],placement:"top",strategy:"fixed"}),_useState22=_slicedToArray((0,react.useState)(LinkPreviewApplied.None),2),linkPreviewApplied=_useState22[0],setLinkPreviewApplied=_useState22[1],hasLinkPreviewApplied=linkPreviewApplied!==LinkPreviewApplied.None,_useState24=_slicedToArray((0,react.useState)(""),2),linkPreviewInputValue=_useState24[0],setLinkPreviewInputValue=_useState24[1];(0,react.useEffect)((function(){linkPreviewInputValue&&linkPreviewApplied!==LinkPreviewApplied.Manual&&debouncedMaybeGrabLinkPreview(linkPreviewInputValue,LinkPreview.hH.StoryCreator,{mode:"story"})}),[debouncedMaybeGrabLinkPreview,linkPreviewApplied,linkPreviewInputValue]),(0,react.useEffect)((function(){text&&linkPreviewApplied!==LinkPreviewApplied.Manual&&debouncedMaybeGrabLinkPreview(text,LinkPreview.hH.StoryCreator)}),[debouncedMaybeGrabLinkPreview,linkPreviewApplied,text]),(0,react.useEffect)((function(){if(linkPreview&&text){var shouldApplyLinkPreview=(0,LinkPreview.rq)(text).includes(linkPreview.url);setLinkPreviewApplied((function(oldValue){return oldValue===LinkPreviewApplied.Manual?oldValue:shouldApplyLinkPreview?LinkPreviewApplied.Automatic:LinkPreviewApplied.None}))}}),[linkPreview,text]);var _useState26=_slicedToArray((0,react.useState)(!1),2),isLinkPreviewInputShowing=_useState26[0],setIsLinkPreviewInputShowing=_useState26[1],_useState28=_slicedToArray((0,react.useState)(null),2),linkPreviewInputPopperButtonRef=_useState28[0],setLinkPreviewInputPopperButtonRef=_useState28[1],_useState30=_slicedToArray((0,react.useState)(null),2),linkPreviewInputPopperRef=_useState30[0],setLinkPreviewInputPopperRef=_useState30[1],linkPreviewInputPopper=(0,usePopper.D)(linkPreviewInputPopperButtonRef,linkPreviewInputPopperRef,{modifiers:[{name:"arrow"}],placement:"top",strategy:"fixed"});(0,react.useEffect)((function(){var handleEscape=function(event){"Escape"===event.key&&(isColorPickerShowing||isEditingText||isLinkPreviewInputShowing?(setIsColorPickerShowing(!1),setIsEditingText(!1),setIsLinkPreviewInputShowing(!1)):onTryClose(),event.preventDefault(),event.stopPropagation())};return document.addEventListener("keydown",handleEscape,true),function(){document.removeEventListener("keydown",handleEscape,true)}}),[isColorPickerShowing,isEditingText,isLinkPreviewInputShowing,colorPickerPopperButtonRef,showConfirmDiscardModal,setShowConfirmDiscardModal,onTryClose]),(0,react.useEffect)((function(){return isColorPickerShowing?(0,handleOutsideClick.p)((function(){return setIsColorPickerShowing(!1),!0}),{containerElements:[colorPickerPopperRef,colorPickerPopperButtonRef],name:"TextStoryCreator.colorPicker"}):noop_default()}),[isColorPickerShowing,colorPickerPopperRef,colorPickerPopperButtonRef]);var textBackgroundColor,sliderColorNumber=(0,color.Wb)(sliderValue),textForegroundColor=sliderColorNumber;textBackground===TextBackground.Background?(textBackgroundColor=getStoryBackground.Pl,textForegroundColor=sliderValue>=95?getStoryBackground.p6:sliderColorNumber):textBackground===TextBackground.Inverse&&(textBackgroundColor=sliderValue>=95?getStoryBackground.p6:sliderColorNumber,textForegroundColor=getStoryBackground.Pl);var textAttachment=Object.assign({},getBackground(selectedBackground),{text,textStyle,textForegroundColor,textBackgroundColor,preview:hasLinkPreviewApplied?linkPreview:void 0}),hasChanges=Boolean(text||hasLinkPreviewApplied),textEditorRef=(0,react.useRef)(null);return(0,jsx_runtime.jsx)(focus_trap_react_default(),{focusTrapOptions:{allowOutsideClick:!0},children:(0,jsx_runtime.jsxs)("div",{className:"StoryCreator",children:[(0,jsx_runtime.jsx)("div",{className:"StoryCreator__container",children:(0,jsx_runtime.jsx)(TextAttachment.S,{disableLinkPreviewPopup:!0,i18n,isEditingText,onChange:setText,onClick:function(){isEditingText||setIsEditingText(!0)},onRemoveLinkPreview:function(){setLinkPreviewApplied(LinkPreviewApplied.None)},ref:textEditorRef,textAttachment})}),(0,jsx_runtime.jsxs)("div",{className:"StoryCreator__toolbar",children:[isEditingText?(0,jsx_runtime.jsxs)("div",{className:"StoryCreator__tools",children:[(0,jsx_runtime.jsx)(Slider.i,{handleStyle:{backgroundColor:(0,color.ls)(sliderValue)},label:(0,color.ls)(sliderValue),moduleClassName:"HueSlider StoryCreator__tools__tool",onChange:setSliderValue,value:sliderValue}),(0,jsx_runtime.jsx)(ContextMenu.x,{i18n,menuOptions:[{icon:"StoryCreator__icon--font-regular",label:i18n("icu:StoryCreator__text--regular"),onClick:function(){return setTextStyle(TextStyle.Regular)},value:TextStyle.Regular},{icon:"StoryCreator__icon--font-bold",label:i18n("icu:StoryCreator__text--bold"),onClick:function(){return setTextStyle(TextStyle.Bold)},value:TextStyle.Bold},{icon:"StoryCreator__icon--font-serif",label:i18n("icu:StoryCreator__text--serif"),onClick:function(){return setTextStyle(TextStyle.Serif)},value:TextStyle.Serif},{icon:"StoryCreator__icon--font-script",label:i18n("icu:StoryCreator__text--script"),onClick:function(){return setTextStyle(TextStyle.Script)},value:TextStyle.Script},{icon:"StoryCreator__icon--font-condensed",label:i18n("icu:StoryCreator__text--condensed"),onClick:function(){return setTextStyle(TextStyle.Condensed)},value:TextStyle.Condensed}],moduleClassName:classnames_default()("StoryCreator__tools__tool",{"StoryCreator__tools__button--font-regular":textStyle===TextStyle.Regular,"StoryCreator__tools__button--font-bold":textStyle===TextStyle.Bold,"StoryCreator__tools__button--font-serif":textStyle===TextStyle.Serif,"StoryCreator__tools__button--font-script":textStyle===TextStyle.Script,"StoryCreator__tools__button--font-condensed":textStyle===TextStyle.Condensed}),theme:theme.Q.Dark,value:textStyle}),(0,jsx_runtime.jsx)("button",{"aria-label":getBgButtonAriaLabel(i18n,textBackground),className:classnames_default()("StoryCreator__tools__tool",{"StoryCreator__tools__button--bg-none":textBackground===TextBackground.None,"StoryCreator__tools__button--bg":textBackground===TextBackground.Background,"StoryCreator__tools__button--bg-inverse":textBackground===TextBackground.Inverse}),onClick:function(){textBackground===TextBackground.None?setTextBackground(TextBackground.Background):textBackground===TextBackground.Background?setTextBackground(TextBackground.Inverse):setTextBackground(TextBackground.None)},type:"button"}),(0,jsx_runtime.jsx)(EmojiButton.K,{className:"StoryCreator__emoji-button",i18n,onPickEmoji:function(data){var _textEditorRef$curren,_textEditorRef$curren2;onUseEmoji(data);var emoji=(0,lib.nS)(data.shortName,data.skinTone),insertAt=null!==(_textEditorRef$curren=null===(_textEditorRef$curren2=textEditorRef.current)||void 0===_textEditorRef$curren2?void 0:_textEditorRef$curren2.selectionEnd)&&void 0!==_textEditorRef$curren?_textEditorRef$curren:text.length;setText((function(originalText){return`${originalText.substr(0,insertAt)}${emoji}${originalText.substr(insertAt,text.length)}`}))},recentEmojis,skinTone,onSetSkinTone})]}):(0,jsx_runtime.jsx)("div",{className:"StoryCreator__toolbar--space"}),(0,jsx_runtime.jsxs)("div",{className:"StoryCreator__toolbar--buttons",children:[(0,jsx_runtime.jsx)(Button.zx,{onClick:onTryClose,theme:theme.Q.Dark,variant:Button.Wu.Secondary,children:i18n("icu:discard")}),(0,jsx_runtime.jsxs)("div",{className:"StoryCreator__controls",children:[(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:StoryCreator__story-bg"),className:classnames_default()({StoryCreator__control:!0,"StoryCreator__control--bg":!0,"StoryCreator__control--bg--selected":isColorPickerShowing}),onClick:function(){return setIsColorPickerShowing(!isColorPickerShowing)},ref:setColorPickerPopperButtonRef,style:{background:(0,getStoryBackground.dF)(getBackground(selectedBackground))},type:"button"}),isColorPickerShowing&&(0,jsx_runtime.jsxs)("div",Object.assign({className:"StoryCreator__popper",ref:setColorPickerPopperRef,style:colorPickerPopper.styles.popper},colorPickerPopper.attributes.popper,{children:[(0,jsx_runtime.jsx)("div",{"data-popper-arrow":!0,className:"StoryCreator__popper__arrow"}),(0,objectMap.x)(BackgroundStyle,(function(bg,backgroundValue){return(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:StoryCreator__story-bg"),className:classnames_default()({StoryCreator__bg:!0,"StoryCreator__bg--selected":selectedBackground===backgroundValue}),onClick:function(){setSelectedBackground(backgroundValue),setIsColorPickerShowing(!1)},type:"button",style:{background:(0,getStoryBackground.dF)(getBackground(backgroundValue))}},String(bg))}))]})),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:StoryCreator__control--text"),className:classnames_default()({StoryCreator__control:!0,"StoryCreator__control--text":!0,"StoryCreator__control--selected":isEditingText}),onClick:function(){setIsEditingText(!isEditingText)},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:StoryCreator__control--link"),className:"StoryCreator__control StoryCreator__control--link",onClick:function(){return setIsLinkPreviewInputShowing(!isLinkPreviewInputShowing)},ref:setLinkPreviewInputPopperButtonRef,type:"button"}),isLinkPreviewInputShowing&&(0,jsx_runtime.jsxs)("div",Object.assign({className:classnames_default()("StoryCreator__popper StoryCreator__link-preview-input-popper",(0,theme.j)(theme.Q.Dark)),ref:setLinkPreviewInputPopperRef,style:linkPreviewInputPopper.styles.popper},linkPreviewInputPopper.attributes.popper,{children:[(0,jsx_runtime.jsx)("div",{"data-popper-arrow":!0,className:"StoryCreator__popper__arrow"}),(0,jsx_runtime.jsx)(Input.I,{disableSpellcheck:!0,i18n,moduleClassName:"StoryCreator__link-preview-input",onChange:setLinkPreviewInputValue,placeholder:i18n("icu:StoryCreator__link-preview-placeholder"),ref:function(el){return null==el?void 0:el.focus()},value:linkPreviewInputValue}),(0,jsx_runtime.jsx)("div",{className:"StoryCreator__link-preview-container",children:linkPreview?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"StoryCreator__link-preview-wrapper",children:(0,jsx_runtime.jsx)(StoryLinkPreview.Q,Object.assign({},linkPreview,{forceCompactMode:!0,i18n}))}),(0,jsx_runtime.jsx)(Button.zx,{className:"StoryCreator__link-preview-button",onClick:function(){setLinkPreviewApplied(LinkPreviewApplied.Manual),setIsLinkPreviewInputShowing(!1)},theme:theme.Q.Dark,variant:Button.Wu.Primary,children:i18n("icu:StoryCreator__add-link")})]}):(0,jsx_runtime.jsxs)("div",{className:"StoryCreator__link-preview-empty",children:[(0,jsx_runtime.jsx)("div",{className:"StoryCreator__link-preview-empty__icon"}),i18n("icu:StoryCreator__link-preview-empty")]})})]}))]}),(0,jsx_runtime.jsx)(Button.zx,{disabled:!hasChanges||isSending,onClick:function(){return onDone(textAttachment)},theme:theme.Q.Dark,variant:Button.Wu.Primary,children:isSending?(0,jsx_runtime.jsx)(Spinner.$j,{svgSize:"small"}):i18n("icu:StoryCreator__next")})]})]}),showConfirmDiscardModal&&(0,jsx_runtime.jsx)(ConfirmDiscardDialog.a,{i18n,onClose:function(){return setShowConfirmDiscardModal(!1)},onDiscard:onClose})]})})}function StoryCreator_slicedToArray(arr,i){return function StoryCreator_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function StoryCreator_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function StoryCreator_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return StoryCreator_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return StoryCreator_arrayLikeToArray(o,minLen)}(arr,i)||function StoryCreator_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function StoryCreator_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function StoryCreator(_ref){var candidateConversations=_ref.candidateConversations,debouncedMaybeGrabLinkPreview=_ref.debouncedMaybeGrabLinkPreview,distributionLists=_ref.distributionLists,file=_ref.file,getPreferredBadge=_ref.getPreferredBadge,groupConversations=_ref.groupConversations,groupStories=_ref.groupStories,hasFirstStoryPostExperience=_ref.hasFirstStoryPostExperience,i18n=_ref.i18n,imageToBlurHash=_ref.imageToBlurHash,installedPacks=_ref.installedPacks,isSending=_ref.isSending,linkPreview=_ref.linkPreview,me=_ref.me,mostRecentActiveStoryTimestampByGroupOrDistributionList=_ref.mostRecentActiveStoryTimestampByGroupOrDistributionList,onClose=_ref.onClose,onDeleteList=_ref.onDeleteList,onDistributionListCreated=_ref.onDistributionListCreated,onHideMyStoriesFrom=_ref.onHideMyStoriesFrom,onRemoveMembers=_ref.onRemoveMembers,onRepliesNReactionsChanged=_ref.onRepliesNReactionsChanged,onSelectedStoryList=_ref.onSelectedStoryList,onSend=_ref.onSend,onSetSkinTone=_ref.onSetSkinTone,onUseEmoji=_ref.onUseEmoji,onViewersUpdated=_ref.onViewersUpdated,onMediaPlaybackStart=_ref.onMediaPlaybackStart,ourConversationId=_ref.ourConversationId,processAttachment=_ref.processAttachment,recentEmojis=_ref.recentEmojis,recentStickers=_ref.recentStickers,renderCompositionTextArea=_ref.renderCompositionTextArea,sendStoryModalOpenStateChanged=_ref.sendStoryModalOpenStateChanged,setMyStoriesToAllSignalConnections=_ref.setMyStoriesToAllSignalConnections,signalConnections=_ref.signalConnections,skinTone=_ref.skinTone,toggleGroupsForStorySend=_ref.toggleGroupsForStorySend,toggleSignalConnectionsModal=_ref.toggleSignalConnectionsModal,_useState2=StoryCreator_slicedToArray((0,react.useState)(),2),draftAttachment=_useState2[0],setDraftAttachment=_useState2[1],_useState4=StoryCreator_slicedToArray((0,react.useState)(!1),2),isReadyToSend=_useState4[0],setIsReadyToSend=_useState4[1],_useState6=StoryCreator_slicedToArray((0,react.useState)(),2),attachmentUrl=_useState6[0],setAttachmentUrl=_useState6[1],_useState8=StoryCreator_slicedToArray((0,react.useState)(),2),bodyRanges=_useState8[0],setBodyRanges=_useState8[1];return(0,react.useEffect)((function(){var url,unmounted=!1;return async function loadAttachment(){if(file&&!unmounted){var attachment=await processAttachment(file);attachment&&!unmounted&&(setDraftAttachment(attachment),(0,Attachment.fr)(attachment)?(setAttachmentUrl(void 0),setIsReadyToSend(!0)):attachment&&has_default()(attachment,"data")&&(url=URL.createObjectURL(new Blob([get_default()(attachment,"data")])),setAttachmentUrl(url),setIsReadyToSend(!1)))}}(),function(){unmounted=!0,url&&URL.revokeObjectURL(url)}}),[file,processAttachment]),(0,react.useEffect)((function(){void 0===draftAttachment?(sendStoryModalOpenStateChanged(!1),setIsReadyToSend(!1)):sendStoryModalOpenStateChanged(!0)}),[draftAttachment,sendStoryModalOpenStateChanged]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[draftAttachment&&isReadyToSend&&(0,jsx_runtime.jsx)(SendStoryModal.a,{draftAttachment,candidateConversations,distributionLists,getPreferredBadge,groupConversations,groupStories,hasFirstStoryPostExperience,ourConversationId,i18n,me,onClose:function(){return setDraftAttachment(void 0)},onDeleteList,onDistributionListCreated,onHideMyStoriesFrom,onRemoveMembers,onRepliesNReactionsChanged,onSelectedStoryList,onSend:function(listIds,groupIds){onSend(listIds,groupIds,draftAttachment,bodyRanges),setDraftAttachment(void 0)},onViewersUpdated,onMediaPlaybackStart,setMyStoriesToAllSignalConnections,signalConnections,toggleGroupsForStorySend,mostRecentActiveStoryTimestampByGroupOrDistributionList,toggleSignalConnectionsModal}),draftAttachment&&!isReadyToSend&&attachmentUrl&&(0,jsx_runtime.jsx)(MediaEditor.W,{doneButtonLabel:i18n("icu:next2"),i18n,imageSrc:attachmentUrl,installedPacks,isSending,onClose,supportsCaption:!0,renderCompositionTextArea,imageToBlurHash,onDone:function(_ref2){var contentType=_ref2.contentType,data=_ref2.data,blurHash=_ref2.blurHash,caption=_ref2.caption,captionBodyRanges=_ref2.captionBodyRanges;setDraftAttachment(Object.assign({},draftAttachment,{contentType,data,size:data.byteLength,blurHash,caption})),setBodyRanges(captionBodyRanges),setIsReadyToSend(!0)},recentStickers}),!file&&(0,jsx_runtime.jsx)(TextStoryCreator,{debouncedMaybeGrabLinkPreview,i18n,isSending,linkPreview,onClose,onDone:function(textAttachment){var _textAttachment$text;setDraftAttachment({contentType:MIME.np,textAttachment,size:(null===(_textAttachment$text=textAttachment.text)||void 0===_textAttachment$text?void 0:_textAttachment$text.length)||0}),setIsReadyToSend(!0)},onUseEmoji,onSetSkinTone,recentEmojis,skinTone})]})}TextStoryCreator.displayName="TextStoryCreator";var fakeAttachment=__webpack_require__("./ts/test-both/helpers/fakeAttachment.ts"),getDefaultConversation=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),getFakeDistributionLists=__webpack_require__("./ts/test-both/helpers/getFakeDistributionLists.ts"),i18n=(0,__webpack_require__("./ts/util/setupI18n.ts").E5)("en",messages);const StoryCreator_stories={title:"Components/StoryCreator",component:StoryCreator,argTypes:{candidateConversations:{defaultValue:Array.from(Array(100),getDefaultConversation.E$)},debouncedMaybeGrabLinkPreview:{action:!0},distributionLists:{defaultValue:(0,getFakeDistributionLists.sJ)()},getPreferredBadge:{action:!0},groupConversations:{defaultValue:Array.from(Array(7),getDefaultConversation.uN)},groupStories:{defaultValue:Array.from(Array(4),getDefaultConversation.uN)},hasFirstStoryPostExperience:{defaultValue:!1},i18n:{defaultValue:i18n},imageToBlurHash:async function(){return"LDA,FDBnm+I=p{tkIUI;~UkpELV]"},installedPacks:{defaultValue:[]},isSending:{defaultValue:!1},linkPreview:{defaultValue:void 0},me:{defaultValue:(0,getDefaultConversation.E$)()},onClose:{action:!0},onDeleteList:{action:!0},onDistributionListCreated:{action:!0},onHideMyStoriesFrom:{action:!0},onSend:{action:!0},onSetSkinTone:{action:!0},onUseEmoji:{action:!0},onViewersUpdated:{action:!0},processAttachment:{action:!0},recentEmojis:{defaultValue:[]},recentStickers:{defaultValue:[]},sendStoryModalOpenStateChanged:{action:!0},setMyStoriesToAllSignalConnections:{action:!0},signalConnections:{defaultValue:Array.from(Array(42),getDefaultConversation.E$)},skinTone:{defaultValue:0},toggleSignalConnectionsModal:{action:!0}}};var Template=function(args){return(0,jsx_runtime.jsx)(StoryCreator,Object.assign({},args))};Template.displayName="Template";var Default=Template.bind({});Default.args={},Default.story={name:"w/o Link Preview available"};var StoryCreator_stories_LinkPreview=Template.bind({});StoryCreator_stories_LinkPreview.args={linkPreview:{domain:"www.catsandkittens.lolcats",image:(0,fakeAttachment.dh)({url:"/fixtures/kitten-4-112-112.jpg"}),title:"Cats & Kittens LOL",url:"https://www.catsandkittens.lolcats/kittens/page/1"}},StoryCreator_stories_LinkPreview.story={name:"with Link Preview ready to be applied"};var FirstTime=Template.bind({});FirstTime.args={hasFirstStoryPostExperience:!0},FirstTime.story={name:"First time posting a story"};var Sending=Template.bind({});Sending.args={isSending:!0};var __namedExportsOrder=["Default","LinkPreview","FirstTime","Sending"]},"./ts/hooks/useRestoreFocus.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>useRestoreFocus,e:()=>useDelayedRestoreFocus});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),useRestoreFocus=function(){var toFocusRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),lastFocusedRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),setFocusRef=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(toFocus){toFocus&&(toFocusRef.current||(toFocusRef.current=toFocus,lastFocusedRef.current=document.activeElement,toFocus.focus()))}),[]);return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){return function(){setTimeout((function(){lastFocusedRef.current&&lastFocusedRef.current.focus&&lastFocusedRef.current.focus()}))}}),[]),[setFocusRef]},useDelayedRestoreFocus=function(){var toFocusRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),lastFocusedRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),setFocusRef=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(toFocus){var timeout=setTimeout((function setFocus(){toFocus&&(toFocusRef.current||(toFocusRef.current=toFocus,lastFocusedRef.current=document.activeElement,toFocus.focus()))}),250);return function(){clearTimeout(timeout)}}),[]);return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){return function(){setTimeout((function(){lastFocusedRef.current&&lastFocusedRef.current.focus&&lastFocusedRef.current.focus()}))}}),[]),[setFocusRef]}},"./ts/test-both/helpers/fakeAttachment.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C4:()=>fakeDraftAttachment,Jh:()=>fakeThumbnail,dh:()=>fakeAttachment});var _types_MIME__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/MIME.ts"),fakeAttachment=function(){var overrides=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,width:800,height:600,size:10304},overrides)},fakeThumbnail=function(url){return{contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,height:100,path:url,url,width:100}},fakeDraftAttachment=function(){var overrides=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({pending:!1,contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,path:"file.jpg",size:10304},overrides)}},"./ts/util/objectMap.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function objectMap(obj,f){return Object.keys(obj).map((function(key){return f(key,obj[key])}))}__webpack_require__.d(__webpack_exports__,{x:()=>objectMap})},"./ts/util/popperUtil.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>offsetDistanceModifier,W:()=>sameWidthModifier});var offsetDistanceModifier=function(distance){return{name:"offset",options:{offset:[void 0,distance]}}},sameWidthModifier={name:"sameWidth",enabled:!0,phase:"write",fn:function(_ref){var state=_ref.state;state.elements.popper.style.width=`${state.rects.reference.width}px`}}},"./node_modules/react-popper/lib/esm/Manager.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C8:()=>ManagerReferenceNodeContext,dK:()=>Manager,mq:()=>ManagerReferenceNodeSetterContext});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),ManagerReferenceNodeContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext(),ManagerReferenceNodeSetterContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext();function Manager(_ref){var children=_ref.children,_React$useState=react__WEBPACK_IMPORTED_MODULE_0__.useState(null),referenceNode=_React$useState[0],setReferenceNode=_React$useState[1],hasUnmounted=react__WEBPACK_IMPORTED_MODULE_0__.useRef(!1);react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){return function(){hasUnmounted.current=!0}}),[]);var handleSetReferenceNode=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(node){hasUnmounted.current||setReferenceNode(node)}),[]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(ManagerReferenceNodeContext.Provider,{value:referenceNode},react__WEBPACK_IMPORTED_MODULE_0__.createElement(ManagerReferenceNodeSetterContext.Provider,{value:handleSetReferenceNode},children))}},"./node_modules/react-popper/lib/esm/Popper.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{r:()=>Popper});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_Manager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-popper/lib/esm/Manager.js"),_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-popper/lib/esm/utils.js"),_usePopper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react-popper/lib/esm/usePopper.js"),NOOP=function NOOP(){},NOOP_PROMISE=function NOOP_PROMISE(){return Promise.resolve(null)},EMPTY_MODIFIERS=[];function Popper(_ref){var _ref$placement=_ref.placement,placement=void 0===_ref$placement?"bottom":_ref$placement,_ref$strategy=_ref.strategy,strategy=void 0===_ref$strategy?"absolute":_ref$strategy,_ref$modifiers=_ref.modifiers,modifiers=void 0===_ref$modifiers?EMPTY_MODIFIERS:_ref$modifiers,referenceElement=_ref.referenceElement,onFirstUpdate=_ref.onFirstUpdate,innerRef=_ref.innerRef,children=_ref.children,referenceNode=react__WEBPACK_IMPORTED_MODULE_0__.useContext(_Manager__WEBPACK_IMPORTED_MODULE_1__.C8),_React$useState=react__WEBPACK_IMPORTED_MODULE_0__.useState(null),popperElement=_React$useState[0],setPopperElement=_React$useState[1],_React$useState2=react__WEBPACK_IMPORTED_MODULE_0__.useState(null),arrowElement=_React$useState2[0],setArrowElement=_React$useState2[1];react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){(0,_utils__WEBPACK_IMPORTED_MODULE_2__.k$)(innerRef,popperElement)}),[innerRef,popperElement]);var options=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return{placement,strategy,onFirstUpdate,modifiers:[].concat(modifiers,[{name:"arrow",enabled:null!=arrowElement,options:{element:arrowElement}}])}}),[placement,strategy,onFirstUpdate,modifiers,arrowElement]),_usePopper=(0,_usePopper__WEBPACK_IMPORTED_MODULE_3__.D)(referenceElement||referenceNode,popperElement,options),state=_usePopper.state,styles=_usePopper.styles,forceUpdate=_usePopper.forceUpdate,update=_usePopper.update,childrenProps=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return{ref:setPopperElement,style:styles.popper,placement:state?state.placement:placement,hasPopperEscaped:state&&state.modifiersData.hide?state.modifiersData.hide.hasPopperEscaped:null,isReferenceHidden:state&&state.modifiersData.hide?state.modifiersData.hide.isReferenceHidden:null,arrowProps:{style:styles.arrow,ref:setArrowElement},forceUpdate:forceUpdate||NOOP,update:update||NOOP_PROMISE}}),[setPopperElement,setArrowElement,placement,state,styles,update,forceUpdate]);return(0,_utils__WEBPACK_IMPORTED_MODULE_2__.$p)(children)(childrenProps)}},"./node_modules/react-popper/lib/esm/Reference.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>Reference});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),warning__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/warning/warning.js"),warning__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(warning__WEBPACK_IMPORTED_MODULE_1__),_Manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-popper/lib/esm/Manager.js"),_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react-popper/lib/esm/utils.js");function Reference(_ref){var children=_ref.children,innerRef=_ref.innerRef,setReferenceNode=react__WEBPACK_IMPORTED_MODULE_0__.useContext(_Manager__WEBPACK_IMPORTED_MODULE_2__.mq),refHandler=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(node){(0,_utils__WEBPACK_IMPORTED_MODULE_3__.k$)(innerRef,node),(0,_utils__WEBPACK_IMPORTED_MODULE_3__.DL)(setReferenceNode,node)}),[innerRef,setReferenceNode]);return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){return function(){return(0,_utils__WEBPACK_IMPORTED_MODULE_3__.k$)(innerRef,null)}}),[]),react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){warning__WEBPACK_IMPORTED_MODULE_1___default()(Boolean(setReferenceNode),"`Reference` should not be used outside of a `Manager` component.")}),[setReferenceNode]),(0,_utils__WEBPACK_IMPORTED_MODULE_3__.$p)(children)({ref:refHandler})}},"./node_modules/warning/warning.js":module=>{var warning=function(){};module.exports=warning}}]);