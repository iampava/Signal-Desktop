(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[3369,4377],{"./ts/components/Tabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{m:()=>Tabs});var react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),assert=__webpack_require__("./ts/util/assert.ts"),getClassNamesFor=__webpack_require__("./ts/util/getClassNamesFor.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var _excluded=["children"];function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function Tabs(props){var children=props.children,_useTabs=function useTabs(options){(0,assert.q8)(options.tabs.length,"Tabs needs more than 1 tab present");var selectedTab,onChange,getClassName=(0,getClassNamesFor.h)("Tabs",options.moduleClassName);if("selectedTab"in options)selectedTab=options.selectedTab,onChange=options.onTabChange;else{var _useState2=_slicedToArray((0,react.useState)(options.initialSelectedTab||options.tabs[0].id),2),tabState=_useState2[0],setTabState=_useState2[1];selectedTab=tabState,onChange=function(newTab){var _options$onTabChange;setTabState(newTab),null===(_options$onTabChange=options.onTabChange)||void 0===_options$onTabChange||_options$onTabChange.call(options,newTab)}}var tabsHeaderElement=(0,jsx_runtime.jsx)("div",{className:getClassName(""),children:options.tabs.map((function(_ref){var id=_ref.id,label=_ref.label;return(0,jsx_runtime.jsx)("div",{className:classnames_default()(getClassName("__tab"),selectedTab===id&&getClassName("__tab--selected")),onClick:function(){onChange(id)},onKeyUp:function(e){e.target===e.currentTarget&&13===e.keyCode&&(onChange(id),e.preventDefault(),e.stopPropagation())},role:"tab",tabIndex:0,children:label},id)}))});return{selectedTab,tabsHeaderElement}}(_objectWithoutProperties(props,_excluded)),selectedTab=_useTabs.selectedTab,tabsHeaderElement=_useTabs.tabsHeaderElement;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[tabsHeaderElement,children({selectedTab})]})}},"./ts/components/conversation/media-gallery/EmptyState.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{u:()=>EmptyState});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function EmptyState(_ref){var label=_ref.label;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{className:"module-empty-state",children:label})}EmptyState.displayName="EmptyState"},"./ts/components/conversation/media-gallery/MediaGallery.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Empty:()=>Empty,NoDocuments:()=>NoDocuments,NoMedia:()=>NoMedia,OneEach:()=>OneEach,Populated:()=>Populated,__namedExportsOrder:()=>__namedExportsOrder,default:()=>MediaGallery_stories});var react=__webpack_require__("./node_modules/react/index.js"),esm=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),setupI18n=__webpack_require__("./ts/util/setupI18n.ts"),messages=__webpack_require__("./_locales/en/messages.json"),AttachmentSection_stories=__webpack_require__("./ts/components/conversation/media-gallery/AttachmentSection.stories.tsx"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment),AttachmentSection=__webpack_require__("./ts/components/conversation/media-gallery/AttachmentSection.tsx"),EmptyState=__webpack_require__("./ts/components/conversation/media-gallery/EmptyState.tsx"),Tabs=__webpack_require__("./ts/components/Tabs.tsx"),getMessageTimestamp=__webpack_require__("./ts/util/getMessageTimestamp.ts"),sortBy=__webpack_require__("./node_modules/lodash/sortBy.js"),sortBy_default=__webpack_require__.n(sortBy),groupBy=__webpack_require__("./node_modules/lodash/groupBy.js"),groupBy_default=__webpack_require__.n(groupBy),compact=__webpack_require__("./node_modules/lodash/compact.js"),compact_default=__webpack_require__.n(compact),log=__webpack_require__("./ts/logging/log.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var TabViews,toSection=function(messagesWithSection){if(messagesWithSection&&0!==messagesWithSection.length){var firstMediaItemWithSection=messagesWithSection[0];if(firstMediaItemWithSection){var mediaItems=messagesWithSection.map((function(messageWithSection){return messageWithSection.mediaItem}));switch(firstMediaItemWithSection.type){case"today":case"yesterday":case"thisWeek":case"thisMonth":return{type:firstMediaItemWithSection.type,mediaItems};case"yearMonth":return{type:firstMediaItemWithSection.type,year:firstMediaItemWithSection.year,month:firstMediaItemWithSection.month,mediaItems};default:return void log.error((0,missingCaseError.b)(firstMediaItemWithSection))}}}},withSection=function(referenceDateTime){return function(mediaItem){var today=moment_default()(referenceDateTime).startOf("day"),yesterday=moment_default()(referenceDateTime).subtract(1,"day").startOf("day"),thisWeek=moment_default()(referenceDateTime).startOf("isoWeek"),thisMonth=moment_default()(referenceDateTime).startOf("month"),message=mediaItem.message,mediaItemReceivedDate=moment_default().utc((0,getMessageTimestamp.T)(message));if(mediaItemReceivedDate.isAfter(today))return{order:0,type:"today",mediaItem};if(mediaItemReceivedDate.isAfter(yesterday))return{order:1,type:"yesterday",mediaItem};if(mediaItemReceivedDate.isAfter(thisWeek))return{order:2,type:"thisWeek",mediaItem};if(mediaItemReceivedDate.isAfter(thisMonth))return{order:3,type:"thisMonth",mediaItem};var month=mediaItemReceivedDate.month(),year=mediaItemReceivedDate.year();return{order:100*year+month,type:"yearMonth",month,year,mediaItem}}},jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");!function(TabViews){TabViews.Media="Media",TabViews.Documents="Documents"}(TabViews||(TabViews={}));function MediaSection(_ref){var type=_ref.type,i18n=_ref.i18n,media=_ref.media,documents=_ref.documents,saveAttachment=_ref.saveAttachment,showLightboxWithMedia=_ref.showLightboxWithMedia,mediaItems="media"===type?media:documents;if(!mediaItems||0===mediaItems.length){var label=function(){switch(type){case"media":return i18n("icu:mediaEmptyState");case"documents":return i18n("icu:documentsEmptyState");default:throw(0,missingCaseError.b)(type)}}();return(0,jsx_runtime.jsx)(EmptyState.u,{"data-test":"EmptyState",label})}var sections=function(timestamp,mediaItems){var referenceDateTime=moment_default().utc(timestamp),messagesWithSection=sortBy_default()(mediaItems,(function(mediaItem){return-mediaItem.message.received_at})).map(withSection(referenceDateTime)),groupedMediaItem=groupBy_default()(messagesWithSection,"type"),yearMonthMediaItem=Object.values(groupBy_default()(groupedMediaItem.yearMonth,"order")).reverse();return compact_default()([toSection(groupedMediaItem.today),toSection(groupedMediaItem.yesterday),toSection(groupedMediaItem.thisWeek),toSection(groupedMediaItem.thisMonth)].concat(_toConsumableArray(yearMonthMediaItem.map(toSection))))}(Date.now(),mediaItems).map((function(section){var message=section.mediaItems[0].message,date=moment_default()((0,getMessageTimestamp.T)(message));var header=function getHeader(){switch(section.type){case"yearMonth":return date.format("MMMM YYYY");case"today":return i18n("icu:today");case"yesterday":return i18n("icu:yesterday");case"thisWeek":return i18n("icu:thisWeek");case"thisMonth":return i18n("icu:thisMonth");default:throw(0,missingCaseError.b)(section)}}();return(0,jsx_runtime.jsx)(AttachmentSection.v,{header,i18n,type,mediaItems:section.mediaItems,onItemClick:function(event){switch(event.type){case"documents":saveAttachment(event.attachment,event.message.sent_at);break;case"media":showLightboxWithMedia(event.attachment.path,media);break;default:throw new TypeError(`Unknown attachment type: '${event.type}'`)}}},header)}));return(0,jsx_runtime.jsx)("div",{className:"module-media-gallery__sections",children:sections})}function MediaGallery(_ref2){var conversationId=_ref2.conversationId,documents=_ref2.documents,i18n=_ref2.i18n,loadMediaItems=_ref2.loadMediaItems,media=_ref2.media,saveAttachment=_ref2.saveAttachment,showLightboxWithMedia=_ref2.showLightboxWithMedia,focusRef=(0,react.useRef)(null);return(0,react.useEffect)((function(){var _focusRef$current;null===(_focusRef$current=focusRef.current)||void 0===_focusRef$current||_focusRef$current.focus()}),[]),(0,react.useEffect)((function(){loadMediaItems(conversationId)}),[conversationId,loadMediaItems]),(0,jsx_runtime.jsx)("div",{className:"module-media-gallery",tabIndex:-1,ref:focusRef,children:(0,jsx_runtime.jsx)(Tabs.m,{initialSelectedTab:TabViews.Media,tabs:[{id:TabViews.Media,label:i18n("icu:media")},{id:TabViews.Documents,label:i18n("icu:documents")}],children:function(_ref3){var selectedTab=_ref3.selectedTab;return(0,jsx_runtime.jsxs)("div",{className:"module-media-gallery__content",children:[selectedTab===TabViews.Media&&(0,jsx_runtime.jsx)(MediaSection,{documents,i18n,media,saveAttachment,showLightboxWithMedia,type:"media"}),selectedTab===TabViews.Documents&&(0,jsx_runtime.jsx)(MediaSection,{documents,i18n,media,saveAttachment,showLightboxWithMedia,type:"documents"})]})}})})}MediaSection.displayName="MediaSection",MediaGallery.displayName="MediaGallery";var i18n=(0,setupI18n.E5)("en",messages);const MediaGallery_stories={title:"Components/Conversation/MediaGallery/MediaGallery"};var createProps=function(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{conversationId:"123",documents:overrideProps.documents||[],i18n,loadMediaItems:(0,esm.action)("loadMediaItems"),media:overrideProps.media||[],saveAttachment:(0,esm.action)("saveAttachment"),showLightboxWithMedia:(0,esm.action)("showLightboxWithMedia")}};function Populated(){var documents=(0,AttachmentSection_stories.createRandomDocuments)(AttachmentSection_stories.now,(0,AttachmentSection_stories.days)(1)).slice(0,1),media=(0,AttachmentSection_stories.createPreparedMediaItems)(AttachmentSection_stories.createRandomMedia),props=createProps({documents,media});return(0,jsx_runtime.jsx)(MediaGallery,Object.assign({},props))}function NoDocuments(){var media=(0,AttachmentSection_stories.createPreparedMediaItems)(AttachmentSection_stories.createRandomMedia),props=createProps({media});return(0,jsx_runtime.jsx)(MediaGallery,Object.assign({},props))}function NoMedia(){var documents=(0,AttachmentSection_stories.createPreparedMediaItems)(AttachmentSection_stories.createRandomDocuments),props=createProps({documents});return(0,jsx_runtime.jsx)(MediaGallery,Object.assign({},props))}function OneEach(){var media=(0,AttachmentSection_stories.createRandomMedia)(AttachmentSection_stories.now,(0,AttachmentSection_stories.days)(1)).slice(0,1),documents=(0,AttachmentSection_stories.createRandomDocuments)(AttachmentSection_stories.now,(0,AttachmentSection_stories.days)(1)).slice(0,1),props=createProps({documents,media});return(0,jsx_runtime.jsx)(MediaGallery,Object.assign({},props))}function Empty(){var props=createProps();return(0,jsx_runtime.jsx)(MediaGallery,Object.assign({},props))}Populated.displayName="Populated",NoDocuments.displayName="NoDocuments",NoMedia.displayName="NoMedia",OneEach.displayName="OneEach",Empty.displayName="Empty";var __namedExportsOrder=["Populated","NoDocuments","NoMedia","OneEach","Empty"]},"./ts/util/getClassNamesFor.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>getClassNamesFor});var classnames__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_0__);function getClassNamesFor(){for(var _len=arguments.length,modules=new Array(_len),_key=0;_key<_len;_key++)modules[_key]=arguments[_key];return function(modifier){if(void 0===modifier)return"";var cx=modules.flatMap((function(m){return m?m.split(" "):void 0})).map((function(parentModule){return parentModule?`${parentModule}${modifier}`:void 0}));return classnames__WEBPACK_IMPORTED_MODULE_0___default()(cx)}}},"./node_modules/lodash/_arrayAggregator.js":module=>{module.exports=function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}},"./node_modules/lodash/_arraySample.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseRandom=__webpack_require__("./node_modules/lodash/_baseRandom.js");module.exports=function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:void 0}},"./node_modules/lodash/_baseAggregator.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseEach=__webpack_require__("./node_modules/lodash/_baseEach.js");module.exports=function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,(function(value,key,collection){setter(accumulator,value,iteratee(value),collection)})),accumulator}},"./node_modules/lodash/_baseRandom.js":module=>{var nativeFloor=Math.floor,nativeRandom=Math.random;module.exports=function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}},"./node_modules/lodash/_baseSample.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arraySample=__webpack_require__("./node_modules/lodash/_arraySample.js"),values=__webpack_require__("./node_modules/lodash/values.js");module.exports=function baseSample(collection){return arraySample(values(collection))}},"./node_modules/lodash/_baseValues.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayMap=__webpack_require__("./node_modules/lodash/_arrayMap.js");module.exports=function baseValues(object,props){return arrayMap(props,(function(key){return object[key]}))}},"./node_modules/lodash/_createAggregator.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayAggregator=__webpack_require__("./node_modules/lodash/_arrayAggregator.js"),baseAggregator=__webpack_require__("./node_modules/lodash/_baseAggregator.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js");module.exports=function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,baseIteratee(iteratee,2),accumulator)}}},"./node_modules/lodash/compact.js":module=>{module.exports=function compact(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result}},"./node_modules/lodash/groupBy.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseAssignValue=__webpack_require__("./node_modules/lodash/_baseAssignValue.js"),createAggregator=__webpack_require__("./node_modules/lodash/_createAggregator.js"),hasOwnProperty=Object.prototype.hasOwnProperty,groupBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])}));module.exports=groupBy},"./node_modules/lodash/sample.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arraySample=__webpack_require__("./node_modules/lodash/_arraySample.js"),baseSample=__webpack_require__("./node_modules/lodash/_baseSample.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js");module.exports=function sample(collection){return(isArray(collection)?arraySample:baseSample)(collection)}},"./node_modules/lodash/values.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseValues=__webpack_require__("./node_modules/lodash/_baseValues.js"),keys=__webpack_require__("./node_modules/lodash/keys.js");module.exports=function values(object){return null==object?[]:baseValues(object,keys(object))}}}]);