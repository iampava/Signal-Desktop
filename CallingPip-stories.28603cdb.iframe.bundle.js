(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[1246],{"./ts/calling/useGetCallingFrameBuffer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>useGetCallingFrameBuffer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/calling/constants.ts");function useGetCallingFrameBuffer(){var ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){return ref.current||(ref.current=Buffer.alloc(_constants__WEBPACK_IMPORTED_MODULE_1__.Iu)),ref.current}),[])}},"./ts/components/CallingPip.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ContactNoColor:()=>ContactNoColor,ContactWithAvatarAndNoVideo:()=>ContactWithAvatarAndNoVideo,Default:()=>Default,GroupCall:()=>GroupCall,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var lodash_times__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/times.js"),lodash_times__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_times__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/@storybook/addon-knobs/dist/index.js")),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),_types_Colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Colors.ts"),_CallingPip__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/CallingPip.tsx"),_types_Calling__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/types/Calling.ts"),_test_both_helpers_getDefaultConversation__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),_test_both_helpers_fakeGetGroupCallVideoFrameSource__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/test-both/helpers/fakeGetGroupCallVideoFrameSource.ts"),_util_setupI18n__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/setupI18n.ts"),_locales_en_messages_json__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./_locales/en/messages.json"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react/jsx-runtime.js"),i18n=(0,_util_setupI18n__WEBPACK_IMPORTED_MODULE_8__.E5)("en",_locales_en_messages_json__WEBPACK_IMPORTED_MODULE_9__),conversation=(0,_test_both_helpers_getDefaultConversation__WEBPACK_IMPORTED_MODULE_7__.E$)({id:"3051234567",avatarPath:void 0,color:_types_Colors__WEBPACK_IMPORTED_MODULE_4__.sj[0],title:"Rick Sanchez",name:"Rick Sanchez",phoneNumber:"3051234567",profileName:"Rick Sanchez"}),getCommonActiveCallData=function(){return{conversation,hasLocalAudio:(0,_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__.boolean)("hasLocalAudio",!0),hasLocalVideo:(0,_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__.boolean)("hasLocalVideo",!1),localAudioLevel:(0,_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__.select)("localAudioLevel",[0,.5,1],0),viewMode:(0,_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__.select)("viewMode",[_types_Calling__WEBPACK_IMPORTED_MODULE_6__.pC.Grid,_types_Calling__WEBPACK_IMPORTED_MODULE_6__.pC.Speaker,_types_Calling__WEBPACK_IMPORTED_MODULE_6__.pC.Presentation],_types_Calling__WEBPACK_IMPORTED_MODULE_6__.pC.Grid),joinedAt:Date.now(),outgoingRing:!0,pip:!0,settingsDialogOpen:!1,showParticipantsList:!1}},defaultCall=Object.assign({},getCommonActiveCallData(),{callMode:_types_Calling__WEBPACK_IMPORTED_MODULE_6__.L6.Direct,callState:_types_Calling__WEBPACK_IMPORTED_MODULE_6__.OX.Accepted,peekedParticipants:[],remoteParticipants:[{hasRemoteVideo:!0,presenting:!1,title:"Arsene"}]}),createProps=function(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{activeCall:overrideProps.activeCall||defaultCall,getGroupCallVideoFrameSource:_test_both_helpers_fakeGetGroupCallVideoFrameSource__WEBPACK_IMPORTED_MODULE_11__.x,hangUpActiveCall:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("hang-up-active-call"),hasLocalVideo:(0,_storybook_addon_knobs__WEBPACK_IMPORTED_MODULE_2__.boolean)("hasLocalVideo",overrideProps.hasLocalVideo||!1),i18n,setGroupCallVideoRequest:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("set-group-call-video-request"),setLocalPreview:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("set-local-preview"),setRendererCanvas:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("set-renderer-canvas"),switchFromPresentationView:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("switch-to-presentation-view"),switchToPresentationView:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("switch-to-presentation-view"),togglePip:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_3__.action)("toggle-pip")}};const __WEBPACK_DEFAULT_EXPORT__={title:"Components/CallingPip"};function Default(){var props=createProps({});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_CallingPip__WEBPACK_IMPORTED_MODULE_5__.V,Object.assign({},props))}function ContactWithAvatarAndNoVideo(){var props=createProps({activeCall:Object.assign({},defaultCall,{conversation:Object.assign({},conversation,{avatarPath:"https://www.fillmurray.com/64/64"}),remoteParticipants:[{hasRemoteVideo:!1,presenting:!1,title:"Julian"}]})});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_CallingPip__WEBPACK_IMPORTED_MODULE_5__.V,Object.assign({},props))}function ContactNoColor(){var props=createProps({activeCall:Object.assign({},defaultCall,{conversation:Object.assign({},conversation,{color:void 0})})});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_CallingPip__WEBPACK_IMPORTED_MODULE_5__.V,Object.assign({},props))}function GroupCall(){var props=createProps({activeCall:Object.assign({},getCommonActiveCallData(),{callMode:_types_Calling__WEBPACK_IMPORTED_MODULE_6__.L6.Group,connectionState:_types_Calling__WEBPACK_IMPORTED_MODULE_6__.mB.Connected,conversationsWithSafetyNumberChanges:[],groupMembers:lodash_times__WEBPACK_IMPORTED_MODULE_0___default()(3,(function(){return(0,_test_both_helpers_getDefaultConversation__WEBPACK_IMPORTED_MODULE_7__.E$)()})),isConversationTooBigToRing:!1,joinState:_types_Calling__WEBPACK_IMPORTED_MODULE_6__.GT.Joined,maxDevices:5,deviceCount:0,peekedParticipants:[],remoteParticipants:[],remoteAudioLevels:new Map})});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_CallingPip__WEBPACK_IMPORTED_MODULE_5__.V,Object.assign({},props))}Default.displayName="Default",ContactWithAvatarAndNoVideo.displayName="ContactWithAvatarAndNoVideo",ContactWithAvatarAndNoVideo.story={name:"Contact (with avatar and no video)"},ContactNoColor.displayName="ContactNoColor",ContactNoColor.story={name:"Contact (no color)"},GroupCall.displayName="GroupCall";var __namedExportsOrder=["Default","ContactWithAvatarAndNoVideo","ContactNoColor","GroupCall"]},"./ts/components/CallingPip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{V:()=>CallingPip});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),debounce=__webpack_require__("./node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce),minBy=__webpack_require__("./node_modules/lodash/minBy.js"),minBy_default=__webpack_require__.n(minBy),react=__webpack_require__("./node_modules/react/index.js"),maxBy=__webpack_require__("./node_modules/lodash/maxBy.js"),maxBy_default=__webpack_require__.n(maxBy),clamp=__webpack_require__("./node_modules/lodash/clamp.js"),clamp_default=__webpack_require__.n(clamp),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),CallBackgroundBlur=__webpack_require__("./ts/components/CallBackgroundBlur.tsx"),DirectCallRemoteParticipant=__webpack_require__("./ts/components/DirectCallRemoteParticipant.tsx"),GroupCallRemoteParticipant=__webpack_require__("./ts/components/GroupCallRemoteParticipant.tsx"),Calling=__webpack_require__("./ts/types/Calling.ts"),Colors=__webpack_require__("./ts/types/Colors.ts"),useGetCallingFrameBuffer=__webpack_require__("./ts/calling/useGetCallingFrameBuffer.ts"),constants=__webpack_require__("./ts/calling/constants.ts"),usePageVisibility=__webpack_require__("./ts/hooks/usePageVisibility.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts"),nonRenderedRemoteParticipant=__webpack_require__("./ts/util/ringrtc/nonRenderedRemoteParticipant.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function NoVideo(_ref){var activeCall=_ref.activeCall,i18n=_ref.i18n,_activeCall$conversat=activeCall.conversation,acceptedMessageRequest=_activeCall$conversat.acceptedMessageRequest,avatarPath=_activeCall$conversat.avatarPath,color=_activeCall$conversat.color,isMe=_activeCall$conversat.isMe,phoneNumber=_activeCall$conversat.phoneNumber,profileName=_activeCall$conversat.profileName,sharedGroupNames=_activeCall$conversat.sharedGroupNames,title=_activeCall$conversat.title;return(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(CallBackgroundBlur.L,{avatarPath,color,children:(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--avatar",children:(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:color||Colors.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe,phoneNumber,profileName,title,size:Avatar.DZ.FORTY_EIGHT,sharedGroupNames})})})})}function CallingPipRemoteVideo(_ref2){var activeCall=_ref2.activeCall,getGroupCallVideoFrameSource=_ref2.getGroupCallVideoFrameSource,i18n=_ref2.i18n,setGroupCallVideoRequest=_ref2.setGroupCallVideoRequest,setRendererCanvas=_ref2.setRendererCanvas,conversation=activeCall.conversation,getGroupCallFrameBuffer=(0,useGetCallingFrameBuffer.b)(),isPageVisible=(0,usePageVisibility.d)(),activeGroupCallSpeaker=(0,react.useMemo)((function(){if(activeCall.callMode===Calling.L6.Group)return maxBy_default()(activeCall.remoteParticipants,(function(participant){return participant.presenting?1/0:participant.speakerTime||-1/0}))}),[activeCall.callMode,activeCall.remoteParticipants]);switch((0,react.useEffect)((function(){activeCall.callMode===Calling.L6.Group&&(isPageVisible?setGroupCallVideoRequest(activeCall.remoteParticipants.map((function(participant){return participant===activeGroupCallSpeaker?{demuxId:participant.demuxId,width:clamp_default()(Math.floor(120*participant.videoAspectRatio),1,constants.up),height:120}:(0,nonRenderedRemoteParticipant.M)(participant)})),120):setGroupCallVideoRequest(activeCall.remoteParticipants.map(nonRenderedRemoteParticipant.M),0))}),[activeCall.callMode,activeCall.remoteParticipants,activeGroupCallSpeaker,isPageVisible,setGroupCallVideoRequest]),activeCall.callMode){case Calling.L6.Direct:var hasRemoteVideo=activeCall.remoteParticipants[0].hasRemoteVideo;return hasRemoteVideo?(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(DirectCallRemoteParticipant.e,{conversation,hasRemoteVideo,i18n,setRendererCanvas})}):(0,jsx_runtime.jsx)(NoVideo,{activeCall,i18n});case Calling.L6.Group:return activeGroupCallSpeaker?(0,jsx_runtime.jsx)("div",{className:"module-calling-pip__video--remote",children:(0,jsx_runtime.jsx)(GroupCallRemoteParticipant.B,{getFrameBuffer:getGroupCallFrameBuffer,getGroupCallVideoFrameSource,i18n,isInPip:!0,remoteParticipant:activeGroupCallSpeaker,remoteParticipantsCount:activeCall.remoteParticipants.length,isActiveSpeakerInSpeakerView:!1})}):(0,jsx_runtime.jsx)(NoVideo,{activeCall,i18n});default:throw(0,missingCaseError.b)(activeCall)}}NoVideo.displayName="NoVideo";var PositionMode,useActivateSpeakerViewOnPresenting=__webpack_require__("./ts/hooks/useActivateSpeakerViewOnPresenting.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(PositionMode){PositionMode[PositionMode.BeingDragged=0]="BeingDragged",PositionMode[PositionMode.SnapToBottom=1]="SnapToBottom",PositionMode[PositionMode.SnapToLeft=2]="SnapToLeft",PositionMode[PositionMode.SnapToRight=3]="SnapToRight",PositionMode[PositionMode.SnapToTop=4]="SnapToTop"}(PositionMode||(PositionMode={}));function CallingPip(_ref){var activeCall=_ref.activeCall,getGroupCallVideoFrameSource=_ref.getGroupCallVideoFrameSource,hangUpActiveCall=_ref.hangUpActiveCall,hasLocalVideo=_ref.hasLocalVideo,i18n=_ref.i18n,setGroupCallVideoRequest=_ref.setGroupCallVideoRequest,setLocalPreview=_ref.setLocalPreview,setRendererCanvas=_ref.setRendererCanvas,switchToPresentationView=_ref.switchToPresentationView,switchFromPresentationView=_ref.switchFromPresentationView,togglePip=_ref.togglePip,videoContainerRef=react.useRef(null),localVideoRef=react.useRef(null),_React$useState2=_slicedToArray(react.useState(window.innerWidth),2),windowWidth=_React$useState2[0],setWindowWidth=_React$useState2[1],_React$useState4=_slicedToArray(react.useState(window.innerHeight),2),windowHeight=_React$useState4[0],setWindowHeight=_React$useState4[1],_React$useState6=_slicedToArray(react.useState({mode:PositionMode.SnapToRight,offsetY:56}),2),positionState=_React$useState6[0],setPositionState=_React$useState6[1];(0,useActivateSpeakerViewOnPresenting.G)({remoteParticipants:activeCall.remoteParticipants,switchToPresentationView,switchFromPresentationView}),react.useEffect((function(){setLocalPreview({element:localVideoRef})}),[setLocalPreview]);var hangUp=react.useCallback((function(){hangUpActiveCall("pip button click")}),[hangUpActiveCall]),handleMouseMove=react.useCallback((function(ev){positionState.mode===PositionMode.BeingDragged&&setPositionState((function(oldState){return Object.assign({},oldState,{mouseX:ev.clientX,mouseY:ev.clientY})}))}),[positionState]),handleMouseUp=react.useCallback((function(){if(positionState.mode===PositionMode.BeingDragged){var mouseX=positionState.mouseX,mouseY=positionState.mouseY,dragOffsetX=positionState.dragOffsetX,dragOffsetY=positionState.dragOffsetY,_window=window,innerHeight=_window.innerHeight,innerWidth=_window.innerWidth,offsetX=mouseX-dragOffsetX,offsetY=mouseY-dragOffsetY,snapCandidates=[{mode:PositionMode.SnapToLeft,distanceToEdge:offsetX},{mode:PositionMode.SnapToRight,distanceToEdge:innerWidth-(offsetX+120)},{mode:PositionMode.SnapToTop,distanceToEdge:offsetY-56},{mode:PositionMode.SnapToBottom,distanceToEdge:innerHeight-(offsetY+156)}],snapTo=minBy_default()(snapCandidates,(function(candidate){return candidate.distanceToEdge}))||snapCandidates[0];switch(snapTo.mode){case PositionMode.SnapToLeft:case PositionMode.SnapToRight:setPositionState({mode:snapTo.mode,offsetY});break;case PositionMode.SnapToTop:case PositionMode.SnapToBottom:setPositionState({mode:snapTo.mode,offsetX});break;default:throw(0,missingCaseError.b)(snapTo.mode)}}}),[positionState,setPositionState]);react.useEffect((function(){return positionState.mode===PositionMode.BeingDragged?(document.addEventListener("mousemove",handleMouseMove,!1),document.addEventListener("mouseup",handleMouseUp,!1),function(){document.removeEventListener("mouseup",handleMouseUp,!1),document.removeEventListener("mousemove",handleMouseMove,!1)}):noop_default()}),[positionState.mode,handleMouseMove,handleMouseUp]),react.useEffect((function(){var handleWindowResize=debounce_default()((function(){setWindowWidth(window.innerWidth),setWindowHeight(window.innerHeight)}),100,{maxWait:3e3});return window.addEventListener("resize",handleWindowResize,!1),function(){window.removeEventListener("resize",handleWindowResize,!1)}}),[]);var _React$useMemo2=_slicedToArray(react.useMemo((function(){switch(positionState.mode){case PositionMode.BeingDragged:return[positionState.mouseX-positionState.dragOffsetX,positionState.mouseY-positionState.dragOffsetY];case PositionMode.SnapToLeft:return[8,Math.min(positionState.offsetY,windowHeight-8-156)];case PositionMode.SnapToRight:return[windowWidth-8-120,Math.min(positionState.offsetY,windowHeight-8-156)];case PositionMode.SnapToTop:return[Math.min(positionState.offsetX,windowWidth-8-120),64];case PositionMode.SnapToBottom:return[Math.min(positionState.offsetX,windowWidth-8-120),windowHeight-8-156];default:throw(0,missingCaseError.b)(positionState)}}),[windowWidth,windowHeight,positionState]),2),translateX=_React$useMemo2[0],translateY=_React$useMemo2[1];return(0,jsx_runtime.jsxs)("div",{className:"module-calling-pip",onMouseDown:function(ev){var node=videoContainerRef.current;if(node){var rect=node.getBoundingClientRect(),dragOffsetX=ev.clientX-rect.left,dragOffsetY=ev.clientY-rect.top;setPositionState({mode:PositionMode.BeingDragged,mouseX:ev.clientX,mouseY:ev.clientY,dragOffsetX,dragOffsetY})}},ref:videoContainerRef,style:{cursor:positionState.mode===PositionMode.BeingDragged?"-webkit-grabbing":"-webkit-grab",transform:`translate3d(${translateX}px,calc(${translateY}px - var(--titlebar-height)), 0)`,transition:positionState.mode===PositionMode.BeingDragged?"none":"transform ease-out 300ms"},children:[(0,jsx_runtime.jsx)(CallingPipRemoteVideo,{activeCall,getGroupCallVideoFrameSource,i18n,setRendererCanvas,setGroupCallVideoRequest}),hasLocalVideo?(0,jsx_runtime.jsx)("video",{className:"module-calling-pip__video--local",ref:localVideoRef,autoPlay:!0}):null,(0,jsx_runtime.jsxs)("div",{className:"module-calling-pip__actions",children:[(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:calling__hangup"),className:"module-calling-pip__button--hangup",onClick:hangUp,type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:calling__pip--off"),className:"module-calling-pip__button--pip",onClick:togglePip,type:"button",children:(0,jsx_runtime.jsx)("div",{})})]})]})}CallingPip.displayName="CallingPip"},"./ts/components/DirectCallRemoteParticipant.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>DirectCallRemoteParticipant});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_types_Colors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Colors.ts"),_Avatar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Avatar.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function DirectCallRemoteParticipant(_ref){var conversation=_ref.conversation,hasRemoteVideo=_ref.hasRemoteVideo,i18n=_ref.i18n,setRendererCanvas=_ref.setRendererCanvas,remoteVideoRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){return setRendererCanvas({element:remoteVideoRef}),function(){setRendererCanvas({element:void 0})}}),[setRendererCanvas]),hasRemoteVideo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("canvas",{className:"module-ongoing-call__remote-video-enabled",ref:remoteVideoRef}):renderAvatar(i18n,conversation)}function renderAvatar(i18n,_ref2){var acceptedMessageRequest=_ref2.acceptedMessageRequest,avatarPath=_ref2.avatarPath,color=_ref2.color,isMe=_ref2.isMe,phoneNumber=_ref2.phoneNumber,profileName=_ref2.profileName,sharedGroupNames=_ref2.sharedGroupNames,title=_ref2.title;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"module-ongoing-call__remote-video-disabled",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_2__.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:color||_types_Colors__WEBPACK_IMPORTED_MODULE_1__.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe,phoneNumber,profileName,title,sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_2__.DZ.EIGHTY})})}renderAvatar.displayName="renderAvatar"},"./ts/hooks/useActivateSpeakerViewOnPresenting.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{G:()=>useActivateSpeakerViewOnPresenting});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_usePrevious__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/hooks/usePrevious.ts");function useActivateSpeakerViewOnPresenting(_ref){var _remoteParticipants$f,remoteParticipants=_ref.remoteParticipants,switchToPresentationView=_ref.switchToPresentationView,switchFromPresentationView=_ref.switchFromPresentationView,presenterUuid=null===(_remoteParticipants$f=remoteParticipants.find((function(participant){return participant.presenting})))||void 0===_remoteParticipants$f?void 0:_remoteParticipants$f.uuid,prevPresenterUuid=(0,_usePrevious__WEBPACK_IMPORTED_MODULE_1__.D)(presenterUuid,presenterUuid);(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){prevPresenterUuid!==presenterUuid&&presenterUuid?switchToPresentationView():prevPresenterUuid&&!presenterUuid&&switchFromPresentationView()}),[presenterUuid,prevPresenterUuid,switchToPresentationView,switchFromPresentationView])}},"./ts/hooks/usePageVisibility.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{d:()=>usePageVisibility});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function usePageVisibility(){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!document.hidden),2),result=_useState2[0],setResult=_useState2[1];return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){var updatePageVisibility=function(){setResult(!document.hidden)};return updatePageVisibility(),document.addEventListener("visibilitychange",updatePageVisibility,!1),function(){document.removeEventListener("visibilitychange",updatePageVisibility,!1)}}),[]),result}},"./ts/test-both/helpers/fakeGetGroupCallVideoFrameSource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,{x:()=>fakeGetGroupCallVideoFrameSource});var COLORS=[[255,0,0],[255,153,0],[255,255,0],[0,255,0],[0,153,255],[255,0,255],[153,51,255]],FakeGroupCallVideoFrameSource=function(){function FakeGroupCallVideoFrameSource(width,height,r,g,b){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FakeGroupCallVideoFrameSource);var length=width*height*4;this.sourceArray=new Uint8Array(length);for(var i=0;i<length;i+=4)this.sourceArray[i]=r,this.sourceArray[i+1]=g,this.sourceArray[i+2]=b,this.sourceArray[i+3]=255;this.dimensions=[width,height]}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(FakeGroupCallVideoFrameSource,[{key:"receiveVideoFrame",value:function receiveVideoFrame(destinationBuffer,_maxWidth,_maxHeight){if(!(Math.random()<.5))return destinationBuffer.set(this.sourceArray),this.dimensions}}]),FakeGroupCallVideoFrameSource}();function fakeGetGroupCallVideoFrameSource(demuxId){var color=COLORS[demuxId%COLORS.length];if(!color)throw new Error("Expected a color, but it was not found");var _color=_slicedToArray(color,3),r=_color[0],g=_color[1],b=_color[2];return new FakeGroupCallVideoFrameSource(13,10,r,g,b)}},"./ts/types/Calling.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var CallMode,CallViewMode,CallState,CallEndedReason,GroupCallConnectionState,GroupCallJoinState,CallingDeviceType;__webpack_require__.d(__webpack_exports__,{$B:()=>CallingDeviceType,GT:()=>GroupCallJoinState,KQ:()=>CallEndedReason,L6:()=>CallMode,OX:()=>CallState,mB:()=>GroupCallConnectionState,pC:()=>CallViewMode}),function(CallMode){CallMode.None="None",CallMode.Direct="Direct",CallMode.Group="Group"}(CallMode||(CallMode={})),function(CallViewMode){CallViewMode.Grid="Grid",CallViewMode.Speaker="Speaker",CallViewMode.Presentation="Presentation"}(CallViewMode||(CallViewMode={})),function(CallState){CallState.Prering="idle",CallState.Ringing="ringing",CallState.Accepted="connected",CallState.Reconnecting="connecting",CallState.Ended="ended"}(CallState||(CallState={})),function(CallEndedReason){CallEndedReason.LocalHangup="LocalHangup",CallEndedReason.RemoteHangup="RemoteHangup",CallEndedReason.RemoteHangupNeedPermission="RemoteHangupNeedPermission",CallEndedReason.Declined="Declined",CallEndedReason.Busy="Busy",CallEndedReason.Glare="Glare",CallEndedReason.ReCall="ReCall",CallEndedReason.ReceivedOfferExpired="ReceivedOfferExpired",CallEndedReason.ReceivedOfferWhileActive="ReceivedOfferWhileActive",CallEndedReason.ReceivedOfferWithGlare="ReceivedOfferWithGlare",CallEndedReason.SignalingFailure="SignalingFailure",CallEndedReason.GlareFailure="GlareFailure",CallEndedReason.ConnectionFailure="ConnectionFailure",CallEndedReason.InternalFailure="InternalFailure",CallEndedReason.Timeout="Timeout",CallEndedReason.AcceptedOnAnotherDevice="AcceptedOnAnotherDevice",CallEndedReason.DeclinedOnAnotherDevice="DeclinedOnAnotherDevice",CallEndedReason.BusyOnAnotherDevice="BusyOnAnotherDevice",CallEndedReason.CallerIsNotMultiring="CallerIsNotMultiring"}(CallEndedReason||(CallEndedReason={})),function(GroupCallConnectionState){GroupCallConnectionState[GroupCallConnectionState.NotConnected=0]="NotConnected",GroupCallConnectionState[GroupCallConnectionState.Connecting=1]="Connecting",GroupCallConnectionState[GroupCallConnectionState.Connected=2]="Connected",GroupCallConnectionState[GroupCallConnectionState.Reconnecting=3]="Reconnecting"}(GroupCallConnectionState||(GroupCallConnectionState={})),function(GroupCallJoinState){GroupCallJoinState[GroupCallJoinState.NotJoined=0]="NotJoined",GroupCallJoinState[GroupCallJoinState.Joining=1]="Joining",GroupCallJoinState[GroupCallJoinState.Joined=2]="Joined"}(GroupCallJoinState||(GroupCallJoinState={})),function(CallingDeviceType){CallingDeviceType[CallingDeviceType.CAMERA=0]="CAMERA",CallingDeviceType[CallingDeviceType.MICROPHONE=1]="MICROPHONE",CallingDeviceType[CallingDeviceType.SPEAKER=2]="SPEAKER"}(CallingDeviceType||(CallingDeviceType={}))},"./ts/util/ringrtc/nonRenderedRemoteParticipant.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M:()=>nonRenderedRemoteParticipant});var nonRenderedRemoteParticipant=function(_ref){return{demuxId:_ref.demuxId,width:0,height:0}}},"./node_modules/lodash/_baseClamp.js":module=>{module.exports=function baseClamp(number,lower,upper){return number==number&&(void 0!==upper&&(number=number<=upper?number:upper),void 0!==lower&&(number=number>=lower?number:lower)),number}},"./node_modules/lodash/_baseExtremum.js":(module,__unused_webpack_exports,__webpack_require__)=>{var isSymbol=__webpack_require__("./node_modules/lodash/isSymbol.js");module.exports=function baseExtremum(array,iteratee,comparator){for(var index=-1,length=array.length;++index<length;){var value=array[index],current=iteratee(value);if(null!=current&&(void 0===computed?current==current&&!isSymbol(current):comparator(current,computed)))var computed=current,result=value}return result}},"./node_modules/lodash/_baseFindIndex.js":module=>{module.exports=function baseFindIndex(array,predicate,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?1:-1);fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}},"./node_modules/lodash/_baseGt.js":module=>{module.exports=function baseGt(value,other){return value>other}},"./node_modules/lodash/_baseLt.js":module=>{module.exports=function baseLt(value,other){return value<other}},"./node_modules/lodash/_castFunction.js":(module,__unused_webpack_exports,__webpack_require__)=>{var identity=__webpack_require__("./node_modules/lodash/identity.js");module.exports=function castFunction(value){return"function"==typeof value?value:identity}},"./node_modules/lodash/_createFind.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),isArrayLike=__webpack_require__("./node_modules/lodash/isArrayLike.js"),keys=__webpack_require__("./node_modules/lodash/keys.js");module.exports=function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=baseIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:void 0}}},"./node_modules/lodash/clamp.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseClamp=__webpack_require__("./node_modules/lodash/_baseClamp.js"),toNumber=__webpack_require__("./node_modules/lodash/toNumber.js");module.exports=function clamp(number,lower,upper){return void 0===upper&&(upper=lower,lower=void 0),void 0!==upper&&(upper=(upper=toNumber(upper))==upper?upper:0),void 0!==lower&&(lower=(lower=toNumber(lower))==lower?lower:0),baseClamp(toNumber(number),lower,upper)}},"./node_modules/lodash/find.js":(module,__unused_webpack_exports,__webpack_require__)=>{var find=__webpack_require__("./node_modules/lodash/_createFind.js")(__webpack_require__("./node_modules/lodash/findIndex.js"));module.exports=find},"./node_modules/lodash/findIndex.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseFindIndex=__webpack_require__("./node_modules/lodash/_baseFindIndex.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),toInteger=__webpack_require__("./node_modules/lodash/toInteger.js"),nativeMax=Math.max;module.exports=function findIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,baseIteratee(predicate,3),index)}},"./node_modules/lodash/findLast.js":(module,__unused_webpack_exports,__webpack_require__)=>{var findLast=__webpack_require__("./node_modules/lodash/_createFind.js")(__webpack_require__("./node_modules/lodash/findLastIndex.js"));module.exports=findLast},"./node_modules/lodash/findLastIndex.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseFindIndex=__webpack_require__("./node_modules/lodash/_baseFindIndex.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),toInteger=__webpack_require__("./node_modules/lodash/toInteger.js"),nativeMax=Math.max,nativeMin=Math.min;module.exports=function findLastIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return void 0!==fromIndex&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,baseIteratee(predicate,3),index,!0)}},"./node_modules/lodash/first.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/lodash/head.js")},"./node_modules/lodash/head.js":module=>{module.exports=function head(array){return array&&array.length?array[0]:void 0}},"./node_modules/lodash/last.js":module=>{module.exports=function last(array){var length=null==array?0:array.length;return length?array[length-1]:void 0}},"./node_modules/lodash/maxBy.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseExtremum=__webpack_require__("./node_modules/lodash/_baseExtremum.js"),baseGt=__webpack_require__("./node_modules/lodash/_baseGt.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js");module.exports=function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,baseIteratee(iteratee,2),baseGt):void 0}},"./node_modules/lodash/minBy.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseExtremum=__webpack_require__("./node_modules/lodash/_baseExtremum.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),baseLt=__webpack_require__("./node_modules/lodash/_baseLt.js");module.exports=function minBy(array,iteratee){return array&&array.length?baseExtremum(array,baseIteratee(iteratee,2),baseLt):void 0}},"./node_modules/lodash/times.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseTimes=__webpack_require__("./node_modules/lodash/_baseTimes.js"),castFunction=__webpack_require__("./node_modules/lodash/_castFunction.js"),toInteger=__webpack_require__("./node_modules/lodash/toInteger.js"),nativeMin=Math.min;module.exports=function times(n,iteratee){if((n=toInteger(n))<1||n>9007199254740991)return[];var index=4294967295,length=nativeMin(n,4294967295);iteratee=castFunction(iteratee),n-=4294967295;for(var result=baseTimes(length,iteratee);++index<n;)iteratee(index);return result}}}]);