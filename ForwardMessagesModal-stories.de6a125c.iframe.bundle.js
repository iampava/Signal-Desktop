"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[2295],{"./ts/Bytes.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>byteLength,mV:()=>concatenate,Gh:()=>fromBase64,H_:()=>fromHex,mL:()=>fromString,s3:()=>toBase64});var buffer=__webpack_require__("./node_modules/buffer/index.js");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _window$SignalContext,Bytes=function(){function Bytes(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Bytes)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Bytes,[{key:"fromBase64",value:function fromBase64(value){return buffer.lW.from(value,"base64")}},{key:"fromHex",value:function fromHex(value){return buffer.lW.from(value,"hex")}},{key:"fromBinary",value:function fromBinary(value){return buffer.lW.from(value,"binary")}},{key:"fromString",value:function fromString(value){return buffer.lW.from(value)}},{key:"toBase64",value:function toBase64(data){return buffer.lW.from(data).toString("base64")}},{key:"toHex",value:function toHex(data){return buffer.lW.from(data).toString("hex")}},{key:"toBinary",value:function toBinary(data){return buffer.lW.from(data).toString("binary")}},{key:"toString",value:function toString(data){return buffer.lW.from(data).toString()}},{key:"byteLength",value:function byteLength(value){return buffer.lW.byteLength(value)}},{key:"concatenate",value:function concatenate(list){return buffer.lW.concat(list)}},{key:"isEmpty",value:function isEmpty(data){return!data||0===data.length}},{key:"isNotEmpty",value:function isNotEmpty(data){return!this.isEmpty(data)}},{key:"areEqual",value:function areEqual(a,b){return a&&b?0===buffer.lW.compare(a,b):!a&&!b}}]),Bytes}(),bytes=(null===(_window$SignalContext=window.SignalContext)||void 0===_window$SignalContext?void 0:_window$SignalContext.bytes)||new Bytes;function fromBase64(value){return bytes.fromBase64(value)}function fromHex(value){return bytes.fromHex(value)}function fromString(value){return bytes.fromString(value)}function toBase64(data){return bytes.toBase64(data)}function byteLength(value){return bytes.byteLength(value)}function concatenate(list){return bytes.concatenate(list)}},"./ts/components/CompositionTextArea.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>CompositionTextArea});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_util_shouldNeverBeCalled__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/shouldNeverBeCalled.ts"),_CompositionInput__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/CompositionInput.tsx"),_emoji_EmojiButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/emoji/EmojiButton.tsx"),_util_grapheme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/grapheme.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CompositionTextArea(_ref){var bodyRanges=_ref.bodyRanges,draftText=_ref.draftText,getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,isFormattingEnabled=_ref.isFormattingEnabled,isFormattingFlagEnabled=_ref.isFormattingFlagEnabled,isFormattingSpoilersFlagEnabled=_ref.isFormattingSpoilersFlagEnabled,maxLength=_ref.maxLength,onChange=_ref.onChange,onPickEmoji=_ref.onPickEmoji,onScroll=_ref.onScroll,onSetSkinTone=_ref.onSetSkinTone,onSubmit=_ref.onSubmit,onTextTooLong=_ref.onTextTooLong,placeholder=_ref.placeholder,platform=_ref.platform,recentEmojis=_ref.recentEmojis,scrollerRef=_ref.scrollerRef,skinTone=_ref.skinTone,theme=_ref.theme,_ref$whenToShowRemain=_ref.whenToShowRemainingCount,whenToShowRemainingCount=void 0===_ref$whenToShowRemain?1/0:_ref$whenToShowRemain,inputApiRef=react__WEBPACK_IMPORTED_MODULE_1__.useRef(),_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(_util_grapheme__WEBPACK_IMPORTED_MODULE_5__.QX(draftText)),2),characterCount=_React$useState2[0],setCharacterCount=_React$useState2[1],insertEmoji=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(e){inputApiRef.current&&(inputApiRef.current.insertEmoji(e),onPickEmoji(e))}),[inputApiRef,onPickEmoji]),focusTextEditInput=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){inputApiRef.current&&inputApiRef.current.focus()}),[inputApiRef]),handleChange=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(_ref2){var updatedBodyRanges=_ref2.bodyRanges,caretLocation=_ref2.caretLocation,newValue=_ref2.messageText,inputEl=inputApiRef.current;if(inputEl){var _grapheme$truncateAnd2=_slicedToArray(_util_grapheme__WEBPACK_IMPORTED_MODULE_5__.Rc(newValue,maxLength),2),newValueSized=_grapheme$truncateAnd2[0],newCharacterCount=_grapheme$truncateAnd2[1];void 0!==maxLength&&newValueSized.length<newValue.length&&inputEl.setContents(newValueSized,updatedBodyRanges,!0),setCharacterCount(newCharacterCount),onChange(newValue,updatedBodyRanges,caretLocation)}}),[maxLength,onChange]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"CompositionTextArea",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_CompositionInput__WEBPACK_IMPORTED_MODULE_3__.D,{clearQuotedMessage:_util_shouldNeverBeCalled__WEBPACK_IMPORTED_MODULE_2__.U,draftBodyRanges:bodyRanges,draftText,getPreferredBadge,getQuotedMessage:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),i18n,isFormattingEnabled,isFormattingFlagEnabled,isFormattingSpoilersFlagEnabled,inputApi:inputApiRef,large:!0,moduleClassName:"CompositionTextArea__input",onEditorStateChange:handleChange,onPickEmoji,onScroll,onSubmit,onTextTooLong,placeholder,platform,scrollerRef,sendCounter:0,theme}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"CompositionTextArea__emoji",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_emoji_EmojiButton__WEBPACK_IMPORTED_MODULE_4__.K,{i18n,onClose:focusTextEditInput,onPickEmoji:insertEmoji,onSetSkinTone,recentEmojis,skinTone})}),void 0!==maxLength&&characterCount>=whenToShowRemainingCount&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"CompositionTextArea__remaining-character-count",children:maxLength-characterCount})]})}CompositionTextArea.displayName="CompositionTextArea"},"./ts/components/ForwardMessagesModal.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ASticker:()=>ASticker,AnnouncementOnlyGroupsNonAdmin:()=>AnnouncementOnlyGroupsNonAdmin,LinkPreview:()=>ForwardMessagesModal_stories_LinkPreview,MediaAttachments:()=>MediaAttachments,Modal:()=>Modal,WithAContact:()=>WithAContact,WithText:()=>WithText,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ForwardMessagesModal_stories});var react=__webpack_require__("./node_modules/react/index.js"),esm=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),dist=__webpack_require__("./node_modules/@storybook/addon-knobs/dist/index.js"),messages=__webpack_require__("./_locales/en/messages.json"),index_esm=__webpack_require__("./node_modules/react-measure/dist/index.esm.js"),react_spring_web_esm=__webpack_require__("./node_modules/@react-spring/web/dist/react-spring-web.esm.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),AttachmentList=__webpack_require__("./ts/components/conversation/AttachmentList.tsx"),Button=__webpack_require__("./ts/components/Button.tsx"),ConfirmationDialog=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),ContactCheckbox=__webpack_require__("./ts/components/conversationList/ContactCheckbox.tsx"),ConversationList=__webpack_require__("./ts/components/ConversationList.tsx"),ModalHost=__webpack_require__("./ts/components/ModalHost.tsx"),SearchInput=__webpack_require__("./ts/components/SearchInput.tsx"),StagedLinkPreview=__webpack_require__("./ts/components/conversation/StagedLinkPreview.tsx"),filterAndSortConversations=__webpack_require__("./ts/util/filterAndSortConversations.ts"),useAnimated=__webpack_require__("./ts/hooks/useAnimated.tsx"),shouldNeverBeCalled=__webpack_require__("./ts/util/shouldNeverBeCalled.ts"),Attachment=(__webpack_require__("./node_modules/lodash/orderBy.js"),__webpack_require__("./ts/types/Attachment.ts")),logging_log=__webpack_require__("./ts/logging/log.ts"),p_queue_dist=(__webpack_require__("./ts/components/SafetyNumberChangeDialog.tsx"),__webpack_require__("./node_modules/p-queue/dist/index.js")),durations=__webpack_require__("./ts/util/durations/index.ts");var helpers=__webpack_require__("./ts/messages/helpers.ts"),whatTypeOfConversation=__webpack_require__("./ts/util/whatTypeOfConversation.ts");var omit=__webpack_require__("./node_modules/lodash/omit.js"),omit_default=__webpack_require__.n(omit),debounce=__webpack_require__("./node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce),errors=__webpack_require__("./ts/types/errors.ts"),ts_Bytes=__webpack_require__("./ts/Bytes.ts"),types_LinkPreview=__webpack_require__("./ts/types/LinkPreview.ts"),values=__webpack_require__("./node_modules/lodash/values.js"),values_default=__webpack_require__.n(values),groupBy=__webpack_require__("./node_modules/lodash/groupBy.js"),groupBy_default=__webpack_require__.n(groupBy),reject=__webpack_require__("./node_modules/lodash/reject.js"),reject_default=__webpack_require__.n(reject),pick=__webpack_require__("./node_modules/lodash/pick.js"),pick_default=__webpack_require__.n(pick),isNumber=__webpack_require__("./node_modules/lodash/isNumber.js"),isNumber_default=__webpack_require__.n(isNumber),p_map=__webpack_require__("./node_modules/p-map/index.js"),p_map_default=__webpack_require__.n(p_map),assert=__webpack_require__("./ts/util/assert.ts");function dropNull_dropNull(value){if(null!==value)return value}var Crypto_HashType,Crypto_CipherType,util_url=__webpack_require__("./ts/util/url.ts"),buffer=__webpack_require__("./node_modules/buffer/index.js"),libsignal_client_=(__webpack_require__("./node_modules/long/src/long.js"),__webpack_require__("@signalapp/libsignal-client"));!function(HashType){HashType.size256="sha256",HashType.size512="sha512"}(Crypto_HashType||(Crypto_HashType={})),function(CipherType){CipherType.AES256CBC="aes-256-cbc",CipherType.AES256CTR="aes-256-ctr",CipherType.AES256GCM="aes-256-gcm"}(Crypto_CipherType||(Crypto_CipherType={}));var types_UUID=__webpack_require__("./ts/types/UUID.ts");__webpack_require__("./node_modules/lodash/chunk.js");function Crypto_slicedToArray(arr,i){return function Crypto_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function Crypto_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function Crypto_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Crypto_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Crypto_arrayLikeToArray(o,minLen)}(arr,i)||function Crypto_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Crypto_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function deriveSecrets(input,salt,info){var output=libsignal_client_.HKDF.new(3).deriveSecrets(96,buffer.lW.from(input),buffer.lW.from(info),buffer.lW.from(salt));return[output.slice(0,32),output.slice(32,64),output.slice(64,96)]}function hmacSha256(key,plaintext){return function sign(key,data){return Crypto_crypto.sign(key,data)}(key,plaintext)}function decryptAes256CbcPkcsPadding(key,ciphertext,iv){return decrypt(Crypto_CipherType.AES256CBC,{key,ciphertext,iv})}function sha256(data){return Crypto_hash(Crypto_HashType.size256,data)}function getZeroes(n){return new Uint8Array(n)}function decryptAttachment(encryptedBin,keys,theirDigest){if(64!==keys.byteLength)throw new Error("Got invalid length attachment keys");if(encryptedBin.byteLength<48)throw new Error("Got invalid length attachment");var aesKey=keys.slice(0,32),macKey=keys.slice(32,64),iv=encryptedBin.slice(0,16),ciphertext=encryptedBin.slice(16,encryptedBin.byteLength-32);return function verifyHmacSha256(plaintext,key,theirMac,length){var ourMac=hmacSha256(key,plaintext);if(theirMac.byteLength!==length||ourMac.byteLength<length)throw new Error("Bad MAC length");for(var result=0,i=0;i<theirMac.byteLength;i+=1)result|=ourMac[i]^theirMac[i];if(0!==result)throw new Error("Bad MAC")}(encryptedBin.slice(0,encryptedBin.byteLength-32),macKey,encryptedBin.slice(encryptedBin.byteLength-32,encryptedBin.byteLength),32),theirDigest&&function verifyDigest(data,theirDigest){for(var ourDigest=sha256(data),result=0,i=0;i<theirDigest.byteLength;i+=1)result|=ourDigest[i]^theirDigest[i];if(0!==result)throw new Error("Bad digest")}(encryptedBin,theirDigest),decryptAes256CbcPkcsPadding(aesKey,ciphertext,iv)}var Crypto_crypto=window.SignalContext.crypto;function Crypto_hash(type,data){return Crypto_crypto.hash(type,data)}function decrypt(){return Crypto_crypto.decrypt.apply(Crypto_crypto,arguments)}var MIME=__webpack_require__("./ts/types/MIME.ts");var TYPES=[{mimeType:MIME.Oh,bytePattern:new Uint8Array([0,0,1,0])},{mimeType:MIME.Oh,bytePattern:new Uint8Array([0,0,2,0])},{mimeType:MIME.UG,bytePattern:new Uint8Array([66,77])},{mimeType:MIME.dB,bytePattern:new Uint8Array([71,73,70,56,55,97])},{mimeType:MIME.dB,bytePattern:new Uint8Array([71,73,70,56,57,97])},{mimeType:MIME.to,bytePattern:new Uint8Array([82,73,70,70,0,0,0,0,87,69,66,80,86,80]),patternMask:new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255])},{mimeType:MIME.Ih,bytePattern:new Uint8Array([137,80,78,71,13,10,26,10])},{mimeType:MIME._l,bytePattern:new Uint8Array([255,216,255])}];function matchesType(input,type){if(input.byteLength<type.bytePattern.byteLength)return!1;for(var p=0;p<type.bytePattern.length;p+=1){var mask=type.patternMask?type.patternMask[p]:255;if((input[p]&mask)!==type.bytePattern[p])return!1}return!0}var map=__webpack_require__("./node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),last=__webpack_require__("./node_modules/lodash/last.js"),last_default=__webpack_require__.n(last),isTypedArray=__webpack_require__("./node_modules/lodash/isTypedArray.js"),isTypedArray_default=__webpack_require__.n(isTypedArray),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),has=__webpack_require__("./node_modules/lodash/has.js"),has_default=__webpack_require__.n(has),external_electron_=__webpack_require__("electron");function buildAvatarUpdater(_ref){var field=_ref.field;return async function(conversation,data,_ref2){var deleteAttachmentData=_ref2.deleteAttachmentData,doesAttachmentExist=_ref2.doesAttachmentExist,writeNewAttachmentData=_ref2.writeNewAttachmentData;if(!conversation)return conversation;var avatar=conversation[field],newHash=function computeHash(data){return ts_Bytes.s3(Crypto_hash(Crypto_HashType.size512,data))}(data);if(!avatar||!avatar.hash)return Object.assign({},conversation,{[field]:{hash:newHash,path:await writeNewAttachmentData(data)}});var hash=avatar.hash,path=avatar.path,exists=await doesAttachmentExist(path);return exists||window.SignalContext.log.warn(`Conversation.buildAvatarUpdater: attachment ${path} did not exist`),exists&&hash===newHash?conversation:(await deleteAttachmentData(path),Object.assign({},conversation,{[field]:{hash:newHash,path:await writeNewAttachmentData(data)}}))}}buildAvatarUpdater({field:"avatar"}),buildAvatarUpdater({field:"profileAvatar"});var clearTimeoutIfNecessary=__webpack_require__("./ts/util/clearTimeoutIfNecessary.ts"),sleep=__webpack_require__("./ts/util/sleep.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var optimizer=new(function(){function FTSOptimizer(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FTSOptimizer),this.isRunning=!1}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(FTSOptimizer,[{key:"run",value:async function run(){if(!this.isRunning){var state;this.isRunning=!0,logging_log.info("ftsOptimizer: starting");var start=Date.now();try{do{var _state;void 0!==state&&await(0,sleep._)(50),state=await Client.optimizeFTS(state)}while(null===(_state=state)||void 0===_state||!_state.done)}finally{this.isRunning=!1}var duration=Date.now()-start;state?logging_log.info(`ftsOptimizer: took ${duration}ms and ${state.steps} steps`):logging_log.warn("ftsOptimizer: no final state")}}}]),FTSOptimizer}()),scheduleOptimizeFTS=debounce_default()((function(){optimizer.run()}),durations.sh,{maxWait:5*durations.sh});function expiringMessagesDeletion_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ExpiringMessagesDeletionService=function(){function ExpiringMessagesDeletionService(){!function expiringMessagesDeletion_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ExpiringMessagesDeletionService),this.update=debounce_default()(this.checkExpiringMessages,1e3)}return function expiringMessagesDeletion_createClass(Constructor,protoProps,staticProps){return protoProps&&expiringMessagesDeletion_defineProperties(Constructor.prototype,protoProps),staticProps&&expiringMessagesDeletion_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(ExpiringMessagesDeletionService,[{key:"destroyExpiredMessages",value:async function destroyExpiredMessages(){try{window.SignalContext.log.info("destroyExpiredMessages: Loading messages...");var messages=await window.Signal.Data.getExpiredMessages();window.SignalContext.log.info(`destroyExpiredMessages: found ${messages.length} messages to expire`);var messageIds=[],inMemoryMessages=[],messageCleanup=[];messages.forEach((function(dbMessage){var message=window.MessageController.register(dbMessage.id,dbMessage);messageIds.push(message.id),inMemoryMessages.push(message),messageCleanup.push(message.cleanup())})),await window.Signal.Data.removeMessages(messageIds),await Promise.all(messageCleanup),inMemoryMessages.forEach((function(message){window.SignalContext.log.info("Message expired",{sentAt:message.get("sent_at")});var conversation=message.getConversation();message.trigger("expired"),window.reduxActions.conversations.messageExpired(message.id),conversation&&conversation.decrementMessageCount()})),messages.length>0&&scheduleOptimizeFTS()}catch(error){window.SignalContext.log.error("destroyExpiredMessages: Error deleting expired messages",errors.G(error)),window.SignalContext.log.info("destroyExpiredMessages: Waiting 30 seconds before trying again"),await(0,sleep._)(30*durations.sh)}window.SignalContext.log.info("destroyExpiredMessages: done, scheduling another check"),this.update()}},{key:"checkExpiringMessages",value:async function checkExpiringMessages(){window.SignalContext.log.info("checkExpiringMessages: checking for expiring messages");var soonestExpiry=await window.Signal.Data.getSoonestMessageExpiry();if(soonestExpiry){var wait=soonestExpiry-Date.now();wait<0&&(wait=0),wait>2147483647&&(wait=2147483647),window.SignalContext.log.info(`checkExpiringMessages: next message expires ${new Date(soonestExpiry).toISOString()}; waiting ${wait} ms before clearing`),(0,clearTimeoutIfNecessary.S)(this.timeout),this.timeout=setTimeout(this.destroyExpiredMessages.bind(this),wait)}else window.SignalContext.log.info("checkExpiringMessages: found no messages to expire")}}]),ExpiringMessagesDeletionService}(),expiringMessagesDeletionService=new ExpiringMessagesDeletionService;function tapToViewMessagesDeletionService_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TapToViewMessagesDeletionService=function(){function TapToViewMessagesDeletionService(){!function tapToViewMessagesDeletionService_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TapToViewMessagesDeletionService),this.update=debounce_default()(this.checkTapToViewMessages,1e3)}return function tapToViewMessagesDeletionService_createClass(Constructor,protoProps,staticProps){return protoProps&&tapToViewMessagesDeletionService_defineProperties(Constructor.prototype,protoProps),staticProps&&tapToViewMessagesDeletionService_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(TapToViewMessagesDeletionService,[{key:"checkTapToViewMessages",value:async function checkTapToViewMessages(){var _this=this,receivedAt=await window.Signal.Data.getNextTapToViewMessageTimestampToAgeOut();if(receivedAt){var nextCheck=receivedAt+30*durations.x4;window.SignalContext.log.info("checkTapToViewMessages: next check at",new Date(nextCheck).toISOString());var wait=nextCheck-Date.now();wait<0&&(wait=0),wait>2147483647&&(wait=2147483647),(0,clearTimeoutIfNecessary.S)(this.timeout),this.timeout=setTimeout((async function(){await async function eraseTapToViewMessages(){try{window.SignalContext.log.info("eraseTapToViewMessages: Loading messages...");var messages=await window.Signal.Data.getTapToViewMessagesNeedingErase();await Promise.all(messages.map((async function(fromDB){var message=window.MessageController.register(fromDB.id,fromDB);window.SignalContext.log.info("eraseTapToViewMessages: erasing message contents",message.idForLogging()),message.trigger("expired"),window.reduxActions.conversations.messageExpired(message.id),await message.eraseContents()})))}catch(error){window.SignalContext.log.error("eraseTapToViewMessages: Error erasing messages",errors.G(error))}window.SignalContext.log.info("eraseTapToViewMessages: complete")}(),_this.update()}),wait)}}}]),TapToViewMessagesDeletionService}(),tapToViewMessagesDeletionService=new TapToViewMessagesDeletionService;window.batchers=[],window.waitForAllBatchers=async function(){logging_log.info("batcher#waitForAllBatchers");try{await Promise.all(window.batchers.map((function(item){return item.flushAndWait()})))}catch(error){logging_log.error("waitForAllBatchers: error flushing all",errors.G(error))}};var set=__webpack_require__("./node_modules/lodash/set.js"),set_default=__webpack_require__.n(set),cloneDeep=__webpack_require__("./node_modules/lodash/cloneDeep.js"),cloneDeep_default=__webpack_require__.n(cloneDeep);function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function mapObjectWithSpec_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return mapObjectWithSpec_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mapObjectWithSpec_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function mapObjectWithSpec_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function mapObjectWithSpec(spec,data,map){var target=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cloneDeep_default()(data);if(!data)return target;if("string"==typeof spec){var _value=get_default()(data,spec);return _value&&set_default()(target,spec,map(_value)),target}if("isMap"in spec){for(var _i=0,_Object$keys=Object.keys(data);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];target[key]=mapObjectWithSpec(spec.valueSpec,data[key],map,target[key])}return target}if("key"in spec)return target[spec.key]=mapObjectWithSpec(spec.valueSpec,data[spec.key],map,target[spec.key]),target;var _step,_iterator=_createForOfIteratorHelper(spec);try{for(_iterator.s();!(_step=_iterator.n()).done;){var _key=_step.value;mapObjectWithSpec(_key,data,map,target)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return target}var isPlainObject=__webpack_require__("./node_modules/lodash/isPlainObject.js"),isPlainObject_default=__webpack_require__.n(isPlainObject),iterables=__webpack_require__("./ts/util/iterables.ts");function cleanDataForIpc_slicedToArray(arr,i){return function cleanDataForIpc_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function cleanDataForIpc_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||cleanDataForIpc_unsupportedIterableToArray(arr,i)||function cleanDataForIpc_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cleanDataForIpc_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return cleanDataForIpc_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cleanDataForIpc_arrayLikeToArray(o,minLen):void 0}}function cleanDataForIpc_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function cleanDataForIpc(data){var pathsChanged=[];return{cleaned:cleanDataInner(data,"root",pathsChanged,0),pathsChanged}}function cleanDataInner(data,path,pathsChanged,depth){if(depth>10)return logging_log.error(`cleanDataInner: Reached maximum depth ${depth}; path is ${path}`),{cleaned:data,pathsChanged};switch(typeof data){case"undefined":case"boolean":case"number":case"string":return data;case"bigint":return pathsChanged.push(path),data.toString();case"function":return;case"object":if(null===data)return null;if(Array.isArray(data)){var _result=[];return data.forEach((function(item,index){var indexPath=`${path}.${index}`;null==item?pathsChanged.push(indexPath):_result.push(cleanDataInner(item,indexPath,pathsChanged,depth+1))})),_result}if(data instanceof Map){var _result2={};return pathsChanged.push(path),data.forEach((function(value,key){"string"==typeof key?_result2[key]=cleanDataInner(value,`${path}.<map value at ${key}>`,pathsChanged,depth+1):pathsChanged.push(`${path}.<map key ${String(key)}>`)})),_result2}if(data instanceof Date)return pathsChanged.push(path),Number.isNaN(data.valueOf())?void 0:data.toISOString();if(data instanceof ArrayBuffer)return void pathsChanged.push(path);if(data instanceof Uint8Array)return data;var dataAsRecord=data;if("toNumber"in dataAsRecord&&"function"==typeof dataAsRecord.toNumber)return cleanDataInner(dataAsRecord.toNumber(),path,pathsChanged,depth+1);if((0,iterables.TW)(dataAsRecord)){var _result3=[],index=0;pathsChanged.push(path);var _step,_iterator=function cleanDataForIpc_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=cleanDataForIpc_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(dataAsRecord);try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;_result3.push(cleanDataInner(value,`${path}.<iterator index ${index}>`,pathsChanged,depth+1)),index+=1}}catch(err){_iterator.e(err)}finally{_iterator.f()}return _result3}isPlainObject_default()(data)||pathsChanged.push(path);var result={};return Object.entries(dataAsRecord).forEach((function(_ref){var _ref2=cleanDataForIpc_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];result[key]=cleanDataInner(value,`${path}.${key}`,pathsChanged,depth+1)})),result;default:return void pathsChanged.push(path)}}var util_explodePromise=__webpack_require__("./ts/util/explodePromise.ts");var tasks=new Set,shouldStartTimers=!0;function createTaskWithTimeout(task,id){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},timeout=options.timeout||30*durations.EB,timeoutError=new Error(`${id||""} task did not complete in time.`);return async function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var timer,result,complete=!1,_explodePromise=(0,util_explodePromise.R)(),timerPromise=_explodePromise.promise,reject=_explodePromise.reject,startTimer=function(){stopTimer(),complete||(entry.startedAt=Date.now(),timer=setTimeout((function(){complete?logging_log.warn(`TaskWithTimeout: ${id} task timed out, but was already complete`):(complete=!0,tasks.delete(entry),logging_log.error((0,errors.G)(timeoutError)),reject(timeoutError))}),timeout))},stopTimer=function(){(0,clearTimeoutIfNecessary.S)(timer),timer=void 0},entry={id,startedAt:void 0,suspend:function(){logging_log.warn(`TaskWithTimeout: ${id} task suspended`),stopTimer()},resume:function(){logging_log.warn(`TaskWithTimeout: ${id} task resumed`),startTimer()}};tasks.add(entry),shouldStartTimers&&startTimer();var run=async function(){result=await task.apply(void 0,args)};try{return await Promise.race([run(),timerPromise]),result}finally{complete=!0,tasks.delete(entry),stopTimer()}}}async function cleanupMessage(message){var _window$reduxActions,_parentConversation$d,id=message.id,conversationId=message.conversationId;null===(_window$reduxActions=window.reduxActions)||void 0===_window$reduxActions||_window$reduxActions.conversations.messageDeleted(id,conversationId);var parentConversation=window.ConversationController.get(conversationId);null==parentConversation||null===(_parentConversation$d=parentConversation.debouncedUpdateLastMessage)||void 0===_parentConversation$d||_parentConversation$d.call(parentConversation),window.MessageController.unregister(id),await async function deleteMessageData(message){if(await window.Signal.Migrations.deleteExternalMessageFiles(message),(0,helpers.zK)(message)){var id=message.id,conversationId=message.conversationId,parentConversation=window.ConversationController.get(conversationId),isGroupConversation=Boolean(parentConversation&&!(0,whatTypeOfConversation.C$)(parentConversation.attributes));await cleanupStoryReplies(conversationId,id,isGroupConversation)}var sticker=message.sticker;if(!sticker)return;var packId=sticker.packId;packId&&await deletePackReference(message.id,packId)}(message);var isGroupConversation=Boolean(parentConversation&&!(0,whatTypeOfConversation.C$)(parentConversation.attributes));(0,helpers.zK)(message)&&await cleanupStoryReplies(conversationId,id,isGroupConversation)}async function cleanupStoryReplies(conversationId,storyId,isGroupConversation,pagination){var _ref=pagination||{},messageId=_ref.messageId,receivedAt=_ref.receivedAt,replies=await window.Signal.Data.getOlderMessagesByConversation({conversationId,includeStoryReplies:!1,messageId,receivedAt,storyId});if(replies.length){var lastMessage=replies[replies.length-1],lastMessageId=lastMessage.id,lastReceivedAt=lastMessage.received_at;if(messageId!==lastMessageId)return isGroupConversation?await Promise.all(replies.map((function(reply){return window.MessageController.register(reply.id,reply).eraseContents()}))):replies.forEach((function(reply){var model=window.MessageController.register(reply.id,reply);model.unset("storyReplyContext"),model.hydrateStoryContext()})),cleanupStoryReplies(conversationId,storyId,isGroupConversation,{messageId:lastMessageId,receivedAt:lastReceivedAt})}}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return channels_arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function channels_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return channels_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return channels_arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function channels_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var resolveShutdown,receivedAtCounter,SQL_CHANNEL_KEY="sql-channel",activeJobCount=0,shutdownPromise=null;async function ipcInvoke(name,args){var fnName=String(name);if(shutdownPromise&&"close"!==name)throw new Error(`Rejecting SQL channel job (${fnName}); application is shutting down`);return activeJobCount+=1,createTaskWithTimeout((async function(){try{return await external_electron_.ipcRenderer.invoke.apply(external_electron_.ipcRenderer,[SQL_CHANNEL_KEY,name].concat(_toConsumableArray(args)))}finally{var _resolveShutdown;if(0===(activeJobCount-=1))null===(_resolveShutdown=resolveShutdown)||void 0===_resolveShutdown||_resolveShutdown()}}),`SQL channel call (${fnName})`)()}var debouncedUpdateLastReceivedAt=debounce_default()((function(){localStorage.setItem("lastReceivedAtCounter",String(receivedAtCounter))}),25,{maxWait:25}),exclusiveInterface={createOrUpdateIdentityKey:async function createOrUpdateIdentityKey(data){var updated=specFromBytes(IDENTITY_KEY_SPEC,data);await channels.createOrUpdateIdentityKey(updated)},getIdentityKeyById:async function getIdentityKeyById(id){var data=await channels.getIdentityKeyById(id);return specToBytes(IDENTITY_KEY_SPEC,data)},bulkAddIdentityKeys:async function bulkAddIdentityKeys(array){var updated=map_default()(array,(function(data){return specFromBytes(IDENTITY_KEY_SPEC,data)}));await channels.bulkAddIdentityKeys(updated)},getAllIdentityKeys:async function getAllIdentityKeys(){return(await channels.getAllIdentityKeys()).map((function(key){return specToBytes(IDENTITY_KEY_SPEC,key)}))},createOrUpdatePreKey:async function createOrUpdatePreKey(data){var updated=specFromBytes(PRE_KEY_SPEC,data);await channels.createOrUpdatePreKey(updated)},getPreKeyById:async function getPreKeyById(id){var data=await channels.getPreKeyById(id);return specToBytes(PRE_KEY_SPEC,data)},bulkAddPreKeys:async function bulkAddPreKeys(array){var updated=map_default()(array,(function(data){return specFromBytes(PRE_KEY_SPEC,data)}));await channels.bulkAddPreKeys(updated)},getAllPreKeys:async function getAllPreKeys(){return(await channels.getAllPreKeys()).map((function(key){return specToBytes(PRE_KEY_SPEC,key)}))},createOrUpdateSignedPreKey:async function createOrUpdateSignedPreKey(data){var updated=specFromBytes(PRE_KEY_SPEC,data);await channels.createOrUpdateSignedPreKey(updated)},getSignedPreKeyById:async function getSignedPreKeyById(id){var data=await channels.getSignedPreKeyById(id);return specToBytes(PRE_KEY_SPEC,data)},bulkAddSignedPreKeys:async function bulkAddSignedPreKeys(array){var updated=map_default()(array,(function(data){return specFromBytes(PRE_KEY_SPEC,data)}));await channels.bulkAddSignedPreKeys(updated)},getAllSignedPreKeys:async function getAllSignedPreKeys(){return(await channels.getAllSignedPreKeys()).map((function(key){return specToBytes(PRE_KEY_SPEC,key)}))},createOrUpdateItem:async function createOrUpdateItem(data){var id=data.id;if(!id)throw new Error("createOrUpdateItem: Provided data did not have a truthy id");var spec=ITEM_SPECS[id],updated=spec?specFromBytes(spec,data):data;await channels.createOrUpdateItem(updated)},getItemById:async function getItemById(id){var spec=ITEM_SPECS[id],data=await channels.getItemById(id);return spec?specToBytes(spec,data):data},getAllItems:async function getAllItems(){for(var items=await channels.getAllItems(),result=Object.create(null),_i=0,_Object$keys=Object.keys(items);_i<_Object$keys.length;_i++){var key=_Object$keys[_i],value=items[key],keys=ITEM_SPECS[key],deserializedValue=keys?specToBytes(keys,{value}).value:value;result[key]=deserializedValue}return result},updateConversation:function updateConversation(data){updateConversationBatcher.add(data)},removeConversation:async function removeConversation(id){var existing=await channels.getConversationById(id);existing&&(await channels.removeConversation(id),await async function deleteExternalFiles(conversation,_ref3){var deleteAttachmentData=_ref3.deleteAttachmentData;if(conversation){var avatar=conversation.avatar,profileAvatar=conversation.profileAvatar;avatar&&avatar.path&&await deleteAttachmentData(avatar.path),profileAvatar&&profileAvatar.path&&await deleteAttachmentData(profileAvatar.path)}}(existing,{deleteAttachmentData:window.Signal.Migrations.deleteAttachmentData}))},searchMessages:async function searchMessages(query){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},limit=_ref.limit,messages=await channels.searchMessages(query,{limit});return handleSearchMessageJSON(messages)},searchMessagesInConversation:async function searchMessagesInConversation(query,conversationId){var _ref2=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},limit=_ref2.limit,messages=await channels.searchMessagesInConversation(query,conversationId,{limit});return handleSearchMessageJSON(messages)},getOlderMessagesByConversation,getConversationRangeCenteredOnMessage:async function getConversationRangeCenteredOnMessage(options){var result=await channels.getConversationRangeCenteredOnMessage(options);return Object.assign({},result,{older:handleMessageJSON(result.older),newer:handleMessageJSON(result.newer)})},getNewerMessagesByConversation:async function getNewerMessagesByConversation(options){var messages=await channels.getNewerMessagesByConversation(options);return handleMessageJSON(messages)},shutdown:async function shutdown(){logging_log.info("Client.shutdown"),await async function doShutdown(){if(logging_log.info(`data.shutdown: shutdown requested. ${activeJobCount} jobs outstanding`),shutdownPromise)return shutdownPromise;if(0!==activeJobCount){var _explodePromise=(0,util_explodePromise.R)();shutdownPromise=_explodePromise.promise,resolveShutdown=_explodePromise.resolve;try{await shutdownPromise}finally{logging_log.info("data.shutdown: process complete")}}}(),await channels.close()},removeAllMessagesInConversation:async function removeAllMessagesInConversation(conversationId,_ref3){var messages,logId=_ref3.logId;do{if(logging_log.info(`removeAllMessagesInConversation/${logId}: Fetching chunk of 20 messages`),!(messages=await getOlderMessagesByConversation({conversationId,limit:20,includeStoryReplies:!0,storyId:void 0})).length)return;var ids=messages.map((function(message){return message.id}));logging_log.info(`removeAllMessagesInConversation/${logId}: Cleanup...`),await _cleanupMessages(messages),logging_log.info(`removeAllMessagesInConversation/${logId}: Deleting...`),await channels.removeMessages(ids)}while(messages.length>0)},removeOtherData:async function removeOtherData(){await Promise.all([invokeWithTimeout("erase-sql-key"),invokeWithTimeout("erase-attachments"),invokeWithTimeout("erase-stickers"),invokeWithTimeout("erase-temp"),invokeWithTimeout("erase-drafts")])},cleanupOrphanedAttachments:async function cleanupOrphanedAttachments(){try{await invokeWithTimeout("cleanup-orphaned-attachments")}catch(error){logging_log.warn("sql/Client: cleanupOrphanedAttachments failure",errors.G(error))}},ensureFilePermissions:async function ensureFilePermissions(){await invokeWithTimeout("ensure-file-permissions")}},channels=new Proxy({},{get:function(_target,name){return async function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return ipcInvoke(String(name),args)}}}),clientExclusiveOverrides=Object.assign({},exclusiveInterface,{removeMessage:async function removeMessage(id){var message=await channels.getMessageById(id);message&&(await channels.removeMessage(id),await cleanupMessage(message))},removeMessages:async function removeMessages(messageIds){var messages=await channels.getMessagesById(messageIds);await _cleanupMessages(messages),await channels.removeMessages(messageIds)},saveAttachmentDownloadJob:async function saveAttachmentDownloadJob(job){await channels.saveAttachmentDownloadJob(_cleanData(job))},saveMessage:async function saveMessage(data,options){var id=await channels.saveMessage(_cleanMessageData(data),Object.assign({},options,{jobToInsert:options.jobToInsert&&(job=options.jobToInsert,{id:job.id,timestamp:job.timestamp,queueType:job.queueType,data:job.data})}));var job;return(0,assert.wN)((0,types_UUID.TP)(id),"saveMessage: messageId is not a UUID"),expiringMessagesDeletionService.update(),tapToViewMessagesDeletionService.update(),id},saveMessages:async function saveMessages(arrayOfMessages,options){await channels.saveMessages(arrayOfMessages.map((function(message){return _cleanMessageData(message)})),options),expiringMessagesDeletionService.update(),tapToViewMessagesDeletionService.update()},updateConversations});const Client=new Proxy(Object.assign({},clientExclusiveOverrides),{get:function(target,name){return async function(){return has_default()(target,name)?get_default()(target,name).apply(void 0,arguments):get_default()(channels,name).apply(void 0,arguments)}}});function _cleanData(data){var _cleanDataForIpc=cleanDataForIpc(data),cleaned=_cleanDataForIpc.cleaned,pathsChanged=_cleanDataForIpc.pathsChanged;return pathsChanged.length&&logging_log.info(`_cleanData cleaned the following paths: ${pathsChanged.join(", ")}`),cleaned}function _cleanMessageData(data){var result=Object.assign({},data);if(data.received_at||((0,assert.q8)(!1,"received_at was not set on the message"),result.received_at=function incrementMessageCounter(){return(0,assert.Yj)(void 0!==receivedAtCounter,"incrementMessageCounter: not initialized"),receivedAtCounter+=1,debouncedUpdateLastReceivedAt(),receivedAtCounter}()),data.attachments){var logId=function idForLogging_getMessageIdForLogging(message){return`${(0,helpers.Zw)(message)||(0,helpers.b5)(message)}.${(0,helpers.gD)(message)} ${message.sent_at}`}(data);result.attachments=data.attachments.map((function(attachment,index){return attachment.data&&!isTypedArray_default()(attachment.data)?(logging_log.warn(`_cleanMessageData/${logId}: Attachment ${index} had non-array \`data\` field; deleting.`),omit_default()(attachment,["data"])):attachment}))}return _cleanData(omit_default()(result,["dataMessage"]))}function specToBytes(spec,data){return mapObjectWithSpec(spec,data,(function(x){return ts_Bytes.Gh(x)}))}function specFromBytes(spec,data){return mapObjectWithSpec(spec,data,(function(x){return ts_Bytes.s3(x)}))}var IDENTITY_KEY_SPEC=["publicKey"];var PRE_KEY_SPEC=["privateKey","publicKey"];var ITEM_SPECS={identityKeyMap:{key:"value",valueSpec:{isMap:!0,valueSpec:["privKey","pubKey"]}},profileKey:["value"],senderCertificate:["value.serialized"],senderCertificateNoE164:["value.serialized"],subscriberId:["value"]};var updateConversationBatcher=function createBatcher(options){var batcher,timeout,items=[],queue=new p_queue_dist.Z({concurrency:1,timeout:30*durations.EB,throwOnTimeout:!0});function _kickBatchOff(){(0,clearTimeoutIfNecessary.S)(timeout),timeout=null;var itemsRef=items;items=[],queue.add((async function(){await options.processBatch(itemsRef)}))}function anyPending(){return queue.size>0||queue.pending>0||items.length>0}return batcher={add:function add(item){items.push(item),1===items.length?timeout=setTimeout(_kickBatchOff,options.wait):items.length>=options.maxSize&&_kickBatchOff()},removeAll:function removeAll(needle){items=items.filter((function(item){return item!==needle}))},anyPending,onIdle:async function onIdle(){for(;anyPending();)(queue.size>0||queue.pending>0)&&await queue.onIdle(),items.length>0&&await(0,sleep._)(2*options.wait)},flushAndWait:async function flushAndWait(){for(logging_log.info(`Flushing ${options.name} batcher items.length=${items.length}`);anyPending();)_kickBatchOff(),(queue.size>0||queue.pending>0)&&await queue.onIdle();logging_log.info(`Flushing complete ${options.name} for batcher`)},unregister:function unregister(){window.batchers=window.batchers.filter((function(item){return item!==batcher}))}},window.batchers.push(batcher),batcher}({name:"sql.Client.updateConversationBatcher",wait:500,maxSize:20,processBatch:async function(items){var byId=groupBy_default()(items,(function(item){return item.id})),mostRecent=Object.keys(byId).map((function(id){var maybeLast=last_default()(byId[id]);return(0,assert.q8)(void 0!==maybeLast,"Empty array in `groupBy` result"),maybeLast}));await updateConversations(mostRecent)}});async function updateConversations(array){var _cleanDataForIpc2=cleanDataForIpc(array),cleaned=_cleanDataForIpc2.cleaned,pathsChanged=_cleanDataForIpc2.pathsChanged;(0,assert.q8)(!pathsChanged.length,`Paths were cleaned: ${JSON.stringify(pathsChanged)}`),await channels.updateConversations(cleaned)}function handleSearchMessageJSON(messages){return messages.map((function(message){return Object.assign({json:message.json,bodyRanges:[]},JSON.parse(message.json),{snippet:message.snippet})}))}async function _cleanupMessages(messages){var queue=new p_queue_dist.Z({concurrency:3,timeout:30*durations.EB});queue.addAll(messages.map((function(message){return async function(){return cleanupMessage(message)}}))),await queue.onIdle()}function handleMessageJSON(messages){return messages.map((function(message){return JSON.parse(message.json)}))}async function getOlderMessagesByConversation(options){return handleMessageJSON(await channels.getOlderMessagesByConversation(options))}async function invokeWithTimeout(name){return createTaskWithTimeout((function(){return external_electron_.ipcRenderer.invoke(name)}),`callChannel call to ${name}`)()}var protobuf=__webpack_require__("./ts/protobuf/index.ts");var BLESSED_PACKS={"9acc9e8aba563d26a4994e69263e3b25":{key:"Wm3/OUjCjvubeq+T7MN1xp/DFueAd+0mhnoU0QoPahI=",status:"downloaded"},fb535407d2f6497ec074df8b9c51dd1d:{key:"F+lxwTQDViJ4HS7iSeZHO3dFg3ULaMEbuCt1CcaLbf0=",status:"downloaded"},e61fa0867031597467ccc036cc65d403:{key:"E657GnQHMYKA6bOMEmHe044OcTi5+WSmzLtz5A9zeps=",status:"downloaded"},cca32f5b905208b7d0f1e17f23fdc185:{key:"i/jpX3pFver+DI9bAC7wGrlbjxtbqsQBnM1ra+Cxg3o=",status:"downloaded"},ccc89a05dc077856b57351e90697976c:{key:"RXMOYPCdVWYRUiN0RTemt9nqmc7qy3eh+9aAG5YH+88=",status:"downloaded"},cfc50156556893ef9838069d3890fe49:{key:"X1vqt9OCRDywCh5I65Upe2uMrf0GMeXQ2dyUnmmZ/0s=",status:"downloaded"}},STICKER_PACK_DEFAULTS={id:"",key:"",author:"",coverStickerId:0,createdAt:0,downloadAttempts:0,status:"ephemeral",stickerCount:0,stickers:{},title:"",storageNeedsSync:!1},VALID_PACK_ID_REGEXP=/^[0-9a-f]{32}$/i;new p_queue_dist.Z({concurrency:1,timeout:30*durations.EB});function getDataFromLink(link){var url=(0,util_url.FS)(link);if(url){var hash=url.hash;if(hash){var params;try{params=new URLSearchParams(hash.slice(1))}catch(err){return}var id=params.get("pack_id");if(function isPackIdValid(packId){return"string"==typeof packId&&VALID_PACK_ID_REGEXP.test(packId)}(id)){var key=params.get("pack_key");if(key)return{id,key}}}}}function redactPackId(packId){return`[REDACTED]${packId.slice(-3)}`}function getReduxStickerActions(){var actions=window.reduxActions;return(0,assert.Yj)(actions&&actions.stickers,"Redux not ready"),actions.stickers}function decryptSticker(packKey,ciphertext){var derivedKey=function deriveStickerPackKey(packKey){var _deriveSecrets2=Crypto_slicedToArray(deriveSecrets(packKey,getZeroes(32),ts_Bytes.mL("Sticker Pack")),2),part1=_deriveSecrets2[0],part2=_deriveSecrets2[1];return ts_Bytes.mV([part1,part2])}(ts_Bytes.Gh(packKey));return decryptAttachment(ciphertext,derivedKey)}async function downloadSticker(packId,packKey,proto){var _ref=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},ephemeral=_ref.ephemeral,id=proto.id,emoji=proto.emoji;(0,assert.Yj)(null!=id,"Sticker id can't be null");var messaging=window.textsecure.messaging;if(!messaging)throw new Error("messaging is not available!");var ciphertext=await messaging.getSticker(packId,id),plaintext=decryptSticker(packKey,ciphertext),sticker=ephemeral?await window.Signal.Migrations.processNewEphemeralSticker(plaintext):await window.Signal.Migrations.processNewSticker(plaintext);return Object.assign({id,emoji:dropNull_dropNull(emoji)},sticker,{packId})}function getStickerPack(packId){var packs=window.reduxStore.getState().stickers.packs;if(packs)return packs[packId]}function getStickerPackStatus(packId){var pack=getStickerPack(packId);if(pack)return pack.status}async function deletePackReference(messageId,packId){if(!Boolean(BLESSED_PACKS[packId])){var paths=await Client.deleteStickerPackReference(messageId,packId);if(paths)(0,getReduxStickerActions().removeStickerPack)(packId),await p_map_default()(paths,window.Signal.Migrations.deleteSticker,{concurrency:3})}}var VisualAttachment=__webpack_require__("./ts/types/VisualAttachment.ts"),path=__webpack_require__("./node_modules/path/path.js"),path_default=__webpack_require__.n(path),js=(__webpack_require__("./node_modules/uuid-browser/index.js"),__webpack_require__("./node_modules/blueimp-load-image/js/index.js")),js_default=__webpack_require__.n(js),blurhash_dist=__webpack_require__("./node_modules/blurhash/dist/index.js"),imageToBlurHash_imageToBlurHash=async function(input){var _await$loadImageData=await async function(input){return new Promise((function(resolve,reject){js_default()(input,(function(canvasOrError){if(canvasOrError instanceof Event&&"error"===canvasOrError.type){var processError=new Error("imageToBlurHash: Failed to process image",{cause:canvasOrError});reject(processError)}else if(canvasOrError instanceof HTMLCanvasElement){var context=canvasOrError.getContext("2d");context?resolve(context.getImageData(0,0,canvasOrError.width,canvasOrError.height)):reject(new Error("imageToBlurHash: cannot get CanvasRenderingContext2D from canvas"))}else reject(new Error("imageToBlurHash: result is not a canvas"))}),{canvas:!0,orientation:!0,maxWidth:200,maxHeight:200})}))}(input),data=_await$loadImageData.data,width=_await$loadImageData.width,height=_await$loadImageData.height;return(0,blurhash_dist.encode)(data,width,height,4,3)},canvasToBlob=__webpack_require__("./ts/util/canvasToBlob.ts"),throttle=__webpack_require__("./node_modules/lodash/throttle.js"),throttle_default=__webpack_require__.n(throttle);__webpack_require__("./ts/types/PhoneNumber.ts");var config={},listeners={};throttle_default()((async function(server){var now=Date.now(),newConfig=await server.getConfig(),oldConfig=config;config=newConfig.reduce((function(acc,_ref){var name=_ref.name,enabled=_ref.enabled,value=_ref.value,previouslyEnabled=get_default()(oldConfig,[name,"enabled"],!1),previousValue=get_default()(oldConfig,[name,"value"],void 0),configValue={name,enabled,enabledAt:previouslyEnabled&&enabled?now:get_default()(oldConfig,[name,"enabledAt"]),value},hasChanged=previouslyEnabled!==enabled||previousValue!==configValue.value,currentListeners=listeners[name]||[];return hasChanged&&(logging_log.info(`Remote Config: Flag ${name} has changed`),currentListeners.forEach((function(listener){listener(configValue)}))),Object.assign({},acc,{[name]:configValue})}),{}),await window.storage.put("remoteConfig",config)}),72e5,{trailing:!1});function getValue(name){return get_default()(config,[name,"value"],void 0)}var MediaQualityLevels,libphonenumberInstance=__webpack_require__("./ts/util/libphonenumberInstance.ts");function scaleImageToLevel_slicedToArray(arr,i){return function scaleImageToLevel_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function scaleImageToLevel_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function scaleImageToLevel_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return scaleImageToLevel_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return scaleImageToLevel_arrayLikeToArray(o,minLen)}(arr,i)||function scaleImageToLevel_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function scaleImageToLevel_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(MediaQualityLevels){MediaQualityLevels[MediaQualityLevels.One=1]="One",MediaQualityLevels[MediaQualityLevels.Two=2]="Two",MediaQualityLevels[MediaQualityLevels.Three=3]="Three"}(MediaQualityLevels||(MediaQualityLevels={}));var DEFAULT_LEVEL=MediaQualityLevels.One,MiB=1048576,DEFAULT_LEVEL_DATA={maxDimensions:1600,quality:.7,size:MiB,thresholdSize:.2*MiB},MEDIA_QUALITY_LEVEL_DATA=new Map([[MediaQualityLevels.One,DEFAULT_LEVEL_DATA],[MediaQualityLevels.Two,{maxDimensions:2048,quality:.75,size:1572864,thresholdSize:.3*MiB}],[MediaQualityLevels.Three,{maxDimensions:4096,quality:.75,size:3*MiB,thresholdSize:.4*MiB}]]),SCALABLE_DIMENSIONS=[3072,2048,1600,1024,768];function getMediaQualityLevel(){var values=getValue("desktop.mediaQuality.levels");if(!values)return DEFAULT_LEVEL;var e164=window.textsecure.storage.user.getNumber();if(!e164)return DEFAULT_LEVEL;var parsedPhoneNumber=function parseNumber(number,defaultRegionCode){try{var _parsedNumber$getCoun,parsedNumber=libphonenumberInstance.eE.parse(number,defaultRegionCode);return libphonenumberInstance.eE.isValidNumber(parsedNumber)?{isValidNumber:!0,regionCode:libphonenumberInstance.eE.getRegionCodeForNumber(parsedNumber),countryCode:null===(_parsedNumber$getCoun=parsedNumber.getCountryCode())||void 0===_parsedNumber$getCoun?void 0:_parsedNumber$getCoun.toString(),e164:libphonenumberInstance.eE.format(parsedNumber,libphonenumberInstance.M9.E164)}:{error:new Error("Invalid phone number"),isValidNumber:!1}}catch(error){return{error,isValidNumber:!1}}}(e164);if(!parsedPhoneNumber.isValidNumber)return DEFAULT_LEVEL;var countryValues=function parseCountryValues(values){var map=new Map;return values.split(",").forEach((function(value){var _value$split2=scaleImageToLevel_slicedToArray(value.split(":"),2),countryCode=_value$split2[0],level=_value$split2[1];map.set(countryCode,2===Number(level)?MediaQualityLevels.Two:MediaQualityLevels.One)})),map}(values),level=parsedPhoneNumber.countryCode?countryValues.get(parsedPhoneNumber.countryCode):void 0;return level||(countryValues.get("*")||DEFAULT_LEVEL)}async function getCanvasBlobAsJPEG(image,dimensions,quality){var canvas=js_default().scale(image,{canvas:!0,maxHeight:dimensions,maxWidth:dimensions});if(!(canvas instanceof HTMLCanvasElement))throw new Error("image not a canvas");return(0,canvasToBlob._)(canvas,MIME._l,quality)}async function autoScale(_ref2){var contentType=_ref2.contentType,file=_ref2.file,fileName=_ref2.fileName;if(!(0,Attachment.QF)({contentType}))return{contentType,file,fileName};var _await$scaleImageToLe=await async function scaleImageToLevel(fileOrBlobOrURL,contentType,sendAsHighQuality){var data;try{if(!((data=await js_default()(fileOrBlobOrURL,{canvas:!0,orientation:!0,meta:!0})).image instanceof HTMLCanvasElement))throw new Error("image not a canvas")}catch(cause){throw new Error("scaleImageToLevel: Failed to process image",{cause})}var level=sendAsHighQuality?MediaQualityLevels.Three:getMediaQualityLevel(),_ref=MEDIA_QUALITY_LEVEL_DATA.get(level)||DEFAULT_LEVEL_DATA,maxDimensions=_ref.maxDimensions,quality=_ref.quality,size=_ref.size,thresholdSize=_ref.thresholdSize;if(fileOrBlobOrURL.size<=thresholdSize)return{blob:await(0,canvasToBlob._)(data.image,contentType),contentType};for(var i=0;i<SCALABLE_DIMENSIONS.length;i+=1){var scalableDimensions=SCALABLE_DIMENSIONS[i];if(!(maxDimensions<scalableDimensions)){var _blob2=await getCanvasBlobAsJPEG(data.image,scalableDimensions,quality);if(_blob2.size<=size)return{blob:_blob2,contentType:MIME._l}}}return{blob:await getCanvasBlobAsJPEG(data.image,512,quality),contentType:MIME._l}}(file,contentType,!0),blob=_await$scaleImageToLe.blob;if(_await$scaleImageToLe.contentType!==MIME._l)return{contentType,file:blob,fileName};var name=path_default().parse(fileName).name;return{contentType:MIME._l,file:blob,fileName:`${name}.jpg`}}var currentlyMatchedLink,linkPreviewAbortController,linkPreviewResult,LINK_PREVIEW_TIMEOUT=60*durations.sh,disableLinkPreviews=!1,excludedPreviewUrls=[];debounce_default()((function _maybeGrabLinkPreview(message,source){var _ref=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},caretLocation=_ref.caretLocation,conversationId=_ref.conversationId,_ref$mode=_ref.mode,mode=void 0===_ref$mode?"conversation":_ref$mode;if(!window.Events.getLinkPreviewSetting()&&"conversation"===mode)return;var messaging=window.textsecure.messaging;if(!messaging)return;if(window.isBehindProxy())return;if(!message)return void LinkPreview_resetLinkPreview(conversationId);if(disableLinkPreviews)return;var links=types_LinkPreview.rq(message,caretLocation);if(currentlyMatchedLink&&links.includes(currentlyMatchedLink))return;currentlyMatchedLink=void 0,excludedPreviewUrls=excludedPreviewUrls||[];var link=links.find((function(item){return types_LinkPreview.go(item)&&!excludedPreviewUrls.includes(item)}));if(!link)return void removeLinkPreview(conversationId);addLinkPreview(link,source,{conversationId,disableFetch:!window.Events.getLinkPreviewSetting()})}),200);function LinkPreview_resetLinkPreview(conversationId){disableLinkPreviews=!1,excludedPreviewUrls=[],removeLinkPreview(conversationId)}function removeLinkPreview(conversationId){var _linkPreviewAbortCont;(linkPreviewResult||[]).forEach((function(item){item.url&&URL.revokeObjectURL(item.url)})),linkPreviewResult=void 0,currentlyMatchedLink=void 0,null===(_linkPreviewAbortCont=linkPreviewAbortController)||void 0===_linkPreviewAbortCont||_linkPreviewAbortCont.abort(),linkPreviewAbortController=void 0,window.reduxActions.linkPreviews.removeLinkPreview(conversationId)}async function addLinkPreview(url,source){var _ref2=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},conversationId=_ref2.conversationId,disableFetch=_ref2.disableFetch;if(currentlyMatchedLink!==url){(linkPreviewResult||[]).forEach((function(item){item.url&&URL.revokeObjectURL(item.url)})),window.reduxActions.linkPreviews.removeLinkPreview(conversationId),linkPreviewResult=void 0,linkPreviewAbortController&&(logging_log.info("addLinkPreview: canceling another in-flight link preview request"),linkPreviewAbortController.abort());var thisRequestAbortController=new AbortController;linkPreviewAbortController=thisRequestAbortController;var timeout=setTimeout((function(){thisRequestAbortController.abort()}),LINK_PREVIEW_TIMEOUT);currentlyMatchedLink=url,window.reduxActions.linkPreviews.addLinkPreview({url},source,conversationId);try{var result;if(!(result=disableFetch?{title:null,url,description:null,date:null}:await getPreview(url,thisRequestAbortController.signal))){logging_log.info("addLinkPreview: failed to load preview (not necessarily a problem)");var failedToFetch=currentlyMatchedLink===url;return void(failedToFetch&&(excludedPreviewUrls.push(url),removeLinkPreview(conversationId)))}if(result.image&&result.image.data){var blob=new Blob([result.image.data],{type:result.image.contentType});result.image.url=URL.createObjectURL(blob)}else if(!result.title&&!disableFetch)return void removeLinkPreview(conversationId);window.reduxActions.linkPreviews.addLinkPreview(Object.assign({},result,{title:dropNull_dropNull(result.title),description:dropNull_dropNull(result.description),date:dropNull_dropNull(result.date),domain:types_LinkPreview.ge(result.url),isStickerPack:types_LinkPreview.Df(result.url)}),source,conversationId),linkPreviewResult=[result]}catch(error){logging_log.error("Problem loading link preview, disabling.",errors.G(error)),disableLinkPreviews=!0,removeLinkPreview(conversationId)}finally{clearTimeout(timeout)}}else logging_log.warn("addLinkPreview should not be called with the same URL like this")}async function getPreview(url,abortSignal){var messaging=window.textsecure.messaging;if(!messaging)throw new Error("messaging is not available!");if(types_LinkPreview.Df(url))return async function getStickerPackPreview(url,abortSignal){var isPackDownloaded=function(pack){return!!pack&&("downloaded"===pack.status||"installed"===pack.status)},isPackValid=function(pack){return!!pack&&("ephemeral"===pack.status||"downloaded"===pack.status||"installed"===pack.status)},dataFromLink=getDataFromLink(url);if(!dataFromLink)return null;var id=dataFromLink.id,key=dataFromLink.key;try{var keyBytes=ts_Bytes.H_(key),keyBase64=ts_Bytes.s3(keyBytes);if(isPackDownloaded(getStickerPack(id))||await async function downloadEphemeralPack(packId,packKey){var _getReduxStickerActio3=getReduxStickerActions(),stickerAdded=_getReduxStickerActio3.stickerAdded,stickerPackAdded=_getReduxStickerActio3.stickerPackAdded,stickerPackUpdated=_getReduxStickerActio3.stickerPackUpdated,existingPack=getStickerPack(packId);if(!existingPack||"downloaded"!==existingPack.status&&"installed"!==existingPack.status&&"pending"!==existingPack.status)try{stickerPackAdded(Object.assign({},STICKER_PACK_DEFAULTS,{id:packId,key:packKey,status:"ephemeral"}));var messaging=window.textsecure.messaging;if(!messaging)throw new Error("messaging is not available!");var ciphertext=await messaging.getStickerPackManifest(packId),plaintext=decryptSticker(packKey,ciphertext),proto=protobuf.g.StickerPack.decode(plaintext),firstStickerProto=proto.stickers?proto.stickers[0]:null,stickerCount=proto.stickers.length,coverProto=proto.cover||firstStickerProto,coverStickerId=coverProto?coverProto.id:null;if(!coverProto||!isNumber_default()(coverStickerId))throw new Error(`Sticker pack ${redactPackId(packId)} is malformed - it has no cover, and no stickers`);var nonCoverStickers=reject_default()(proto.stickers,(function(sticker){return!isNumber_default()(sticker.id)||sticker.id===coverStickerId})),coverSticker=proto.stickers.filter((function(sticker){return isNumber_default()(sticker.id)&&sticker.id===coverStickerId}));coverSticker[0]&&!coverProto.emoji&&(coverProto.emoji=coverSticker[0].emoji);var coverIncludedInList=nonCoverStickers.length<stickerCount;stickerPackAdded(Object.assign({},STICKER_PACK_DEFAULTS,{id:packId,key:packKey,coverStickerId,stickerCount,status:"ephemeral"},pick_default()(proto,["title","author"])));var downloadStickerJob=async function(stickerProto){var stickerInfo;try{stickerInfo=await downloadSticker(packId,packKey,stickerProto,{ephemeral:!0})}catch(error){return logging_log.error(`downloadEphemeralPack/downloadStickerJob error: ${errors.G(error)}`),!1}var sticker=Object.assign({},stickerInfo,{isCoverOnly:!coverIncludedInList&&stickerInfo.id===coverStickerId}),statusCheck=getStickerPackStatus(packId);if("ephemeral"!==statusCheck)throw new Error(`Ephemeral download for pack ${redactPackId(packId)} interrupted by status change. Status is now ${statusCheck}.`);return stickerAdded(sticker),!0};if(await downloadStickerJob(coverProto),0===(await p_map_default()(nonCoverStickers,downloadStickerJob,{concurrency:3})).filter((function(item){return item})).length&&0!==nonCoverStickers.length)throw new Error("downloadEphemeralPack: All stickers failed to download")}catch(error){"ephemeral"===getStickerPackStatus(packId)&&stickerPackUpdated(packId,{attemptedStatus:"ephemeral",status:"error"}),logging_log.error(`Ephemeral download error for sticker pack ${redactPackId(packId)}:`,errors.G(error))}else logging_log.warn(`Ephemeral download for pack ${redactPackId(packId)} requested, we already know about it. Skipping.`)}(id,keyBase64),abortSignal.aborted)return null;var pack=getStickerPack(id);if(!isPackValid(pack))return null;if(pack.key!==keyBase64)return null;var contentType,title=pack.title,coverStickerId=pack.coverStickerId,sticker=pack.stickers[coverStickerId],data="ephemeral"===pack.status?await window.Signal.Migrations.readTempData(sticker.path):await window.Signal.Migrations.readStickerData(sticker.path);if(abortSignal.aborted)return null;var sniffedMimeType=function sniffImageMimeType_sniffImageMimeType(bytes){for(var i=0;i<TYPES.length;i+=1){var type=TYPES[i];if(matchesType(bytes,type))return type.mimeType}}(data);return sniffedMimeType?contentType=sniffedMimeType:(logging_log.warn("getStickerPackPreview: Unable to sniff sticker MIME type; falling back to WebP"),contentType=MIME.to),{date:null,description:null,image:Object.assign({},sticker,{data,size:data.byteLength,contentType}),title,url}}catch(error){return logging_log.error("getStickerPackPreview error:",errors.G(error)),null}finally{id&&await async function removeEphemeralPack(packId){var existing=getStickerPack(packId);if((0,assert.Yj)(existing,`No existing sticker pack with id: ${packId}`),"ephemeral"===existing.status||"error"===existing.status&&"ephemeral"===existing.attemptedStatus){(0,getReduxStickerActions().removeStickerPack)(packId);var paths=values_default()(existing.stickers).map((function(sticker){return sticker.path}));await p_map_default()(paths,window.Signal.Migrations.deleteTempFile,{concurrency:3}),await Client.deleteStickerPack(packId)}}(id)}}(url,abortSignal);if(types_LinkPreview.Hz(url))return async function getGroupPreview(url,abortSignal){var _result$memberCount,urlObject=(0,util_url.FS)(url);if(!urlObject)return null;var hash=urlObject.hash;if(!hash)return null;var groupData=hash.slice(1),_window$Signal$Groups=window.Signal.Groups.parseGroupLink(groupData),inviteLinkPassword=_window$Signal$Groups.inviteLinkPassword,masterKey=_window$Signal$Groups.masterKey,fields=window.Signal.Groups.deriveGroupFields(ts_Bytes.Gh(masterKey)),logId=`groupv2(${ts_Bytes.s3(fields.id)})`,secretParams=ts_Bytes.s3(fields.secretParams);logging_log.info(`getGroupPreview/${logId}: Fetching pre-join state`);var result=await window.Signal.Groups.getPreJoinGroupInfo(inviteLinkPassword,masterKey);if(abortSignal.aborted)return null;var image,title=window.Signal.Groups.decryptGroupTitle(result.title,secretParams)||window.i18n("icu:unknownGroup"),description=window.i18n("icu:GroupV2--join--group-metadata--full",{memberCount:null!==(_result$memberCount=null==result?void 0:result.memberCount)&&void 0!==_result$memberCount?_result$memberCount:0});if(result.avatar)try{var data=await window.Signal.Groups.decryptGroupAvatar(result.avatar,secretParams);image={data,size:data.byteLength,contentType:MIME._l,blurHash:await imageToBlurHash_imageToBlurHash(new Blob([data],{type:MIME._l}))}}catch(error){var errorString=errors.G(error);logging_log.error(`getGroupPreview/${logId}: Failed to fetch avatar ${errorString}`)}if(abortSignal.aborted)return null;return{date:null,description,image,title,url}}(url,abortSignal);if(!types_LinkPreview.go(url))return null;var linkPreviewMetadata=await messaging.fetchLinkPreviewMetadata(url,abortSignal);if(!linkPreviewMetadata||abortSignal.aborted)return null;var image,objectUrl,title=linkPreviewMetadata.title,imageHref=linkPreviewMetadata.imageHref,description=linkPreviewMetadata.description,date=linkPreviewMetadata.date;if(imageHref&&types_LinkPreview.go(imageHref))try{var fullSizeImage=await messaging.fetchLinkPreviewImage(imageHref,abortSignal);if(abortSignal.aborted)return null;if(!fullSizeImage)throw new Error("Failed to fetch link preview image");var withBlob=await autoScale({contentType:fullSizeImage.contentType,file:new Blob([fullSizeImage.data],{type:fullSizeImage.contentType}),fileName:title}),data=await function fileToBytes(file){return new Promise((function(resolve,rejectPromise){var FR=new FileReader;FR.onload=function(){FR.result&&"string"!=typeof FR.result?resolve(new Uint8Array(FR.result)):rejectPromise(new Error("bytesFromFile: No result!"))},FR.onerror=rejectPromise,FR.onabort=rejectPromise,FR.readAsArrayBuffer(file)}))}(withBlob.file);objectUrl=URL.createObjectURL(withBlob.file);var blurHash=await imageToBlurHash_imageToBlurHash(withBlob.file),dimensions=await VisualAttachment.pz({objectUrl,logger:logging_log});image=Object.assign({data,size:data.byteLength},dimensions,{contentType:(0,MIME.cJ)(withBlob.file.type),blurHash})}catch(error){logging_log.error("getPreview failed to get image for link preview:",error.message)}finally{objectUrl&&URL.revokeObjectURL(objectUrl)}return abortSignal.aborted?null:{date:date||null,description:description||null,image,title,url}}__webpack_require__("./node_modules/lodash/compact.js");function isDraftForwardable(draft){var _draft$messageBody$le,_draft$messageBody,_draft$attachments$le,_draft$attachments2;return(null!==(_draft$messageBody$le=null===(_draft$messageBody=draft.messageBody)||void 0===_draft$messageBody?void 0:_draft$messageBody.length)&&void 0!==_draft$messageBody$le?_draft$messageBody$le:0)>0||(!!draft.isSticker||(!!draft.hasContact||(null!==(_draft$attachments$le=null===(_draft$attachments2=draft.attachments)||void 0===_draft$attachments2?void 0:_draft$attachments2.length)&&void 0!==_draft$attachments$le?_draft$attachments$le:0)>0))}var Toast=__webpack_require__("./ts/types/Toast.tsx"),BodyRange=__webpack_require__("./ts/types/BodyRange.ts"),UserText=__webpack_require__("./ts/components/UserText.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function ForwardMessagesModal_toConsumableArray(arr){return function ForwardMessagesModal_arrayWithoutHoles(arr){if(Array.isArray(arr))return ForwardMessagesModal_arrayLikeToArray(arr)}(arr)||function ForwardMessagesModal_iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||ForwardMessagesModal_unsupportedIterableToArray(arr)||function ForwardMessagesModal_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ForwardMessagesModal_slicedToArray(arr,i){return function ForwardMessagesModal_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function ForwardMessagesModal_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||ForwardMessagesModal_unsupportedIterableToArray(arr,i)||function ForwardMessagesModal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ForwardMessagesModal_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return ForwardMessagesModal_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ForwardMessagesModal_arrayLikeToArray(o,minLen):void 0}}function ForwardMessagesModal_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ForwardMessagesModal(_ref){var drafts=_ref.drafts,candidateConversations=_ref.candidateConversations,doForwardMessages=_ref.doForwardMessages,linkPreviewForSource=_ref.linkPreviewForSource,getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,onClose=_ref.onClose,onChange=_ref.onChange,removeLinkPreview=_ref.removeLinkPreview,RenderCompositionTextArea=_ref.RenderCompositionTextArea,showToast=_ref.showToast,theme=_ref.theme,regionCode=_ref.regionCode,inputRef=(0,react.useRef)(null),_useState2=ForwardMessagesModal_slicedToArray((0,react.useState)([]),2),selectedContacts=_useState2[0],setSelectedContacts=_useState2[1],_useState4=ForwardMessagesModal_slicedToArray((0,react.useState)(""),2),searchTerm=_useState4[0],setSearchTerm=_useState4[1],_useState6=ForwardMessagesModal_slicedToArray((0,react.useState)((0,filterAndSortConversations.x)(candidateConversations,"",regionCode)),2),filteredConversations=_useState6[0],setFilteredConversations=_useState6[1],_useState8=ForwardMessagesModal_slicedToArray((0,react.useState)(!1),2),isEditingMessage=_useState8[0],setIsEditingMessage=_useState8[1],_useState10=ForwardMessagesModal_slicedToArray((0,react.useState)(!1),2),cannotMessage=_useState10[0],setCannotMessage=_useState10[1],isLonelyDraft=1===drafts.length,lonelyDraft=isLonelyDraft?drafts[0]:null,isLonelyDraftEditable=null!=lonelyDraft&&function isDraftEditable(draft){var _draft$attachments$so,_draft$attachments;return!(draft.isSticker||draft.hasContact||null!==(_draft$attachments$so=null===(_draft$attachments=draft.attachments)||void 0===_draft$attachments?void 0:_draft$attachments.some(Attachment.CZ))&&void 0!==_draft$attachments$so&&_draft$attachments$so)}(lonelyDraft),lonelyLinkPreview=isLonelyDraft?linkPreviewForSource(types_LinkPreview.hH.ForwardMessageModal):null,hasSelectedMaximumNumberOfContacts=selectedContacts.length>=5,selectedConversationIdsSet=(0,react.useMemo)((function(){return new Set(selectedContacts.map((function(contact){return contact.id})))}),[selectedContacts]),hasContactsSelected=Boolean(selectedContacts.length),canForwardMessages=hasContactsSelected&&drafts.every(isDraftForwardable),forwardMessages=react.useCallback((function(){if(canForwardMessages){var conversationIds=selectedContacts.map((function(contact){return contact.id}));if(null!=lonelyDraft){var previews=lonelyLinkPreview?[lonelyLinkPreview]:[];doForwardMessages(conversationIds,[Object.assign({},lonelyDraft,{previews})])}else doForwardMessages(conversationIds,drafts.map((function(draft){var _draft$bodyRanges;return Object.assign({},draft,{bodyRanges:null===(_draft$bodyRanges=draft.bodyRanges)||void 0===_draft$bodyRanges?void 0:_draft$bodyRanges.filter(BodyRange.OY.isFormatting)})})))}else showToast({toastType:Toast.p.CannotForwardEmptyMessage})}),[drafts,lonelyDraft,lonelyLinkPreview,doForwardMessages,selectedContacts,canForwardMessages,showToast]),normalizedSearchTerm=searchTerm.trim();(0,react.useEffect)((function(){var timeout=setTimeout((function(){setFilteredConversations((0,filterAndSortConversations.x)(candidateConversations,normalizedSearchTerm,regionCode))}),200);return function(){clearTimeout(timeout)}}),[candidateConversations,normalizedSearchTerm,setFilteredConversations,regionCode]);var contactLookup=(0,react.useMemo)((function(){var map=new Map;return candidateConversations.forEach((function(contact){map.set(contact.id,contact)})),map}),[candidateConversations]),toggleSelectedConversation=(0,react.useCallback)((function(conversationId){var removeContact=!1,nextSelectedContacts=selectedContacts.filter((function(contact){return contact.id!==conversationId||(removeContact=!0,!1)}));if(removeContact)setSelectedContacts(nextSelectedContacts);else{var selectedContact=contactLookup.get(conversationId);selectedContact&&(selectedContact.announcementsOnly&&!selectedContact.areWeAdmin?setCannotMessage(!0):setSelectedContacts([].concat(ForwardMessagesModal_toConsumableArray(nextSelectedContacts),[selectedContact])))}}),[contactLookup,selectedContacts,setSelectedContacts]),_useAnimated=(0,useAnimated.F)(onClose,{getFrom:function(){return{opacity:0,transform:"translateY(48px)"}},getTo:function(isOpen){return isOpen?{opacity:1,transform:"translateY(0px)"}:{opacity:0,transform:"translateY(48px)"}}}),close=_useAnimated.close,modalStyles=_useAnimated.modalStyles,overlayStyles=_useAnimated.overlayStyles,handleBackOrClose=(0,react.useCallback)((function(){isEditingMessage?setIsEditingMessage(!1):close()}),[isEditingMessage,close,setIsEditingMessage]),rowCount=filteredConversations.length,getRow=function(index){var contact=filteredConversations[index];if(contact){var disabledReason,isSelected=selectedConversationIdsSet.has(contact.id);return hasSelectedMaximumNumberOfContacts&&!isSelected&&(disabledReason=ContactCheckbox.B.MaximumContactsSelected),{type:ConversationList.aC.ContactCheckbox,contact,isChecked:isSelected,disabledReason}}};return(0,react.useEffect)((function(){var timeout=setTimeout((function(){var _inputRef$current;null===(_inputRef$current=inputRef.current)||void 0===_inputRef$current||_inputRef$current.focus()}),100);return function(){clearTimeout(timeout)}}),[]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[cannotMessage&&(0,jsx_runtime.jsx)(ConfirmationDialog.U,{dialogName:"ForwardMessageModal.confirm",cancelText:i18n("icu:Confirmation--confirm"),i18n,onClose:function(){return setCannotMessage(!1)},children:i18n("icu:GroupV2--cannot-send")}),(0,jsx_runtime.jsx)(ModalHost.l,{modalName:"ForwardMessageModal",noMouseClose:!0,onEscape:handleBackOrClose,onClose:close,overlayStyles,useFocusTrap:!1,children:(0,jsx_runtime.jsxs)(react_spring_web_esm.animated.div,{className:"module-ForwardMessageModal",style:modalStyles,children:[(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-ForwardMessageModal__header",{"module-ForwardMessageModal__header--edit":isEditingMessage}),children:[isEditingMessage?(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:back"),className:"module-ForwardMessageModal__header--back",onClick:function(){return setIsEditingMessage(!1)},type:"button",children:" "}):(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:close"),className:"module-ForwardMessageModal__header--close",onClick:close,type:"button"}),(0,jsx_runtime.jsx)("h1",{children:i18n("icu:ForwardMessageModal__title")})]}),isEditingMessage&&null!=lonelyDraft?(0,jsx_runtime.jsx)(ForwardMessageEditor,{draft:lonelyDraft,linkPreview:lonelyLinkPreview,onChange:function(messageBody,bodyRanges){onChange([Object.assign({},lonelyDraft,{messageBody,bodyRanges})])},onChangeAttachments:function(attachments){onChange([Object.assign({},lonelyDraft,{attachments})])},removeLinkPreview,theme,i18n,RenderCompositionTextArea,onSubmit:forwardMessages}):(0,jsx_runtime.jsxs)("div",{className:"module-ForwardMessageModal__main-body",children:[(0,jsx_runtime.jsx)(SearchInput.M,{disabled:0===candidateConversations.length,i18n,placeholder:i18n("icu:contactSearchPlaceholder"),onChange:function(event){setSearchTerm(event.target.value)},ref:inputRef,value:searchTerm}),candidateConversations.length?(0,jsx_runtime.jsx)(index_esm.Z,{bounds:!0,children:function(_ref2){var contentRect=_ref2.contentRect,measureRef=_ref2.measureRef;return(0,jsx_runtime.jsx)("div",{className:"module-ForwardMessageModal__list-wrapper",ref:measureRef,children:(0,jsx_runtime.jsx)(ConversationList.p7,{dimensions:contentRect.bounds,getPreferredBadge,getRow,i18n,onClickArchiveButton:shouldNeverBeCalled.U,onClickContactCheckbox:function(conversationId,disabledReason){disabledReason!==ContactCheckbox.B.MaximumContactsSelected&&toggleSelectedConversation(conversationId)},lookupConversationWithoutUuid:shouldNeverBeCalled.q,showConversation:shouldNeverBeCalled.U,showUserNotFoundModal:shouldNeverBeCalled.U,setIsFetchingUUID:shouldNeverBeCalled.U,onSelectConversation:shouldNeverBeCalled.U,blockConversation:shouldNeverBeCalled.U,removeConversation:shouldNeverBeCalled.U,onOutgoingAudioCallInConversation:shouldNeverBeCalled.U,onOutgoingVideoCallInConversation:shouldNeverBeCalled.U,renderMessageSearchResult:function(){return(0,shouldNeverBeCalled.U)(),(0,jsx_runtime.jsx)("div",{})},rowCount,shouldRecomputeRowHeights:!1,showChooseGroupMembers:shouldNeverBeCalled.U,theme})})}}):(0,jsx_runtime.jsx)("div",{className:"module-ForwardMessageModal__no-candidate-contacts",children:i18n("icu:noContactsFound")})]}),(0,jsx_runtime.jsxs)("div",{className:"module-ForwardMessageModal__footer",children:[(0,jsx_runtime.jsx)("div",{children:selectedContacts.map((function(contact,index){return(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)(UserText.a,{text:contact.title}),index<selectedContacts.length-1?", ":""]},contact.id)}))}),(0,jsx_runtime.jsx)("div",{children:isEditingMessage||!isLonelyDraftEditable?(0,jsx_runtime.jsx)(Button.zx,{"aria-label":i18n("icu:ForwardMessageModal--continue"),className:"module-ForwardMessageModal__send-button module-ForwardMessageModal__send-button--forward","aria-disabled":!canForwardMessages,onClick:forwardMessages}):(0,jsx_runtime.jsx)(Button.zx,{"aria-label":i18n("icu:forwardMessage"),className:"module-ForwardMessageModal__send-button module-ForwardMessageModal__send-button--continue",disabled:!hasContactsSelected,onClick:function(){return setIsEditingMessage(!0)}})})]})]})})]})}function ForwardMessageEditor(_ref3){var _linkPreview$descript,_draft$messageBody,draft=_ref3.draft,linkPreview=_ref3.linkPreview,i18n=_ref3.i18n,RenderCompositionTextArea=_ref3.RenderCompositionTextArea,removeLinkPreview=_ref3.removeLinkPreview,onChange=_ref3.onChange,onChangeAttachments=_ref3.onChangeAttachments,onSubmit=_ref3.onSubmit,theme=_ref3.theme,attachments=draft.attachments;return(0,jsx_runtime.jsxs)("div",{className:"module-ForwardMessageModal__main-body",children:[linkPreview?(0,jsx_runtime.jsx)("div",{className:"module-ForwardMessageModal--link-preview",children:(0,jsx_runtime.jsx)(StagedLinkPreview.Q,{date:linkPreview.date,description:null!==(_linkPreview$descript=linkPreview.description)&&void 0!==_linkPreview$descript?_linkPreview$descript:"",domain:linkPreview.url,i18n,image:linkPreview.image,onClose:removeLinkPreview,title:linkPreview.title,url:linkPreview.url})}):null,null!=attachments&&attachments.length>0?(0,jsx_runtime.jsx)(AttachmentList.f,{attachments,i18n,onCloseAttachment:function(attachment){var newAttachments=attachments.filter((function(currentAttachment){return currentAttachment!==attachment}));onChangeAttachments(newAttachments)}}):null,(0,jsx_runtime.jsx)(RenderCompositionTextArea,{bodyRanges:draft.bodyRanges,draftText:null!==(_draft$messageBody=draft.messageBody)&&void 0!==_draft$messageBody?_draft$messageBody:"",onChange,onSubmit,theme})]})}ForwardMessageEditor.displayName="ForwardMessageEditor";var getDefaultConversation=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),setupI18n=__webpack_require__("./ts/util/setupI18n.ts"),StorybookThemeContext=__webpack_require__("./.storybook/StorybookThemeContext.js"),CompositionTextArea=__webpack_require__("./ts/components/CompositionTextArea.tsx"),createAttachment=function(){var props=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{pending:!1,path:"fileName.jpg",contentType:(0,MIME.cJ)((0,dist.text)("attachment contentType",props.contentType||"")),fileName:(0,dist.text)("attachment fileName",props.fileName||""),screenshotPath:!1===props.pending?props.screenshotPath:void 0,url:(0,dist.text)("attachment url",!1===props.pending&&props.url||""),size:3433}};const ForwardMessagesModal_stories={title:"Components/ForwardMessageModal"};var i18n=(0,setupI18n.E5)("en",messages),candidateConversations=Array.from(Array(100),(function(){return(0,getDefaultConversation.E$)()})),useProps=function(){var _overrideProps$drafts,overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{drafts:null!==(_overrideProps$drafts=overrideProps.drafts)&&void 0!==_overrideProps$drafts?_overrideProps$drafts:[],candidateConversations,doForwardMessages:(0,esm.action)("doForwardMessages"),getPreferredBadge:function(){},i18n,linkPreviewForSource:function(){},onClose:(0,esm.action)("onClose"),onChange:(0,esm.action)("onChange"),removeLinkPreview:(0,esm.action)("removeLinkPreview"),RenderCompositionTextArea:function(props){return(0,jsx_runtime.jsx)(CompositionTextArea.n,Object.assign({},props,{getPreferredBadge:function(){},i18n,isFormattingEnabled:!0,isFormattingFlagEnabled:!0,isFormattingSpoilersFlagEnabled:!0,onPickEmoji:(0,esm.action)("onPickEmoji"),onSetSkinTone:(0,esm.action)("onSetSkinTone"),onTextTooLong:(0,esm.action)("onTextTooLong"),platform:"darwin",skinTone:0}))},showToast:(0,esm.action)("showToast"),theme:react.useContext(StorybookThemeContext.x),regionCode:"US"}};function getMessageForwardDraft(overrideProps){var _overrideProps$previe;return{attachments:overrideProps.attachments,hasContact:Boolean(overrideProps.hasContact),isSticker:Boolean(overrideProps.isSticker),messageBody:(0,dist.text)("messageBody",overrideProps.messageBody||""),originalMessageId:"123",previews:null!==(_overrideProps$previe=overrideProps.previews)&&void 0!==_overrideProps$previe?_overrideProps$previe:[]}}function Modal(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps()))}function WithText(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps({drafts:[getMessageForwardDraft({messageBody:"sup"})]})))}function ASticker(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps({drafts:[getMessageForwardDraft({isSticker:!0})]})))}function WithAContact(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps({drafts:[getMessageForwardDraft({hasContact:!0})]})))}function ForwardMessagesModal_stories_LinkPreview(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps({drafts:[getMessageForwardDraft({messageBody:"signal.org",previews:[{description:"You're gonna love this description. Not only does it have a lot of characters, but it will also be truncated in the UI. How cool is that??",date:Date.now(),domain:"https://www.signal.org",url:"signal.org",image:createAttachment({url:"/fixtures/kitten-4-112-112.jpg",contentType:MIME._l}),isStickerPack:!1,title:"This is a super-sweet site. And it's got some really amazing content in store for you if you just click that link. Can you click that link for me?"}]})]})))}function MediaAttachments(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps({drafts:[getMessageForwardDraft({messageBody:"cats",attachments:[createAttachment({pending:!0}),createAttachment({contentType:MIME._l,fileName:"tina-rolf-269345-unsplash.jpg",url:"/fixtures/tina-rolf-269345-unsplash.jpg"}),createAttachment({contentType:MIME.ml,fileName:"pixabay-Soap-Bubble-7141.mp4",url:"/fixtures/pixabay-Soap-Bubble-7141.mp4",screenshotPath:"/fixtures/kitten-4-112-112.jpg"})]})]})))}function AnnouncementOnlyGroupsNonAdmin(){return(0,jsx_runtime.jsx)(ForwardMessagesModal,Object.assign({},useProps(),{candidateConversations:[(0,getDefaultConversation.E$)({announcementsOnly:!0,areWeAdmin:!1})]}))}Modal.displayName="Modal",WithText.displayName="WithText",WithText.story={name:"with text"},ASticker.displayName="ASticker",ASticker.story={name:"a sticker"},WithAContact.displayName="WithAContact",WithAContact.story={name:"with a contact"},ForwardMessagesModal_stories_LinkPreview.displayName="LinkPreview",ForwardMessagesModal_stories_LinkPreview.story={name:"link preview"},MediaAttachments.displayName="MediaAttachments",MediaAttachments.story={name:"media attachments"},AnnouncementOnlyGroupsNonAdmin.displayName="AnnouncementOnlyGroupsNonAdmin",AnnouncementOnlyGroupsNonAdmin.story={name:"announcement only groups non-admin"};var __namedExportsOrder=["Modal","WithText","ASticker","WithAContact","LinkPreview","MediaAttachments","AnnouncementOnlyGroupsNonAdmin"]},"./ts/components/InContactsIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>InContactsIcon});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_Tooltip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Tooltip.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function InContactsIcon(props){var className=props.className,i18n=props.i18n,tooltipContainerRef=props.tooltipContainerRef;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Tooltip__WEBPACK_IMPORTED_MODULE_2__.u,{content:i18n("icu:contactInAddressBook"),popperModifiers:[{name:"preventOverflow",options:{boundary:(null==tooltipContainerRef?void 0:tooltipContainerRef.current)||void 0}}],children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{"aria-label":i18n("icu:contactInAddressBook"),className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-in-contacts-icon__icon",className),role:"img",tabIndex:0})})}InContactsIcon.displayName="InContactsIcon"},"./ts/components/SafetyNumberChangeDialog.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SafetyNumberChangeDialog});var SafetyNumberChangeSource,DialogState,lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),_Avatar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Avatar.tsx"),_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/InContactsIcon.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Modal.tsx"),_types_Util__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/types/Util.ts"),_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./ts/util/isInSystemContacts.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./ts/util/missingCaseError.ts"),_ContextMenu__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/components/ContextMenu.tsx"),_util_theme__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/theme.ts"),_util_isNotNil__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./ts/util/isNotNil.ts"),_types_Stories__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/types/Stories.ts"),_UserText__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SafetyNumberChangeDialog(_ref){var confirmText=_ref.confirmText,contacts=_ref.contacts,getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,onCancel=_ref.onCancel,onConfirm=_ref.onConfirm,removeFromStory=_ref.removeFromStory,renderSafetyNumber=_ref.renderSafetyNumber,theme=_ref.theme,totalCount=contacts.reduce((function(count,item){return count+item.contacts.length}),0),allVerified=contacts.every((function(item){return item.contacts.every((function(contact){return contact.isVerified}))})),_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(function getStartingDialogState(count){return 0===count?DialogState.ExplicitReviewComplete:function doesRequireExplicitReviewMode(count){return count>5}(count)?DialogState.ExplicitReviewNeeded:DialogState.StartingInReview}(totalCount)),2),dialogState=_React$useState2[0],setDialogState=_React$useState2[1],_React$useState4=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(void 0),2),selectedContact=_React$useState4[0],setSelectedContact=_React$useState4[1],cancelButtonRef=react__WEBPACK_IMPORTED_MODULE_1__.createRef();react__WEBPACK_IMPORTED_MODULE_1__.useEffect((function(){cancelButtonRef&&cancelButtonRef.current&&cancelButtonRef.current.focus()}),[cancelButtonRef,contacts]),react__WEBPACK_IMPORTED_MODULE_1__.useEffect((function(){dialogState!==DialogState.ExplicitReviewStep||0!==totalCount&&!allVerified||setDialogState(DialogState.ExplicitReviewComplete)}),[allVerified,dialogState,setDialogState,totalCount]);var _text,text,onClose=selectedContact?function(){setSelectedContact(void 0)}:onCancel;if(selectedContact)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_6__.u_,{modalName:"SafetyNumberChangeDialog",hasXButton:!0,i18n,onClose,children:renderSafetyNumber({contactID:selectedContact.id,onClose})});if(dialogState===DialogState.StartingInReview||dialogState===DialogState.ExplicitReviewStep)return _text=dialogState===DialogState.ExplicitReviewStep?i18n("icu:safetyNumberChangeDialog_done"):allVerified||0===totalCount?confirmText||i18n("icu:safetyNumberChangeDialog_send"):confirmText||i18n("icu:sendAnyway"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.reviewing",actions:[{action:function(){dialogState===DialogState.ExplicitReviewStep?setDialogState(DialogState.ExplicitReviewComplete):onConfirm()},text:_text,style:"affirmative"}],hasXButton:!0,i18n,moduleClassName:"module-SafetyNumberChangeDialog__confirm-dialog",noMouseClose:!0,onCancel:onClose,onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__shield-icon"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__title",children:i18n("icu:safetyNumberChanges")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__message",children:i18n("icu:safetyNumberChangeDialog__message")}),contacts.map((function(section){var _section$story;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactSection,{section,getPreferredBadge,i18n,removeFromStory,setSelectedContact,theme},(null===(_section$story=section.story)||void 0===_section$story?void 0:_section$story.name)||"default")}))]},"SafetyNumberChangeDialog.reviewing");if(dialogState===DialogState.ExplicitReviewNeeded)text=confirmText||i18n("icu:sendAnyway");else{if(dialogState!==DialogState.ExplicitReviewComplete)throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_13__.b)(dialogState);text=confirmText||i18n("icu:safetyNumberChangeDialog_send")}var actions=[{action:onConfirm,text,style:"affirmative"}];return dialogState===DialogState.ExplicitReviewNeeded&&actions.unshift({action:function(){return setDialogState(DialogState.ExplicitReviewStep)},text:i18n("icu:safetyNumberChangeDialog__review")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.manyContacts",actions,hasXButton:!0,i18n,moduleClassName:"module-SafetyNumberChangeDialog__confirm-dialog",noMouseClose:!0,noDefaultCancelButton:dialogState===DialogState.ExplicitReviewNeeded,onCancel:onClose,onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__shield-icon"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__title",children:i18n("icu:safetyNumberChanges")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("module-SafetyNumberChangeDialog__message",dialogState===DialogState.ExplicitReviewComplete?"module-SafetyNumberChangeDialog__message--narrow":void 0),children:dialogState===DialogState.ExplicitReviewNeeded?i18n("icu:safetyNumberChangeDialog__many-contacts",{count:totalCount}):i18n("icu:safetyNumberChangeDialog__post-review")})]},"SafetyNumberChangeDialog.manyContacts")}function ContactSection(_ref2){var section=_ref2.section,getPreferredBadge=_ref2.getPreferredBadge,i18n=_ref2.i18n,removeFromStory=_ref2.removeFromStory,setSelectedContact=_ref2.setSelectedContact,theme=_ref2.theme;if(0===section.contacts.length)return null;if(!section.story)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("ul",{className:"module-SafetyNumberChangeDialog__contacts",children:section.contacts.map((function(contact){var shouldShowNumber=Boolean(contact.name||contact.profileName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactRow,{contact,getPreferredBadge,i18n,removeFromStory,setSelectedContact,shouldShowNumber,theme},contact.id)}))});var distributionId=section.story.distributionId,uuids=section.contacts.map((function(contact){return contact.uuid})).filter(_util_isNotNil__WEBPACK_IMPORTED_MODULE_14__.D),sectionName=distributionId===_types_Stories__WEBPACK_IMPORTED_MODULE_10__.qn?i18n("icu:Stories__mine"):section.story.name;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__section",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-SafetyNumberChangeDialog__row__story-name",children:sectionName}),distributionId&&removeFromStory&&uuids.length>1&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(SectionButtonWithMenu,{ariaLabel:i18n("icu:safetyNumberChangeDialog__actions-story",{story:sectionName}),i18n,memberCount:uuids.length,storyName:sectionName,theme,removeFromStory:function(){removeFromStory(distributionId,uuids)}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("ul",{className:"module-SafetyNumberChangeDialog__contacts",children:section.contacts.map((function(contact){var shouldShowNumber=Boolean(contact.name||contact.profileName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(ContactRow,{contact,distributionId,getPreferredBadge,i18n,removeFromStory,setSelectedContact,shouldShowNumber,theme},contact.id)}))})]})}function SectionButtonWithMenu(_ref3){var ariaLabel=_ref3.ariaLabel,i18n=_ref3.i18n,removeFromStory=_ref3.removeFromStory,storyName=_ref3.storyName,memberCount=_ref3.memberCount,theme=_ref3.theme,_React$useState6=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(!1),2),isConfirming=_React$useState6[0],setIsConfirming=_React$useState6[1];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ContextMenu__WEBPACK_IMPORTED_MODULE_8__.x,{ariaLabel,i18n,menuOptions:[{icon:"module-SafetyNumberChangeDialog__menu-icon--delete",label:i18n("icu:safetyNumberChangeDialog__remove-all"),onClick:function(){return setIsConfirming(!0)}}],moduleClassName:"module-SafetyNumberChangeDialog__row__chevron",theme:theme===_types_Util__WEBPACK_IMPORTED_MODULE_7__.f8.dark?_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Dark:_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Light}),isConfirming&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_4__.U,{dialogName:"SafetyNumberChangeDialog.confirm-remove-all",actions:[{action:function(){removeFromStory(),setIsConfirming(!1)},text:i18n("icu:safetyNumberChangeDialog__remove-all"),style:"affirmative"}],i18n,noMouseClose:!0,onCancel:function(){return setIsConfirming(!1)},onClose:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),children:i18n("icu:safetyNumberChangeDialog__confirm-remove-all",{story:storyName,count:memberCount})},"SafetyNumberChangeDialog.confirm-remove-all")]})}function ContactRow(_ref4){var contact=_ref4.contact,distributionId=_ref4.distributionId,getPreferredBadge=_ref4.getPreferredBadge,i18n=_ref4.i18n,removeFromStory=_ref4.removeFromStory,setSelectedContact=_ref4.setSelectedContact,shouldShowNumber=_ref4.shouldShowNumber,theme=_ref4.theme,uuid=contact.uuid;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("li",{className:"module-SafetyNumberChangeDialog__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_3__.qE,{acceptedMessageRequest:contact.acceptedMessageRequest,avatarPath:contact.avatarPath,badge:getPreferredBadge(contact.badges),color:contact.color,conversationType:"direct",i18n,isMe:contact.isMe,phoneNumber:contact.phoneNumber,profileName:contact.profileName,theme,title:contact.title,sharedGroupNames:contact.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_3__.DZ.THIRTY_TWO,unblurredAvatarPath:contact.unblurredAvatarPath}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--wrapper",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--name",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_11__.a,{text:contact.title}),(0,_util_isInSystemContacts__WEBPACK_IMPORTED_MODULE_15__.H)(contact)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("span",{children:[" ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_InContactsIcon__WEBPACK_IMPORTED_MODULE_5__.C,{i18n})]})]}),shouldShowNumber||contact.isVerified?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-SafetyNumberChangeDialog__row--subtitle",children:[shouldShowNumber&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:contact.phoneNumber}),shouldShowNumber&&contact.isVerified&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:" · "}),contact.isVerified&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-SafetyNumberChangeDialog__rtl-span",children:i18n("icu:verified")})]}):null]}),distributionId&&removeFromStory&&uuid?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(RowButtonWithMenu,{ariaLabel:i18n("icu:safetyNumberChangeDialog__actions-contact",{contact:contact.title}),i18n,theme,removeFromStory:function(){return removeFromStory(distributionId,[uuid])},verifyContact:function(){return setSelectedContact(contact)}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("button",{className:"module-SafetyNumberChangeDialog__row__view",onClick:function(){setSelectedContact(contact)},tabIndex:0,type:"button",children:i18n("icu:view")})]},contact.id)}function RowButtonWithMenu(_ref5){var ariaLabel=_ref5.ariaLabel,i18n=_ref5.i18n,removeFromStory=_ref5.removeFromStory,verifyContact=_ref5.verifyContact,theme=_ref5.theme;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_ContextMenu__WEBPACK_IMPORTED_MODULE_8__.x,{ariaLabel,i18n,menuOptions:[{icon:"module-SafetyNumberChangeDialog__menu-icon--verify",label:i18n("icu:safetyNumberChangeDialog__verify-number"),onClick:verifyContact},{icon:"module-SafetyNumberChangeDialog__menu-icon--delete",label:i18n("icu:safetyNumberChangeDialog__remove"),onClick:removeFromStory}],moduleClassName:"module-SafetyNumberChangeDialog__row__chevron",theme:theme===_types_Util__WEBPACK_IMPORTED_MODULE_7__.f8.dark?_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Dark:_util_theme__WEBPACK_IMPORTED_MODULE_9__.Q.Light})}!function(SafetyNumberChangeSource){SafetyNumberChangeSource.Calling="Calling",SafetyNumberChangeSource.MessageSend="MessageSend",SafetyNumberChangeSource.Story="Story"}(SafetyNumberChangeSource||(SafetyNumberChangeSource={})),function(DialogState){DialogState.StartingInReview="StartingInReview",DialogState.ExplicitReviewNeeded="ExplicitReviewNeeded",DialogState.ExplicitReviewStep="ExplicitReviewStep",DialogState.ExplicitReviewComplete="ExplicitReviewComplete"}(DialogState||(DialogState={})),SafetyNumberChangeDialog.displayName="SafetyNumberChangeDialog",ContactSection.displayName="ContactSection",ContactRow.displayName="ContactRow",RowButtonWithMenu.displayName="RowButtonWithMenu"},"./ts/components/SearchInput.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>SearchInput});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/getClassNamesFor.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js"),SearchInput=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)((function SearchInputInner(_ref,ref){var children=_ref.children,_ref$disabled=_ref.disabled,disabled=void 0!==_ref$disabled&&_ref$disabled,_ref$hasSearchIcon=_ref.hasSearchIcon,hasSearchIcon=void 0===_ref$hasSearchIcon||_ref$hasSearchIcon,i18n=_ref.i18n,label=_ref.label,moduleClassName=_ref.moduleClassName,onClear=_ref.onClear,onBlur=_ref.onBlur,onChange=_ref.onChange,onKeyDown=_ref.onKeyDown,placeholder=_ref.placeholder,value=_ref.value,getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_2__.h)("module-SearchInput",moduleClassName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:getClassName("__container"),"data-supertab":!0,children:[hasSearchIcon&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("i",{className:getClassName("__icon")}),children,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("input",{"aria-label":label||i18n("icu:search"),className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName("__input"),value&&getClassName("__input--with-text"),children&&getClassName("__input--with-children")),dir:"auto",disabled,onBlur,onChange,onKeyDown:function(event){var ctrlKey=event.ctrlKey,key=event.key;"linux"===window.platform&&ctrlKey&&"/"===key?(event.preventDefault(),event.stopPropagation()):"Escape"===key&&onClear&&(onClear(),event.preventDefault(),event.stopPropagation()),null==onKeyDown||onKeyDown(event)},placeholder,ref,type:"text",value}),value&&onClear&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("button",{"aria-label":i18n("icu:cancel"),className:getClassName("__cancel"),onClick:onClear,tabIndex:-1,type:"button"})]})}))},"./ts/components/Tooltip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{TQ:()=>TooltipPlacement,u:()=>Tooltip});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),react_popper__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react-popper/lib/esm/Manager.js"),react_popper__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/react-popper/lib/esm/Reference.js"),react_popper__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react-popper/lib/esm/Popper.js"),_util_theme__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/util/theme.ts"),_util_refMerger__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/refMerger.ts"),_util_popperUtil__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/popperUtil.ts"),_services_InteractionMode__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/services/InteractionMode.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var TooltipPlacement,TooltipEventWrapper=react__WEBPACK_IMPORTED_MODULE_1__.forwardRef((function TooltipEvent(_ref,ref){var onHoverChanged=_ref.onHoverChanged,children=_ref.children,wrapperRef=react__WEBPACK_IMPORTED_MODULE_1__.useRef(null),on=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){onHoverChanged(!0)}),[onHoverChanged]),off=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){onHoverChanged(!1)}),[onHoverChanged]),onFocus=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){"keyboard"===(0,_services_InteractionMode__WEBPACK_IMPORTED_MODULE_7__.G)()&&on()}),[on]);return react__WEBPACK_IMPORTED_MODULE_1__.useEffect((function(){var wrapperEl=wrapperRef.current;return wrapperEl?(wrapperEl.addEventListener("mouseenter",on),wrapperEl.addEventListener("mouseleave",off),function(){wrapperEl.removeEventListener("mouseenter",on),wrapperEl.removeEventListener("mouseleave",off)}):lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}),[on,off]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{onFocus,onBlur:off,ref:(0,_util_refMerger__WEBPACK_IMPORTED_MODULE_4__.M)(ref,wrapperRef),children})}));function Tooltip(_ref2){var children=_ref2.children,className=_ref2.className,content=_ref2.content,direction=_ref2.direction,sticky=_ref2.sticky,theme=_ref2.theme,_ref2$popperModifiers=_ref2.popperModifiers,popperModifiers=void 0===_ref2$popperModifiers?[]:_ref2$popperModifiers,_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(!1),2),isHovering=_React$useState2[0],setIsHovering=_React$useState2[1],showTooltip=isHovering||Boolean(sticky),tooltipThemeClassName=theme?`module-tooltip--${(0,_util_theme__WEBPACK_IMPORTED_MODULE_3__.j)(theme)}`:void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_popper__WEBPACK_IMPORTED_MODULE_8__.dK,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_9__.s,{children:function(_ref3){var ref=_ref3.ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(TooltipEventWrapper,{ref,onHoverChanged:setIsHovering,children})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_10__.r,{placement:direction,modifiers:[(0,_util_popperUtil__WEBPACK_IMPORTED_MODULE_5__.E)(12)].concat(_toConsumableArray(popperModifiers)),children:function(_ref4){var arrowProps=_ref4.arrowProps,placement=_ref4.placement,ref=_ref4.ref,style=_ref4.style;return showTooltip&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("module-tooltip",tooltipThemeClassName,className),ref,style,"data-placement":placement,children:[content,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-tooltip-arrow",ref:arrowProps.ref,style:arrowProps.style})]})}})]})}!function(TooltipPlacement){TooltipPlacement.Top="top",TooltipPlacement.Right="right",TooltipPlacement.Bottom="bottom",TooltipPlacement.Left="left"}(TooltipPlacement||(TooltipPlacement={})),Tooltip.displayName="Tooltip"},"./ts/components/conversation/AttachmentList.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>AttachmentList});__webpack_require__("./node_modules/react/index.js");var _Image__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/conversation/Image.tsx"),_StagedGenericAttachment__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/conversation/StagedGenericAttachment.tsx"),_StagedPlaceholderAttachment__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/StagedPlaceholderAttachment.tsx"),_types_Attachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Attachment.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function AttachmentList(_ref){var attachments=_ref.attachments,canEditImages=_ref.canEditImages,i18n=_ref.i18n,onAddAttachment=_ref.onAddAttachment,onClickAttachment=_ref.onClickAttachment,onCloseAttachment=_ref.onCloseAttachment,onClose=_ref.onClose;if(!attachments.length)return null;var allVisualAttachments=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.pU)(attachments);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"module-attachments",children:[onClose&&attachments.length>1?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-attachments__header",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{type:"button",onClick:onClose,className:"module-attachments__close-button","aria-label":i18n("icu:close")})}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"module-attachments__rail",children:[(attachments||[]).map((function(attachment,index){var url=function getUrl(attachment){var _attachment$screensho;if(!attachment.pending)return"screenshot"in attachment&&(null===(_attachment$screensho=attachment.screenshot)||void 0===_attachment$screensho?void 0:_attachment$screensho.url)||attachment.url}(attachment),key=url||attachment.path||attachment.fileName||index,isImage=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.VV)(attachment),isVideo=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.fr)(attachment),closeAttachment=function(){return onCloseAttachment(attachment)};if(isImage&&(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.cR)([attachment])||isVideo||attachment.pending){var isDownloaded=!attachment.pending,imageUrl=url||(isVideo?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQAAAAA3bvkkAAAACklEQVR42mNiAAAABgADm78GJQAAAABJRU5ErkJggg==":void 0),clickAttachment=onClickAttachment?function(){return onClickAttachment(attachment)}:void 0,imgElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_1__.E,{alt:i18n("icu:stagedImageAttachment",{path:attachment.fileName||url||index.toString()}),className:"module-staged-attachment",i18n,attachment,isDownloaded,curveBottomLeft:_Image__WEBPACK_IMPORTED_MODULE_1__.v.Tiny,curveBottomRight:_Image__WEBPACK_IMPORTED_MODULE_1__.v.Tiny,curveTopLeft:_Image__WEBPACK_IMPORTED_MODULE_1__.v.Tiny,curveTopRight:_Image__WEBPACK_IMPORTED_MODULE_1__.v.Tiny,playIconOverlay:isVideo,height:120,width:120,url:imageUrl,closeButton:!0,onClick:clickAttachment,onClickClose:closeAttachment,onError:closeAttachment},key);return isImage&&canEditImages?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"module-attachments--editable",children:[imgElement,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-attachments__edit-icon"})]}):imgElement}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_StagedGenericAttachment__WEBPACK_IMPORTED_MODULE_2__.S,{attachment,i18n,onClose:closeAttachment},key)})),allVisualAttachments&&onAddAttachment?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_StagedPlaceholderAttachment__WEBPACK_IMPORTED_MODULE_3__.D,{onClick:onAddAttachment,i18n}):null]})]})}AttachmentList.displayName="AttachmentList"},"./ts/components/conversation/Image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>Image,v:()=>CurveType});var CurveType,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_blurhash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-blurhash/es/index.js"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_types_Attachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Attachment.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Image(_ref){var alt=_ref.alt,attachment=_ref.attachment,blurHash=_ref.blurHash,bottomOverlay=_ref.bottomOverlay,className=_ref.className,closeButton=_ref.closeButton,curveBottomLeft=_ref.curveBottomLeft,curveBottomRight=_ref.curveBottomRight,curveTopLeft=_ref.curveTopLeft,curveTopRight=_ref.curveTopRight,darkOverlay=_ref.darkOverlay,isDownloaded=_ref.isDownloaded,_ref$height=_ref.height,height=void 0===_ref$height?0:_ref$height,i18n=_ref.i18n,noBackground=_ref.noBackground,noBorder=_ref.noBorder,onClick=_ref.onClick,onClickClose=_ref.onClickClose,onError=_ref.onError,overlayText=_ref.overlayText,playIconOverlay=_ref.playIconOverlay,tabIndex=_ref.tabIndex,theme=_ref.theme,url=_ref.url,_ref$width=_ref.width,width=void 0===_ref$width?0:_ref$width,_ref$cropWidth=_ref.cropWidth,cropWidth=void 0===_ref$cropWidth?0:_ref$cropWidth,_ref$cropHeight=_ref.cropHeight,cropHeight=void 0===_ref$cropHeight?0:_ref$cropHeight,_ref2=attachment||{caption:null,pending:!0},caption=_ref2.caption,pending=_ref2.pending,imgNotDownloaded=!isDownloaded&&!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.TG)(attachment),resolvedBlurHash=blurHash||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.d0)(theme),curveStyles={borderTopLeftRadius:curveTopLeft||CurveType.None,borderTopRightRadius:curveTopRight||CurveType.None,borderBottomLeftRadius:curveBottomLeft||CurveType.None,borderBottomRightRadius:curveBottomRight||CurveType.None},canClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return null!=onClick&&!pending}),[pending,onClick]),handleClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(event){if(!canClick)return event.preventDefault(),void event.stopPropagation();onClick&&(event.preventDefault(),event.stopPropagation(),onClick(attachment))}),[attachment,canClick,onClick]),handleKeyDown=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(event){if(!canClick)return event.preventDefault(),void event.stopPropagation();!onClick||"Enter"!==event.key&&"Space"!==event.key||(event.preventDefault(),event.stopPropagation(),onClick(attachment))}),[attachment,canClick,onClick]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-image",className,noBackground?null:"module-image--with-background",cropWidth||cropHeight?"module-image--cropped":null),style:Object.assign({width:width-cropWidth,height:height-cropHeight},curveStyles),children:[pending?blurHash?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"module-image__download-pending",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:blurHash,width,height,style:{display:"block"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__download-pending--spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__download-pending--spinner",title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{moduleClassName:"module-image-spinner",svgSize:"small"})})})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__loading-placeholder",style:{height:`${height}px`,width:`${width}px`,lineHeight:`${height}px`,textAlign:"center"},title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{svgSize:"normal"})}):url?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("img",{onError,className:"module-image__image",alt,height,width,src:url}):resolvedBlurHash?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:resolvedBlurHash,width,height,style:{display:"block"}}):null,caption?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("img",{className:"module-image__caption-icon",src:"images/caption-shadow.svg",alt:i18n("icu:imageCaptionIconAlt")}):null,bottomOverlay?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__bottom-overlay",style:{borderBottomLeftRadius:curveBottomLeft||CurveType.None,borderBottomRightRadius:curveBottomRight||CurveType.None}}):null,pending||imgNotDownloaded||!playIconOverlay?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__play-overlay__circle",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__play-overlay__icon"})}),overlayText?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__text-container",style:{lineHeight:`${height}px`},children:overlayText}):null,canClick?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{type:"button",className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-image__border-overlay",{"module-image__border-overlay--with-border":!noBorder,"module-image__border-overlay--with-click-handler":canClick,"module-image__border-overlay--dark":darkOverlay,"module-image--not-downloaded":imgNotDownloaded}),style:curveStyles,onClick:handleClick,onKeyDown:handleKeyDown,tabIndex,children:imgNotDownloaded?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{}):null}):null,closeButton?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),onClickClose&&onClickClose(attachment)},className:"module-image__close-button",title:i18n("icu:remove-attachment"),"aria-label":i18n("icu:remove-attachment")}):null]})}!function(CurveType){CurveType[CurveType.None=0]="None",CurveType[CurveType.Tiny=4]="Tiny",CurveType[CurveType.Small=10]="Small",CurveType[CurveType.Normal=18]="Normal"}(CurveType||(CurveType={})),Image.displayName="Image"},"./ts/components/conversation/LinkPreviewDate.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>LinkPreviewDate});__webpack_require__("./node_modules/react/index.js");var moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment);var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function LinkPreviewDate(_ref){var date=_ref.date,_ref$className=_ref.className,className=void 0===_ref$className?"":_ref$className,dateMoment=function isLinkPreviewDateValid(value){var maximumLinkPreviewDate=Date.now()+864e5;return"number"==typeof value&&0!==value&&Number.isFinite(value)&&value<maximumLinkPreviewDate}(date)?moment_default()(date):null;return dateMoment?(0,jsx_runtime.jsx)("time",{className,dateTime:dateMoment.toISOString(),children:dateMoment.format("ll")}):null}},"./ts/components/conversation/StagedGenericAttachment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>StagedGenericAttachment});__webpack_require__("./node_modules/react/index.js");var _types_Attachment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Attachment.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function StagedGenericAttachment(_ref){var attachment=_ref.attachment,i18n=_ref.i18n,onClose=_ref.onClose,fileName=attachment.fileName,contentType=attachment.contentType,extension=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_1__.Gq)({contentType,fileName});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:"module-staged-attachment module-staged-generic-attachment",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("button",{type:"button",className:"module-staged-generic-attachment__close-button","aria-label":i18n("icu:close"),onClick:function(){onClose&&onClose(attachment)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"module-staged-generic-attachment__icon",children:extension?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"module-staged-generic-attachment__icon__extension",children:extension}):null}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"module-staged-generic-attachment__filename",children:fileName})]})}StagedGenericAttachment.displayName="StagedGenericAttachment"},"./ts/components/conversation/StagedPlaceholderAttachment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>StagedPlaceholderAttachment});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function StagedPlaceholderAttachment(_ref){var i18n=_ref.i18n,onClick=_ref.onClick;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("button",{type:"button",className:"module-staged-placeholder-attachment",onClick,title:i18n("icu:addImageOrVideoattachment"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{className:"module-staged-placeholder-attachment__plus-icon"})})}StagedPlaceholderAttachment.displayName="StagedPlaceholderAttachment"},"./ts/messages/helpers.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Zw:()=>getSourceUuid,b5:()=>getSource,dc:()=>getPaymentEventNotificationText,gD:()=>getSourceDevice,rW:()=>getPaymentEventDescription,zK:()=>isStory});var _logging_log__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/logging/log.ts"),_types_Payment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Payment.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/missingCaseError.ts");function isIncoming(message){return"incoming"===message.type}function isOutgoing(message){return"outgoing"===message.type}function isStory(message){return"story"===message.type}function getPaymentEventNotificationText(payment,senderTitle,conversationTitle,senderIsMe,i18n){return payment.kind===_types_Payment__WEBPACK_IMPORTED_MODULE_1__.s.Notification?i18n("icu:payment-event-notification-label"):getPaymentEventDescription(payment,senderTitle,conversationTitle,senderIsMe,i18n)}function getPaymentEventDescription(payment,senderTitle,conversationTitle,senderIsMe,i18n){var kind=payment.kind;if(kind===_types_Payment__WEBPACK_IMPORTED_MODULE_1__.s.Notification)return senderIsMe?null!=conversationTitle?i18n("icu:payment-event-notification-message-you-label",{receiver:conversationTitle}):i18n("icu:payment-event-notification-message-you-label-without-receiver"):i18n("icu:payment-event-notification-message-label",{sender:senderTitle});if(kind===_types_Payment__WEBPACK_IMPORTED_MODULE_1__.s.ActivationRequest)return senderIsMe?null!=conversationTitle?i18n("icu:payment-event-activation-request-you-label",{receiver:conversationTitle}):i18n("icu:payment-event-activation-request-you-label-without-receiver"):i18n("icu:payment-event-activation-request-label",{sender:senderTitle});if(kind===_types_Payment__WEBPACK_IMPORTED_MODULE_1__.s.Activation)return senderIsMe?i18n("icu:payment-event-activated-you-label"):i18n("icu:payment-event-activated-label",{sender:senderTitle});throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_2__.b)(kind)}function getSource(message){return isIncoming(message)||isStory(message)?message.source:(isOutgoing(message)||_logging_log__WEBPACK_IMPORTED_MODULE_0__.warn("Message.getSource: Called for non-incoming/non-outgoing message"),window.textsecure.storage.user.getNumber())}function getSourceDevice(message){var sourceDevice=message.sourceDevice;return isIncoming(message)||isStory(message)?sourceDevice:(isOutgoing(message)||_logging_log__WEBPACK_IMPORTED_MODULE_0__.warn("Message.getSourceDevice: Called for non-incoming/non-outgoing message"),sourceDevice||window.textsecure.storage.user.getDeviceId())}function getSourceUuid(message){var _window$textsecure$st;return isIncoming(message)||isStory(message)?message.sourceUuid:(isOutgoing(message)||_logging_log__WEBPACK_IMPORTED_MODULE_0__.warn("Message.getSourceUuid: Called for non-incoming/non-outgoing message"),null===(_window$textsecure$st=window.textsecure.storage.user.getUuid())||void 0===_window$textsecure$st?void 0:_window$textsecure$st.toString())}},"./ts/services/InteractionMode.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>getInteractionMode});var interactionMode="mouse";function getInteractionMode(){return interactionMode}},"./ts/types/Payment.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var PaymentEventKind;__webpack_require__.d(__webpack_exports__,{s:()=>PaymentEventKind}),function(PaymentEventKind){PaymentEventKind[PaymentEventKind.Notification=1]="Notification",PaymentEventKind[PaymentEventKind.ActivationRequest=2]="ActivationRequest",PaymentEventKind[PaymentEventKind.Activation=3]="Activation"}(PaymentEventKind||(PaymentEventKind={}))},"./ts/types/PhoneNumber.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var memoizee__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/memoizee/index.js"),memoizee__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(memoizee__WEBPACK_IMPORTED_MODULE_0__),_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/libphonenumberInstance.ts");__webpack_require__("./ts/logging/log.ts"),__webpack_require__("./ts/types/errors.ts");memoizee__WEBPACK_IMPORTED_MODULE_0___default()((function _format(phoneNumber,options){try{var ourRegionCode=options.ourRegionCode,parsedNumber=_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.parse(phoneNumber),regionCode=_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.getRegionCodeForNumber(parsedNumber);return ourRegionCode&&regionCode===ourRegionCode?_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.format(parsedNumber,_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.M9.NATIONAL):_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.format(parsedNumber,_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.M9.INTERNATIONAL)}catch(error){return phoneNumber}}),{primitive:!0,normalizer:function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return JSON.stringify(args)},max:5e3})},"./ts/types/Toast.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var ToastType;__webpack_require__.d(__webpack_exports__,{p:()=>ToastType}),function(ToastType){ToastType.AddingUserToGroup="AddingUserToGroup",ToastType.AlreadyGroupMember="AlreadyGroupMember",ToastType.AlreadyRequestedToJoin="AlreadyRequestedToJoin",ToastType.Blocked="Blocked",ToastType.BlockedGroup="BlockedGroup",ToastType.CannotEditMessage="CannotEditMessage",ToastType.CannotForwardEmptyMessage="CannotForwardEmptyMessage",ToastType.CannotMixMultiAndNonMultiAttachments="CannotMixMultiAndNonMultiAttachments",ToastType.CannotOpenGiftBadgeIncoming="CannotOpenGiftBadgeIncoming",ToastType.CannotOpenGiftBadgeOutgoing="CannotOpenGiftBadgeOutgoing",ToastType.CannotStartGroupCall="CannotStartGroupCall",ToastType.ConversationArchived="ConversationArchived",ToastType.ConversationMarkedUnread="ConversationMarkedUnread",ToastType.ConversationRemoved="ConversationRemoved",ToastType.ConversationUnarchived="ConversationUnarchived",ToastType.CopiedUsername="CopiedUsername",ToastType.CopiedUsernameLink="CopiedUsernameLink",ToastType.DangerousFileType="DangerousFileType",ToastType.DeleteForEveryoneFailed="DeleteForEveryoneFailed",ToastType.Error="Error",ToastType.Expired="Expired",ToastType.FailedToDeleteUsername="FailedToDeleteUsername",ToastType.FileSaved="FileSaved",ToastType.FileSize="FileSize",ToastType.InvalidConversation="InvalidConversation",ToastType.LeftGroup="LeftGroup",ToastType.MaxAttachments="MaxAttachments",ToastType.MessageBodyTooLong="MessageBodyTooLong",ToastType.OriginalMessageNotFound="OriginalMessageNotFound",ToastType.PinnedConversationsFull="PinnedConversationsFull",ToastType.ReactionFailed="ReactionFailed",ToastType.ReportedSpamAndBlocked="ReportedSpamAndBlocked",ToastType.StoryMuted="StoryMuted",ToastType.StoryReact="StoryReact",ToastType.StoryReply="StoryReply",ToastType.StoryVideoError="StoryVideoError",ToastType.StoryVideoUnsupported="StoryVideoUnsupported",ToastType.TapToViewExpiredIncoming="TapToViewExpiredIncoming",ToastType.TapToViewExpiredOutgoing="TapToViewExpiredOutgoing",ToastType.TooManyMessagesToDeleteForEveryone="TooManyMessagesToDeleteForEveryone",ToastType.TooManyMessagesToForward="TooManyMessagesToForward",ToastType.UnableToLoadAttachment="UnableToLoadAttachment",ToastType.UnsupportedMultiAttachment="UnsupportedMultiAttachment",ToastType.UnsupportedOS="UnsupportedOS",ToastType.UserAddedToGroup="UserAddedToGroup"}(ToastType||(ToastType={}))},"./ts/types/VisualAttachment.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{UR:()=>makeObjectUrl,pz:()=>getImageDimensions,qg:()=>revokeObjectUrl});__webpack_require__("./node_modules/blueimp-load-image/js/index.js");var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/errors.ts");__webpack_require__("./ts/types/MIME.ts"),__webpack_require__("./ts/util/assert.ts"),__webpack_require__("./ts/util/canvasToBlob.ts");function getImageDimensions(_ref){var objectUrl=_ref.objectUrl,logger=_ref.logger;return new Promise((function(resolve,reject){var image=document.createElement("img");image.addEventListener("load",(function(){resolve({height:image.naturalHeight,width:image.naturalWidth})})),image.addEventListener("error",(function(error){logger.error("getImageDimensions error",(0,_errors__WEBPACK_IMPORTED_MODULE_1__.G)(error)),reject(error)})),image.src=objectUrl}))}function makeObjectUrl(data,contentType){var blob=new Blob([data],{type:contentType});return URL.createObjectURL(blob)}function revokeObjectUrl(objectUrl){URL.revokeObjectURL(objectUrl)}},"./ts/util/canvasToBlob.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>canvasToBlob});var _types_MIME__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/MIME.ts");async function canvasToBlob(canvas){var mimeType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,quality=arguments.length>2?arguments[2]:void 0;return new Promise((function(resolve,reject){return canvas.toBlob((function(result){result?resolve(result):reject(new Error("Couldn't convert the canvas to a Blob"))}),mimeType,quality)}))}},"./ts/util/clearTimeoutIfNecessary.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function clearTimeoutIfNecessary(timeout){timeout&&clearTimeout(timeout)}__webpack_require__.d(__webpack_exports__,{S:()=>clearTimeoutIfNecessary})},"./ts/util/explodePromise.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function explodePromise(){var resolve,reject;return{promise:new Promise((function(innerResolve,innerReject){resolve=innerResolve,reject=innerReject})),resolve,reject}}__webpack_require__.d(__webpack_exports__,{R:()=>explodePromise})},"./ts/util/filterAndSortConversations.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>filterAndSortConversationsByRecent});var fuse_esm=__webpack_require__("./node_modules/fuse.js/dist/fuse.esm.js"),libphonenumberInstance=__webpack_require__("./ts/util/libphonenumberInstance.ts");function removeDiacritics(text){return text.normalize("NFD").replace(/\p{Diacritic}/gu,"")}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ACTIVE_AT_SCORE_FACTOR=1/__webpack_require__("./ts/util/durations/index.ts").ps*.01,FUSE_OPTIONS={threshold:.2,includeScore:!0,useExtendedSearch:!0,shouldSort:!0,distance:200,keys:[{name:"searchableTitle",weight:1},{name:"title",weight:1},{name:"name",weight:1},{name:"username",weight:1},{name:"e164",weight:.5}],getFn:function(){var _Fuse$config,text=(_Fuse$config=fuse_esm.Z.config).getFn.apply(_Fuse$config,arguments);return text?"string"==typeof text?removeDiacritics(text):text.map(removeDiacritics):text}},cachedIndices=new WeakMap,COMMANDS=new Map;function filterAndSortConversationsByRecent(conversations,searchTerm,regionCode){if(searchTerm.length){var now=Date.now();return function searchConversations(conversations,searchTerm,regionCode){var maybeCommand=searchTerm.match(/^!([^\s]+):(.*)$/);if(maybeCommand){var _maybeCommand=_slicedToArray(maybeCommand,3),commandName=_maybeCommand[1],_query=_maybeCommand[2],command=COMMANDS.get(commandName);if(command)return command(conversations,_query).map((function(item){return{item}}))}var phoneNumber=(0,libphonenumberInstance.i9)(searchTerm,regionCode),extendedSearchTerm=searchTerm;phoneNumber&&(extendedSearchTerm+=` | ${phoneNumber.e164}`);var index=cachedIndices.get(conversations);return index||(index=new fuse_esm.Z(conversations,FUSE_OPTIONS),cachedIndices.set(conversations,index)),index.search(extendedSearchTerm)}(conversations.filter((function(item){return item.titleNoDefault})),searchTerm,regionCode).slice().sort((function(a,b){var _a$score,_b$score,_a$item=a.item,_a$item$activeAt=_a$item.activeAt,aActiveAt=void 0===_a$item$activeAt?0:_a$item$activeAt,_a$item$left=_a$item.left,aLeft=void 0!==_a$item$left&&_a$item$left,_b$item=b.item,_b$item$activeAt=_b$item.activeAt,bActiveAt=void 0===_b$item$activeAt?0:_b$item$activeAt,_b$item$left=_b$item.left,bLeft=void 0!==_b$item$left&&_b$item$left;return(now-aActiveAt)*ACTIVE_AT_SCORE_FACTOR+(null!==(_a$score=a.score)&&void 0!==_a$score?_a$score:0)+(aLeft?1:0)-((now-bActiveAt)*ACTIVE_AT_SCORE_FACTOR+(null!==(_b$score=b.score)&&void 0!==_b$score?_b$score:0)+(bLeft?1:0))})).map((function(result){return result.item}))}return conversations.concat().sort((function(a,b){return a.activeAt&&b.activeAt?a.activeAt>b.activeAt?-1:1:a.activeAt&&!b.activeAt?-1:1}))}COMMANDS.set("uuidEndsWith",(function(conversations,query){return conversations.filter((function(convo){var _convo$uuid;return null===(_convo$uuid=convo.uuid)||void 0===_convo$uuid?void 0:_convo$uuid.endsWith(query)}))})),COMMANDS.set("idEndsWith",(function(conversations,query){return conversations.filter((function(convo){var _convo$id;return null===(_convo$id=convo.id)||void 0===_convo$id?void 0:_convo$id.endsWith(query)}))})),COMMANDS.set("e164EndsWith",(function(conversations,query){return conversations.filter((function(convo){var _convo$e;return null===(_convo$e=convo.e164)||void 0===_convo$e?void 0:_convo$e.endsWith(query)}))})),COMMANDS.set("groupIdEndsWith",(function(conversations,query){return conversations.filter((function(convo){var _convo$groupId;return null===(_convo$groupId=convo.groupId)||void 0===_convo$groupId?void 0:_convo$groupId.endsWith(query)}))}))},"./ts/util/grapheme.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QX:()=>count,Rc:()=>truncateAndSize,i3:()=>isSingleGrapheme});var _iterables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/iterables.ts");function count(str){var segments=(new Intl.Segmenter).segment(str);return(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments)}function truncateAndSize(str,toSize){var segments=(new Intl.Segmenter).segment(str),originalSize=(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments);return void 0===toSize||originalSize<=toSize?[str,originalSize]:[(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.v_)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.UI)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.qn)(segments,toSize),(function(s){return s.segment})),""),toSize]}function isSingleGrapheme(str){return""!==str&&(new Intl.Segmenter).segment(str).containing(0).segment===str}},"./ts/util/libphonenumberInstance.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M9:()=>PhoneNumberFormat,eE:()=>instance,i9:()=>parseAndFormatPhoneNumber});var google_libphonenumber__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/google-libphonenumber/dist/libphonenumber.js"),google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(google_libphonenumber__WEBPACK_IMPORTED_MODULE_0__),instance=google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default().PhoneNumberUtil.getInstance(),PhoneNumberFormat=google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default().PhoneNumberFormat;function parseAndFormatPhoneNumber(str,regionCode){var result,format=arguments.length>2&&void 0!==arguments[2]?arguments[2]:PhoneNumberFormat.E164;try{result=instance.parse(str,regionCode)}catch(err){return}return{isValid:instance.isValidNumber(result),userInput:str,e164:instance.format(result,format)}}},"./ts/util/shouldNeverBeCalled.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>shouldNeverBeCalled,q:()=>asyncShouldNeverBeCalled});var _assert__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/assert.ts");function shouldNeverBeCalled(){(0,_assert__WEBPACK_IMPORTED_MODULE_0__.q8)(!1,"This should never be called. Doing nothing")}async function asyncShouldNeverBeCalled(){shouldNeverBeCalled()}},"./ts/util/sleep.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function sleep(ms,abortSignal){return new Promise((function(resolve,reject){var timeout=setTimeout(resolve,ms);null==abortSignal||abortSignal.addEventListener("abort",(function(){void 0!==timeout&&(clearTimeout(timeout),timeout=void 0),reject(new Error("Aborted"))}))}))}__webpack_require__.d(__webpack_exports__,{_:()=>sleep})},"./ts/util/whatTypeOfConversation.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C$:()=>isDirectConversation});var ConversationTypes;__webpack_require__("./ts/Bytes.ts"),__webpack_require__("./ts/logging/log.ts");function isDirectConversation(conversationAttrs){return"private"===conversationAttrs.type||"direct"===conversationAttrs.type}!function(ConversationTypes){ConversationTypes.Me="Me",ConversationTypes.Direct="Direct",ConversationTypes.GroupV1="GroupV1",ConversationTypes.GroupV2="GroupV2"}(ConversationTypes||(ConversationTypes={}))}}]);