"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[1065],{"./ts/components/conversation/AddNewLines.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>AddNewLines});__webpack_require__("./node_modules/react/index.js");var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js"),defaultRenderNonNewLine=function(_ref){return _ref.text};function AddNewLines(_ref2){var text=_ref2.text,_ref2$renderNonNewLin=_ref2.renderNonNewLine,renderNonNewLine=void 0===_ref2$renderNonNewLin?defaultRenderNonNewLine:_ref2$renderNonNewLin,results=[],FIND_NEWLINES=/\n/g,match=FIND_NEWLINES.exec(text),last=0,count=1;if(!match)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.Fragment,{children:renderNonNewLine({text,key:0})});for(;match;){if(last<match.index){var textWithNoNewline=text.slice(last,match.index);count+=1,results.push(renderNonNewLine({text:textWithNoNewline,key:count}))}count+=1,results.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("br",{},count)),last=FIND_NEWLINES.lastIndex,match=FIND_NEWLINES.exec(text)}return last<text.length&&(count+=1,results.push(renderNonNewLine({text:text.slice(last),key:count}))),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.Fragment,{children:results})}},"./ts/components/conversation/AtMention.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>AtMention});var classnames__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_0__),_Emojify__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./ts/components/conversation/Emojify.tsx")),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function AtMention(_ref){var direction=_ref.direction,id=_ref.id,isInvisible=_ref.isInvisible,name=_ref.name,onClick=_ref.onClick,onKeyUp=_ref.onKeyUp;return isInvisible?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:classnames__WEBPACK_IMPORTED_MODULE_0___default()("MessageBody__at-mention","MessageBody__at-mention--invisible"),"data-id":id,"data-title":name,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("bdi",{children:["@",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Emojify__WEBPACK_IMPORTED_MODULE_2__.u,{isInvisible,text:name})]})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:classnames__WEBPACK_IMPORTED_MODULE_0___default()("MessageBody__at-mention",`MessageBody__at-mention--${direction}`),onClick,onKeyUp,tabIndex:0,role:"link","data-id":id,"data-title":name,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("bdi",{children:["@",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Emojify__WEBPACK_IMPORTED_MODULE_2__.u,{isInvisible,text:name})]})})}AtMention.displayName="AtMention"},"./ts/components/conversation/Linkify.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N1:()=>linkify,v2:()=>SUPPORTED_PROTOCOLS,zR:()=>Linkify});__webpack_require__("./node_modules/react/index.js");var linkify_it__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/linkify-it/index.js"),linkify_it__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(linkify_it__WEBPACK_IMPORTED_MODULE_1__),_types_LinkPreview__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/types/LinkPreview.ts"),_util_emoji__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/util/emoji.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/missingCaseError.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js"),linkify=linkify_it__WEBPACK_IMPORTED_MODULE_1___default()().tlds(["ac","ad","ae","aero","af","ag","ai","al","am","an","ao","aq","ar","arpa","as","asia","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","biz","bj","bl","bm","bn","bo","bq","br","bs","bt","bv","bw","by","bz","ca","cat","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","com","coop","cr","cu","cv","cw","cx","cy","cz","de","dj","dk","dm","do","dz","ec","edu","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gov","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","info","int","io","iq","ir","is","it","je","jm","jo","jobs","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mf","mg","mh","mil","mk","ml","mm","mn","mo","mobi","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","nc","ne","net","nf","ng","ni","nl","no","np","nr","nu","nz","om","org","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","pro","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","st","su","sv","sx","sy","sz","tc","td","tel","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","travel","tt","tv","tw","tz","ua","ug","uk","um","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","中国","中國","ලංකා","香港","台湾","台灣","امارات","الاردن","السعودية","ไทย","рф","تونس","مصر","قطر","இலங்கை","فلسطين","ye","yt","za","zm","zw"]),SUPPORTED_PROTOCOLS=/^(http|https):/i,defaultRenderNonLink=function(_ref){return _ref.text};function Linkify(props){var text=props.text,_props$renderNonLink=props.renderNonLink,renderNonLink=void 0===_props$renderNonLink?defaultRenderNonLink:_props$renderNonLink;if(!(0,_types_LinkPreview__WEBPACK_IMPORTED_MODULE_2__.vl)(text))return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment,{children:renderNonLink({text,key:1})});var chunkData=(0,_util_emoji__WEBPACK_IMPORTED_MODULE_3__.b)(text).map((function(_ref2){var type=_ref2.type,chunk=_ref2.value;if("text"===type)return{chunk,matchData:linkify.match(chunk)||[]};if("emoji"===type)return{chunk,matchData:[]};throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_5__.b)(type)})),results=[],count=1;return chunkData.forEach((function(_ref3){var chunk=_ref3.chunk,matchData=_ref3.matchData;if(0===matchData.length)return count+=1,void results.push(renderNonLink({text:chunk,key:count}));var chunkLastIndex=0;matchData.forEach((function(match){if(chunkLastIndex<match.index){var textWithNoLink=chunk.slice(chunkLastIndex,match.index);count+=1,results.push(renderNonLink({text:textWithNoLink,key:count}))}var url=match.url,originalText=match.text;count+=1,SUPPORTED_PROTOCOLS.test(url)&&!(0,_types_LinkPreview__WEBPACK_IMPORTED_MODULE_2__.kz)(url)?results.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("a",{href:url,children:originalText},count)):results.push(renderNonLink({text:originalText,key:count})),chunkLastIndex=match.lastIndex})),chunkLastIndex<chunk.length&&(count+=1,results.push(renderNonLink({text:chunk.slice(chunkLastIndex),key:count})))})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment,{children:results})}},"./ts/components/conversation/MessageTextRenderer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G5:()=>RenderLocation,mI:()=>MessageTextRenderer});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),emoji_regex__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/emoji-regex/index.js"),emoji_regex__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(emoji_regex__WEBPACK_IMPORTED_MODULE_2__),_Linkify__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/Linkify.tsx"),_types_BodyRange__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/BodyRange.ts"),_AtMention__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/conversation/AtMention.tsx"),_types_LinkPreview__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/types/LinkPreview.ts"),_Emojify__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/components/conversation/Emojify.tsx"),_AddNewLines__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/components/conversation/AddNewLines.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var RenderLocation,EMOJI_REGEXP=emoji_regex__WEBPACK_IMPORTED_MODULE_2___default()();function MessageTextRenderer(_ref){var bodyRanges=_ref.bodyRanges,direction=_ref.direction,disableLinks=_ref.disableLinks,emojiSizeClass=_ref.emojiSizeClass,i18n=_ref.i18n,isSpoilerExpanded=_ref.isSpoilerExpanded,messageText=_ref.messageText,onExpandSpoiler=_ref.onExpandSpoiler,onMentionTrigger=_ref.onMentionTrigger,renderLocation=_ref.renderLocation,textLength=_ref.textLength,links=disableLinks?[]:function extractLinks(messageText){var matches=_Linkify__WEBPACK_IMPORTED_MODULE_3__.N1.match(messageText.replace(EMOJI_REGEXP,(function(s){return" ".repeat(s.length)})));if(null==matches)return[];return matches.map((function(match){return{start:match.index,length:match.lastIndex-match.index,url:match.url}}))}(messageText),tree=bodyRanges.reduce((function(acc,range){return range.start<textLength?(0,_types_BodyRange__WEBPACK_IMPORTED_MODULE_4__.GO)(range,acc):acc}),links.map((function(b){return Object.assign({},b,{ranges:[]})}))),nodes=(0,_types_BodyRange__WEBPACK_IMPORTED_MODULE_4__.E5)({tree,text:messageText}),finalNodes=(0,_types_BodyRange__WEBPACK_IMPORTED_MODULE_4__.$Y)(nodes);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:finalNodes.map((function(node){return renderNode({direction,disableLinks,emojiSizeClass,i18n,isInvisible:!1,isSpoilerExpanded,node,renderLocation,onMentionTrigger,onExpandSpoiler})}))})}function renderNode(_ref2){var _node$spoilerChildren,direction=_ref2.direction,disableLinks=_ref2.disableLinks,emojiSizeClass=_ref2.emojiSizeClass,i18n=_ref2.i18n,isInvisible=_ref2.isInvisible,isSpoilerExpanded=_ref2.isSpoilerExpanded,node=_ref2.node,onExpandSpoiler=_ref2.onExpandSpoiler,onMentionTrigger=_ref2.onMentionTrigger,renderLocation=_ref2.renderLocation,key=node.start;if(node.isSpoiler&&null!==(_node$spoilerChildren=node.spoilerChildren)&&void 0!==_node$spoilerChildren&&_node$spoilerChildren.length){var _node$spoilerChildren2,isSpoilerHidden=Boolean(node.isSpoiler&&!isSpoilerExpanded),_content=null===(_node$spoilerChildren2=node.spoilerChildren)||void 0===_node$spoilerChildren2?void 0:_node$spoilerChildren2.map((function(spoilerNode){return renderNode({direction,disableLinks,emojiSizeClass,i18n,isInvisible:isSpoilerHidden,isSpoilerExpanded,node:spoilerNode,renderLocation,onMentionTrigger,onExpandSpoiler})}));return isSpoilerHidden?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span",{tabIndex:disableLinks?void 0:0,role:disableLinks?void 0:"button","aria-label":i18n("icu:MessageTextRenderer--spoiler--label"),"aria-expanded":!1,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("MessageTextRenderer__formatting--spoiler",`MessageTextRenderer__formatting--spoiler-${renderLocation}`,direction?`MessageTextRenderer__formatting--spoiler-${renderLocation}--${direction}`:null,disableLinks?"MessageTextRenderer__formatting--spoiler--noninteractive":null),onClick:disableLinks?void 0:function(event){onExpandSpoiler&&(event.preventDefault(),event.stopPropagation(),onExpandSpoiler())},onKeyDown:disableLinks?void 0:function(event){"Enter"!==event.key&&" "!==event.key||(event.preventDefault(),event.stopPropagation(),null==onExpandSpoiler||onExpandSpoiler())},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span",{"aria-hidden":!0,children:_content})},key):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span",{className:"MessageTextRenderer__formatting--spoiler--revealed",children:_content},key)}var content=function renderMentions(_ref3){var _step,direction=_ref3.direction,disableLinks=_ref3.disableLinks,emojiSizeClass=_ref3.emojiSizeClass,isInvisible=_ref3.isInvisible,mentions=_ref3.mentions,onMentionTrigger=_ref3.onMentionTrigger,text=_ref3.text,result=[],offset=0,_iterator=_createForOfIteratorHelper(mentions);try{for(_iterator.s();!(_step=_iterator.n()).done;){var mention=_step.value;mention.start>offset&&result.push(renderText({isInvisible,key:result.length.toString(),emojiSizeClass,text:text.slice(offset,mention.start)})),result.push(renderMention({isInvisible,key:result.length.toString(),conversationId:mention.conversationID,disableLinks,direction,name:mention.replacementText,onMentionTrigger})),offset=mention.start+mention.length}}catch(err){_iterator.e(err)}finally{_iterator.f()}return result.push(renderText({isInvisible,key:result.length.toString(),emojiSizeClass,text:text.slice(offset,text.length)})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:result})}({direction,disableLinks,emojiSizeClass,isInvisible,mentions:node.mentions,onMentionTrigger,text:node.text});(node.isBold||node.isKeywordHighlight)&&(content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("strong",{children:content})),node.isItalic&&(content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("em",{children:content})),node.isStrikethrough&&(content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("s",{children:content}));var formattingClasses=classnames__WEBPACK_IMPORTED_MODULE_1___default()(node.isMonospace?"MessageTextRenderer__formatting--monospace":null,node.isKeywordHighlight?"MessageTextRenderer__formatting--keywordHighlight":null,isInvisible?"MessageTextRenderer__formatting--invisible":null);return node.url&&_Linkify__WEBPACK_IMPORTED_MODULE_3__.v2.test(node.url)&&!(0,_types_LinkPreview__WEBPACK_IMPORTED_MODULE_6__.kz)(node.url)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("a",{className:formattingClasses,href:node.url,children:content},key):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span",{className:formattingClasses,children:content},key)}function renderMention(_ref4){var conversationId=_ref4.conversationId,name=_ref4.name,isInvisible=_ref4.isInvisible,key=_ref4.key,disableLinks=_ref4.disableLinks,direction=_ref4.direction,onMentionTrigger=_ref4.onMentionTrigger;return disableLinks?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("bdi",{children:["@",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_Emojify__WEBPACK_IMPORTED_MODULE_7__.u,{isInvisible,text:name})]},key):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_AtMention__WEBPACK_IMPORTED_MODULE_5__.Q,{id:conversationId,isInvisible,name,direction,onClick:function(){onMentionTrigger&&onMentionTrigger(conversationId)},onKeyUp:function(e){e.target===e.currentTarget&&"Enter"===e.key&&onMentionTrigger&&onMentionTrigger(conversationId)}},key)}function renderText(_ref5){var text=_ref5.text,emojiSizeClass=_ref5.emojiSizeClass,isInvisible=_ref5.isInvisible,key=_ref5.key;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_Emojify__WEBPACK_IMPORTED_MODULE_7__.u,{isInvisible,renderNonEmoji:function(_ref6){var innerText=_ref6.text,innerKey=_ref6.key;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_AddNewLines__WEBPACK_IMPORTED_MODULE_8__.K,{text:innerText},innerKey)},sizeClass:emojiSizeClass,text},key)}!function(RenderLocation){RenderLocation.ConversationList="ConversationList",RenderLocation.Quote="Quote",RenderLocation.SearchResult="SearchResult",RenderLocation.StoryViewer="StoryViewer",RenderLocation.Timeline="Timeline"}(RenderLocation||(RenderLocation={})),renderNode.displayName="renderNode",renderMention.displayName="renderMention",renderText.displayName="renderText"},"./ts/types/BodyRange.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$Y:()=>groupContiguousSpoilers,E5:()=>collapseRangeTree,GO:()=>insertRange,OY:()=>BodyRange,pP:()=>processBodyRangesForSearchResult});var DisplayStyle,BodyRange,lodash_omit__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/omit.js"),lodash_omit__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_omit__WEBPACK_IMPORTED_MODULE_0__),lodash_isNumber__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/isNumber.js"),lodash_isNumber__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_isNumber__WEBPACK_IMPORTED_MODULE_1__),lodash_escapeRegExp__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lodash/escapeRegExp.js"),lodash_escapeRegExp__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash_escapeRegExp__WEBPACK_IMPORTED_MODULE_2__),_protobuf__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/protobuf/index.ts"),_logging_log__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/logging/log.ts"),_util_assert__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/assert.ts"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/util/missingCaseError.ts");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toArray(arr){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function insertRange(range,rangeTree){var _rangeTree=_toArray(rangeTree),current=_rangeTree[0],rest=_rangeTree.slice(1);if(!current)return[Object.assign({},range,{ranges:[]})];var rangeEnd=range.start+range.length,currentEnd=current.start+current.length;if(rangeEnd<=current.start)return[Object.assign({},range,{ranges:[]}),current].concat(_toConsumableArray(rest));if(range.start>=currentEnd)return[current].concat(_toConsumableArray(insertRange(range,rest)));if(range.start>=current.start&&rangeEnd<=currentEnd)return[Object.assign({},current,{ranges:insertRange(Object.assign({},range,{start:range.start-current.start}),current.ranges)})].concat(_toConsumableArray(rest));if(range.start<current.start&&rangeEnd>currentEnd)return[Object.assign({},range,{length:current.start-range.start,ranges:[]}),Object.assign({},current,{ranges:insertRange(Object.assign({},range,{start:0,length:current.length}),current.ranges)})].concat(_toConsumableArray(insertRange(Object.assign({},range,{start:currentEnd,length:rangeEnd-currentEnd}),rest)));if(range.start<current.start&&rangeEnd<=currentEnd)return[Object.assign({},range,{length:current.start-range.start,ranges:[]}),Object.assign({},current,{ranges:insertRange(Object.assign({},range,{start:0,length:range.length-(current.start-range.start)}),current.ranges)})].concat(_toConsumableArray(rest));if(range.start>=current.start&&rangeEnd>currentEnd)return[Object.assign({},current,{ranges:insertRange(Object.assign({},range,{start:range.start-current.start,length:currentEnd-range.start}),current.ranges)})].concat(_toConsumableArray(insertRange(Object.assign({},range,{start:currentEnd,length:range.length-(currentEnd-range.start)}),rest)));throw _logging_log__WEBPACK_IMPORTED_MODULE_4__.error(`MessageTextRenderer: unhandled range ${range}`),new Error("unhandled range")}function collapseRangeTree(_ref){var parentData=_ref.parentData,_ref$parentOffset=_ref.parentOffset,parentOffset=void 0===_ref$parentOffset?0:_ref$parentOffset,text=_ref.text,tree=_ref.tree,collapsed=[],offset=0,mentions=[];return tree.forEach((function(range){if(BodyRange.isMention(range))mentions.push(Object.assign({},lodash_omit__WEBPACK_IMPORTED_MODULE_0___default()(range,["ranges"]),{start:range.start-offset}));else{range.start>offset&&(collapsed.push(Object.assign({},parentData,{text:text.slice(offset,range.start),start:offset+parentOffset,length:range.start-offset,mentions})),mentions=[]);var partialNode=Object.assign({},parentData,function rangeToPartialNode(range){if(BodyRange.isFormatting(range)){if(range.style===BodyRange.Style.BOLD)return{isBold:!0};if(range.style===BodyRange.Style.ITALIC)return{isItalic:!0};if(range.style===BodyRange.Style.MONOSPACE)return{isMonospace:!0};if(range.style===BodyRange.Style.SPOILER)return{isSpoiler:!0};if(range.style===BodyRange.Style.STRIKETHROUGH)return{isStrikethrough:!0};if(range.style===BodyRange.Style.NONE)return{};throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_6__.b)(range.style)}if(BodyRange.isLink(range))return{url:range.url};if(BodyRange.isDisplayOnly(range)){if(range.displayStyle===DisplayStyle.SearchKeywordHighlight)return{isKeywordHighlight:!0};throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_6__.b)(range.displayStyle)}throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_6__.b)(range)}(range));collapsed=collapsed.concat(collapseRangeTree({parentData:partialNode,parentOffset:range.start+parentOffset,text:text.slice(range.start,range.start+range.length),tree:range.ranges})),offset=range.start+range.length}})),text.length>offset&&collapsed.push(Object.assign({},parentData,{text:text.slice(offset,text.length),start:offset+parentOffset,length:text.length-offset,mentions})),collapsed}function groupContiguousSpoilers(nodes){var spoilerContainer,result=[];return nodes.forEach((function(node){node.isSpoiler?(spoilerContainer||(spoilerContainer=Object.assign({},node,{isSpoiler:!0,spoilerChildren:[]}),result.push(spoilerContainer)),spoilerContainer&&(spoilerContainer.spoilerChildren=[].concat(_toConsumableArray(spoilerContainer.spoilerChildren||[]),[node]))):(spoilerContainer=void 0,result.push(node))})),result}!function(DisplayStyle){DisplayStyle.SearchKeywordHighlight="SearchKeywordHighlight"}(DisplayStyle||(DisplayStyle={})),function(_BodyRange){var Style=_protobuf__WEBPACK_IMPORTED_MODULE_3__.g.DataMessage.BodyRange.Style;function isMention(bodyRange){return"mentionUuid"in bodyRange}function isFormatting(bodyRange){return"style"in bodyRange}_BodyRange.Style=Style,_BodyRange.isRawRange=function isRawRange(range){return isMention(range)||isFormatting(range)},_BodyRange.isMention=isMention,_BodyRange.isFormatting=isFormatting,_BodyRange.isLink=function isLink(node){return"url"in node},_BodyRange.isDisplayOnly=function isDisplayOnly(node){return"displayStyle"in node}}(BodyRange||(BodyRange={}));var LENGTH_OF_LEFT="<<left>>".length,TRUNCATION_START=/^<<truncation>>/,TRUNCATION_END=/<<truncation>>$/;function processBodyRangesForSearchResult(_ref2){var _snippet$match,_snippet$match2,snippet=_ref2.snippet,body=_ref2.body,bodyRanges=_ref2.bodyRanges,cleanedSnippet=snippet.replace(/<<left>>/g,"").replace(/<<right>>/g,""),withNoStartTruncation=cleanedSnippet.replace(TRUNCATION_START,""),withNoEndTruncation=withNoStartTruncation.replace(TRUNCATION_END,""),finalSnippet=cleanedSnippet.replace(TRUNCATION_START,"...").replace(TRUNCATION_END,"..."),truncationDelta=withNoStartTruncation.length!==cleanedSnippet.length?"...".length:0,match=new RegExp(lodash_escapeRegExp__WEBPACK_IMPORTED_MODULE_2___default()(withNoEndTruncation)).exec(body);(0,_util_assert__WEBPACK_IMPORTED_MODULE_5__.q8)(Boolean(match),`No match found for "${snippet}" inside "${body}"`);var startOfSnippet=match?match.index:0,endOfSnippet=startOfSnippet+withNoEndTruncation.length,adjustedBodyRanges=bodyRanges.filter((function(range){var start=range.start;return range.start+range.length>startOfSnippet&&start<endOfSnippet})).map((function(range){var normalizedStart=range.start-startOfSnippet+truncationDelta,start=Math.max(normalizedStart,truncationDelta),end=Math.min(normalizedStart+range.length,withNoEndTruncation.length+truncationDelta);return Object.assign({},range,{start,length:end-start})})),startOfKeywordMatch=null===(_snippet$match=snippet.match(/<<left>>/))||void 0===_snippet$match?void 0:_snippet$match.index,endOfKeywordMatch=null===(_snippet$match2=snippet.match(/<<right>>/))||void 0===_snippet$match2?void 0:_snippet$match2.index;return lodash_isNumber__WEBPACK_IMPORTED_MODULE_1___default()(startOfKeywordMatch)&&lodash_isNumber__WEBPACK_IMPORTED_MODULE_1___default()(endOfKeywordMatch)&&adjustedBodyRanges.push({start:startOfKeywordMatch+(truncationDelta?"...".length-"<<truncation>>".length:0),length:endOfKeywordMatch-(startOfKeywordMatch+LENGTH_OF_LEFT),displayStyle:DisplayStyle.SearchKeywordHighlight}),{cleanedSnippet:finalSnippet,bodyRanges:adjustedBodyRanges}}},"./ts/types/LinkPreview.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Df:()=>isStickerPack,Hz:()=>isGroupLink,ge:()=>getDomain,go:()=>shouldPreviewHref,hH:()=>LinkPreviewSourceType,kz:()=>isLinkSneaky,rq:()=>findLinks,vl:()=>shouldLinkifyMessage});var LinkPreviewSourceType,lodash_range__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/range.js"),lodash_range__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_range__WEBPACK_IMPORTED_MODULE_0__),lodash_isEmpty__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/isEmpty.js"),lodash_isEmpty__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_isEmpty__WEBPACK_IMPORTED_MODULE_1__),lodash_compact__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lodash/compact.js"),lodash_compact__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash_compact__WEBPACK_IMPORTED_MODULE_2__),lodash_isNumber__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lodash/isNumber.js"),lodash_isNumber__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_isNumber__WEBPACK_IMPORTED_MODULE_3__),url__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/url/url.js"),linkify_it__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/linkify-it/index.js"),linkify_it__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(linkify_it__WEBPACK_IMPORTED_MODULE_5__),_util_url__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/url.ts"),_util_emoji__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/util/emoji.ts");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(LinkPreviewSourceType){LinkPreviewSourceType[LinkPreviewSourceType.Composer=0]="Composer",LinkPreviewSourceType[LinkPreviewSourceType.ForwardMessageModal=1]="ForwardMessageModal",LinkPreviewSourceType[LinkPreviewSourceType.StoryCreator=2]="StoryCreator"}(LinkPreviewSourceType||(LinkPreviewSourceType={}));var linkify=linkify_it__WEBPACK_IMPORTED_MODULE_5___default()();function shouldPreviewHref(href){var url=(0,_util_url__WEBPACK_IMPORTED_MODULE_7__.FS)(href);return Boolean(url&&"https:"===url.protocol&&"debuglogs.org"!==url.hostname&&!isLinkSneaky(href))}var DIRECTIONAL_OVERRIDES=/[\u202c\u202d\u202e]/,UNICODE_DRAWING=/[\u2500-\u25FF]/;function shouldLinkifyMessage(message){return!message||!DIRECTIONAL_OVERRIDES.test(message)&&!UNICODE_DRAWING.test(message)}function isStickerPack(){var link=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return link.startsWith("https://signal.art/addstickers/")}function isGroupLink(){var link=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return link.startsWith("https://signal.group/")}function findLinks(text,caretLocation){if(!shouldLinkifyMessage(text))return[];var haveCaretLocation=lodash_isNumber__WEBPACK_IMPORTED_MODULE_3___default()(caretLocation),textLength=text?text.length:0,matches=linkify.match(text?(0,_util_emoji__WEBPACK_IMPORTED_MODULE_6__.s)(text):"")||[];return lodash_compact__WEBPACK_IMPORTED_MODULE_2___default()(matches.map((function(match){return haveCaretLocation?void 0===caretLocation?null:match.lastIndex===textLength&&caretLocation===textLength||match.index>caretLocation||match.lastIndex<caretLocation?match.text:null:match.text})))}function getDomain(href){var url=(0,_util_url__WEBPACK_IMPORTED_MODULE_7__.FS)(href);if(!url||!url.hostname)throw new Error("getDomain: Unable to extract hostname from href");return url.hostname}var VALID_URI_CHARACTERS=new Set(["%",":","/","?","#","[","]","@","!","$","&","'","(",")","*","+",",",";","="].concat(_toConsumableArray(String.fromCharCode.apply(String,_toConsumableArray(lodash_range__WEBPACK_IMPORTED_MODULE_0___default()(65,91)).concat(_toConsumableArray(lodash_range__WEBPACK_IMPORTED_MODULE_0___default()(97,123))))),_toConsumableArray(lodash_range__WEBPACK_IMPORTED_MODULE_0___default()(10).map(String)),["-",".","_","~"])),ASCII_PATTERN=/[\u0020-\u007F]/g;function isLinkSneaky(href){if(href.length>4096)return!0;var url=(0,_util_url__WEBPACK_IMPORTED_MODULE_7__.FS)(href);if(!url)return!0;if(url.username||url.password)return!0;if(!url.hostname)return!0;if(url.hostname.length>2048)return!0;if(url.hostname.includes("%"))return!0;var labels=url.hostname.split(".");if(labels.length<2||labels.some(lodash_isEmpty__WEBPACK_IMPORTED_MODULE_1___default()))return!0;var withoutPeriods=(url__WEBPACK_IMPORTED_MODULE_4__.domainToUnicode?url__WEBPACK_IMPORTED_MODULE_4__.domainToUnicode(url.hostname):url.hostname).replace(/\./g,""),hasASCII=ASCII_PATTERN.test(withoutPeriods),withoutASCII=withoutPeriods.replace(ASCII_PATTERN,"");if(hasASCII&&withoutASCII.length>0)return!0;var startOfPathAndHash=href.indexOf("/",url.protocol.length+4);return _toConsumableArray(-1===startOfPathAndHash?"":href.substr(startOfPathAndHash)).some((function(character){return!VALID_URI_CHARACTERS.has(character)}))}},"./ts/util/url.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function maybeParseUrl(value){if("string"==typeof value)try{return new URL(value)}catch(err){}}__webpack_require__.d(__webpack_exports__,{FS:()=>maybeParseUrl})}}]);