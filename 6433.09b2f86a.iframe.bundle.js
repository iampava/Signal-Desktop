"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[6433],{"./ts/components/TitleBarContainer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>TitleBarContainer});var react=__webpack_require__("./node_modules/react/index.js"),index_es=__webpack_require__("./node_modules/@indutny/frameless-titlebar/dist/index.es.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),isString=__webpack_require__("./node_modules/lodash/isString.js"),isString_default=__webpack_require__.n(isString);function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var createTemplate=function(options,i18n){if(!isString_default()(options.platform))throw new TypeError("`options.platform` must be a string");var isProduction=options.isProduction,devTools=options.devTools,includeSetup=options.includeSetup,openContactUs=options.openContactUs,openForums=options.openForums,openJoinTheBeta=options.openJoinTheBeta,openReleaseNotes=options.openReleaseNotes,openSupportPage=options.openSupportPage,platform=options.platform,setupAsNewDevice=options.setupAsNewDevice,setupAsStandalone=options.setupAsStandalone,forceUpdate=options.forceUpdate,showAbout=options.showAbout,showDebugLog=options.showDebugLog,showKeyboardShortcuts=options.showKeyboardShortcuts,showSettings=options.showSettings,openArtCreator=options.openArtCreator,template=[{label:i18n("icu:mainMenuFile"),submenu:[{label:i18n("icu:mainMenuCreateStickers"),click:openArtCreator},{label:i18n("icu:mainMenuSettings"),accelerator:"CommandOrControl+,",click:showSettings},{type:"separator"},{role:"quit",label:i18n("icu:appMenuQuit")}]},{label:i18n("icu:mainMenuEdit"),submenu:[{role:"undo",label:i18n("icu:editMenuUndo")},{role:"redo",label:i18n("icu:editMenuRedo")},{type:"separator"},{role:"cut",label:i18n("icu:editMenuCut")},{role:"copy",label:i18n("icu:editMenuCopy")},{role:"paste",label:i18n("icu:editMenuPaste")},{role:"pasteAndMatchStyle",label:i18n("icu:editMenuPasteAndMatchStyle")},{role:"delete",label:i18n("icu:editMenuDelete")},{role:"selectAll",label:i18n("icu:editMenuSelectAll")}]},{label:i18n("icu:mainMenuView"),submenu:[{role:"resetZoom",label:i18n("icu:viewMenuResetZoom")},{accelerator:"CmdOrCtrl+=",role:"zoomIn",label:i18n("icu:viewMenuZoomIn")},{role:"zoomOut",label:i18n("icu:viewMenuZoomOut")},{type:"separator"},{role:"togglefullscreen",label:i18n("icu:viewMenuToggleFullScreen")},{type:"separator"},{label:i18n("icu:debugLog"),click:showDebugLog}].concat(_toConsumableArray(devTools?[{type:"separator"},{role:"toggleDevTools",label:i18n("icu:viewMenuToggleDevTools")}]:[]),_toConsumableArray(devTools&&"linux"!==platform?[{label:i18n("icu:forceUpdate"),click:forceUpdate}]:[]))},{label:i18n("icu:mainMenuWindow"),role:"window",submenu:[{role:"minimize",label:i18n("icu:windowMenuMinimize")}]},{label:i18n("icu:mainMenuHelp"),role:"help",submenu:[{label:i18n("icu:helpMenuShowKeyboardShortcuts"),accelerator:"CmdOrCtrl+/",click:showKeyboardShortcuts},{type:"separator"},{label:i18n("icu:contactUs"),click:openContactUs},{label:i18n("icu:goToReleaseNotes"),click:openReleaseNotes},{label:i18n("icu:goToForums"),click:openForums},{label:i18n("icu:goToSupportPage"),click:openSupportPage}].concat(_toConsumableArray(isProduction?[{label:i18n("icu:joinTheBeta"),click:openJoinTheBeta}]:[]),[{type:"separator"},{label:i18n("icu:aboutSignalDesktop"),click:showAbout}])}];if(includeSetup){var fileMenu=template[0];if(!Array.isArray(fileMenu.submenu))throw new Error("createTemplate: fileMenu.submenu was not an array!");options.development&&fileMenu.submenu.unshift({label:i18n("icu:menuSetupAsStandalone"),click:setupAsStandalone}),fileMenu.submenu.unshift({type:"separator"}),fileMenu.submenu.unshift({label:i18n("icu:menuSetupAsNewDevice"),click:setupAsNewDevice})}return"darwin"===platform?function updateForMac(template,i18n,options){var showAbout=options.showAbout,showSettings=options.showSettings,showWindow=options.showWindow,aboutMenu=template[4];if(!Array.isArray(aboutMenu.submenu))throw new Error("updateForMac: help.submenu was not an array!");aboutMenu.submenu.pop(),aboutMenu.submenu.pop();var fileMenu=template[0];if(!Array.isArray(fileMenu.submenu))throw new Error("updateForMac: fileMenu.submenu was not an array!");fileMenu.submenu.pop(),fileMenu.submenu.pop(),fileMenu.submenu.pop(),fileMenu.submenu.push({type:"separator"},{label:i18n("icu:windowMenuClose"),accelerator:"CmdOrCtrl+W",role:"close"});template.unshift({label:i18n("icu:signalDesktop"),submenu:[{label:i18n("icu:aboutSignalDesktop"),click:showAbout},{type:"separator"},{label:i18n("icu:mainMenuSettings"),accelerator:"CommandOrControl+,",click:showSettings},{type:"separator"},{label:i18n("icu:appMenuServices"),role:"services"},{type:"separator"},{label:i18n("icu:appMenuHide"),role:"hide"},{label:i18n("icu:appMenuHideOthers"),role:"hideOthers"},{label:i18n("icu:appMenuUnhide"),role:"unhide"},{type:"separator"},{label:i18n("icu:appMenuQuit"),role:"quit"}]});var editMenu=template[2];if(!Array.isArray(editMenu.submenu))throw new Error("updateForMac: edit.submenu was not an array!");editMenu.submenu.push({type:"separator"},{label:i18n("icu:speech"),submenu:[{role:"startSpeaking",label:i18n("icu:editMenuStartSpeaking")},{role:"stopSpeaking",label:i18n("icu:editMenuStopSpeaking")}]});return template[4].submenu=[{label:i18n("icu:windowMenuMinimize"),accelerator:"CmdOrCtrl+M",role:"minimize"},{label:i18n("icu:windowMenuZoom"),role:"zoom"},{label:i18n("icu:show"),accelerator:"CmdOrCtrl+Shift+0",click:showWindow},{type:"separator"},{role:"front",label:i18n("icu:windowMenuBringAllToFront")}],template}(template,i18n,options):template};var Util=__webpack_require__("./ts/types/Util.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useIsWindowActive_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useIsWindowActive_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useIsWindowActive_arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useIsWindowActive_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),ROLE_TO_ACCELERATOR=new Map;function convertMenu(menuList,executeMenuRole,i18n){return menuList.map((function(item){var _accelerator,_accelerator2,submenu,click,accelerator,type=item.type,label=item.label,originalAccelerator=item.accelerator,originalClick=item.click,originalSubmenu=item.submenu,role=item.role;if(Array.isArray(originalSubmenu))submenu=convertMenu(originalSubmenu,executeMenuRole,i18n);else if(originalSubmenu)throw new Error("Non-array submenu is not supported");if(originalClick){if(role)throw new Error(`Menu item: ${label} has both click and role`);click=originalClick}else role&&(click=function(){return executeMenuRole(role)});return originalAccelerator?accelerator=originalAccelerator.toString():role&&(accelerator=ROLE_TO_ACCELERATOR.get(role)),{type,label,accelerator:accelerator=null===(_accelerator2=accelerator=null===(_accelerator=accelerator)||void 0===_accelerator?void 0:_accelerator.replace(/CommandOrControl|CmdOrCtrl/g,i18n("icu:Keyboard--Key--ctrl")))||void 0===_accelerator2?void 0:_accelerator2.replace(/Shift/g,i18n("icu:Keyboard--Key--shift")),click,submenu}}))}function TitleBarContainer(props){var maybeMenu,theme=props.theme,isMaximized=props.isMaximized,isFullScreen=props.isFullScreen,hasCustomTitleBar=props.hasCustomTitleBar,hideMenuBar=props.hideMenuBar,executeMenuRole=props.executeMenuRole,titleBarDoubleClick=props.titleBarDoubleClick,children=props.children,hasMenu=props.hasMenu,isWindowActive=function useIsWindowActive(){var activeWindowService=window.SignalContext.activeWindowService,_useState2=_slicedToArray((0,react.useState)(activeWindowService.isActive()),2),isActive=_useState2[0],setIsActive=_useState2[1];return(0,react.useEffect)((function(){var update=function(newIsActive){setIsActive(newIsActive)};return activeWindowService.registerForChange(update),function(){activeWindowService.unregisterForChange(update)}}),[activeWindowService]),isActive}(),titleBarTheme=(0,react.useMemo)((function(){return{bar:Object.assign({height:28,palette:theme===Util.f8.light?"light":"dark"},theme===Util.f8.dark?{color:"#e9e9e9",background:"#2e2e2e",borderBottom:"1px solid #121212",button:{active:{color:"#e9e9e9",background:"#3b3b3b"},hover:{color:"#e9e9e9",background:"#3b3b3b"}}}:{}),menu:Object.assign({overlay:{opacity:0},autoHide:hideMenuBar},theme===Util.f8.dark?{separator:{color:"#5e5e5e"},accelerator:{color:"#b9b9b9"},list:{background:"#3b3b3b",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.12)",borderRadius:"0px 0px 6px 6px"}}:{list:{boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.12)",borderRadius:"0px 0px 6px 6px"}}),enableOverflow:!1,scalingFunction:function(value){return`calc(${value} * var(--zoom-factor))`}}}),[theme,hideMenuBar]);if(!hasCustomTitleBar)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children});if(hasMenu){var i18n=props.i18n,menuOptions=props.menuOptions,executeMenuAction=props.executeMenuAction;maybeMenu=convertMenu(createTemplate(Object.assign({},menuOptions,{forceUpdate:function(){return executeMenuAction("forceUpdate")},openArtCreator:function(){return executeMenuAction("openArtCreator")},openContactUs:function(){return executeMenuAction("openContactUs")},openForums:function(){return executeMenuAction("openForums")},openJoinTheBeta:function(){return executeMenuAction("openJoinTheBeta")},openReleaseNotes:function(){return executeMenuAction("openReleaseNotes")},openSupportPage:function(){return executeMenuAction("openSupportPage")},setupAsNewDevice:function(){return executeMenuAction("setupAsNewDevice")},setupAsStandalone:function(){return executeMenuAction("setupAsStandalone")},showAbout:function(){return executeMenuAction("showAbout")},showDebugLog:function(){return executeMenuAction("showDebugLog")},showKeyboardShortcuts:function(){return executeMenuAction("showKeyboardShortcuts")},showSettings:function(){return executeMenuAction("showSettings")},showWindow:function(){return executeMenuAction("showWindow")}}),i18n),executeMenuRole,i18n)}return(0,jsx_runtime.jsxs)("div",{className:classnames_default()("TitleBarContainer",isWindowActive?"TitleBarContainer--active":null,isFullScreen?"TitleBarContainer--fullscreen":null),children:[(0,jsx_runtime.jsx)("div",{className:"TitleBarContainer__padding"}),(0,jsx_runtime.jsx)("div",{className:"TitleBarContainer__content",children}),(0,jsx_runtime.jsx)(index_es.ZP,{className:"TitleBarContainer__title",platform:"win32",iconSrc:"images/titlebar_icon.svg",theme:titleBarTheme,maximized:isMaximized,menu:maybeMenu,onDoubleClick:titleBarDoubleClick,hideControls:!0})]})}ROLE_TO_ACCELERATOR.set("undo","CmdOrCtrl+Z"),ROLE_TO_ACCELERATOR.set("redo","CmdOrCtrl+Y"),ROLE_TO_ACCELERATOR.set("cut","CmdOrCtrl+X"),ROLE_TO_ACCELERATOR.set("copy","CmdOrCtrl+C"),ROLE_TO_ACCELERATOR.set("paste","CmdOrCtrl+V"),ROLE_TO_ACCELERATOR.set("pasteAndMatchStyle","CmdOrCtrl+Shift+V"),ROLE_TO_ACCELERATOR.set("selectAll","CmdOrCtrl+A"),ROLE_TO_ACCELERATOR.set("resetZoom","CmdOrCtrl+0"),ROLE_TO_ACCELERATOR.set("zoomIn","CmdOrCtrl+="),ROLE_TO_ACCELERATOR.set("zoomOut","CmdOrCtrl+-"),ROLE_TO_ACCELERATOR.set("togglefullscreen","F11"),ROLE_TO_ACCELERATOR.set("toggleDevTools","CmdOrCtrl+Shift+I"),ROLE_TO_ACCELERATOR.set("minimize","CmdOrCtrl+M"),TitleBarContainer.displayName="TitleBarContainer"},"./ts/hooks/useTheme.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>useTheme});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_types_Util__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Util.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var useTheme=function(){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(_types_Util__WEBPACK_IMPORTED_MODULE_1__.f8.light),2),theme=_useState2[0],updateTheme=_useState2[1],SignalContext=window.SignalContext;return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){var abortController=new AbortController,signal=abortController.signal;async function applyTheme(){var newTheme=await SignalContext.Settings.themeSetting.getValue();"system"===newTheme&&(newTheme=SignalContext.nativeThemeListener.getSystemTheme()),signal.aborted||updateTheme("dark"===newTheme?_types_Util__WEBPACK_IMPORTED_MODULE_1__.f8.dark:_types_Util__WEBPACK_IMPORTED_MODULE_1__.f8.light)}return SignalContext.nativeThemeListener.subscribe(applyTheme),async function loop(){for(;!signal.aborted;)await applyTheme(),await SignalContext.Settings.waitForChange()}(),function(){abortController.abort(),SignalContext.nativeThemeListener.unsubscribe(applyTheme)}}),[updateTheme,SignalContext.Settings,SignalContext.nativeThemeListener]),theme}}}]);