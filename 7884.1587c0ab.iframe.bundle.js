"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[7884],{"./ts/components/AddCaptionModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>AddCaptionModal});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Button.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Modal.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function AddCaptionModal(_ref){var i18n=_ref.i18n,onClose=_ref.onClose,onSubmit=_ref.onSubmit,draftText=_ref.draftText,draftBodyRanges=_ref.draftBodyRanges,RenderCompositionTextArea=_ref.RenderCompositionTextArea,theme=_ref.theme,_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(""),2),messageText=_React$useState2[0],setMessageText=_React$useState2[1],_React$useState4=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(),2),bodyRanges=_React$useState4[0],setBodyRanges=_React$useState4[1],_React$useState6=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(!0),2),isScrolledTop=_React$useState6[0],setIsScrolledTop=_React$useState6[1],_React$useState8=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(!0),2),isScrolledBottom=_React$useState8[0],setIsScrolledBottom=_React$useState8[1],scrollerRef=react__WEBPACK_IMPORTED_MODULE_1__.useRef(null),updateScrollState=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){var scrollerEl=scrollerRef.current;scrollerEl&&(setIsScrolledTop(0===scrollerEl.scrollTop),setIsScrolledBottom(scrollerEl.scrollHeight-scrollerEl.scrollTop===scrollerEl.clientHeight))}),[scrollerRef]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){updateScrollState()}),[updateScrollState]);var handleSubmit=react__WEBPACK_IMPORTED_MODULE_1__.useCallback((function(){onSubmit(messageText,bodyRanges)}),[bodyRanges,messageText,onSubmit]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_3__.u_,{i18n,modalName:"AddCaptionModal",hasXButton:!0,hasHeaderDivider:!isScrolledTop,hasFooterDivider:!isScrolledBottom,moduleClassName:"AddCaptionModal",padded:!1,title:i18n("icu:AddCaptionModal__title"),onClose,modalFooter:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_2__.zx,{onClick:handleSubmit,children:i18n("icu:AddCaptionModal__submit-button")}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(RenderCompositionTextArea,{maxLength:1500,whenToShowRemainingCount:1450,placeholder:i18n("icu:AddCaptionModal__placeholder"),onChange:function(updatedMessageText,updatedBodyRanges){setMessageText(updatedMessageText),setBodyRanges(updatedBodyRanges)},scrollerRef,draftText,bodyRanges:draftBodyRanges,onSubmit:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),onScroll:updateScrollState,theme})})}AddCaptionModal.displayName="AddCaptionModal"},"./ts/components/ConfirmDiscardDialog.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>ConfirmDiscardDialog});__webpack_require__("./node_modules/react/index.js");var _ConfirmationDialog__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConfirmDiscardDialog(_ref){var i18n=_ref.i18n,onClose=_ref.onClose,onDiscard=_ref.onDiscard;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_1__.U,{dialogName:"ConfirmDiscardDialog",actions:[{action:onDiscard,text:i18n("icu:discard"),style:"negative"}],i18n,onClose,children:i18n("icu:ConfirmDiscardDialog--discard")})}ConfirmDiscardDialog.displayName="ConfirmDiscardDialog"},"./ts/components/MediaEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>MediaEditor});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),has=__webpack_require__("./node_modules/lodash/has.js"),has_default=__webpack_require__.n(has),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),index_esm=__webpack_require__("./node_modules/react-measure/dist/index.esm.js"),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),react_dom=__webpack_require__("./node_modules/react-dom/index.js"),fabric=__webpack_require__("./node_modules/fabric/dist/fabric.js"),Util=__webpack_require__("./ts/types/Util.ts"),MIME=__webpack_require__("./ts/types/MIME.ts"),log=__webpack_require__("./ts/logging/log.ts"),Button=__webpack_require__("./ts/components/Button.tsx"),ContextMenu=__webpack_require__("./ts/components/ContextMenu.tsx"),Slider=__webpack_require__("./ts/components/Slider.tsx"),StickerButton=__webpack_require__("./ts/components/stickers/StickerButton.tsx"),theme=__webpack_require__("./ts/util/theme.ts"),canvasToBytes=__webpack_require__("./ts/util/canvasToBytes.ts"),customFabricObjectControls={br:new fabric.fabric.Control({actionHandler:fabric.fabric.controlsUtils.scalingEqually,cursorStyleHandler:function(){return"se-resize"},render:function(ctx,left,top){ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.lineWidth=1,ctx.beginPath(),ctx.arc(left,top,12,0,2*Math.PI,!1),ctx.fill();ctx.fillStyle="#3b3b3b",ctx.strokeStyle="#3b3b3b",ctx.beginPath(),ctx.moveTo(left+.5,top+.5),ctx.lineTo(left+5,top+5),ctx.moveTo(left+5,top+1),ctx.lineTo(left+5,top+5),ctx.lineTo(left+1,top+5),ctx.moveTo(left-.5,top-.5),ctx.lineTo(left-5,top-5),ctx.moveTo(left-5,top-1),ctx.lineTo(left-5,top-5),ctx.lineTo(left-1,top-5),ctx.stroke(),ctx.restore()},x:.5,y:.5}),mtr:new fabric.fabric.Control({actionHandler:fabric.fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",cursorStyleHandler:fabric.fabric.controlsUtils.rotationStyleHandler,offsetY:-40,render:function(ctx,left,top,_,target){ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.beginPath(),ctx.moveTo(left,top);var radians=0-(target.angle||0)*Math.PI/180,targetLeft=40*Math.sin(radians),targetTop=40*Math.cos(radians);ctx.lineTo(left+targetLeft,top+targetTop),ctx.stroke(),ctx.beginPath(),ctx.moveTo(left,top),ctx.arc(left,top,5,0,2*Math.PI,!1),ctx.fill(),ctx.restore()},withConnection:!1,x:0,y:-.5}),tl:new fabric.fabric.Control({cursorStyleHandler:function(){return"pointer"},mouseUpHandler:function(_eventData,_ref){var target=_ref.target;return!!target.canvas&&(target.canvas.remove(target),!0)},render:function(ctx,left,top){ctx.save(),ctx.fillStyle="#000",ctx.strokeStyle="#000",ctx.lineWidth=1,ctx.beginPath(),ctx.arc(left,top,12,0,2*Math.PI,!1),ctx.fill();ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.beginPath();var topLeft=new fabric.fabric.Point(left-4,top-4),topRight=new fabric.fabric.Point(left+4,top-4),bottomRight=new fabric.fabric.Point(left+4,top+4),bottomLeft=new fabric.fabric.Point(left-4,top+4);ctx.moveTo(topLeft.x,topLeft.y),ctx.lineTo(bottomRight.x,bottomRight.y),ctx.moveTo(topRight.x,topRight.y),ctx.lineTo(bottomLeft.x,bottomLeft.y),ctx.stroke(),ctx.restore()},x:-.5,y:-.5})},getAnalogTime=__webpack_require__("./ts/util/getAnalogTime.ts"),assert=__webpack_require__("./ts/util/assert.ts");var AnalogClockStickerStyle,moreStyles={cursorStyleHandler:function(){return"pointer"},offsetY:20,render:function render(ctx,left,top){ctx.save(),ctx.font="11px Inter";var text=window.i18n("icu:MediaEditor__clock-more-styles"),textMetrics=ctx.measureText(text),boxHeight=2*textMetrics.fontBoundingBoxAscent,boxWidth=1.5*textMetrics.width,boxX=left-boxWidth/2,textX=left-textMetrics.width/2,textY=top+boxHeight/1.5;ctx.fillStyle="#000000",ctx.strokeStyle="#000000",ctx.lineWidth=1,ctx.beginPath(),ctx.roundRect(boxX,top,boxWidth,boxHeight,4),ctx.closePath(),ctx.fill(),ctx.fillStyle="#fff",ctx.fillText(text,textX,textY),ctx.restore()},sizeX:100,sizeY:33,withConnection:!0,x:0,y:.5};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get2(){return _get2="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get2.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}!function(AnalogClockStickerStyle){AnalogClockStickerStyle.Arabic="Arabic",AnalogClockStickerStyle.Baton="Baton",AnalogClockStickerStyle.Explorer="Explorer",AnalogClockStickerStyle.Dive="Dive"}(AnalogClockStickerStyle||(AnalogClockStickerStyle={}));var ASSETS=new Map;function hydrateAssets(){if(!ASSETS.size){var path="images/analog-time";[AnalogClockStickerStyle.Arabic,AnalogClockStickerStyle.Baton,AnalogClockStickerStyle.Explorer,AnalogClockStickerStyle.Dive].forEach((function(name){var dial=new Image,hour=new Image,minute=new Image;dial.src=`${path}/${name}.svg`,hour.src=`${path}/${name}-hour.svg`,minute.src=`${path}/${name}-minute.svg`,ASSETS.set(name,{dial,hour,minute})}))}}function degToRad(deg){return deg*(Math.PI/180)}function drawHands(ctx,clock,hourDimensions,minuteDimensions){var offset=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;ctx.rotate(hourDimensions.rad),ctx.drawImage(clock.hour,0-hourDimensions.width/2,0-hourDimensions.length+offset,hourDimensions.width,hourDimensions.length),ctx.rotate(-hourDimensions.rad),ctx.rotate(minuteDimensions.rad),ctx.drawImage(clock.minute,0-minuteDimensions.width/2,0-minuteDimensions.length+offset,minuteDimensions.width,minuteDimensions.length),ctx.rotate(-minuteDimensions.rad)}var DigitalClockStickerStyle,MediaEditorFabricAnalogTimeSticker=function(_fabric$Image){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(MediaEditorFabricAnalogTimeSticker,_fabric$Image);var _super=_createSuper(MediaEditorFabricAnalogTimeSticker);function MediaEditorFabricAnalogTimeSticker(){var _this,options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,MediaEditorFabricAnalogTimeSticker),ASSETS.size||hydrateAssets();var style=AnalogClockStickerStyle.Arabic;ASSETS.forEach((function(asset,styleName){get_default()(options,"src")===asset.dial.src&&(style=styleName)}));var clock=ASSETS.get(style);return(0,assert.Yj)(clock,"expected clock not found"),(_this=_super.call(this,clock.dial,Object.assign({},options,{data:{stickerStyle:style,timeDeg:(0,getAnalogTime._)()}}))).on("modified",(function(){var _this$canvas;return null===(_this$canvas=_this.canvas)||void 0===_this$canvas?void 0:_this$canvas.bringToFront(_assertThisInitialized(_this))})),_this}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricAnalogTimeSticker,[{key:"render",value:function render(ctx){var _this$angle;_get2(_getPrototypeOf(MediaEditorFabricAnalogTimeSticker.prototype),"render",this).call(this,ctx);var _this$data=this.data,stickerStyle=_this$data.stickerStyle,timeDeg=_this$data.timeDeg,_this$getCenterPoint=this.getCenterPoint(),x=_this$getCenterPoint.x,y=_this$getCenterPoint.y,radius=this.getScaledHeight()/2,flip=this.flipX||this.flipY?180:0,rawAngle=(null!==(_this$angle=this.angle)&&void 0!==_this$angle?_this$angle:0)-flip,timeRad={hour:degToRad(timeDeg.hour+rawAngle),minute:degToRad(timeDeg.minute+rawAngle)};ctx.save(),ctx.translate(x,y);var clock=ASSETS.get(stickerStyle);((0,assert.Yj)(clock,"expected clock not found"),stickerStyle===AnalogClockStickerStyle.Arabic)&&drawHands(ctx,clock,{rad:timeRad.hour,length:.44*radius,width:.049*radius},{rad:timeRad.minute,length:.69*radius,width:.036*radius},.106*radius);stickerStyle===AnalogClockStickerStyle.Baton&&drawHands(ctx,clock,{rad:timeRad.hour,length:.44*radius,width:.09*radius},{rad:timeRad.minute,length:.69*radius,width:.09*radius},.106*radius);if(stickerStyle===AnalogClockStickerStyle.Explorer&&drawHands(ctx,clock,{rad:timeRad.hour,length:.44*radius,width:.07*radius},{rad:timeRad.minute,length:.69*radius,width:.07*radius}),stickerStyle===AnalogClockStickerStyle.Dive){drawHands(ctx,clock,{rad:timeRad.hour,length:.47*radius,width:.095*radius},{rad:timeRad.minute,length:.89*radius,width:.095*radius});var circleSize=.08*radius;ctx.fillStyle="#d1ffc1",ctx.strokeStyle="#d1ffc1",ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,circleSize,0,2*Math.PI),ctx.closePath(),ctx.fill()}ctx.restore()}}],[{key:"getNextStyle",value:function getNextStyle(style){return style===AnalogClockStickerStyle.Dive?AnalogClockStickerStyle.Arabic:style===AnalogClockStickerStyle.Explorer?AnalogClockStickerStyle.Dive:style===AnalogClockStickerStyle.Baton?AnalogClockStickerStyle.Explorer:AnalogClockStickerStyle.Baton}},{key:"fromObject",value:function fromObject(options,callback){callback(new MediaEditorFabricAnalogTimeSticker(options))}}]),MediaEditorFabricAnalogTimeSticker}(fabric.fabric.Image),moreStylesControl=new fabric.fabric.Control(Object.assign({},moreStyles,{mouseUpHandler:function(_eventData,_ref){var _target$canvas,target=_ref.target,stickerStyle=MediaEditorFabricAnalogTimeSticker.getNextStyle(target.data.stickerStyle);target.setOptions({data:Object.assign({},target.data,{stickerStyle})});var clock=ASSETS.get(stickerStyle);return(0,assert.Yj)(clock,"expected clock not found"),target.setElement(clock.dial),target.setCoords(),null===(_target$canvas=target.canvas)||void 0===_target$canvas||_target$canvas.requestRenderAll(),!0}}));function MediaEditorFabricDigitalTimeSticker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MediaEditorFabricDigitalTimeSticker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(target,property,receiver){var base=MediaEditorFabricDigitalTimeSticker_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function MediaEditorFabricDigitalTimeSticker_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=MediaEditorFabricDigitalTimeSticker_getPrototypeOf(object)););return object}function MediaEditorFabricDigitalTimeSticker_setPrototypeOf(o,p){return MediaEditorFabricDigitalTimeSticker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricDigitalTimeSticker_setPrototypeOf(o,p)}function MediaEditorFabricDigitalTimeSticker_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricDigitalTimeSticker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricDigitalTimeSticker_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricDigitalTimeSticker_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricDigitalTimeSticker_possibleConstructorReturn(this,result)}}function MediaEditorFabricDigitalTimeSticker_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function MediaEditorFabricDigitalTimeSticker_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function MediaEditorFabricDigitalTimeSticker_getPrototypeOf(o){return MediaEditorFabricDigitalTimeSticker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricDigitalTimeSticker_getPrototypeOf(o)}function getTextStyle(style){return style===DigitalClockStickerStyle.Black?{fill:"#000",textBackgroundColor:""}:style===DigitalClockStickerStyle.Light?{fill:"#fff",textBackgroundColor:"rgba(255, 255, 255, 0.4)"}:style===DigitalClockStickerStyle.Dark?{fill:"#fff",textBackgroundColor:"rgba(0, 0, 0, 0.4)"}:style===DigitalClockStickerStyle.Orange?{fill:"#ff7629",textBackgroundColor:"rgba(0, 0, 0, 0.6)"}:{fill:"#fff",textBackgroundColor:""}}MediaEditorFabricAnalogTimeSticker.prototype.type="MediaEditorFabricAnalogTimeSticker",MediaEditorFabricAnalogTimeSticker.prototype.borderColor="#ffffff",MediaEditorFabricAnalogTimeSticker.prototype.controls=Object.assign({},customFabricObjectControls,{mb:moreStylesControl}),function(DigitalClockStickerStyle){DigitalClockStickerStyle.White="White",DigitalClockStickerStyle.Black="Black",DigitalClockStickerStyle.Light="Light",DigitalClockStickerStyle.Dark="Dark",DigitalClockStickerStyle.Orange="Orange"}(DigitalClockStickerStyle||(DigitalClockStickerStyle={}));var TEXT_PROPS={editable:!1,fontWeight:"400",left:0,lockScalingFlip:!0,originX:"center",originY:"center",textAlign:"center",top:0},MediaEditorFabricDigitalTimeSticker=function(_fabric$Group){!function MediaEditorFabricDigitalTimeSticker_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricDigitalTimeSticker_setPrototypeOf(subClass,superClass)}(MediaEditorFabricDigitalTimeSticker,_fabric$Group);var _super=MediaEditorFabricDigitalTimeSticker_createSuper(MediaEditorFabricDigitalTimeSticker);function MediaEditorFabricDigitalTimeSticker(timestamp){var _this,style=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DigitalClockStickerStyle.White,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};MediaEditorFabricDigitalTimeSticker_classCallCheck(this,MediaEditorFabricDigitalTimeSticker);var parts=new Intl.DateTimeFormat(window.getPreferredSystemLocales(),{hour:"numeric",minute:"numeric"}).formatToParts(timestamp),_getTextStyle=getTextStyle(style),fill=_getTextStyle.fill,dayPeriodText="",timeText=parts.reduce((function(acc,part){return"dayPeriod"===part.type?(dayPeriodText=part.value,acc):`${acc}${part.value}`}),""),timeTextNode=new fabric.fabric.IText(timeText.trim(),Object.assign({},TEXT_PROPS,{fill,fontSize:72,fontFamily:'"Hatsuishi Large", Hatsuishi, Inter'})),dayPeriodTextNode=new fabric.fabric.IText(dayPeriodText,Object.assign({},TEXT_PROPS,{fill,fontSize:11,fontFamily:"Inter"})),dayPeriodBounds=dayPeriodTextNode.getBoundingRect(),timeBounds=timeTextNode.getBoundingRect(),totalWidth=dayPeriodBounds.width+timeBounds.width;return dayPeriodTextNode.set({left:totalWidth/2+dayPeriodBounds.width/2,top:timeBounds.height/2-1.66*dayPeriodBounds.height}),(_this=_super.call(this,[timeTextNode,dayPeriodTextNode],Object.assign({},options,{data:{stickerStyle:style,timestamp}}))).set("width",2*totalWidth),_this}return function MediaEditorFabricDigitalTimeSticker_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricDigitalTimeSticker_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricDigitalTimeSticker_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricDigitalTimeSticker,[{key:"render",value:function render(ctx){var textBackgroundColor=getTextStyle(this.data.stickerStyle).textBackgroundColor;if(textBackgroundColor){var _this$canvas,bounds=this.getBoundingRect(),zoom=(null===(_this$canvas=this.canvas)||void 0===_this$canvas?void 0:_this$canvas.getZoom())||1,height=bounds.height/zoom,left=bounds.left/zoom,top=bounds.top/zoom,width=bounds.width/zoom;ctx.save(),ctx.fillStyle=textBackgroundColor,ctx.beginPath(),ctx.roundRect(left,top,width,height,14),ctx.closePath(),ctx.fill(),ctx.restore()}_get(MediaEditorFabricDigitalTimeSticker_getPrototypeOf(MediaEditorFabricDigitalTimeSticker.prototype),"render",this).call(this,ctx)}}],[{key:"getNextStyle",value:function getNextStyle(style){return style===DigitalClockStickerStyle.White?DigitalClockStickerStyle.Black:style===DigitalClockStickerStyle.Black?DigitalClockStickerStyle.Light:style===DigitalClockStickerStyle.Light?DigitalClockStickerStyle.Dark:style===DigitalClockStickerStyle.Dark?DigitalClockStickerStyle.Orange:DigitalClockStickerStyle.White}},{key:"fromObject",value:function fromObject(options,callback){var _options$data$timesta,_options$data,result=new MediaEditorFabricDigitalTimeSticker(null!==(_options$data$timesta=null==options?void 0:options.data.timestamp)&&void 0!==_options$data$timesta?_options$data$timesta:Date.now(),null===(_options$data=options.data)||void 0===_options$data?void 0:_options$data.stickerStyle,options);return callback(result),result}}]),MediaEditorFabricDigitalTimeSticker}(fabric.fabric.Group),MediaEditorFabricDigitalTimeSticker_moreStylesControl=new fabric.fabric.Control(Object.assign({},moreStyles,{mouseUpHandler:function(_eventData,_ref){var _target$canvas,target=_ref.target,stickerStyle=MediaEditorFabricDigitalTimeSticker.getNextStyle(target.data.stickerStyle);target.setOptions({data:Object.assign({},target.data,{stickerStyle})});var styleAttrs=getTextStyle(stickerStyle);return target.getObjects().forEach((function(textObject){textObject.set({fill:styleAttrs.fill})})),target.setCoords(),null===(_target$canvas=target.canvas)||void 0===_target$canvas||_target$canvas.requestRenderAll(),!0}}));function MediaEditorFabricIText_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MediaEditorFabricIText_setPrototypeOf(o,p){return MediaEditorFabricIText_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricIText_setPrototypeOf(o,p)}function MediaEditorFabricIText_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricIText_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricIText_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricIText_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricIText_possibleConstructorReturn(this,result)}}function MediaEditorFabricIText_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return MediaEditorFabricIText_assertThisInitialized(self)}function MediaEditorFabricIText_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function MediaEditorFabricIText_getPrototypeOf(o){return MediaEditorFabricIText_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricIText_getPrototypeOf(o)}MediaEditorFabricDigitalTimeSticker.prototype.type="MediaEditorFabricDigitalTimeSticker",MediaEditorFabricDigitalTimeSticker.prototype.controls=Object.assign({},customFabricObjectControls,{mb:MediaEditorFabricDigitalTimeSticker_moreStylesControl});var MediaEditorFabricIText=function(_fabric$IText){!function MediaEditorFabricIText_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricIText_setPrototypeOf(subClass,superClass)}(MediaEditorFabricIText,_fabric$IText);var _super=MediaEditorFabricIText_createSuper(MediaEditorFabricIText);function MediaEditorFabricIText(text,options){var _this;return function MediaEditorFabricIText_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaEditorFabricIText),(_this=_super.call(this,text,Object.assign({fontFamily:"Inter",fontWeight:"bold",lockScalingFlip:!0,originX:"center",originY:"center",textAlign:"center"},options))).on("modified",(function(){var _this$canvas;return null===(_this$canvas=_this.canvas)||void 0===_this$canvas?void 0:_this$canvas.bringToFront(MediaEditorFabricIText_assertThisInitialized(_this))})),_this}return function MediaEditorFabricIText_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricIText_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricIText_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricIText,null,[{key:"fromObject",value:function fromObject(options,callback){var result=new MediaEditorFabricIText(options.text,options);return callback(result),result}}]),MediaEditorFabricIText}(fabric.fabric.IText);function MediaEditorFabricPath_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MediaEditorFabricPath_setPrototypeOf(o,p){return MediaEditorFabricPath_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricPath_setPrototypeOf(o,p)}function MediaEditorFabricPath_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricPath_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricPath_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricPath_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricPath_possibleConstructorReturn(this,result)}}function MediaEditorFabricPath_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function MediaEditorFabricPath_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function MediaEditorFabricPath_getPrototypeOf(o){return MediaEditorFabricPath_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricPath_getPrototypeOf(o)}MediaEditorFabricIText.prototype.type="MediaEditorFabricIText",MediaEditorFabricIText.prototype.lockScalingFlip=!0,MediaEditorFabricIText.prototype.borderColor="#ffffff",MediaEditorFabricIText.prototype.controls=customFabricObjectControls;var MediaEditorFabricPath=function(_fabric$Path){!function MediaEditorFabricPath_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricPath_setPrototypeOf(subClass,superClass)}(MediaEditorFabricPath,_fabric$Path);var _super=MediaEditorFabricPath_createSuper(MediaEditorFabricPath);function MediaEditorFabricPath(path,options){return function MediaEditorFabricPath_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaEditorFabricPath),_super.call(this,path,Object.assign({evented:!1,fill:void 0,hasControls:!1,lockScalingFlip:!0,selectable:!1},options||{}))}return function MediaEditorFabricPath_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricPath_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricPath_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricPath,null,[{key:"fromObject",value:function fromObject(options,callback){var result=new MediaEditorFabricPath(options.path,options);return callback(result),result}}]),MediaEditorFabricPath}(fabric.fabric.Path);function MediaEditorFabricSticker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MediaEditorFabricSticker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MediaEditorFabricSticker_setPrototypeOf(o,p){return MediaEditorFabricSticker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricSticker_setPrototypeOf(o,p)}function MediaEditorFabricSticker_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricSticker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricSticker_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricSticker_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricSticker_possibleConstructorReturn(this,result)}}function MediaEditorFabricSticker_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return MediaEditorFabricSticker_assertThisInitialized(self)}function MediaEditorFabricSticker_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function MediaEditorFabricSticker_getPrototypeOf(o){return MediaEditorFabricSticker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricSticker_getPrototypeOf(o)}MediaEditorFabricPath.prototype.type="MediaEditorFabricPath",MediaEditorFabricPath.prototype.borderColor="#ffffff";var MediaEditorFabricSticker=function(_fabric$Image){!function MediaEditorFabricSticker_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricSticker_setPrototypeOf(subClass,superClass)}(MediaEditorFabricSticker,_fabric$Image);var _super=MediaEditorFabricSticker_createSuper(MediaEditorFabricSticker);function MediaEditorFabricSticker(element){var _this,normalizedElement,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return MediaEditorFabricSticker_classCallCheck(this,MediaEditorFabricSticker),"string"==typeof element?(normalizedElement=new Image).src=element:normalizedElement=element,(_this=_super.call(this,normalizedElement,options)).on("modified",(function(){var _this$canvas;return null===(_this$canvas=_this.canvas)||void 0===_this$canvas?void 0:_this$canvas.bringToFront(MediaEditorFabricSticker_assertThisInitialized(_this))})),_this}return function MediaEditorFabricSticker_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricSticker_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricSticker_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricSticker,null,[{key:"fromObject",value:function fromObject(options,callback){callback(new MediaEditorFabricSticker(options.src,options))}}]),MediaEditorFabricSticker}(fabric.fabric.Image);function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function fabricEffectListener(target,eventNames,handler){var _step,_iterator=_createForOfIteratorHelper(eventNames);try{for(_iterator.s();!(_step=_iterator.n()).done;){var eventName=_step.value;target.on(eventName,handler)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return function(){var _step2,_iterator2=_createForOfIteratorHelper(eventNames);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _eventName=_step2.value;target.off(_eventName,handler)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useFabricHistory_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useFabricHistory_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useFabricHistory_arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useFabricHistory_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}MediaEditorFabricSticker.prototype.type="MediaEditorFabricSticker",MediaEditorFabricSticker.prototype.borderColor="#ffffff",MediaEditorFabricSticker.prototype.controls=customFabricObjectControls;function getCanvasState(fabricCanvas){return JSON.stringify(fabricCanvas.toDatalessJSON(["data"]))}function getIsTimeTraveling(_ref3){return _ref3.highWatermark!==_ref3.appliedHighWatermark}function usePortal_slicedToArray(arr,i){return function usePortal_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function usePortal_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function usePortal_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return usePortal_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return usePortal_arrayLikeToArray(o,minLen)}(arr,i)||function usePortal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function usePortal_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var useUniqueId=__webpack_require__("./ts/hooks/useUniqueId.ts"),clamp=__webpack_require__("./node_modules/lodash/clamp.js"),clamp_default=__webpack_require__.n(clamp);function MediaEditorFabricCropRect_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MediaEditorFabricCropRect_get(){return MediaEditorFabricCropRect_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(target,property,receiver){var base=MediaEditorFabricCropRect_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},MediaEditorFabricCropRect_get.apply(this,arguments)}function MediaEditorFabricCropRect_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=MediaEditorFabricCropRect_getPrototypeOf(object)););return object}function MediaEditorFabricCropRect_setPrototypeOf(o,p){return MediaEditorFabricCropRect_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricCropRect_setPrototypeOf(o,p)}function MediaEditorFabricCropRect_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricCropRect_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricCropRect_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricCropRect_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricCropRect_possibleConstructorReturn(this,result)}}function MediaEditorFabricCropRect_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return MediaEditorFabricCropRect_assertThisInitialized(self)}function MediaEditorFabricCropRect_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function MediaEditorFabricCropRect_getPrototypeOf(o){return MediaEditorFabricCropRect_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricCropRect_getPrototypeOf(o)}var MediaEditorFabricCropRect=function(_fabric$Rect){!function MediaEditorFabricCropRect_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricCropRect_setPrototypeOf(subClass,superClass)}(MediaEditorFabricCropRect,_fabric$Rect);var _super=MediaEditorFabricCropRect_createSuper(MediaEditorFabricCropRect);function MediaEditorFabricCropRect(options){var _this;return function MediaEditorFabricCropRect_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaEditorFabricCropRect),(_this=_super.call(this,Object.assign({fill:void 0,lockScalingFlip:!0},options||{}))).on("modified",_this.containBounds.bind(MediaEditorFabricCropRect_assertThisInitialized(_this))),_this}return function MediaEditorFabricCropRect_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricCropRect_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricCropRect_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricCropRect,[{key:"containBounds",value:function containBounds(){if(this.canvas){var zoom=this.canvas.getZoom()||1,_this$getBoundingRect=this.getBoundingRect(),left=_this$getBoundingRect.left,top=_this$getBoundingRect.top,height=_this$getBoundingRect.height,width=_this$getBoundingRect.width,canvasHeight=this.canvas.getHeight(),canvasWidth=this.canvas.getWidth();height>canvasHeight||width>canvasWidth?this.canvas.discardActiveObject():(this.set("left",clamp_default()(left/zoom,MediaEditorFabricCropRect.PADDING/zoom,(canvasWidth-width-MediaEditorFabricCropRect.PADDING)/zoom)),this.set("top",clamp_default()(top/zoom,MediaEditorFabricCropRect.PADDING/zoom,(canvasHeight-height-MediaEditorFabricCropRect.PADDING)/zoom))),this.setCoords()}}},{key:"render",value:function render(ctx){var _this$canvas,_this$canvas2,_this$canvas3;MediaEditorFabricCropRect_get(MediaEditorFabricCropRect_getPrototypeOf(MediaEditorFabricCropRect.prototype),"render",this).call(this,ctx);var bounds=this.getBoundingRect(),zoom=(null===(_this$canvas=this.canvas)||void 0===_this$canvas?void 0:_this$canvas.getZoom())||1,canvasWidth=((null===(_this$canvas2=this.canvas)||void 0===_this$canvas2?void 0:_this$canvas2.getWidth())||0)/zoom,canvasHeight=((null===(_this$canvas3=this.canvas)||void 0===_this$canvas3?void 0:_this$canvas3.getHeight())||0)/zoom,height=bounds.height/zoom,left=bounds.left/zoom,top=bounds.top/zoom,width=bounds.width/zoom;ctx.save(),ctx.fillStyle="rgba(0, 0, 0, 0.4)",ctx.fillRect(0,0,canvasWidth,top),ctx.fillRect(0,top,left,height),ctx.fillRect(0,height+top,canvasWidth,canvasHeight-top),ctx.fillRect(left+width,top,canvasWidth-left,height),ctx.restore()}}]),MediaEditorFabricCropRect}(fabric.fabric.Rect);function getMinSize(width){return Math.min(width||24,24)}function MediaEditorFabricPencilBrush_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MediaEditorFabricPencilBrush_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MediaEditorFabricPencilBrush_setPrototypeOf(o,p){return MediaEditorFabricPencilBrush_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},MediaEditorFabricPencilBrush_setPrototypeOf(o,p)}function MediaEditorFabricPencilBrush_createSuper(Derived){var hasNativeReflectConstruct=function MediaEditorFabricPencilBrush_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=MediaEditorFabricPencilBrush_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MediaEditorFabricPencilBrush_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MediaEditorFabricPencilBrush_possibleConstructorReturn(this,result)}}function MediaEditorFabricPencilBrush_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function MediaEditorFabricPencilBrush_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function MediaEditorFabricPencilBrush_getPrototypeOf(o){return MediaEditorFabricPencilBrush_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},MediaEditorFabricPencilBrush_getPrototypeOf(o)}MediaEditorFabricCropRect.PADDING=4,MediaEditorFabricCropRect.prototype.controls={tl:new fabric.fabric.Control({x:-.5,y:-.5,actionHandler:fabric.fabric.controlsUtils.scalingEqually,cursorStyle:"nwse-resize",render:function(ctx,left,top,_,rect){var WIDTH=getMinSize(rect.width);ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.lineWidth=3,ctx.beginPath(),ctx.moveTo(left-2,top+WIDTH),ctx.lineTo(left-2,top-2),ctx.lineTo(left+WIDTH,top-2),ctx.stroke(),ctx.restore()}}),tr:new fabric.fabric.Control({x:.5,y:-.5,actionHandler:fabric.fabric.controlsUtils.scalingEqually,cursorStyle:"nesw-resize",render:function(ctx,left,top,_,rect){var WIDTH=getMinSize(rect.width);ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.lineWidth=3,ctx.beginPath(),ctx.moveTo(left+2,top+WIDTH),ctx.lineTo(left+2,top-2),ctx.lineTo(left-WIDTH,top-2),ctx.stroke(),ctx.restore()}}),bl:new fabric.fabric.Control({x:-.5,y:.5,actionHandler:fabric.fabric.controlsUtils.scalingEqually,cursorStyle:"nesw-resize",render:function(ctx,left,top,_,rect){var WIDTH=getMinSize(rect.width);ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.lineWidth=3,ctx.beginPath(),ctx.moveTo(left-2,top-WIDTH),ctx.lineTo(left-2,top+2),ctx.lineTo(left+WIDTH,top+2),ctx.stroke(),ctx.restore()}}),br:new fabric.fabric.Control({x:.5,y:.5,actionHandler:fabric.fabric.controlsUtils.scalingEqually,cursorStyle:"nwse-resize",render:function(ctx,left,top,_,rect){var WIDTH=getMinSize(rect.width);ctx.save(),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",ctx.lineWidth=3,ctx.beginPath(),ctx.moveTo(left+2,top-WIDTH),ctx.lineTo(left+2,top+2),ctx.lineTo(left-WIDTH,top+2),ctx.stroke(),ctx.restore()}})},MediaEditorFabricCropRect.prototype.excludeFromExport=!0,MediaEditorFabricCropRect.prototype.borderColor="#ffffff",MediaEditorFabricCropRect.prototype.cornerColor="#ffffff";var TextStyle,MediaEditorFabricPencilBrush=function(_fabric$PencilBrush){!function MediaEditorFabricPencilBrush_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MediaEditorFabricPencilBrush_setPrototypeOf(subClass,superClass)}(MediaEditorFabricPencilBrush,_fabric$PencilBrush);var _super=MediaEditorFabricPencilBrush_createSuper(MediaEditorFabricPencilBrush);function MediaEditorFabricPencilBrush(){return MediaEditorFabricPencilBrush_classCallCheck(this,MediaEditorFabricPencilBrush),_super.apply(this,arguments)}return function MediaEditorFabricPencilBrush_createClass(Constructor,protoProps,staticProps){return protoProps&&MediaEditorFabricPencilBrush_defineProperties(Constructor.prototype,protoProps),staticProps&&MediaEditorFabricPencilBrush_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(MediaEditorFabricPencilBrush,[{key:"createPath",value:function createPath(pathData){return new MediaEditorFabricPath(pathData,{fill:void 0,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray})}}]),MediaEditorFabricPencilBrush}(fabric.fabric.PencilBrush),util_color=__webpack_require__("./ts/mediaEditor/util/color.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts");function getTextStyleAttributes(textStyle,hueSliderValue){var color=(0,util_color.$j)(hueSliderValue);switch(textStyle){case TextStyle.Regular:return{fill:color,strokeWidth:0,textBackgroundColor:""};case TextStyle.Highlight:return{fill:hueSliderValue>=95?"#000":"#fff",strokeWidth:0,textBackgroundColor:color};case TextStyle.Outline:return{fill:hueSliderValue>=95?"#000":"#fff",stroke:color,strokeWidth:2,textBackgroundColor:""};default:return log.error((0,missingCaseError.b)(textStyle)),getTextStyleAttributes(TextStyle.Regular,hueSliderValue)}}!function(TextStyle){TextStyle.Regular="Regular",TextStyle.Highlight="Highlight",TextStyle.Outline="Outline"}(TextStyle||(TextStyle={}));var AddCaptionModal=__webpack_require__("./ts/components/AddCaptionModal.tsx"),useConfirmDiscard=__webpack_require__("./ts/hooks/useConfirmDiscard.tsx"),Spinner=__webpack_require__("./ts/components/Spinner.tsx"),MessageBody=__webpack_require__("./ts/components/conversation/MessageBody.tsx"),MessageTextRenderer=__webpack_require__("./ts/components/conversation/MessageTextRenderer.tsx"),keyboard=__webpack_require__("./ts/util/keyboard.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),_excluded=["doneButtonLabel","i18n","imageSrc","isSending","onClose","onDone","installedPacks","recentStickers"];function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return MediaEditor_arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||MediaEditor_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MediaEditor_slicedToArray(arr,i){return function MediaEditor_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function MediaEditor_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||MediaEditor_unsupportedIterableToArray(arr,i)||function MediaEditor_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MediaEditor_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return MediaEditor_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?MediaEditor_arrayLikeToArray(o,minLen):void 0}}function MediaEditor_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}var EditMode,DrawWidth,DrawTool,INITIAL_IMAGE_STATE={angle:0,cropX:0,cropY:0,flipX:!1,flipY:!1,height:0,width:0};function isCmdOrCtrl(ev){var ctrlKey=ev.ctrlKey,metaKey=ev.metaKey,commandKey="darwin"===get_default()(window,"platform")&&metaKey,controlKey="darwin"!==get_default()(window,"platform")&&ctrlKey;return commandKey||controlKey}function MediaEditor(_ref){var doneButtonLabel=_ref.doneButtonLabel,i18n=_ref.i18n,imageSrc=_ref.imageSrc,isSending=_ref.isSending,onClose=_ref.onClose,onDone=_ref.onDone,installedPacks=_ref.installedPacks,recentStickers=_ref.recentStickers,props=_objectWithoutProperties(_ref,_excluded),_useState2=MediaEditor_slicedToArray((0,react.useState)(),2),fabricCanvas=_useState2[0],setFabricCanvas=_useState2[1],_useState4=MediaEditor_slicedToArray((0,react.useState)(new Image),2),image=_useState4[0],setImage=_useState4[1],_useState6=MediaEditor_slicedToArray((0,react.useState)(!1),2),isStickerPopperOpen=_useState6[0],setIsStickerPopperOpen=_useState6[1],_useState8=MediaEditor_slicedToArray((0,react.useState)(""),2),caption=_useState8[0],setCaption=_useState8[1],_useState10=MediaEditor_slicedToArray((0,react.useState)(),2),captionBodyRanges=_useState10[0],setCaptionBodyRanges=_useState10[1],_useState12=MediaEditor_slicedToArray((0,react.useState)(!1),2),showAddCaptionModal=_useState12[0],setShowAddCaptionModal=_useState12[1],canvasId=(0,useUniqueId.L)(),_useState14=MediaEditor_slicedToArray((0,react.useState)(INITIAL_IMAGE_STATE),2),imageState=_useState14[0],setImageState=_useState14[1],_useFabricHistory=function useFabricHistory(_ref){var fabricCanvas=_ref.fabricCanvas,imageState=_ref.imageState,setImageState=_ref.setImageState,_useState2=_slicedToArray((0,react.useState)({snapshots:[],highWatermark:0,appliedHighWatermark:0}),2),state=_useState2[0],setState=_useState2[1],highWatermark=state.highWatermark,snapshots=state.snapshots,isTimeTraveling=getIsTimeTraveling(state),desiredSnapshot=snapshots[highWatermark-1],takeSnapshotInternal=(0,react.useCallback)((function(snapshot){setState((function(oldState){var newSnapshots=oldState.snapshots.slice(0,oldState.highWatermark);for(newSnapshots.push(snapshot);newSnapshots.length>1e3;)newSnapshots.shift();return{snapshots:newSnapshots,highWatermark:newSnapshots.length,appliedHighWatermark:newSnapshots.length}}))}),[]),takeSnapshot=(0,react.useCallback)((function(logMessage,newImageState,canvasOverride){var canvas=canvasOverride||fabricCanvas;(0,assert.Yj)(canvas,"Media editor: tried to take a snapshot without a canvas"),log.info(`Media editor: taking snapshot of image state from ${logMessage}`),takeSnapshotInternal({canvasState:getCanvasState(canvas),imageState:newImageState})}),[fabricCanvas,takeSnapshotInternal]),undoIfPossible=(0,react.useCallback)((function(){log.info("Media editor: undoing"),setState((function(oldState){return getIsTimeTraveling(oldState)?oldState:Object.assign({},oldState,{highWatermark:Math.max(oldState.highWatermark-1,1)})}))}),[]),redoIfPossible=(0,react.useCallback)((function(){log.info("Media editor: redoing"),setState((function(oldState){return getIsTimeTraveling(oldState)?oldState:Object.assign({},oldState,{highWatermark:Math.min(oldState.highWatermark+1,oldState.snapshots.length)})}))}),[]);return(0,react.useEffect)((function(){fabric.fabric.Object.NUM_FRACTION_DIGITS=16,Object.assign(fabric.fabric,{MediaEditorFabricAnalogTimeSticker,MediaEditorFabricDigitalTimeSticker,MediaEditorFabricIText,MediaEditorFabricPath,MediaEditorFabricSticker})}),[]),(0,react.useEffect)((function(){fabricCanvas&&isTimeTraveling&&desiredSnapshot&&(log.info(`Media editor: time-traveling to snapshot ${highWatermark}`),fabricCanvas.loadFromJSON(desiredSnapshot.canvasState,(function(){setImageState(desiredSnapshot.imageState),setState((function(oldState){return Object.assign({},oldState,{appliedHighWatermark:highWatermark})}))})))}),[desiredSnapshot,fabricCanvas,highWatermark,isTimeTraveling,setImageState]),(0,react.useEffect)((function(){if(fabricCanvas&&!isTimeTraveling)return fabricEffectListener(fabricCanvas,["object:added","object:modified","object:removed"],(function(_ref2){var target=_ref2.target;isTimeTraveling||null!=target&&target.excludeFromExport||(log.info("Media editor: taking snapshot from object change"),takeSnapshotInternal({canvasState:getCanvasState(fabricCanvas),imageState}))}))}),[takeSnapshotInternal,fabricCanvas,isTimeTraveling,imageState]),{canRedo:highWatermark<snapshots.length,canUndo:highWatermark>1,redoIfPossible,takeSnapshot,undoIfPossible}}({fabricCanvas,imageState,setImageState}),canRedo=_useFabricHistory.canRedo,canUndo=_useFabricHistory.canUndo,redoIfPossible=_useFabricHistory.redoIfPossible,takeSnapshot=_useFabricHistory.takeSnapshot,undoIfPossible=_useFabricHistory.undoIfPossible;(0,react.useEffect)((function(){if(!fabricCanvas){var img=new Image;return img.onload=function(){setImage(img);var canvas=new fabric.fabric.Canvas(canvasId);canvas.selection=!1,setFabricCanvas(canvas);var newImageState=Object.assign({},INITIAL_IMAGE_STATE,{height:img.height,width:img.width});setImageState(newImageState),takeSnapshot("initial state",newImageState,canvas)},img.onerror=function(){log.error("<MediaEditor>: image failed to load. Closing"),onClose()},img.src=imageSrc,function(){img.onload=noop_default(),img.onerror=noop_default()}}}),[canvasId,fabricCanvas,imageSrc,onClose,takeSnapshot]);var _useState16=MediaEditor_slicedToArray((0,react.useState)(),2),editMode=_useState16[0],setEditMode=_useState16[1],_useConfirmDiscard2=MediaEditor_slicedToArray((0,useConfirmDiscard.N)(i18n),2),confirmDiscardModal=_useConfirmDiscard2[0],confirmDiscardIf=_useConfirmDiscard2[1],onTryClose=(0,react.useCallback)((function(){confirmDiscardIf(""!==caption||Boolean(image),onClose)}),[confirmDiscardIf,caption,image,onClose]);(0,react.useEffect)((function(){if(!fabricCanvas)return noop_default();var globalShortcuts=[[function(ev){return isCmdOrCtrl(ev)&&"c"===ev.key},function(){return setEditMode(EditMode.Crop)}],[function(ev){return isCmdOrCtrl(ev)&&"d"===ev.key},function(){return setEditMode(EditMode.Draw)}],[function(ev){return isCmdOrCtrl(ev)&&"t"===ev.key},function(){return setEditMode(EditMode.Text)}],[function(ev){return isCmdOrCtrl(ev)&&"z"===ev.key},undoIfPossible],[function(ev){return isCmdOrCtrl(ev)&&ev.shiftKey&&"z"===ev.key},redoIfPossible],[function(ev){return"Escape"===ev.key},function(){void 0===editMode?isStickerPopperOpen||onTryClose():setEditMode(void 0),fabricCanvas.getActiveObject()&&(fabricCanvas.discardActiveObject(),fabricCanvas.requestRenderAll())}]],objectShortcuts=[[function(ev){return"Delete"===ev.key},function(obj){fabricCanvas.remove(obj),setEditMode(void 0)}],[function(ev){return"ArrowUp"===ev.key},function(obj,ev){var px=ev.shiftKey?20:1;if(ev.altKey)obj.set("angle",(obj.angle||0)-px);else{var _obj$getCenterPoint=obj.getCenterPoint(),x=_obj$getCenterPoint.x,y=_obj$getCenterPoint.y;obj.setPositionByOrigin(new fabric.fabric.Point(x,y-px),"center","center")}obj.setCoords(),fabricCanvas.requestRenderAll()}],[function(ev){return ev.key===(0,keyboard.x)("start")},function(obj,ev){var px=ev.shiftKey?20:1;if(ev.altKey)obj.set("angle",(obj.angle||0)-px);else{var _obj$getCenterPoint2=obj.getCenterPoint(),x=_obj$getCenterPoint2.x,y=_obj$getCenterPoint2.y;obj.setPositionByOrigin(new fabric.fabric.Point(x-px,y),"center","center")}obj.setCoords(),fabricCanvas.requestRenderAll()}],[function(ev){return"ArrowDown"===ev.key},function(obj,ev){var px=ev.shiftKey?20:1;if(ev.altKey)obj.set("angle",(obj.angle||0)+px);else{var _obj$getCenterPoint3=obj.getCenterPoint(),x=_obj$getCenterPoint3.x,y=_obj$getCenterPoint3.y;obj.setPositionByOrigin(new fabric.fabric.Point(x,y+px),"center","center")}obj.setCoords(),fabricCanvas.requestRenderAll()}],[function(ev){return ev.key===(0,keyboard.x)("end")},function(obj,ev){var px=ev.shiftKey?20:1;if(ev.altKey)obj.set("angle",(obj.angle||0)+px);else{var _obj$getCenterPoint4=obj.getCenterPoint(),x=_obj$getCenterPoint4.x,y=_obj$getCenterPoint4.y;obj.setPositionByOrigin(new fabric.fabric.Point(x+px,y),"center","center")}obj.setCoords(),fabricCanvas.requestRenderAll()}]];function handleKeydown(ev){if(fabricCanvas){globalShortcuts.forEach((function(_ref2){var _ref3=MediaEditor_slicedToArray(_ref2,2),conditional=_ref3[0],runShortcut=_ref3[1];conditional(ev)&&(runShortcut(),ev.preventDefault(),ev.stopPropagation())}));var obj=fabricCanvas.getActiveObject();!obj||obj.excludeFromExport||obj instanceof MediaEditorFabricIText&&obj.isEditing||objectShortcuts.forEach((function(_ref4){var _ref5=MediaEditor_slicedToArray(_ref4,2),conditional=_ref5[0],runShortcut=_ref5[1];conditional(ev)&&(runShortcut(obj,ev),ev.preventDefault(),ev.stopPropagation())}))}}return document.addEventListener("keydown",handleKeydown),function(){document.removeEventListener("keydown",handleKeydown)}}),[fabricCanvas,editMode,isStickerPopperOpen,onTryClose,redoIfPossible,undoIfPossible]);var _useState18=MediaEditor_slicedToArray((0,react.useState)(0),2),containerWidth=_useState18[0],setContainerWidth=_useState18[1],_useState20=MediaEditor_slicedToArray((0,react.useState)(0),2),containerHeight=_useState20[0],setContainerHeight=_useState20[1],zoom=Math.min(containerWidth/imageState.width,containerHeight/imageState.height)||1;(0,react.useEffect)((function(){fabricCanvas&&imageState.width&&imageState.height&&(fabricCanvas.setDimensions({width:imageState.width*zoom,height:imageState.height*zoom}),fabricCanvas.setZoom(zoom))}),[containerHeight,containerWidth,fabricCanvas,imageState.height,imageState.width,zoom]),(0,react.useEffect)((function(){fabricCanvas&&drawFabricBackgroundImage({fabricCanvas,image,imageState})}),[fabricCanvas,image,imageState]);var _useState22=MediaEditor_slicedToArray((0,react.useState)(!1),2),canCrop=_useState22[0],setCanCrop=_useState22[1],_useState24=MediaEditor_slicedToArray((0,react.useState)(!1),2),cropAspectRatioLock=_useState24[0],setCropAspectRatioLock=_useState24[1],_useState26=MediaEditor_slicedToArray((0,react.useState)(DrawTool.Pen),2),drawTool=_useState26[0],setDrawTool=_useState26[1],_useState28=MediaEditor_slicedToArray((0,react.useState)(DrawWidth.Regular),2),drawWidth=_useState28[0],setDrawWidth=_useState28[1],_useState30=MediaEditor_slicedToArray((0,react.useState)(0),2),sliderValue=_useState30[0],setSliderValue=_useState30[1],_useState32=MediaEditor_slicedToArray((0,react.useState)(TextStyle.Regular),2),textStyle=_useState32[0],setTextStyle=_useState32[1];(0,react.useEffect)((function(){if(fabricCanvas)return fabricEffectListener(fabricCanvas,["selection:created","selection:updated","selection:cleared"],(function(){(null==fabricCanvas?void 0:fabricCanvas.getActiveObject())instanceof MediaEditorFabricIText?setEditMode(EditMode.Text):editMode===EditMode.Text&&setEditMode(void 0)}))}),[editMode,fabricCanvas]),(0,react.useEffect)((function(){fabricCanvas&&(editMode===EditMode.Crop?fabricCanvas.uniformScaling=cropAspectRatioLock:fabricCanvas.uniformScaling=!0)}),[cropAspectRatioLock,editMode,fabricCanvas]),(0,react.useEffect)((function(){if(fabricCanvas&&editMode!==EditMode.Text){var _obj=fabricCanvas.getActiveObject();_obj&&has_default()(_obj,"text")&&""===get_default()(_obj,"text")&&fabricCanvas.remove(_obj)}}),[editMode,fabricCanvas]),(0,react.useEffect)((function(){if(fabricCanvas)if(editMode===EditMode.Draw){fabricCanvas.discardActiveObject(),fabricCanvas.isDrawingMode=!0;var freeDrawingBrush=new MediaEditorFabricPencilBrush(fabricCanvas);drawTool===DrawTool.Highlighter?(freeDrawingBrush.color=(0,util_color.ls)(sliderValue,.5),freeDrawingBrush.strokeLineCap="square",freeDrawingBrush.strokeLineJoin="miter",freeDrawingBrush.width=drawWidth/zoom*2):(freeDrawingBrush.color=(0,util_color.$j)(sliderValue),freeDrawingBrush.strokeLineCap="round",freeDrawingBrush.strokeLineJoin="bevel",freeDrawingBrush.width=drawWidth/zoom),fabricCanvas.freeDrawingBrush=freeDrawingBrush,fabricCanvas.requestRenderAll()}else fabricCanvas.isDrawingMode=!1}),[drawTool,drawWidth,editMode,fabricCanvas,sliderValue,zoom]),(0,react.useEffect)((function(){if(fabricCanvas){var obj=fabricCanvas.getActiveObject();if(obj&&obj instanceof MediaEditorFabricIText){var isEditing=obj.isEditing;obj.exitEditing(),obj.set(getTextStyleAttributes(textStyle,sliderValue)),fabricCanvas.requestRenderAll(),isEditing&&obj.enterEditing()}}}),[fabricCanvas,sliderValue,textStyle]),(0,react.useEffect)((function(){if(fabricCanvas){if(editMode===EditMode.Crop){var rect,PADDING=MediaEditorFabricCropRect.PADDING/zoom,height=imageState.height-PADDING*Math.max(440/imageState.height,2),width=imageState.width-PADDING*Math.max(440/imageState.width,2),_obj2=fabricCanvas.getActiveObject();_obj2 instanceof MediaEditorFabricCropRect?(rect=_obj2).set({height,width,scaleX:1,scaleY:1}):((rect=new MediaEditorFabricCropRect({height,width})).on("modified",(function(){var _rect$getBoundingRect=rect.getBoundingRect(!0),currHeight=_rect$getBoundingRect.height,currWidth=_rect$getBoundingRect.width;setCanCrop(currHeight<height||currWidth<width)})),rect.on("deselected",(function(){setEditMode(void 0)})),fabricCanvas.add(rect),fabricCanvas.setActiveObject(rect)),fabricCanvas.viewportCenterObject(rect),rect.setCoords()}else fabricCanvas.getObjects().forEach((function(obj){obj instanceof MediaEditorFabricCropRect&&fabricCanvas.remove(obj)}));setCanCrop(!1)}}),[editMode,fabricCanvas,imageState.height,imageState.width,zoom]),(0,react.useEffect)((function(){if(fabricCanvas&&(editMode===EditMode.Text&&!(fabricCanvas.getActiveObject()instanceof MediaEditorFabricIText))){var fontSize=Math.min(imageState.width,imageState.height)/10,text=new MediaEditorFabricIText("",Object.assign({},getTextStyleAttributes(textStyle,sliderValue),{fontSize}));text.setPositionByOrigin(new fabric.fabric.Point(imageState.width/2,imageState.height/2),"center","center"),text.setCoords(),fabricCanvas.add(text),fabricCanvas.setActiveObject(text),text.enterEditing()}}),[editMode,fabricCanvas,imageState.height,imageState.width,sliderValue,textStyle]);var tooling,_useState34=MediaEditor_slicedToArray((0,react.useState)(!1),2),isSaving=_useState34[0],setIsSaving=_useState34[1],portal=function usePortal(){var _useState2=usePortal_slicedToArray((0,react.useState)(null),2),root=_useState2[0],setRoot=_useState2[1];return(0,react.useEffect)((function(){var div=document.createElement("div");return document.body.appendChild(div),setRoot(div),function(){document.body.removeChild(div),setRoot(null)}}),[]),root}();if(!portal)return null;if(editMode===EditMode.Text)tooling=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Slider.i,{handleStyle:{backgroundColor:(0,util_color.$j)(sliderValue)},label:i18n("icu:CustomColorEditor__hue"),moduleClassName:"HueSlider MediaEditor__tools__tool",onChange:setSliderValue,value:sliderValue}),(0,jsx_runtime.jsx)(ContextMenu.x,{i18n,menuOptions:[{icon:"MediaEditor__icon--text-regular",label:i18n("icu:MediaEditor__text--regular"),onClick:function(){return setTextStyle(TextStyle.Regular)},value:TextStyle.Regular},{icon:"MediaEditor__icon--text-highlight",label:i18n("icu:MediaEditor__text--highlight"),onClick:function(){return setTextStyle(TextStyle.Highlight)},value:TextStyle.Highlight},{icon:"MediaEditor__icon--text-outline",label:i18n("icu:MediaEditor__text--outline"),onClick:function(){return setTextStyle(TextStyle.Outline)},value:TextStyle.Outline}],moduleClassName:classnames_default()("MediaEditor__tools__tool",{"MediaEditor__tools__button--text-regular":textStyle===TextStyle.Regular,"MediaEditor__tools__button--text-highlight":textStyle===TextStyle.Highlight,"MediaEditor__tools__button--text-outline":textStyle===TextStyle.Outline}),theme:theme.Q.Dark,value:textStyle}),(0,jsx_runtime.jsx)("button",{className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--words",onClick:function(){setEditMode(void 0);var activeObject=null==fabricCanvas?void 0:fabricCanvas.getActiveObject();activeObject instanceof MediaEditorFabricIText&&activeObject.exitEditing()},type:"button",children:i18n("icu:done")})]});else if(editMode===EditMode.Draw)tooling=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Slider.i,{handleStyle:{backgroundColor:(0,util_color.$j)(sliderValue)},label:i18n("icu:CustomColorEditor__hue"),moduleClassName:"HueSlider MediaEditor__tools__tool",onChange:setSliderValue,value:sliderValue}),(0,jsx_runtime.jsx)(ContextMenu.x,{i18n,menuOptions:[{icon:"MediaEditor__icon--draw-pen",label:i18n("icu:MediaEditor__draw--pen"),onClick:function(){return setDrawTool(DrawTool.Pen)},value:DrawTool.Pen},{icon:"MediaEditor__icon--draw-highlighter",label:i18n("icu:MediaEditor__draw--highlighter"),onClick:function(){return setDrawTool(DrawTool.Highlighter)},value:DrawTool.Highlighter}],moduleClassName:classnames_default()("MediaEditor__tools__tool",{"MediaEditor__tools__button--draw-pen":drawTool===DrawTool.Pen,"MediaEditor__tools__button--draw-highlighter":drawTool===DrawTool.Highlighter}),theme:theme.Q.Dark,value:drawTool}),(0,jsx_runtime.jsx)(ContextMenu.x,{i18n,menuOptions:[{icon:"MediaEditor__icon--width-thin",label:i18n("icu:MediaEditor__draw--thin"),onClick:function(){return setDrawWidth(DrawWidth.Thin)},value:DrawWidth.Thin},{icon:"MediaEditor__icon--width-regular",label:i18n("icu:MediaEditor__draw--regular"),onClick:function(){return setDrawWidth(DrawWidth.Regular)},value:DrawWidth.Regular},{icon:"MediaEditor__icon--width-medium",label:i18n("icu:MediaEditor__draw--medium"),onClick:function(){return setDrawWidth(DrawWidth.Medium)},value:DrawWidth.Medium},{icon:"MediaEditor__icon--width-heavy",label:i18n("icu:MediaEditor__draw--heavy"),onClick:function(){return setDrawWidth(DrawWidth.Heavy)},value:DrawWidth.Heavy}],moduleClassName:classnames_default()("MediaEditor__tools__tool",{"MediaEditor__tools__button--width-thin":drawWidth===DrawWidth.Thin,"MediaEditor__tools__button--width-regular":drawWidth===DrawWidth.Regular,"MediaEditor__tools__button--width-medium":drawWidth===DrawWidth.Medium,"MediaEditor__tools__button--width-heavy":drawWidth===DrawWidth.Heavy}),theme:theme.Q.Dark,value:drawWidth}),(0,jsx_runtime.jsx)("button",{className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--words",onClick:function(){return setEditMode(void 0)},type:"button",children:i18n("icu:done")})]});else if(editMode===EditMode.Crop){var canReset=0!==imageState.cropX||0!==imageState.cropY||imageState.flipX||imageState.flipY||0!==imageState.angle;tooling=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("button",{className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--words",disabled:!canReset,onClick:async function(){if(fabricCanvas){var newImageState=Object.assign({},INITIAL_IMAGE_STATE,{height:image.height,width:image.width});setImageState(newImageState),function moveFabricObjectsForReset(fabricCanvas,oldImageState){fabricCanvas.getObjects().forEach((function(obj){if(!obj.excludeFromExport){var newCenterX,newCenterY,oldCenter=obj.getCenterPoint(),distanceFromRightEdge=oldImageState.width-oldCenter.x,distanceFromBottomEdge=oldImageState.height-oldCenter.y;switch(oldImageState.angle%360){case 0:newCenterX=oldCenter.x,newCenterY=oldCenter.y;break;case 90:newCenterX=oldCenter.y,newCenterY=distanceFromRightEdge;break;case 180:newCenterX=distanceFromRightEdge,newCenterY=distanceFromBottomEdge;break;case 270:newCenterX=distanceFromBottomEdge,newCenterY=oldCenter.x;break;default:throw new Error("Unexpected angle")}newCenterX+=oldImageState.cropX,newCenterY+=oldImageState.cropY,obj.set("angle",(obj.angle||0)-oldImageState.angle),obj.setPositionByOrigin(new fabric.fabric.Point(newCenterX,newCenterY),"center","center"),obj.setCoords()}}))}(fabricCanvas,imageState),takeSnapshot("reset",newImageState)}},type:"button",children:i18n("icu:MediaEditor__crop--reset")}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__crop--rotate"),className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--rotate",onClick:function(){if(fabricCanvas){fabricCanvas.getObjects().forEach((function(obj){if(!(obj instanceof MediaEditorFabricCropRect)){var center=obj.getCenterPoint();obj.set("angle",((obj.angle||0)+270)%360),obj.setPositionByOrigin(new fabric.fabric.Point(center.y,imageState.width-center.x),"center","center"),obj.setCoords()}}));var newImageState=Object.assign({},imageState,{angle:(imageState.angle+270)%360,height:imageState.width,width:imageState.height});setImageState(newImageState),takeSnapshot("rotate",newImageState)}},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__crop--flip"),className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--flip",onClick:function(){if(fabricCanvas){var newImageState=Object.assign({},imageState,imageState.angle%180?{flipY:!imageState.flipY}:{flipX:!imageState.flipX});setImageState(newImageState),takeSnapshot("flip",newImageState)}},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__crop--lock"),className:classnames_default()("MediaEditor__tools__button",`MediaEditor__tools__button--crop-${cropAspectRatioLock?"":"un"}locked`),onClick:function(){fabricCanvas&&(fabricCanvas.uniformScaling=!cropAspectRatioLock),setCropAspectRatioLock(!cropAspectRatioLock)},type:"button"}),(0,jsx_runtime.jsx)("button",{className:"MediaEditor__tools__tool MediaEditor__tools__button MediaEditor__tools__button--words",disabled:!canCrop,onClick:function(){if(fabricCanvas){var pendingCrop=getPendingCrop(fabricCanvas);if(pendingCrop){var newImageState=getNewImageStateFromCrop(imageState,pendingCrop);setImageState(newImageState),moveFabricObjectsForCrop(fabricCanvas,pendingCrop),takeSnapshot("crop",newImageState),setEditMode(void 0)}}},type:"button",children:i18n("icu:done")})]})}return(0,react_dom.createPortal)((0,jsx_runtime.jsxs)("div",{className:"MediaEditor",children:[(0,jsx_runtime.jsx)("div",{className:"MediaEditor__container",children:(0,jsx_runtime.jsx)(index_esm.Z,{bounds:!0,onResize:function(_ref6){var bounds=_ref6.bounds;bounds?(setContainerWidth(bounds.width),setContainerHeight(bounds.height)):log.error("We should be measuring the bounds")},children:function(_ref7){var measureRef=_ref7.measureRef;return(0,jsx_runtime.jsx)("div",{className:"MediaEditor__media",ref:measureRef,children:image&&(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("canvas",{className:classnames_default()("MediaEditor__media--canvas",{"MediaEditor__media--canvas--cropping":editMode===EditMode.Crop}),id:canvasId})})})}})}),(0,jsx_runtime.jsxs)("div",{className:"MediaEditor__toolbar",children:[tooling?(0,jsx_runtime.jsx)("div",{className:"MediaEditor__tools",children:tooling}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:props.supportsCaption?(0,jsx_runtime.jsxs)("div",{className:"MediaEditor__toolbar__caption",children:[(0,jsx_runtime.jsx)("button",{type:"button",className:"MediaEditor__toolbar__caption__add-caption-button",onClick:function(){return setShowAddCaptionModal(!0)},children:""!==caption?(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(MessageBody.D,{renderLocation:MessageTextRenderer.G5.MediaEditor,bodyRanges:captionBodyRanges,i18n,isSpoilerExpanded:{},text:caption})}):i18n("icu:MediaEditor__caption-button")}),showAddCaptionModal&&(0,jsx_runtime.jsx)(AddCaptionModal.R,{i18n,draftText:caption,draftBodyRanges:captionBodyRanges,onSubmit:function(messageText,bodyRanges){setCaption(messageText.trim()),setCaptionBodyRanges(bodyRanges),setShowAddCaptionModal(!1)},onClose:function(){return setShowAddCaptionModal(!1)},RenderCompositionTextArea:props.renderCompositionTextArea,theme:Util.f8.dark})]}):(0,jsx_runtime.jsx)("div",{className:"MediaEditor__toolbar--space"})}),(0,jsx_runtime.jsxs)("div",{className:"MediaEditor__toolbar--buttons",children:[(0,jsx_runtime.jsx)(Button.zx,{onClick:onTryClose,theme:theme.Q.Dark,variant:Button.Wu.Secondary,children:i18n("icu:discard")}),(0,jsx_runtime.jsxs)("div",{className:"MediaEditor__controls",children:[(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__control--draw"),className:classnames_default()({MediaEditor__control:!0,"MediaEditor__control--pen":!0,"MediaEditor__control--selected":editMode===EditMode.Draw}),onClick:function(){setEditMode(editMode===EditMode.Draw?void 0:EditMode.Draw)},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__control--text"),className:classnames_default()({MediaEditor__control:!0,"MediaEditor__control--text":!0,"MediaEditor__control--selected":editMode===EditMode.Text}),onClick:function(){if(editMode===EditMode.Text){setEditMode(void 0);var _obj3=null==fabricCanvas?void 0:fabricCanvas.getActiveObject();_obj3 instanceof MediaEditorFabricIText&&_obj3.exitEditing()}else setEditMode(EditMode.Text)},type:"button"}),(0,jsx_runtime.jsx)(StickerButton.q,{blessedPacks:[],className:classnames_default()({MediaEditor__control:!0,"MediaEditor__control--sticker":!0}),onOpenStateChanged:function(value){setIsStickerPopperOpen(value)},clearInstalledStickerPack:noop_default(),clearShowIntroduction:function(){null==fabricCanvas||fabricCanvas.discardActiveObject(),setEditMode(void 0)},clearShowPickerHint:noop_default(),i18n,installedPacks,knownPacks:[],onPickSticker:function(_packId,_stickerId,src){if(fabricCanvas){var size=Math.min(imageState.width,imageState.height)/4,sticker=new MediaEditorFabricSticker(src);sticker.scaleToHeight(size),sticker.setPositionByOrigin(new fabric.fabric.Point(imageState.width/2,imageState.height/2),"center","center"),sticker.setCoords(),fabricCanvas.add(sticker),fabricCanvas.setActiveObject(sticker),setEditMode(void 0)}},onPickTimeSticker:function(style){if(fabricCanvas){if("digital"===style){var sticker=new MediaEditorFabricDigitalTimeSticker(Date.now());sticker.setPositionByOrigin(new fabric.fabric.Point(imageState.width/2,imageState.height/2),"center","center"),sticker.setCoords(),fabricCanvas.add(sticker),fabricCanvas.setActiveObject(sticker)}if("analog"===style){var _sticker=new MediaEditorFabricAnalogTimeSticker,size=Math.min(imageState.width,imageState.height)/4;_sticker.scaleToHeight(size),_sticker.setPositionByOrigin(new fabric.fabric.Point(imageState.width/2,imageState.height/2),"center","center"),_sticker.setCoords(),fabricCanvas.add(_sticker),fabricCanvas.setActiveObject(_sticker)}setEditMode(void 0)}},receivedPacks:[],recentStickers,showPickerHint:!1,theme:theme.Q.Dark}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__control--crop"),className:classnames_default()({MediaEditor__control:!0,"MediaEditor__control--crop":!0,"MediaEditor__control--selected":editMode===EditMode.Crop}),onClick:function(){if(fabricCanvas)if(editMode===EditMode.Crop){var _obj4=fabricCanvas.getActiveObject();_obj4 instanceof MediaEditorFabricCropRect&&fabricCanvas.remove(_obj4),setEditMode(void 0)}else setEditMode(EditMode.Crop)},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__control--undo"),className:"MediaEditor__control MediaEditor__control--undo",disabled:!canUndo,onClick:function(){editMode===EditMode.Crop&&setEditMode(void 0),undoIfPossible()},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:MediaEditor__control--redo"),className:"MediaEditor__control MediaEditor__control--redo",disabled:!canRedo,onClick:function(){editMode===EditMode.Crop&&setEditMode(void 0),redoIfPossible()},type:"button"})]}),(0,jsx_runtime.jsx)(Button.zx,{disabled:!image||isSaving||isSending,onClick:async function(){if(fabricCanvas){var data,blurHash;setEditMode(void 0),setIsSaving(!0);try{var finalImageState,renderFabricCanvas=await function cloneFabricCanvas(original){return new Promise((function(resolve){original.clone(resolve,["data"])}))}(fabricCanvas);renderFabricCanvas.remove.apply(renderFabricCanvas,_toConsumableArray(renderFabricCanvas.getObjects().filter((function(obj){return obj.excludeFromExport}))));var pendingCrop=getPendingCrop(fabricCanvas);pendingCrop?(finalImageState=getNewImageStateFromCrop(imageState,pendingCrop),moveFabricObjectsForCrop(renderFabricCanvas,pendingCrop),drawFabricBackgroundImage({fabricCanvas:renderFabricCanvas,image,imageState:finalImageState})):finalImageState=imageState,renderFabricCanvas.setDimensions({width:finalImageState.width,height:finalImageState.height}),renderFabricCanvas.setZoom(1);var renderedCanvas=renderFabricCanvas.toCanvasElement();data=await(0,canvasToBytes.E)(renderedCanvas);var blob=new Blob([data],{type:MIME.Ih});blurHash=await props.imageToBlurHash(blob)}catch(err){throw onTryClose(),err}finally{setIsSaving(!1)}onDone({contentType:MIME.Ih,data,caption:""!==caption?caption:void 0,captionBodyRanges,blurHash})}},theme:theme.Q.Dark,variant:Button.Wu.Primary,children:isSending?(0,jsx_runtime.jsx)(Spinner.$j,{svgSize:"small"}):doneButtonLabel||i18n("icu:save")})]})]}),confirmDiscardModal]}),portal)}function getPendingCrop(fabricCanvas){var activeObject=fabricCanvas.getActiveObject();return activeObject instanceof MediaEditorFabricCropRect?activeObject.getBoundingRect(!0):void 0}function getNewImageStateFromCrop(state,_ref8){var cropX,cropY,left=_ref8.left,height=_ref8.height,top=_ref8.top,width=_ref8.width;switch(state.angle){case 0:cropX=state.cropX+left,cropY=state.cropY+top;break;case 90:cropX=state.cropX+top,cropY=state.cropY+(state.width-(left+width));break;case 180:cropX=state.cropX+(state.width-(left+width)),cropY=state.cropY+(state.height-(top+height));break;case 270:cropX=state.cropX+(state.height-(top+height)),cropY=state.cropY+left;break;default:throw new Error("Unexpected angle")}return Object.assign({},state,{cropX,cropY,height,width})}function moveFabricObjectsForCrop(fabricCanvas,_ref9){var left=_ref9.left,top=_ref9.top;fabricCanvas.getObjects().forEach((function(obj){var _obj$getCenterPoint5=obj.getCenterPoint(),x=_obj$getCenterPoint5.x,y=_obj$getCenterPoint5.y,translatedCenter=new fabric.fabric.Point(x-left,y-top);obj.setPositionByOrigin(translatedCenter,"center","center"),obj.setCoords()}))}function drawFabricBackgroundImage(_ref10){var left,top,fabricCanvas=_ref10.fabricCanvas,image=_ref10.image,imageState=_ref10.imageState,backgroundImage=new fabric.fabric.Image(image,{canvas:fabricCanvas,height:imageState.height||image.height,width:imageState.width||image.width});switch(imageState.angle){case 0:left=0,top=0;break;case 90:left=imageState.width,top=0;break;case 180:left=imageState.width,top=imageState.height;break;case 270:left=0,top=imageState.height;break;default:throw new Error("Unexpected angle")}var height=imageState.height,width=imageState.width;if(imageState.angle%180){var _ref11=[height,width];width=_ref11[0],height=_ref11[1]}fabricCanvas.setBackgroundImage(backgroundImage,fabricCanvas.requestRenderAll.bind(fabricCanvas),{angle:imageState.angle,cropX:imageState.cropX,cropY:imageState.cropY,flipX:imageState.flipX,flipY:imageState.flipY,left,top,originX:"left",originY:"top",width,height})}!function(EditMode){EditMode.Crop="Crop",EditMode.Draw="Draw",EditMode.Text="Text"}(EditMode||(EditMode={})),function(DrawWidth){DrawWidth[DrawWidth.Thin=2]="Thin",DrawWidth[DrawWidth.Regular=4]="Regular",DrawWidth[DrawWidth.Medium=12]="Medium",DrawWidth[DrawWidth.Heavy=24]="Heavy"}(DrawWidth||(DrawWidth={})),function(DrawTool){DrawTool.Pen="Pen",DrawTool.Highlighter="Highlighter"}(DrawTool||(DrawTool={}))},"./ts/components/Slider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{i:()=>Slider});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/getClassNamesFor.ts"),_util_keyboard__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/keyboard.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Slider(_ref){var _ref$containerStyle=_ref.containerStyle,containerStyle=void 0===_ref$containerStyle?{}:_ref$containerStyle,label=_ref.label,_ref$handleStyle=_ref.handleStyle,handleStyle=void 0===_ref$handleStyle?{}:_ref$handleStyle,moduleClassName=_ref.moduleClassName,onChange=_ref.onChange,value=_ref.value,diff=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0),handleRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),sliderRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_1__.h)("Slider",moduleClassName),handleValueChange=function(ev){if(sliderRef&&sliderRef.current){var x=ev.clientX-diff.current-sliderRef.current.getBoundingClientRect().left,max=sliderRef.current.offsetWidth;x=Math.min(max,Math.max(0,x)),onChange(100*x/max),ev.preventDefault(),ev.stopPropagation()}},handleMouseUp=function(){document.removeEventListener("mouseup",handleMouseUp),document.removeEventListener("mousemove",handleValueChange)};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{"aria-label":label,className:getClassName(""),onClick:handleValueChange,onKeyDown:function(ev){var preventDefault=!1;if(ev.key===(0,_util_keyboard__WEBPACK_IMPORTED_MODULE_2__.x)("end")){var nextValue=value+1;onChange(Math.min(nextValue,100)),preventDefault=!0}if(ev.key===(0,_util_keyboard__WEBPACK_IMPORTED_MODULE_2__.x)("start")){var _nextValue=value-1;onChange(Math.max(0,_nextValue)),preventDefault=!0}"Home"===ev.key&&(onChange(0),preventDefault=!0),"End"===ev.key&&(onChange(100),preventDefault=!0),preventDefault&&(ev.preventDefault(),ev.stopPropagation())},ref:sliderRef,role:"button",style:containerStyle,tabIndex:0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{"aria-label":label,"aria-valuenow":value,className:getClassName("__handle"),onMouseDown:function(ev){handleRef&&handleRef.current&&(diff.current=ev.clientX-handleRef.current.getBoundingClientRect().left,document.addEventListener("mousemove",handleValueChange),document.addEventListener("mouseup",handleMouseUp))},ref:handleRef,role:"slider",style:Object.assign({},handleStyle,{left:`${value}%`}),tabIndex:-1})})}Slider.displayName="Slider"},"./ts/components/stickers/StickerButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>StickerButton});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),lodash_get__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_3__),react_popper__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/react-popper/lib/esm/Manager.js"),react_popper__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/react-popper/lib/esm/Reference.js"),react_popper__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/react-popper/lib/esm/Popper.js"),react_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react-dom/index.js"),_StickerPicker__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/stickers/StickerPicker.tsx"),_lib__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./ts/components/stickers/lib.ts"),_util_popperUtil__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/util/popperUtil.ts"),_util_theme__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/theme.ts"),_util_handleOutsideClick__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/handleOutsideClick.ts"),_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/services/keyboardLayout.ts"),_hooks_useRefMerger__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/hooks/useRefMerger.ts"),_UserText__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var StickerButton=react__WEBPACK_IMPORTED_MODULE_2__.memo((function StickerButtonInner(_ref){var className=_ref.className,i18n=_ref.i18n,clearInstalledStickerPack=_ref.clearInstalledStickerPack,onClickAddPack=_ref.onClickAddPack,onPickSticker=_ref.onPickSticker,onPickTimeSticker=_ref.onPickTimeSticker,recentStickers=_ref.recentStickers,onOpenStateChanged=_ref.onOpenStateChanged,receivedPacks=_ref.receivedPacks,installedPack=_ref.installedPack,installedPacks=_ref.installedPacks,blessedPacks=_ref.blessedPacks,knownPacks=_ref.knownPacks,showIntroduction=_ref.showIntroduction,clearShowIntroduction=_ref.clearShowIntroduction,showPickerHint=_ref.showPickerHint,clearShowPickerHint=_ref.clearShowPickerHint,_ref$position=_ref.position,position=void 0===_ref$position?"top-end":_ref$position,theme=_ref.theme,_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_2__.useState(!1),2),open=_React$useState2[0],internalSetOpen=_React$useState2[1],setOpen=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(value){internalSetOpen(value),onOpenStateChanged&&onOpenStateChanged(value)}),[internalSetOpen,onOpenStateChanged]),_React$useState4=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_2__.useState(null),2),popperRoot=_React$useState4[0],setPopperRoot=_React$useState4[1],buttonRef=react__WEBPACK_IMPORTED_MODULE_2__.useRef(null),refMerger=(0,_hooks_useRefMerger__WEBPACK_IMPORTED_MODULE_10__.T)(),handleClickButton=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){clearInstalledStickerPack(),clearShowIntroduction(),0===installedPacks.length?null==onClickAddPack||onClickAddPack():setOpen(!popperRoot)}),[clearInstalledStickerPack,clearShowIntroduction,installedPacks,onClickAddPack,popperRoot,setOpen]),handlePickSticker=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(packId,stickerId,url){setOpen(!1),onPickSticker(packId,stickerId,url)}),[setOpen,onPickSticker]),handlePickTimeSticker=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(style){setOpen(!1),null==onPickTimeSticker||onPickTimeSticker(style)}),[setOpen,onPickTimeSticker]),handleClose=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){setOpen(!1)}),[setOpen]),handleClickAddPack=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){setOpen(!1),showPickerHint&&clearShowPickerHint(),null==onClickAddPack||onClickAddPack()}),[onClickAddPack,showPickerHint,setOpen,clearShowPickerHint]),handleClearIntroduction=react__WEBPACK_IMPORTED_MODULE_2__.useCallback((function(){clearInstalledStickerPack(),clearShowIntroduction()}),[clearInstalledStickerPack,clearShowIntroduction]);return react__WEBPACK_IMPORTED_MODULE_2__.useEffect((function(){if(open){var root=document.createElement("div");return setPopperRoot(root),document.body.appendChild(root),function(){document.body.removeChild(root),setPopperRoot(null)}}return lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}),[open,setOpen,setPopperRoot]),react__WEBPACK_IMPORTED_MODULE_2__.useEffect((function(){return open?(0,_util_handleOutsideClick__WEBPACK_IMPORTED_MODULE_8__.p)((function(target){var targetClassName=target&&target.className||"";return(!targetClassName||targetClassName.indexOf("module-sticker-picker__header__button")<0)&&(setOpen(!1),!0)}),{containerElements:[popperRoot,buttonRef],name:"StickerButton"}):lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}),[open,popperRoot,setOpen]),react__WEBPACK_IMPORTED_MODULE_2__.useEffect((function(){var handleKeydown=function(event){var ctrlKey=event.ctrlKey,metaKey=event.metaKey,shiftKey=event.shiftKey,commandKey="darwin"===lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(window,"platform")&&metaKey,controlKey="darwin"!==lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(window,"platform")&&ctrlKey,commandOrCtrl=commandKey||controlKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_9__.P(event),panels=document.querySelectorAll(".conversation .panel");panels&&panels.length>1||commandOrCtrl&&shiftKey&&("g"===key||"G"===key)&&(event.stopPropagation(),event.preventDefault(),setOpen(!open))};return document.addEventListener("keydown",handleKeydown),function(){document.removeEventListener("keydown",handleKeydown)}}),[open,setOpen]),react__WEBPACK_IMPORTED_MODULE_2__.useEffect((function(){if(installedPack){var timerId=setTimeout(clearInstalledStickerPack,1e4);return function(){clearTimeout(timerId)}}return lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}),[installedPack,clearInstalledStickerPack]),0===(0,_lib__WEBPACK_IMPORTED_MODULE_13__.Q)({knownPacks,blessedPacks,installedPacks,receivedPacks})?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)(react_popper__WEBPACK_IMPORTED_MODULE_14__.dK,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_15__.s,{children:function(_ref2){var ref=_ref2.ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("button",{type:"button",ref:refMerger(buttonRef,ref),onClick:handleClickButton,className:classnames__WEBPACK_IMPORTED_MODULE_3___default()({"module-sticker-button__button":!0,"module-sticker-button__button--active":open},className),"aria-label":i18n("icu:stickers--StickerPicker--Open")})}}),open||showIntroduction||!installedPack?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_16__.r,{placement:position,modifiers:[(0,_util_popperUtil__WEBPACK_IMPORTED_MODULE_6__.E)(6)],children:function(_ref3){var ref=_ref3.ref,style=_ref3.style,placement=_ref3.placement,arrowProps=_ref3.arrowProps;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:theme?(0,_util_theme__WEBPACK_IMPORTED_MODULE_7__.j)(theme):void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("button",{type:"button",ref,style,className:"module-sticker-button__tooltip",onClick:clearInstalledStickerPack,children:[installedPack.cover?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("img",{className:"module-sticker-button__tooltip__image",src:installedPack.cover.url,alt:installedPack.title}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-sticker-button__tooltip__image-placeholder"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("span",{className:"module-sticker-button__tooltip__text",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("span",{className:"module-sticker-button__tooltip__text__title",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_11__.a,{text:installedPack.title})})," ","installed"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{ref:arrowProps.ref,style:arrowProps.style,className:classnames__WEBPACK_IMPORTED_MODULE_3___default()("module-sticker-button__tooltip__triangle",`module-sticker-button__tooltip__triangle--${placement}`)})]})})}},installedPack.id),!open&&showIntroduction?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_16__.r,{placement:position,modifiers:[(0,_util_popperUtil__WEBPACK_IMPORTED_MODULE_6__.E)(6)],children:function(_ref4){var ref=_ref4.ref,style=_ref4.style,placement=_ref4.placement,arrowProps=_ref4.arrowProps;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:theme?(0,_util_theme__WEBPACK_IMPORTED_MODULE_7__.j)(theme):void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("button",{type:"button",ref,style,className:classnames__WEBPACK_IMPORTED_MODULE_3___default()("module-sticker-button__tooltip","module-sticker-button__tooltip--introduction"),onClick:handleClearIntroduction,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("img",{className:"module-sticker-button__tooltip--introduction__image",srcSet:"images/sticker_splash@1x.png 1x, images/sticker_splash@2x.png 2x",alt:i18n("icu:stickers--StickerManager--Introduction--Image")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{className:"module-sticker-button__tooltip--introduction__meta",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-sticker-button__tooltip--introduction__meta__title",children:i18n("icu:stickers--StickerManager--Introduction--Title")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-sticker-button__tooltip--introduction__meta__subtitle",children:i18n("icu:stickers--StickerManager--Introduction--Body")})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:"module-sticker-button__tooltip--introduction__close",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("button",{type:"button",className:"module-sticker-button__tooltip--introduction__close__button",onClick:handleClearIntroduction,"aria-label":i18n("icu:close")})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{ref:arrowProps.ref,style:arrowProps.style,className:classnames__WEBPACK_IMPORTED_MODULE_3___default()("module-sticker-button__tooltip__triangle","module-sticker-button__tooltip__triangle--introduction",`module-sticker-button__tooltip__triangle--${placement}`)})]})})}}):null,open&&popperRoot?(0,react_dom__WEBPACK_IMPORTED_MODULE_4__.createPortal)((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_popper__WEBPACK_IMPORTED_MODULE_16__.r,{placement:position,children:function(_ref5){var ref=_ref5.ref,style=_ref5.style;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{className:theme?(0,_util_theme__WEBPACK_IMPORTED_MODULE_7__.j)(theme):void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_StickerPicker__WEBPACK_IMPORTED_MODULE_5__.C,{ref,i18n,style,packs:installedPacks,onClose:handleClose,onClickAddPack:onClickAddPack?handleClickAddPack:void 0,onPickSticker:handlePickSticker,onPickTimeSticker:onPickTimeSticker?handlePickTimeSticker:void 0,recentStickers,showPickerHint})})}}),popperRoot):null]})}))},"./ts/components/stickers/StickerPicker.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>StickerPicker});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),focus_trap_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),focus_trap_react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(focus_trap_react__WEBPACK_IMPORTED_MODULE_2__),_hooks_useRestoreFocus__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/hooks/useRestoreFocus.ts"),_util_getAnalogTime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/util/getAnalogTime.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function getPacksPageOffset(page,packs){return 0===page?0:isLastPacksPage(page,packs)?224*(Math.floor(packs/7)-1)+32*(packs%7-1):32*page*7}function isLastPacksPage(page,packs){return page===Math.floor(packs/7)}var StickerPicker=react__WEBPACK_IMPORTED_MODULE_0__.memo(react__WEBPACK_IMPORTED_MODULE_0__.forwardRef((function(_ref,ref){var i18n=_ref.i18n,packs=_ref.packs,recentStickers=_ref.recentStickers,onClose=_ref.onClose,onClickAddPack=_ref.onClickAddPack,onPickSticker=_ref.onPickSticker,onPickTimeSticker=_ref.onPickTimeSticker,showPickerHint=_ref.showPickerHint,style=_ref.style,tabIds=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return["recents"].concat(_toConsumableArray(packs.map((function(_ref2){return _ref2.id}))))}),[packs]),_useTabs=function useTabs(tabs){var initialTab=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tabs[0],_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_0__.useState(initialTab),2),tab=_React$useState2[0],setTab=_React$useState2[1],handlers=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){return tabs.map((function(t){return function(){setTab(t)}}))}),[tabs]);return[tab,handlers]}(tabIds,tabIds[recentStickers.length>0?0:Math.min(1,tabIds.length)]),_useTabs2=_slicedToArray(_useTabs,2),currentTab=_useTabs2[0],_useTabs2$=function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest()}(_useTabs2[1]),recentsHandler=_useTabs2$[0],packsHandlers=_useTabs2$.slice(1),selectedPack=packs.find((function(_ref3){return _ref3.id===currentTab})),_ref4=selectedPack||{},_ref4$stickers=_ref4.stickers,stickers=void 0===_ref4$stickers?recentStickers:_ref4$stickers,_ref4$title=_ref4.title,packTitle=void 0===_ref4$title?"Recent Stickers":_ref4$title,_React$useState4=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_0__.useState(!1),2),isUsingKeyboard=_React$useState4[0],setIsUsingKeyboard=_React$useState4[1],_React$useState6=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_0__.useState(0),2),packsPage=_React$useState6[0],setPacksPage=_React$useState6[1],onClickPrevPackPage=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(){setPacksPage((function(i){return i-1}))}),[setPacksPage]),onClickNextPackPage=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(){setPacksPage((function(i){return i+1}))}),[setPacksPage]);react__WEBPACK_IMPORTED_MODULE_0__.useEffect((function(){var handler=function(event){"Tab"!==event.key?"Escape"===event.key&&(event.stopPropagation(),event.preventDefault(),onClose()):setIsUsingKeyboard(!0)};return document.addEventListener("keydown",handler),function(){document.removeEventListener("keydown",handler)}}),[onClose]);var focusRef=_slicedToArray((0,_hooks_useRestoreFocus__WEBPACK_IMPORTED_MODULE_3__.H)(),1)[0],hasPacks=packs.length>0,isRecents=hasPacks&&"recents"===currentTab,hasTimeStickers=isRecents&&onPickTimeSticker,isEmpty=0===stickers.length&&!hasTimeStickers,addPackRef=isEmpty?focusRef:void 0,downloadError=selectedPack&&"error"===selectedPack.status&&selectedPack.stickerCount!==selectedPack.stickers.length,pendingCount=selectedPack&&"pending"===selectedPack.status?selectedPack.stickerCount-stickers.length:0,showEmptyText=!downloadError&&isEmpty,showText=pendingCount>0||downloadError||showEmptyText,showLongText=showPickerHint,analogTime=(0,_util_getAnalogTime__WEBPACK_IMPORTED_MODULE_5__._)();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(focus_trap_react__WEBPACK_IMPORTED_MODULE_2___default(),{focusTrapOptions:{allowOutsideClick:!0},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker",ref,style,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__header",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__header__packs",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__header__packs__slider",style:{transform:`translateX(-${getPacksPageOffset(packsPage,packs.length)}px)`},children:[hasPacks?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{"aria-pressed":"recents"===currentTab,type:"button",onClick:recentsHandler,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()({"module-sticker-picker__header__button":!0,"module-sticker-picker__header__button--recents":!0,"module-sticker-picker__header__button--selected":"recents"===currentTab}),"aria-label":i18n("icu:stickers--StickerPicker--Recents")}):null,packs.map((function(pack,i){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{"aria-pressed":currentTab===pack.id,type:"button",onClick:packsHandlers[i],className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__header__button",{"module-sticker-picker__header__button--selected":currentTab===pack.id,"module-sticker-picker__header__button--error":"error"===pack.status}),children:pack.cover?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("img",{className:"module-sticker-picker__header__button__image",src:pack.cover.url,alt:pack.title,title:pack.title}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-sticker-picker__header__button__image-placeholder"})},pack.id)}))]}),!isUsingKeyboard&&packsPage>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{type:"button",className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__header__button","module-sticker-picker__header__button--prev-page"),onClick:onClickPrevPackPage,"aria-label":i18n("icu:stickers--StickerPicker--PrevPage")}):null,isUsingKeyboard||isLastPacksPage(packsPage,packs.length)?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{type:"button",className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__header__button","module-sticker-picker__header__button--next-page"),onClick:onClickNextPackPage,"aria-label":i18n("icu:stickers--StickerPicker--NextPage")})]}),onClickAddPack&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{type:"button",ref:addPackRef,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__header__button","module-sticker-picker__header__button--add-pack",{"module-sticker-picker__header__button--hint":showPickerHint}),onClick:onClickAddPack,"aria-label":i18n("icu:stickers--StickerPicker--AddPack")})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__body",{"module-sticker-picker__body--empty":isEmpty}),children:[showPickerHint?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__body__text","module-sticker-picker__body__text--hint",{"module-sticker-picker__body__text--pin":showEmptyText}),children:i18n("icu:stickers--StickerPicker--Hint")}):null,hasPacks?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-sticker-picker__body__text",children:i18n("icu:stickers--StickerPicker--NoPacks")}),pendingCount>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-sticker-picker__body__text",children:i18n("icu:stickers--StickerPicker--DownloadPending")}):null,downloadError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__body__text","module-sticker-picker__body__text--error"),children:stickers.length>0?i18n("icu:stickers--StickerPicker--DownloadError"):i18n("icu:stickers--StickerPicker--Empty")}):null,hasPacks&&showEmptyText?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__body__text",{"module-sticker-picker__body__text--error":!isRecents}),children:i18n(isRecents?"icu:stickers--StickerPicker--NoRecents":"icu:stickers--StickerPicker--Empty")}):null,isEmpty?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__body__content",children:[isRecents&&onPickTimeSticker&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__recents",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("strong",{className:"module-sticker-picker__recents__title",children:i18n("icu:stickers__StickerPicker__featured")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-sticker-picker__body__grid",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{type:"button",className:"module-sticker-picker__body__cell module-sticker-picker__time--digital",onClick:function(){return onPickTimeSticker("digital")},children:new Intl.DateTimeFormat(window.getPreferredSystemLocales(),{hour:"numeric",minute:"numeric"}).formatToParts(Date.now()).filter((function(x){return"dayPeriod"!==x.type})).reduce((function(acc,_ref5){return`${acc}${_ref5.value}`}),"")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("button",{"aria-label":i18n("icu:stickers__StickerPicker__analog-time"),className:"module-sticker-picker__body__cell module-sticker-picker__time--analog",onClick:function(){return onPickTimeSticker("analog")},type:"button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span",{className:"module-sticker-picker__time--analog__hour",style:{transform:`rotate(${analogTime.hour}deg)`}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span",{className:"module-sticker-picker__time--analog__minute",style:{transform:`rotate(${analogTime.minute}deg)`}})]})]}),stickers.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("strong",{className:"module-sticker-picker__recents__title",children:i18n("icu:stickers__StickerPicker__recent")})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-sticker-picker__body__grid",{"module-sticker-picker__body__content--under-text":showText,"module-sticker-picker__body__content--under-long-text":showLongText}),children:[stickers.map((function(_ref6,index){var packId=_ref6.packId,id=_ref6.id,url=_ref6.url,maybeFocusRef=0===index?focusRef:void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{type:"button",ref:maybeFocusRef,className:"module-sticker-picker__body__cell",onClick:function(){return onPickSticker(packId,id,url)},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("img",{className:"module-sticker-picker__body__cell__image",src:url,alt:packTitle})},`${packId}-${id}`)})),Array(pendingCount).fill(0).map((function(_,i){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-sticker-picker__body__cell__placeholder",role:"presentation"},i)}))]})]})]})]})})})))},"./ts/components/stickers/lib.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function countStickers(o){return o.knownPacks.length+o.blessedPacks.length+o.installedPacks.length+o.receivedPacks.length}__webpack_require__.d(__webpack_exports__,{Q:()=>countStickers})},"./ts/hooks/useConfirmDiscard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>useConfirmDiscard});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_components_ConfirmDiscardDialog__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/ConfirmDiscardDialog.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function useConfirmDiscard(i18n){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),2),props=_useState2[0],setProps=_useState2[1];return[props?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_components_ConfirmDiscardDialog__WEBPACK_IMPORTED_MODULE_1__.a,Object.assign({i18n},props)):null,function confirmDiscardIf(condition,callback){condition?setProps({onClose:function(){setProps(null)},onDiscard:callback}):callback()}]}},"./ts/hooks/useUniqueId.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{L:()=>useUniqueId});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),uuid__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/uuid-browser/index.js");function useUniqueId(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return(0,uuid__WEBPACK_IMPORTED_MODULE_1__.v4)()}),[])}},"./ts/mediaEditor/util/color.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getRatio(min,max,value){return(value-min)/(max-min)}__webpack_require__.d(__webpack_exports__,{$j:()=>getHSL,Wb:()=>getRGBANumber,ls:()=>getRGBA});function getHSLValues(percentage){return percentage<=7?[0,.5,.5*getRatio(0,7,percentage)]:percentage>=95?[0,0,Math.min(1,.5+getRatio(95,100,percentage))]:[338*getRatio(7,95,percentage),1,.5]}function hslToRGB(h,s,l){var a=s*Math.min(l,1-l);function f(n){var k=(n+h/30)%12;return l-a*Math.max(Math.min(k-3,9-k,1),-1)}return{r:Math.round(255*f(0)),g:Math.round(255*f(8)),b:Math.round(255*f(4))}}function getHSL(percentage){var _getHSLValues2=_slicedToArray(getHSLValues(percentage),3);return`hsl(${_getHSLValues2[0]}, ${100*_getHSLValues2[1]}%, ${100*_getHSLValues2[2]}%)`}function getRGBANumber(percentage){var _getHSLValues4=_slicedToArray(getHSLValues(percentage),3),_hslToRGB=hslToRGB(_getHSLValues4[0],_getHSLValues4[1],_getHSLValues4[2]);return 4294967296+(255<<24|(255&_hslToRGB.r)<<16|(255&_hslToRGB.g)<<8|_hslToRGB.b)}function getRGBA(percentage){var alpha=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,_getHSLValues5=getHSLValues(percentage),_getHSLValues6=_slicedToArray(_getHSLValues5,3),h=_getHSLValues6[0],s=_getHSLValues6[1],l=_getHSLValues6[2],_hslToRGB2=hslToRGB(h,s,l),r=_hslToRGB2.r,g=_hslToRGB2.g,b=_hslToRGB2.b,rgbValue=[r,g,b].map(String).join(",");return`rgba(${rgbValue},${alpha})`}},"./ts/util/canvasToBlob.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>canvasToBlob});var _types_MIME__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/MIME.ts");async function canvasToBlob(canvas){var mimeType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,quality=arguments.length>2?arguments[2]:void 0;return new Promise((function(resolve,reject){return canvas.toBlob((function(result){result?resolve(result):reject(new Error("Couldn't convert the canvas to a Blob"))}),mimeType,quality)}))}},"./ts/util/canvasToBytes.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>canvasToBytes});var _canvasToBlob__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/canvasToBlob.ts");async function canvasToBytes(canvas,mimeType,quality){var blob=await(0,_canvasToBlob__WEBPACK_IMPORTED_MODULE_0__._)(canvas,mimeType,quality);return new Uint8Array(await blob.arrayBuffer())}},"./ts/util/getAnalogTime.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>getAnalogTime});var HOURS=[0,30,60,90,120,150,180,210,240,270,300,330];function getAnalogTime(){var _HOURS$hourIndex,date=new Date,minutesBy60=60/date.getMinutes(),minute=360/minutesBy60,hourIndex=date.getHours()%12;return{hour:(null!==(_HOURS$hourIndex=HOURS[hourIndex])&&void 0!==_HOURS$hourIndex?_HOURS$hourIndex:0)+30/minutesBy60,minute}}},"./ts/util/keyboard.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>arrow});var logicalArrows={start:{ltr:"ArrowLeft",rtl:"ArrowRight"},end:{ltr:"ArrowRight",rtl:"ArrowLeft"}};function arrow(logicalDirection){var localeDirection=window.getResolvedMessagesLocaleDirection();return logicalArrows[logicalDirection][localeDirection]}}}]);