/*! For license information please see BetterAvatar-stories.de3e6db6.iframe.bundle.js.LICENSE.txt */
(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[8799,3905],{"./ts/components/BetterAvatar.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GroupIcon:()=>GroupIcon,PersonalIcon:()=>PersonalIcon,Text:()=>Text,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var _storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),_locales_en_messages_json__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./_locales/en/messages.json"),_types_Colors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/types/Colors.ts"),_types_Avatar__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Avatar.ts"),_BetterAvatar__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/BetterAvatar.tsx"),_util_createAvatarData__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/util/createAvatarData.ts"),_util_setupI18n__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/setupI18n.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react/jsx-runtime.js"),i18n=(0,_util_setupI18n__WEBPACK_IMPORTED_MODULE_7__.E5)("en",_locales_en_messages_json__WEBPACK_IMPORTED_MODULE_2__),createProps=function(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{avatarData:overrideProps.avatarData||(0,_util_createAvatarData__WEBPACK_IMPORTED_MODULE_6__.s)({color:_types_Colors__WEBPACK_IMPORTED_MODULE_3__.sj[0],text:"OOO"}),i18n,isSelected:Boolean(overrideProps.isSelected),onClick:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("onClick"),onDelete:(0,_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("onDelete"),size:80}};const __WEBPACK_DEFAULT_EXPORT__={title:"Components/BetterAvatar"};function Text(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_BetterAvatar__WEBPACK_IMPORTED_MODULE_5__.Y,Object.assign({},createProps({avatarData:(0,_util_createAvatarData__WEBPACK_IMPORTED_MODULE_6__.s)({color:_types_Colors__WEBPACK_IMPORTED_MODULE_3__.sj[0],text:"AH"})})))}function PersonalIcon(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_BetterAvatar__WEBPACK_IMPORTED_MODULE_5__.Y,Object.assign({},createProps({avatarData:(0,_util_createAvatarData__WEBPACK_IMPORTED_MODULE_6__.s)({color:_types_Colors__WEBPACK_IMPORTED_MODULE_3__.sj[1],icon:_types_Avatar__WEBPACK_IMPORTED_MODULE_4__.jo[1]})})))}function GroupIcon(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_BetterAvatar__WEBPACK_IMPORTED_MODULE_5__.Y,Object.assign({},createProps({avatarData:(0,_util_createAvatarData__WEBPACK_IMPORTED_MODULE_6__.s)({color:_types_Colors__WEBPACK_IMPORTED_MODULE_3__.sj[1],icon:_types_Avatar__WEBPACK_IMPORTED_MODULE_4__.SR[1]})})))}Text.displayName="Text",PersonalIcon.displayName="PersonalIcon",GroupIcon.displayName="GroupIcon";var __namedExportsOrder=["Text","PersonalIcon","GroupIcon"]},"./ts/components/BetterAvatar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Y:()=>BetterAvatar});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/BetterAvatarBubble.tsx"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/avatarDataToBytes.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function BetterAvatar(_ref){var avatarData=_ref.avatarData,i18n=_ref.i18n,isSelected=_ref.isSelected,onClick=_ref.onClick,onDelete=_ref.onDelete,_ref$size=_ref.size,size=void 0===_ref$size?48:_ref$size,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(avatarData.buffer),2),avatarBuffer=_useState2[0],setAvatarBuffer=_useState2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),2),avatarURL=_useState4[0],setAvatarURL=_useState4[1];(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){var shouldCancel=!1;return avatarBuffer?lodash_noop__WEBPACK_IMPORTED_MODULE_0___default():(async function makeAvatar(){var buffer=await(0,_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_4__.u)(avatarData);shouldCancel||setAvatarBuffer(buffer)}(),function(){shouldCancel=!0})}),[avatarBuffer,avatarData]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){if(avatarBuffer){var url=URL.createObjectURL(new Blob([avatarBuffer]));setAvatarURL(url)}}),[avatarBuffer]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){return function(){avatarURL&&URL.revokeObjectURL(avatarURL)}}),[avatarURL]);var isEditable=Boolean(avatarData.color),handleDelete=avatarData.icon?void 0:function(ev){ev.preventDefault(),ev.stopPropagation(),onDelete()};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_2__.p,{i18n,isSelected,onDelete:handleDelete,onSelect:function(){onClick(avatarBuffer)},style:{backgroundImage:avatarURL?`url(${avatarURL})`:void 0,backgroundSize:size,height:size+8,width:size+8},children:[isEditable&&isSelected&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"BetterAvatarBubble--editable"}),!avatarURL&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-Avatar__spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{size:size-8+"px",svgSize:"small",direction:"on-avatar"})})]})}BetterAvatar.displayName="BetterAvatar"},"./ts/components/BetterAvatarBubble.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{p:()=>BetterAvatarBubble});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function BetterAvatarBubble(_ref){var children=_ref.children,color=_ref.color,i18n=_ref.i18n,isSelected=_ref.isSelected,onDelete=_ref.onDelete,onSelect=_ref.onSelect,style=_ref.style;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()({BetterAvatarBubble:!0,"BetterAvatarBubble--selected":isSelected},color&&`BetterAvatarBubble--${color}`),onKeyDown:function(ev){"Enter"===ev.key&&onSelect()},onClick:onSelect,role:"button",style,tabIndex:0,children:[onDelete&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("button",{"aria-label":i18n("icu:delete"),className:"BetterAvatarBubble__delete",onClick:onDelete,tabIndex:-1,type:"button"}),children]})}BetterAvatarBubble.displayName="BetterAvatarBubble"},"./ts/util/avatarDataToBytes.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{u:()=>avatarDataToBytes});var _types_Colors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/Colors.ts"),_canvasToBytes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/canvasToBytes.ts"),_avatarTextSizeCalculator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/avatarTextSizeCalculator.ts");function getAvatarColor(color){return _types_Colors__WEBPACK_IMPORTED_MODULE_0__.nE.get(color)||{bg:"black",fg:"white"}}function setCanvasBackground(bg,context,canvas){context.fillStyle=bg,context.fillRect(0,0,canvas.width,canvas.height)}async function drawImage(src,context,canvas){var image=new Image;image.src=src,await image.decode(),canvas.width=image.width,canvas.height=image.height,context.drawImage(image,0,0)}async function avatarDataToBytes(avatarData){var canvas=document.createElement("canvas");canvas.width=1024,canvas.height=1024;var context=canvas.getContext("2d");if(!context)throw new Error("avatarDataToBytes: could not get canvas rendering context");var _window$Signal,color=avatarData.color,icon=avatarData.icon,imagePath=avatarData.imagePath,text=avatarData.text;if(imagePath)await drawImage(null!==(_window$Signal=window.Signal)&&void 0!==_window$Signal&&_window$Signal.Migrations?window.Signal.Migrations.getAbsoluteAvatarPath(imagePath):imagePath,context,canvas);else if(color&&text){var _getAvatarColor=getAvatarColor(color),bg=_getAvatarColor.bg,fg=_getAvatarColor.fg,textToWrite=text.toLocaleUpperCase();setCanvasBackground(bg,context,canvas),context.fillStyle=fg;var font=await async function getFont(text){var font=new window.FontFace("Inter",'url("fonts/inter-v3.19/Inter-Regular.woff2")');await font.load();var measurerCanvas=document.createElement("canvas");measurerCanvas.width=1024,measurerCanvas.height=1024;var measurerContext=measurerCanvas.getContext("2d");if(!measurerContext)throw new Error("getFont: could not get canvas rendering context");return`${(0,_avatarTextSizeCalculator__WEBPACK_IMPORTED_MODULE_2__.Z)(1024,text,(function(candidateFontSize){var candidateFont=`${candidateFontSize}px Inter`;measurerContext.font=candidateFont;var _measurerContext$meas=measurerContext.measureText(text),actualBoundingBoxLeft=_measurerContext$meas.actualBoundingBoxLeft,actualBoundingBoxRight=_measurerContext$meas.actualBoundingBoxRight,actualBoundingBoxAscent=_measurerContext$meas.actualBoundingBoxAscent,actualBoundingBoxDescent=_measurerContext$meas.actualBoundingBoxDescent,width=Math.abs(actualBoundingBoxLeft)+Math.abs(actualBoundingBoxRight);return{height:Math.abs(actualBoundingBoxAscent)+Math.abs(actualBoundingBoxDescent),width}}))}px Inter`}(textToWrite);context.font=font,context.textBaseline="middle",context.textAlign="center",context.fillText(textToWrite,512,542)}else if(color&&icon){var iconPath=`images/avatars/avatar_${icon}.svg`;await drawImage(iconPath,context,canvas),context.globalCompositeOperation="destination-over",setCanvasBackground(getAvatarColor(color).bg,context,canvas)}return(0,_canvasToBytes__WEBPACK_IMPORTED_MODULE_1__.E)(canvas)}},"./ts/util/avatarTextSizeCalculator.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$:()=>getFontSizes,Z:()=>getFittedFontSize});var _components_emoji_lib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/components/emoji/lib.ts");function getFontSizes(bubbleSize){return{diameter:Math.ceil(.75*bubbleSize),singleEmoji:Math.ceil(.6*bubbleSize),smol:Math.ceil(.05*bubbleSize),text:Math.ceil(.45*bubbleSize)}}function getFittedFontSize(bubbleSize,text,measure){var sizes=getFontSizes(bubbleSize),candidateFontSize=sizes.text;for((0,_components_emoji_lib__WEBPACK_IMPORTED_MODULE_0__.Mz)(text)||1!==(0,_components_emoji_lib__WEBPACK_IMPORTED_MODULE_0__.J7)(text)||(candidateFontSize=sizes.singleEmoji);candidateFontSize>=sizes.smol;candidateFontSize-=1){var _measure=measure(candidateFontSize),height=_measure.height;if(_measure.width<sizes.diameter&&height<sizes.diameter)return candidateFontSize}return candidateFontSize}},"./ts/util/canvasToBlob.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_:()=>canvasToBlob});var _types_MIME__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/MIME.ts");async function canvasToBlob(canvas){var mimeType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,quality=arguments.length>2?arguments[2]:void 0;return new Promise((function(resolve,reject){return canvas.toBlob((function(result){result?resolve(result):reject(new Error("Couldn't convert the canvas to a Blob"))}),mimeType,quality)}))}},"./ts/util/canvasToBytes.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>canvasToBytes});var _canvasToBlob__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/canvasToBlob.ts");async function canvasToBytes(canvas,mimeType,quality){var blob=await(0,_canvasToBlob__WEBPACK_IMPORTED_MODULE_0__._)(canvas,mimeType,quality);return new Uint8Array(await blob.arrayBuffer())}},"./ts/util/createAvatarData.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{s:()=>createAvatarData});var uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/uuid-browser/index.js");function createAvatarData(partialAvatarData){return Object.assign({id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.v4)()},partialAvatarData)}},"./ts/util/getClassNamesFor.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>getClassNamesFor});var classnames__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_0__);function getClassNamesFor(){for(var _len=arguments.length,modules=new Array(_len),_key=0;_key<_len;_key++)modules[_key]=arguments[_key];return function(modifier){if(void 0===modifier)return"";var cx=modules.flatMap((function(m){return m?m.split(" "):void 0})).map((function(parentModule){return parentModule?`${parentModule}${modifier}`:void 0}));return classnames__WEBPACK_IMPORTED_MODULE_0___default()(cx)}}},"./node_modules/classnames/index.js":(module,exports)=>{var __WEBPACK_AMD_DEFINE_RESULT__;!function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg))classes.push(classNames.apply(null,arg));else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}return classes.join(" ")}module.exports?module.exports=classNames:void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}}]);