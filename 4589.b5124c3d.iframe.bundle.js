"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[4589],{"./ts/calling/useGetCallingFrameBuffer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>useGetCallingFrameBuffer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/calling/constants.ts");function useGetCallingFrameBuffer(){var ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){return ref.current||(ref.current=Buffer.alloc(_constants__WEBPACK_IMPORTED_MODULE_1__.Iu)),ref.current}),[])}},"./ts/components/CallScreen.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>CallScreen});var setUtil_namespaceObject={};__webpack_require__.r(setUtil_namespaceObject),__webpack_require__.d(setUtil_namespaceObject,{isEqual:()=>isEqual,remove:()=>remove,toggle:()=>toggle});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),CallingHeader=__webpack_require__("./ts/components/CallingHeader.tsx"),CallingPreCallInfo=__webpack_require__("./ts/components/CallingPreCallInfo.tsx"),CallingButton=__webpack_require__("./ts/components/CallingButton.tsx"),CallBackgroundBlur=__webpack_require__("./ts/components/CallBackgroundBlur.tsx"),Calling=__webpack_require__("./ts/types/Calling.ts"),Colors=__webpack_require__("./ts/types/Colors.ts"),clearTimeoutIfNecessary=__webpack_require__("./ts/util/clearTimeoutIfNecessary.ts"),CallingToast=__webpack_require__("./ts/components/CallingToast.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ME=Symbol("me");function getCurrentPresenter(activeCall){return activeCall.presentingSource?ME:activeCall.callMode===Calling.L6.Direct?activeCall.remoteParticipants.some((function(participant){return participant.presenting}))?activeCall.conversation:void 0:activeCall.callMode===Calling.L6.Group?activeCall.remoteParticipants.find((function(participant){return participant.presenting})):void 0}function CallingToastManager(props){var _toast2,toast,reconnectingToast=function getReconnectingToast(_ref){var activeCall=_ref.activeCall,i18n=_ref.i18n;if(activeCall.callMode===Calling.L6.Group&&activeCall.connectionState===Calling.mB.Reconnecting)return{message:i18n("icu:callReconnecting"),type:"static"}}(props),screenSharingToast=function useScreenSharingToast(_ref2){var activeCall=_ref2.activeCall,i18n=_ref2.i18n,_useState2=_slicedToArray((0,react.useState)(void 0),2),result=_useState2[0],setResult=_useState2[1],_useState4=_slicedToArray((0,react.useState)(void 0),2),previousPresenter=_useState4[0],setPreviousPresenter=_useState4[1],previousPresenterId=null==previousPresenter?void 0:previousPresenter.id,previousPresenterTitle=null==previousPresenter?void 0:previousPresenter.title;return(0,react.useEffect)((function(){!getCurrentPresenter(activeCall)&&previousPresenterId&&(previousPresenterId===ME?setResult({type:"dismissable",message:i18n("icu:calling__presenting--you-stopped")}):previousPresenterTitle&&setResult({type:"dismissable",message:i18n("icu:calling__presenting--person-stopped",{name:previousPresenterTitle})}))}),[activeCall,i18n,previousPresenterId,previousPresenterTitle]),(0,react.useEffect)((function(){var currentPresenter=getCurrentPresenter(activeCall);if(currentPresenter===ME)setPreviousPresenter({id:ME});else if(currentPresenter){var id=currentPresenter.id,title=currentPresenter.title;setPreviousPresenter({id,title})}else setPreviousPresenter(void 0)}),[activeCall]),result}(props);reconnectingToast?toast=reconnectingToast:screenSharingToast&&(toast=screenSharingToast);var _useState6=_slicedToArray((0,react.useState)(!1),2),isVisible=_useState6[0],setIsVisible=_useState6[1],timeoutRef=(0,react.useRef)(null),dismissToast=(0,react.useCallback)((function(){timeoutRef&&setIsVisible(!1)}),[setIsVisible,timeoutRef]);return(0,react.useEffect)((function(){setIsVisible(void 0!==toast)}),[toast]),(0,react.useEffect)((function(){var _toast;return"dismissable"===(null===(_toast=toast)||void 0===_toast?void 0:_toast.type)&&((0,clearTimeoutIfNecessary.S)(timeoutRef.current),timeoutRef.current=setTimeout(dismissToast,CallingToast.q)),function(){(0,clearTimeoutIfNecessary.S)(timeoutRef.current)}}),[dismissToast,setIsVisible,timeoutRef,toast]),(0,jsx_runtime.jsx)(CallingToast.o,{isVisible,onClick:dismissToast,children:null===(_toast2=toast)||void 0===_toast2?void 0:_toast2.message})}CallingToastManager.displayName="CallingToastManager";var DirectCallRemoteParticipant=__webpack_require__("./ts/components/DirectCallRemoteParticipant.tsx"),flatten=__webpack_require__("./node_modules/lodash/flatten.js"),flatten_default=__webpack_require__.n(flatten),maxBy=__webpack_require__("./node_modules/lodash/maxBy.js"),maxBy_default=__webpack_require__.n(maxBy),chunk=__webpack_require__("./node_modules/lodash/chunk.js"),chunk_default=__webpack_require__.n(chunk),clamp=__webpack_require__("./node_modules/lodash/clamp.js"),clamp_default=__webpack_require__.n(clamp),takeWhile=__webpack_require__("./node_modules/lodash/takeWhile.js"),takeWhile_default=__webpack_require__.n(takeWhile),index_esm=__webpack_require__("./node_modules/react-measure/dist/index.esm.js"),GroupCallRemoteParticipant=__webpack_require__("./ts/components/GroupCallRemoteParticipant.tsx"),GroupCallOverflowArea=__webpack_require__("./ts/components/GroupCallOverflowArea.tsx"),useGetCallingFrameBuffer=__webpack_require__("./ts/calling/useGetCallingFrameBuffer.ts"),usePageVisibility=__webpack_require__("./ts/hooks/usePageVisibility.ts");function useDevicePixelRatio_slicedToArray(arr,i){return function useDevicePixelRatio_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useDevicePixelRatio_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useDevicePixelRatio_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useDevicePixelRatio_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useDevicePixelRatio_arrayLikeToArray(o,minLen)}(arr,i)||function useDevicePixelRatio_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useDevicePixelRatio_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var nonRenderedRemoteParticipant=__webpack_require__("./ts/util/ringrtc/nonRenderedRemoteParticipant.ts"),missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts"),durations=__webpack_require__("./ts/util/durations/index.ts"),iterables=__webpack_require__("./ts/util/iterables.ts"),add=function(set,item){return new Set(set).add(item)},remove=function(set){for(var clone=new Set(set),_len=arguments.length,items=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)items[_key-1]=arguments[_key];for(var _i=0,_items=items;_i<_items.length;_i++){var item=_items[_i];clone.delete(item)}return clone},toggle=function(set,item,shouldInclude){return(shouldInclude?add:remove)(set,item)},isEqual=function(a,b){return a===b||a.size===b.size&&(0,iterables.yW)(a,(function(item){return b.has(item)}))},log=__webpack_require__("./ts/logging/log.ts"),constants=__webpack_require__("./ts/calling/constants.ts");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return GroupCallRemoteParticipants_arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||GroupCallRemoteParticipants_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GroupCallRemoteParticipants_slicedToArray(arr,i){return function GroupCallRemoteParticipants_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function GroupCallRemoteParticipants_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||GroupCallRemoteParticipants_unsupportedIterableToArray(arr,i)||function GroupCallRemoteParticipants_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GroupCallRemoteParticipants_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return GroupCallRemoteParticipants_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?GroupCallRemoteParticipants_arrayLikeToArray(o,minLen):void 0}}function GroupCallRemoteParticipants_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var VideoRequestMode,TIME_TO_STOP_REQUESTING_VIDEO_WHEN_PAGE_INVISIBLE=20*durations.sh;function GroupCallRemoteParticipants(_ref){var getGroupCallVideoFrameSource=_ref.getGroupCallVideoFrameSource,i18n=_ref.i18n,isInSpeakerView=_ref.isInSpeakerView,remoteParticipants=_ref.remoteParticipants,setGroupCallVideoRequest=_ref.setGroupCallVideoRequest,remoteAudioLevels=_ref.remoteAudioLevels,_useState2=GroupCallRemoteParticipants_slicedToArray((0,react.useState)({width:0,height:0}),2),containerDimensions=_useState2[0],setContainerDimensions=_useState2[1],_useState4=GroupCallRemoteParticipants_slicedToArray((0,react.useState)({width:0,height:0}),2),gridDimensions=_useState4[0],setGridDimensions=_useState4[1],devicePixelRatio=function useDevicePixelRatio(){var _useState2=useDevicePixelRatio_slicedToArray((0,react.useState)(window.devicePixelRatio),2),result=_useState2[0],setResult=_useState2[1];return(0,react.useEffect)((function(){var update=function(){setResult(window.devicePixelRatio)};update();var mediaQuery=window.matchMedia(`screen and (resolution: ${result}dppx)`);return mediaQuery.addEventListener("change",update),function(){mediaQuery.removeEventListener("change",update)}}),[result]),result}(),getFrameBuffer=(0,useGetCallingFrameBuffer.b)(),_useInvisibleParticip=function useInvisibleParticipants(remoteParticipants){var _useState6=GroupCallRemoteParticipants_slicedToArray((0,react.useState)(new Set),2),invisibleDemuxIds=_useState6[0],setInvisibleDemuxIds=_useState6[1],onParticipantVisibilityChanged=(0,react.useCallback)((function(demuxId,isVisible){setInvisibleDemuxIds((function(oldInvisibleDemuxIds){return pickDifferentSet(oldInvisibleDemuxIds,toggle(oldInvisibleDemuxIds,demuxId,!isVisible))}))}),[]);return(0,react.useEffect)((function(){log.info(`Invisible demux IDs changed to [${(0,iterables.v_)(invisibleDemuxIds,",")}]`)}),[invisibleDemuxIds]),(0,react.useEffect)((function(){var remoteParticipantDemuxIds=new Set(remoteParticipants.map((function(r){return r.demuxId})));setInvisibleDemuxIds((function(oldInvisibleDemuxIds){var staleIds=(0,iterables.hX)(oldInvisibleDemuxIds,(function(id){return!remoteParticipantDemuxIds.has(id)})),withoutStaleIds=remove.apply(setUtil_namespaceObject,[oldInvisibleDemuxIds].concat(_toConsumableArray(staleIds)));return pickDifferentSet(oldInvisibleDemuxIds,withoutStaleIds)}))}),[remoteParticipants]),{invisibleDemuxIds,onParticipantVisibilityChanged}}(remoteParticipants),invisibleDemuxIds=_useInvisibleParticip.invisibleDemuxIds,onParticipantVisibilityChanged=_useInvisibleParticip.onParticipantVisibilityChanged,maxRowCount=Math.min(remoteParticipants.length,Math.floor(containerDimensions.height/190)),sortedParticipants=(0,react.useMemo)((function(){return remoteParticipants.concat().sort((function(a,b){return Number(b.presenting||0)-Number(a.presenting||0)||(b.speakerTime||-1/0)-(a.speakerTime||-1/0)}))}),[remoteParticipants]),gridParticipants=(0,react.useMemo)((function(){if(!sortedParticipants.length)return[];var candidateParticipants=isInSpeakerView?[sortedParticipants[0]]:sortedParticipants,maxTotalWidth=maxRowCount*containerDimensions.width,totalWidth=0;return takeWhile_default()(candidateParticipants,(function(remoteParticipant){return(totalWidth+=180*remoteParticipant.videoAspectRatio)<maxTotalWidth})).sort(stableParticipantComparator)}),[containerDimensions.width,isInSpeakerView,maxRowCount,sortedParticipants]),overflowedParticipants=(0,react.useMemo)((function(){return sortedParticipants.slice(gridParticipants.length).sort(stableParticipantComparator)}),[sortedParticipants,gridParticipants.length]),gridArrangement=(0,react.useMemo)((function(){var bestArrangement={scalar:-1,rows:[]};if(!gridParticipants.length)return bestArrangement;for(var rowCount=1;rowCount<=maxRowCount;rowCount+=1){var numberOfParticipantsInRow=Math.ceil(gridParticipants.length/rowCount),rows=chunk_default()(gridParticipants,numberOfParticipantsInRow),widestRow=maxBy_default()(rows,totalRemoteParticipantWidthAtMinHeight);if(widestRow){var widthScalar=(gridDimensions.width-10*(widestRow.length+1))/totalRemoteParticipantWidthAtMinHeight(widestRow),heightScalar=(gridDimensions.height-10*(rowCount+1))/(180*rowCount),scalar=Math.min(widthScalar,heightScalar);scalar>bestArrangement.scalar&&(bestArrangement={scalar,rows})}else log.error("Unable to find the widest row, which should be impossible")}return bestArrangement}),[gridParticipants,maxRowCount,gridDimensions.width,gridDimensions.height]),gridParticipantHeight=Math.floor(180*gridArrangement.scalar),gridParticipantHeightWithMargin=gridParticipantHeight+10,gridTotalRowHeightWithMargin=gridParticipantHeightWithMargin*gridArrangement.rows.length,gridTopOffset=Math.floor((gridDimensions.height-gridTotalRowHeightWithMargin)/2),rowElements=gridArrangement.rows.map((function(remoteParticipantsInRow,index){var top=gridTopOffset+index*gridParticipantHeightWithMargin,totalRowWidth=totalRemoteParticipantWidthAtMinHeight(remoteParticipantsInRow)*gridArrangement.scalar+10*(remoteParticipantsInRow.length-1),leftOffset=Math.floor((gridDimensions.width-totalRowWidth)/2),rowWidthSoFar=0;return remoteParticipantsInRow.map((function(remoteParticipant){var _remoteAudioLevels$ge,demuxId=remoteParticipant.demuxId,videoAspectRatio=remoteParticipant.videoAspectRatio,audioLevel=null!==(_remoteAudioLevels$ge=remoteAudioLevels.get(demuxId))&&void 0!==_remoteAudioLevels$ge?_remoteAudioLevels$ge:0,renderedWidth=Math.floor(videoAspectRatio*gridParticipantHeight),left=rowWidthSoFar+leftOffset;return rowWidthSoFar+=renderedWidth+10,(0,jsx_runtime.jsx)(GroupCallRemoteParticipant.B,{getFrameBuffer,getGroupCallVideoFrameSource,height:gridParticipantHeight,i18n,audioLevel,left,remoteParticipant,top,width:renderedWidth,remoteParticipantsCount:remoteParticipants.length,isActiveSpeakerInSpeakerView:isInSpeakerView},demuxId)}))})),videoRequestMode=function useVideoRequestMode(){var isPageVisible=(0,usePageVisibility.d)(),_useState8=GroupCallRemoteParticipants_slicedToArray((0,react.useState)(isPageVisible?VideoRequestMode.Normal:VideoRequestMode.LowResolution),2),result=_useState8[0],setResult=_useState8[1];return(0,react.useEffect)((function(){if(isPageVisible)return setResult(VideoRequestMode.Normal),noop_default();setResult(VideoRequestMode.LowResolution);var timeout=setTimeout((function(){setResult(VideoRequestMode.NoVideo)}),TIME_TO_STOP_REQUESTING_VIDEO_WHEN_PAGE_INVISIBLE);return function(){clearTimeout(timeout)}}),[isPageVisible]),result}();return(0,react.useEffect)((function(){log.info(`Group call now using ${videoRequestMode} video request mode`)}),[videoRequestMode]),(0,react.useEffect)((function(){var videoRequest;switch(videoRequestMode){case VideoRequestMode.Normal:videoRequest=[].concat(_toConsumableArray(gridParticipants.map((function(participant){var scalar;return scalar=participant.sharingScreen?Math.max(devicePixelRatio,1):.75,{demuxId:participant.demuxId,width:clamp_default()(Math.floor(gridParticipantHeight*participant.videoAspectRatio*scalar),1,constants.up),height:clamp_default()(Math.floor(gridParticipantHeight*scalar),1,constants.Kd)}}))),_toConsumableArray(overflowedParticipants.map((function(participant){return invisibleDemuxIds.has(participant.demuxId)?(0,nonRenderedRemoteParticipant.M)(participant):{demuxId:participant.demuxId,width:clamp_default()(Math.floor(.75*GroupCallOverflowArea.h),1,constants.up),height:clamp_default()(Math.floor(GroupCallOverflowArea.h/participant.videoAspectRatio*.75),1,constants.Kd)}}))));break;case VideoRequestMode.LowResolution:videoRequest=remoteParticipants.map((function(participant){return participant.hasRemoteVideo?{demuxId:participant.demuxId,width:1,height:1}:(0,nonRenderedRemoteParticipant.M)(participant)}));break;case VideoRequestMode.NoVideo:videoRequest=remoteParticipants.map(nonRenderedRemoteParticipant.M);break;default:log.error((0,missingCaseError.b)(videoRequestMode)),videoRequest=remoteParticipants.map(nonRenderedRemoteParticipant.M)}setGroupCallVideoRequest(videoRequest,clamp_default()(gridParticipantHeight,0,constants.Kd))}),[devicePixelRatio,gridParticipantHeight,gridParticipants,invisibleDemuxIds,overflowedParticipants,remoteParticipants,setGroupCallVideoRequest,videoRequestMode]),(0,jsx_runtime.jsx)(index_esm.Z,{bounds:!0,onResize:function(_ref2){var bounds=_ref2.bounds;bounds?setContainerDimensions(bounds):log.error("We should be measuring the bounds")},children:function(containerMeasure){return(0,jsx_runtime.jsxs)("div",{className:"module-ongoing-call__participants",ref:containerMeasure.measureRef,children:[(0,jsx_runtime.jsx)(index_esm.Z,{bounds:!0,onResize:function(_ref3){var bounds=_ref3.bounds;bounds?setGridDimensions(bounds):log.error("We should be measuring the bounds")},children:function(gridMeasure){return(0,jsx_runtime.jsx)("div",{className:"module-ongoing-call__participants__grid",ref:gridMeasure.measureRef,children:flatten_default()(rowElements)})}}),(0,jsx_runtime.jsx)(GroupCallOverflowArea.P,{getFrameBuffer,getGroupCallVideoFrameSource,i18n,onParticipantVisibilityChanged,overflowedParticipants,remoteAudioLevels,remoteParticipantsCount:remoteParticipants.length})]})}})}function pickDifferentSet(a,b){return a.size===b.size?a:b}function totalRemoteParticipantWidthAtMinHeight(remoteParticipants){return remoteParticipants.reduce((function(result,_ref4){return result+180*_ref4.videoAspectRatio}),0)}function stableParticipantComparator(a,b){return a.demuxId-b.demuxId}!function(VideoRequestMode){VideoRequestMode.Normal="Normal",VideoRequestMode.LowResolution="LowResolution",VideoRequestMode.NoVideo="NoVideo"}(VideoRequestMode||(VideoRequestMode={})),GroupCallRemoteParticipants.displayName="GroupCallRemoteParticipants";var theme=__webpack_require__("./ts/util/theme.ts"),Modal=__webpack_require__("./ts/components/Modal.tsx"),Button=__webpack_require__("./ts/components/Button.tsx");function focusRef(el){el&&el.focus()}function NeedsScreenRecordingPermissionsModal(_ref){var i18n=_ref.i18n,openSystemPreferencesAction=_ref.openSystemPreferencesAction,toggleScreenRecordingPermissionsDialog=_ref.toggleScreenRecordingPermissionsDialog,footer=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Button.zx,{onClick:toggleScreenRecordingPermissionsDialog,ref:focusRef,variant:Button.Wu.Secondary,children:i18n("icu:calling__presenting--permission-cancel")}),(0,jsx_runtime.jsx)(Button.zx,{onClick:function(){openSystemPreferencesAction(),toggleScreenRecordingPermissionsDialog()},variant:Button.Wu.Primary,children:i18n("icu:calling__presenting--permission-open")})]});return(0,jsx_runtime.jsxs)(Modal.u_,{modalName:"NeedsScreenRecordingPermissionsModal",i18n,title:i18n("icu:calling__presenting--permission-title"),theme:theme.Q.Dark,onClose:toggleScreenRecordingPermissionsDialog,modalFooter:footer,children:[(0,jsx_runtime.jsx)("p",{children:i18n("icu:calling__presenting--macos-permission-description")}),(0,jsx_runtime.jsxs)("ol",{style:{paddingLeft:16},children:[(0,jsx_runtime.jsx)("li",{children:i18n("icu:calling__presenting--permission-instruction-step1")}),(0,jsx_runtime.jsx)("li",{children:i18n("icu:calling__presenting--permission-instruction-step2")}),(0,jsx_runtime.jsx)("li",{children:i18n("icu:calling__presenting--permission-instruction-step3")})]})]})}NeedsScreenRecordingPermissionsModal.displayName="NeedsScreenRecordingPermissionsModal";var keyboardLayout=__webpack_require__("./ts/services/keyboardLayout.ts"),useActivateSpeakerViewOnPresenting=__webpack_require__("./ts/hooks/useActivateSpeakerViewOnPresenting.ts"),CallingAudioIndicator=__webpack_require__("./ts/components/CallingAudioIndicator.tsx"),useKeyboardShortcuts=__webpack_require__("./ts/hooks/useKeyboardShortcuts.tsx"),useValueAtFixedRate=__webpack_require__("./ts/hooks/useValueAtFixedRate.ts");function CallScreen_slicedToArray(arr,i){return function CallScreen_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function CallScreen_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function CallScreen_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return CallScreen_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CallScreen_arrayLikeToArray(o,minLen)}(arr,i)||function CallScreen_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CallScreen_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var isInSpeakerView=function(call){return Boolean((null==call?void 0:call.viewMode)===Calling.pC.Presentation||(null==call?void 0:call.viewMode)===Calling.pC.Speaker)};function DirectCallHeaderMessage(_ref){var callState=_ref.callState,i18n=_ref.i18n,joinedAt=_ref.joinedAt,_useState2=CallScreen_slicedToArray((0,react.useState)(),2),acceptedDuration=_useState2[0],setAcceptedDuration=_useState2[1];return(0,react.useEffect)((function(){if(!joinedAt)return noop_default();var interval=setInterval((function(){setAcceptedDuration(Date.now()-joinedAt)}),100);return clearInterval.bind(null,interval)}),[joinedAt]),callState===Calling.OX.Reconnecting?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:i18n("icu:callReconnecting")}):callState===Calling.OX.Accepted&&acceptedDuration?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:i18n("icu:callDuration",{duration:renderDuration(acceptedDuration)})}):null}function CallScreen(_ref2){var activeCall=_ref2.activeCall,getGroupCallVideoFrameSource=_ref2.getGroupCallVideoFrameSource,getPresentingSources=_ref2.getPresentingSources,groupMembers=_ref2.groupMembers,hangUpActiveCall=_ref2.hangUpActiveCall,i18n=_ref2.i18n,joinedAt=_ref2.joinedAt,me=_ref2.me,openSystemPreferencesAction=_ref2.openSystemPreferencesAction,setGroupCallVideoRequest=_ref2.setGroupCallVideoRequest,setLocalAudio=_ref2.setLocalAudio,setLocalVideo=_ref2.setLocalVideo,setLocalPreview=_ref2.setLocalPreview,setPresenting=_ref2.setPresenting,setRendererCanvas=_ref2.setRendererCanvas,stickyControls=_ref2.stickyControls,switchToPresentationView=_ref2.switchToPresentationView,switchFromPresentationView=_ref2.switchFromPresentationView,toggleParticipants=_ref2.toggleParticipants,togglePip=_ref2.togglePip,toggleScreenRecordingPermissionsDialog=_ref2.toggleScreenRecordingPermissionsDialog,toggleSettings=_ref2.toggleSettings,toggleSpeakerView=_ref2.toggleSpeakerView,conversation=activeCall.conversation,hasLocalAudio=activeCall.hasLocalAudio,hasLocalVideo=activeCall.hasLocalVideo,localAudioLevel=activeCall.localAudioLevel,presentingSource=activeCall.presentingSource,remoteParticipants=activeCall.remoteParticipants,showNeedsScreenRecordingPermissionsWarning=activeCall.showNeedsScreenRecordingPermissionsWarning,showParticipantsList=activeCall.showParticipantsList,isSpeaking=(0,useValueAtFixedRate.L)(localAudioLevel>0,CallingAudioIndicator.E);(0,useActivateSpeakerViewOnPresenting.G)({remoteParticipants,switchToPresentationView,switchFromPresentationView});var activeCallShortcuts=(0,useKeyboardShortcuts.Al)(hangUpActiveCall);(0,useKeyboardShortcuts.aL)(activeCallShortcuts);var toggleAudio=(0,react.useCallback)((function(){setLocalAudio({enabled:!hasLocalAudio})}),[setLocalAudio,hasLocalAudio]),toggleVideo=(0,react.useCallback)((function(){setLocalVideo({enabled:!hasLocalVideo})}),[setLocalVideo,hasLocalVideo]),togglePresenting=(0,react.useCallback)((function(){presentingSource?setPresenting():getPresentingSources()}),[getPresentingSources,presentingSource,setPresenting]),hangUp=(0,react.useCallback)((function(){hangUpActiveCall("button click")}),[hangUpActiveCall]),_useState4=CallScreen_slicedToArray((0,react.useState)(!1),2),controlsHover=_useState4[0],setControlsHover=_useState4[1],onControlsMouseEnter=(0,react.useCallback)((function(){setControlsHover(!0)}),[setControlsHover]),onControlsMouseLeave=(0,react.useCallback)((function(){setControlsHover(!1)}),[setControlsHover]),_useState6=CallScreen_slicedToArray((0,react.useState)(!0),2),showControls=_useState6[0],setShowControls=_useState6[1],localVideoRef=(0,react.useRef)(null);(0,react.useEffect)((function(){return setLocalPreview({element:localVideoRef}),function(){setLocalPreview({element:void 0})}}),[setLocalPreview,setRendererCanvas]),(0,react.useEffect)((function(){if(!showControls||stickyControls||controlsHover)return noop_default();var timer=setTimeout((function(){setShowControls(!1)}),5e3);return clearTimeout.bind(null,timer)}),[showControls,stickyControls,controlsHover]),(0,react.useEffect)((function(){var handleKeyDown=function(event){var eventHandled=!1,key=keyboardLayout.P(event);!event.shiftKey||"V"!==key&&"v"!==key?!event.shiftKey||"M"!==key&&"m"!==key||(toggleAudio(),eventHandled=!0):(toggleVideo(),eventHandled=!0),eventHandled&&(event.preventDefault(),event.stopPropagation(),setShowControls(!0))};return document.addEventListener("keydown",handleKeyDown),function(){document.removeEventListener("keydown",handleKeyDown)}}),[toggleAudio,toggleVideo]);var isRinging,hasCallStarted,headerMessage,headerTitle,isConnected,participantCount,remoteParticipantsElement,lonelyInGroupNode,localPreviewNode,videoButtonType,currentPresenter=remoteParticipants.find((function(participant){return participant.presenting})),hasRemoteVideo=remoteParticipants.some((function(remoteParticipant){return remoteParticipant.hasRemoteVideo})),isSendingVideo=hasLocalVideo||presentingSource;switch(activeCall.callMode){case Calling.L6.Direct:hasCallStarted=!(isRinging=activeCall.callState===Calling.OX.Prering||activeCall.callState===Calling.OX.Ringing),headerMessage=(0,jsx_runtime.jsx)(DirectCallHeaderMessage,{i18n,callState:activeCall.callState||Calling.OX.Prering,joinedAt}),headerTitle=isRinging?void 0:conversation.title,participantCount=(isConnected=activeCall.callState===Calling.OX.Accepted)?2:0,remoteParticipantsElement=hasCallStarted?(0,jsx_runtime.jsx)(DirectCallRemoteParticipant.e,{conversation,hasRemoteVideo,i18n,setRendererCanvas}):(0,jsx_runtime.jsx)("div",{className:"module-ongoing-call__direct-call-ringing-spacer"});break;case Calling.L6.Group:isRinging=activeCall.outgoingRing&&!activeCall.remoteParticipants.length&&!(1===(null==groupMembers?void 0:groupMembers.length)&&groupMembers[0].id===me.id),hasCallStarted=activeCall.joinState!==Calling.GT.NotJoined,participantCount=activeCall.remoteParticipants.length+1,isRinging?headerTitle=void 0:currentPresenter?headerTitle=i18n("icu:calling__presenting--person-ongoing",{name:currentPresenter.title}):activeCall.remoteParticipants.length||(headerTitle=i18n("icu:calling__in-this-call--zero")),isConnected=activeCall.connectionState===Calling.mB.Connected,remoteParticipantsElement=(0,jsx_runtime.jsx)(GroupCallRemoteParticipants,{getGroupCallVideoFrameSource,i18n,isInSpeakerView:isInSpeakerView(activeCall),remoteParticipants:activeCall.remoteParticipants,setGroupCallVideoRequest,remoteAudioLevels:activeCall.remoteAudioLevels});break;default:throw(0,missingCaseError.b)(activeCall)}activeCall.callMode!==Calling.L6.Group||activeCall.remoteParticipants.length?localPreviewNode=isSendingVideo?(0,jsx_runtime.jsx)("video",{className:classnames_default()("module-ongoing-call__footer__local-preview__video",presentingSource&&"module-ongoing-call__footer__local-preview__video--presenting"),ref:localVideoRef,autoPlay:!0}):(0,jsx_runtime.jsx)(CallBackgroundBlur.L,{avatarPath:me.avatarPath,color:me.color,children:(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest:!0,avatarPath:me.avatarPath,badge:void 0,color:me.color||Colors.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe:!0,phoneNumber:me.phoneNumber,profileName:me.profileName,title:me.title,sharedGroupNames:[],size:Avatar.DZ.EIGHTY})}):lonelyInGroupNode=(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-ongoing-call__local-preview-fullsize",presentingSource&&"module-ongoing-call__local-preview-fullsize--presenting"),children:isSendingVideo?(0,jsx_runtime.jsx)("video",{ref:localVideoRef,autoPlay:!0}):(0,jsx_runtime.jsxs)(CallBackgroundBlur.L,{avatarPath:me.avatarPath,color:me.color,children:[(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest:!0,avatarPath:me.avatarPath,badge:void 0,color:me.color||Colors.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe:!0,phoneNumber:me.phoneNumber,profileName:me.profileName,title:me.title,sharedGroupNames:[],size:Avatar.DZ.EIGHTY}),(0,jsx_runtime.jsx)("div",{className:"module-calling__camera-is-off",children:i18n("icu:calling__your-video-is-off")})]})}),videoButtonType=presentingSource?CallingButton.h.VIDEO_DISABLED:hasLocalVideo?CallingButton.h.VIDEO_ON:CallingButton.h.VIDEO_OFF;var presentingButtonType,audioButtonType=hasLocalAudio?CallingButton.h.AUDIO_ON:CallingButton.h.AUDIO_OFF,isAudioOnly=!hasLocalVideo&&!hasRemoteVideo,controlsFadeClass=classnames_default()({"module-ongoing-call__controls--fadeIn":(showControls||isAudioOnly)&&!isConnected,"module-ongoing-call__controls--fadeOut":!showControls&&!isAudioOnly&&isConnected}),isGroupCall=activeCall.callMode===Calling.L6.Group;return presentingButtonType=presentingSource?CallingButton.h.PRESENTING_ON:currentPresenter?CallingButton.h.PRESENTING_DISABLED:CallingButton.h.PRESENTING_OFF,(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-calling__container",`module-ongoing-call__container--${getCallModeClassSuffix(activeCall.callMode)}`,"module-ongoing-call__container--"+(hasCallStarted?"call-started":"call-not-started")),onFocus:function(){setShowControls(!0)},onMouseMove:function(){setShowControls(!0)},role:"group",children:[showNeedsScreenRecordingPermissionsWarning?(0,jsx_runtime.jsx)(NeedsScreenRecordingPermissionsModal,{toggleScreenRecordingPermissionsDialog,i18n,openSystemPreferencesAction}):null,(0,jsx_runtime.jsx)(CallingToastManager,{activeCall,i18n}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-ongoing-call__header",controlsFadeClass),children:(0,jsx_runtime.jsx)(CallingHeader.X,{i18n,isInSpeakerView:isInSpeakerView(activeCall),isGroupCall,message:headerMessage,participantCount,showParticipantsList,title:headerTitle,toggleParticipants,togglePip,toggleSettings,toggleSpeakerView})}),isRinging&&(0,jsx_runtime.jsx)(CallingPreCallInfo.e,{conversation,groupMembers,i18n,me,ringMode:CallingPreCallInfo.A.IsRinging}),remoteParticipantsElement,lonelyInGroupNode,(0,jsx_runtime.jsxs)("div",{className:"module-ongoing-call__footer",children:[(0,jsx_runtime.jsx)("div",{className:"module-ongoing-call__footer__local-preview-offset"}),(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-ongoing-call__footer__actions",controlsFadeClass),children:[(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:presentingButtonType,i18n,onMouseEnter:onControlsMouseEnter,onMouseLeave:onControlsMouseLeave,onClick:togglePresenting}),(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:videoButtonType,i18n,onMouseEnter:onControlsMouseEnter,onMouseLeave:onControlsMouseLeave,onClick:toggleVideo}),(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:audioButtonType,i18n,onMouseEnter:onControlsMouseEnter,onMouseLeave:onControlsMouseLeave,onClick:toggleAudio}),(0,jsx_runtime.jsx)(CallingButton.k,{buttonType:CallingButton.h.HANG_UP,i18n,onMouseEnter:onControlsMouseEnter,onMouseLeave:onControlsMouseLeave,onClick:hangUp})]}),(0,jsx_runtime.jsxs)("div",{className:"module-ongoing-call__footer__local-preview",children:[localPreviewNode,(0,jsx_runtime.jsx)(CallingAudioIndicator.u,{hasAudio:hasLocalAudio,audioLevel:localAudioLevel,shouldShowSpeaking:isSpeaking})]})]})]})}function getCallModeClassSuffix(callMode){switch(callMode){case Calling.L6.Direct:return"direct";case Calling.L6.Group:return"group";default:throw(0,missingCaseError.b)(callMode)}}function renderDuration(ms){var secs=Math.floor(ms/1e3%60).toString().padStart(2,"0"),mins=Math.floor(ms/6e4%60).toString().padStart(2,"0"),hours=Math.floor(ms/36e5);return hours>0?`${hours}:${mins}:${secs}`:`${mins}:${secs}`}CallScreen.displayName="CallScreen"},"./ts/components/DirectCallRemoteParticipant.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>DirectCallRemoteParticipant});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_types_Colors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Colors.ts"),_Avatar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Avatar.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function DirectCallRemoteParticipant(_ref){var conversation=_ref.conversation,hasRemoteVideo=_ref.hasRemoteVideo,i18n=_ref.i18n,setRendererCanvas=_ref.setRendererCanvas,remoteVideoRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){return setRendererCanvas({element:remoteVideoRef}),function(){setRendererCanvas({element:void 0})}}),[setRendererCanvas]),hasRemoteVideo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("canvas",{className:"module-ongoing-call__remote-video-enabled",ref:remoteVideoRef}):renderAvatar(i18n,conversation)}function renderAvatar(i18n,_ref2){var acceptedMessageRequest=_ref2.acceptedMessageRequest,avatarPath=_ref2.avatarPath,color=_ref2.color,isMe=_ref2.isMe,phoneNumber=_ref2.phoneNumber,profileName=_ref2.profileName,sharedGroupNames=_ref2.sharedGroupNames,title=_ref2.title;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"module-ongoing-call__remote-video-disabled",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_2__.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:color||_types_Colors__WEBPACK_IMPORTED_MODULE_1__.sj[0],noteToSelf:!1,conversationType:"direct",i18n,isMe,phoneNumber,profileName,title,sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_2__.DZ.EIGHTY})})}renderAvatar.displayName="renderAvatar"},"./ts/components/GroupCallOverflowArea.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>GroupCallOverflowArea,h:()=>OVERFLOW_PARTICIPANT_WIDTH});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_GroupCallRemoteParticipant__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/GroupCallRemoteParticipant.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var OVERFLOW_PARTICIPANT_WIDTH=140;function GroupCallOverflowArea(_ref){var visibleHeight,scrollMax,getFrameBuffer=_ref.getFrameBuffer,getGroupCallVideoFrameSource=_ref.getGroupCallVideoFrameSource,i18n=_ref.i18n,onParticipantVisibilityChanged=_ref.onParticipantVisibilityChanged,overflowedParticipants=_ref.overflowedParticipants,remoteAudioLevels=_ref.remoteAudioLevels,remoteParticipantsCount=_ref.remoteParticipantsCount,overflowRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0),2),overflowScrollTop=_useState2[0],setOverflowScrollTop=_useState2[1];overflowRef.current?(visibleHeight=overflowRef.current.clientHeight,scrollMax=overflowRef.current.scrollHeight-visibleHeight):(visibleHeight=0,scrollMax=0);var hasOverflowedParticipants=Boolean(overflowedParticipants.length);if((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){hasOverflowedParticipants||setOverflowScrollTop(0)}),[hasOverflowedParticipants]),!hasOverflowedParticipants)return null;var isScrolledToTop=overflowScrollTop<20,isScrolledToBottom=overflowScrollTop>scrollMax-20;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"module-ongoing-call__participants__overflow",style:{width:OVERFLOW_PARTICIPANT_WIDTH},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(OverflowAreaScrollMarker,{i18n,isHidden:isScrolledToTop,onClick:function(){var el=overflowRef.current;el&&el.scrollTo({top:Math.max(el.scrollTop-.75*visibleHeight,0),left:0,behavior:"smooth"})},placement:"top"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"module-ongoing-call__participants__overflow__inner",ref:overflowRef,onScroll:function(){var el=overflowRef.current;el&&setOverflowScrollTop(el.scrollTop)},children:overflowedParticipants.map((function(remoteParticipant){var _remoteAudioLevels$ge;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_GroupCallRemoteParticipant__WEBPACK_IMPORTED_MODULE_2__.B,{getFrameBuffer,getGroupCallVideoFrameSource,i18n,audioLevel:null!==(_remoteAudioLevels$ge=remoteAudioLevels.get(remoteParticipant.demuxId))&&void 0!==_remoteAudioLevels$ge?_remoteAudioLevels$ge:0,onVisibilityChanged:onParticipantVisibilityChanged,width:OVERFLOW_PARTICIPANT_WIDTH,height:Math.floor(OVERFLOW_PARTICIPANT_WIDTH/remoteParticipant.videoAspectRatio),remoteParticipant,remoteParticipantsCount,isActiveSpeakerInSpeakerView:!1},remoteParticipant.demuxId)}))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(OverflowAreaScrollMarker,{i18n,isHidden:isScrolledToBottom,onClick:function(){var el=overflowRef.current;el&&el.scrollTo({top:Math.min(el.scrollTop+.75*visibleHeight,scrollMax),left:0,behavior:"smooth"})},placement:"bottom"})]})}function OverflowAreaScrollMarker(_ref2){var i18n=_ref2.i18n,isHidden=_ref2.isHidden,onClick=_ref2.onClick,placement=_ref2.placement,baseClassName="module-ongoing-call__participants__overflow__scroll-marker";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(baseClassName,`${baseClassName}--${placement}`,{[`${baseClassName}--hidden`]:isHidden}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("button",{type:"button",className:`${baseClassName}__button`,onClick,"aria-label":i18n("top"===placement?"icu:calling__overflow__scroll-up":"icu:calling__overflow__scroll-down")})})}GroupCallOverflowArea.displayName="GroupCallOverflowArea",OverflowAreaScrollMarker.displayName="OverflowAreaScrollMarker"},"./ts/hooks/useActivateSpeakerViewOnPresenting.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>useActivateSpeakerViewOnPresenting});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_usePrevious__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/hooks/usePrevious.ts");function useActivateSpeakerViewOnPresenting(_ref){var _remoteParticipants$f,remoteParticipants=_ref.remoteParticipants,switchToPresentationView=_ref.switchToPresentationView,switchFromPresentationView=_ref.switchFromPresentationView,presenterUuid=null===(_remoteParticipants$f=remoteParticipants.find((function(participant){return participant.presenting})))||void 0===_remoteParticipants$f?void 0:_remoteParticipants$f.uuid,prevPresenterUuid=(0,_usePrevious__WEBPACK_IMPORTED_MODULE_1__.D)(presenterUuid,presenterUuid);(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){prevPresenterUuid!==presenterUuid&&presenterUuid?switchToPresentationView():prevPresenterUuid&&!presenterUuid&&switchFromPresentationView()}),[presenterUuid,prevPresenterUuid,switchToPresentationView,switchFromPresentationView])}},"./ts/hooks/useKeyboardShortcuts.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Al:()=>useActiveCallShortcuts,Gu:()=>useStartCallShortcuts,aL:()=>useKeyboardShortcuts,dn:()=>useAttachFileShortcut,oN:()=>useIncomingCallShortcuts,py:()=>useStartRecordingShortcut,sP:()=>useToggleReactionPicker});var lodash_get__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/services/keyboardLayout.ts");function isCmdOrCtrl(ev){var ctrlKey=ev.ctrlKey,metaKey=ev.metaKey,commandKey="darwin"===lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(window,"platform")&&metaKey,controlKey="darwin"!==lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(window,"platform")&&ctrlKey;return commandKey||controlKey}function isCtrlOrAlt(ev){var altKey=ev.altKey,ctrlKey=ev.ctrlKey,controlKey="darwin"===lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(window,"platform")&&ctrlKey,theAltKey="darwin"!==lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(window,"platform")&&altKey;return controlKey||theAltKey}function useActiveCallShortcuts(hangUp){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return!(!isCtrlOrAlt(ev)||!shiftKey||"e"!==key&&"E"!==key)&&(ev.preventDefault(),ev.stopPropagation(),hangUp("Keyboard shortcut"),!0)}),[hangUp])}function useIncomingCallShortcuts(acceptAudioCall,acceptVideoCall,declineCall){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return isCtrlOrAlt(ev)&&shiftKey&&("v"===key||"V"===key)?(ev.preventDefault(),ev.stopPropagation(),acceptVideoCall(),!0):isCtrlOrAlt(ev)&&shiftKey&&("a"===key||"A"===key)?(ev.preventDefault(),ev.stopPropagation(),acceptAudioCall(),!0):!(!isCtrlOrAlt(ev)||!shiftKey||"d"!==key&&"D"!==key)&&(ev.preventDefault(),ev.stopPropagation(),declineCall(),!0)}),[acceptAudioCall,acceptVideoCall,declineCall])}function useStartCallShortcuts(startAudioCall,startVideoCall){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return isCtrlOrAlt(ev)&&shiftKey&&("c"===key||"C"===key)?(ev.preventDefault(),ev.stopPropagation(),startAudioCall(),!0):!(!isCtrlOrAlt(ev)||!shiftKey||"y"!==key&&"Y"!==key)&&(ev.preventDefault(),ev.stopPropagation(),startVideoCall(),!0)}),[startAudioCall,startVideoCall])}function useStartRecordingShortcut(startAudioRecording){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return!(!isCmdOrCtrl(ev)||!shiftKey||"v"!==key&&"V"!==key)&&(ev.preventDefault(),ev.stopPropagation(),startAudioRecording(),!0)}),[startAudioRecording])}function useAttachFileShortcut(attachFile){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return!(!isCmdOrCtrl(ev)||shiftKey||"u"!==key&&"U"!==key)&&(ev.preventDefault(),ev.stopPropagation(),attachFile(),!0)}),[attachFile])}function useToggleReactionPicker(handleReact){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var shiftKey=ev.shiftKey,key=_services_keyboardLayout__WEBPACK_IMPORTED_MODULE_2__.P(ev);return!(!isCmdOrCtrl(ev)||!shiftKey||"e"!==key&&"E"!==key)&&(ev.preventDefault(),ev.stopPropagation(),handleReact(),!0)}),[handleReact])}function useKeyboardShortcuts(){for(var _len=arguments.length,eventHandlers=new Array(_len),_key=0;_key<_len;_key++)eventHandlers[_key]=arguments[_key];(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){function handleKeydown(ev){eventHandlers.some((function(eventHandler){return eventHandler(ev)}))}return document.addEventListener("keydown",handleKeydown),function(){document.removeEventListener("keydown",handleKeydown)}}),[eventHandlers])}},"./ts/hooks/usePageVisibility.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>usePageVisibility});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function usePageVisibility(){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!document.hidden),2),result=_useState2[0],setResult=_useState2[1];return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){var updatePageVisibility=function(){setResult(!document.hidden)};return updatePageVisibility(),document.addEventListener("visibilitychange",updatePageVisibility,!1),function(){document.removeEventListener("visibilitychange",updatePageVisibility,!1)}}),[]),result}},"./ts/test-both/helpers/fakeGetGroupCallVideoFrameSource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,{x:()=>fakeGetGroupCallVideoFrameSource});var COLORS=[[255,0,0],[255,153,0],[255,255,0],[0,255,0],[0,153,255],[255,0,255],[153,51,255]],FakeGroupCallVideoFrameSource=function(){function FakeGroupCallVideoFrameSource(width,height,r,g,b){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FakeGroupCallVideoFrameSource);var length=width*height*4;this.sourceArray=new Uint8Array(length);for(var i=0;i<length;i+=4)this.sourceArray[i]=r,this.sourceArray[i+1]=g,this.sourceArray[i+2]=b,this.sourceArray[i+3]=255;this.dimensions=[width,height]}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(FakeGroupCallVideoFrameSource,[{key:"receiveVideoFrame",value:function receiveVideoFrame(destinationBuffer,_maxWidth,_maxHeight){if(!(Math.random()<.5))return destinationBuffer.set(this.sourceArray),this.dimensions}}]),FakeGroupCallVideoFrameSource}();function fakeGetGroupCallVideoFrameSource(demuxId){var color=COLORS[demuxId%COLORS.length];if(!color)throw new Error("Expected a color, but it was not found");var _color=_slicedToArray(color,3),r=_color[0],g=_color[1],b=_color[2];return new FakeGroupCallVideoFrameSource(13,10,r,g,b)}},"./ts/types/Calling.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var CallMode,CallViewMode,CallState,CallEndedReason,GroupCallConnectionState,GroupCallJoinState,CallingDeviceType;__webpack_require__.d(__webpack_exports__,{$B:()=>CallingDeviceType,GT:()=>GroupCallJoinState,KQ:()=>CallEndedReason,L6:()=>CallMode,OX:()=>CallState,mB:()=>GroupCallConnectionState,pC:()=>CallViewMode}),function(CallMode){CallMode.None="None",CallMode.Direct="Direct",CallMode.Group="Group"}(CallMode||(CallMode={})),function(CallViewMode){CallViewMode.Grid="Grid",CallViewMode.Speaker="Speaker",CallViewMode.Presentation="Presentation"}(CallViewMode||(CallViewMode={})),function(CallState){CallState.Prering="idle",CallState.Ringing="ringing",CallState.Accepted="connected",CallState.Reconnecting="connecting",CallState.Ended="ended"}(CallState||(CallState={})),function(CallEndedReason){CallEndedReason.LocalHangup="LocalHangup",CallEndedReason.RemoteHangup="RemoteHangup",CallEndedReason.RemoteHangupNeedPermission="RemoteHangupNeedPermission",CallEndedReason.Declined="Declined",CallEndedReason.Busy="Busy",CallEndedReason.Glare="Glare",CallEndedReason.ReCall="ReCall",CallEndedReason.ReceivedOfferExpired="ReceivedOfferExpired",CallEndedReason.ReceivedOfferWhileActive="ReceivedOfferWhileActive",CallEndedReason.ReceivedOfferWithGlare="ReceivedOfferWithGlare",CallEndedReason.SignalingFailure="SignalingFailure",CallEndedReason.GlareFailure="GlareFailure",CallEndedReason.ConnectionFailure="ConnectionFailure",CallEndedReason.InternalFailure="InternalFailure",CallEndedReason.Timeout="Timeout",CallEndedReason.AcceptedOnAnotherDevice="AcceptedOnAnotherDevice",CallEndedReason.DeclinedOnAnotherDevice="DeclinedOnAnotherDevice",CallEndedReason.BusyOnAnotherDevice="BusyOnAnotherDevice",CallEndedReason.CallerIsNotMultiring="CallerIsNotMultiring"}(CallEndedReason||(CallEndedReason={})),function(GroupCallConnectionState){GroupCallConnectionState[GroupCallConnectionState.NotConnected=0]="NotConnected",GroupCallConnectionState[GroupCallConnectionState.Connecting=1]="Connecting",GroupCallConnectionState[GroupCallConnectionState.Connected=2]="Connected",GroupCallConnectionState[GroupCallConnectionState.Reconnecting=3]="Reconnecting"}(GroupCallConnectionState||(GroupCallConnectionState={})),function(GroupCallJoinState){GroupCallJoinState[GroupCallJoinState.NotJoined=0]="NotJoined",GroupCallJoinState[GroupCallJoinState.Joining=1]="Joining",GroupCallJoinState[GroupCallJoinState.Joined=2]="Joined"}(GroupCallJoinState||(GroupCallJoinState={})),function(CallingDeviceType){CallingDeviceType[CallingDeviceType.CAMERA=0]="CAMERA",CallingDeviceType[CallingDeviceType.MICROPHONE=1]="MICROPHONE",CallingDeviceType[CallingDeviceType.SPEAKER=2]="SPEAKER"}(CallingDeviceType||(CallingDeviceType={}))},"./ts/util/clearTimeoutIfNecessary.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function clearTimeoutIfNecessary(timeout){timeout&&clearTimeout(timeout)}__webpack_require__.d(__webpack_exports__,{S:()=>clearTimeoutIfNecessary})},"./ts/util/ringrtc/nonRenderedRemoteParticipant.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>nonRenderedRemoteParticipant});var nonRenderedRemoteParticipant=function(_ref){return{demuxId:_ref.demuxId,width:0,height:0}}}}]);