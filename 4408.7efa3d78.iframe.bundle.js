(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[4408],{"./ts/components/Button.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Wu:()=>ButtonVariant,c:()=>ButtonIconType,qE:()=>ButtonSize,zx:()=>Button});var ButtonSize,ButtonVariant,ButtonIconType,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_util_assert__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/assert.ts"),_util_theme__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/util/theme.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");!function(ButtonSize){ButtonSize[ButtonSize.Large=0]="Large",ButtonSize[ButtonSize.Medium=1]="Medium",ButtonSize[ButtonSize.Small=2]="Small"}(ButtonSize||(ButtonSize={})),function(ButtonVariant){ButtonVariant.Calling="Calling",ButtonVariant.Destructive="Destructive",ButtonVariant.Details="Details",ButtonVariant.Primary="Primary",ButtonVariant.Secondary="Secondary",ButtonVariant.SecondaryAffirmative="SecondaryAffirmative",ButtonVariant.SecondaryDestructive="SecondaryDestructive",ButtonVariant.SystemMessage="SystemMessage"}(ButtonVariant||(ButtonVariant={})),function(ButtonIconType){ButtonIconType.audio="audio",ButtonIconType.muted="muted",ButtonIconType.photo="photo",ButtonIconType.search="search",ButtonIconType.text="text",ButtonIconType.unmuted="unmuted",ButtonIconType.video="video"}(ButtonIconType||(ButtonIconType={}));var SIZE_CLASS_NAMES=new Map([[ButtonSize.Large,"module-Button--large"],[ButtonSize.Medium,"module-Button--medium"],[ButtonSize.Small,"module-Button--small"]]),VARIANT_CLASS_NAMES=new Map([[ButtonVariant.Primary,"module-Button--primary"],[ButtonVariant.Secondary,"module-Button--secondary"],[ButtonVariant.SecondaryAffirmative,"module-Button--secondary module-Button--secondary--affirmative"],[ButtonVariant.SecondaryDestructive,"module-Button--secondary module-Button--secondary--destructive"],[ButtonVariant.Destructive,"module-Button--destructive"],[ButtonVariant.Calling,"module-Button--calling"],[ButtonVariant.SystemMessage,"module-Button--system-message"],[ButtonVariant.Details,"module-Button--details"]]),Button=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef((function ButtonInner(props,ref){var onClick,type,form,children=props.children,className=props.className,_props$disabled=props.disabled,disabled=void 0!==_props$disabled&&_props$disabled,icon=props.icon,style=props.style,tabIndex=props.tabIndex,theme=props.theme,_props$variant=props.variant,variant=void 0===_props$variant?ButtonVariant.Primary:_props$variant,_props$size=props.size,size=void 0===_props$size?variant===ButtonVariant.Details?ButtonSize.Small:ButtonSize.Medium:_props$size,ariaLabel=props["aria-label"],ariaDisabled=props["aria-disabled"];"onClick"in props?(onClick=props.onClick,type="button"):(onClick=void 0,type=props.type,form=props.form);var sizeClassName=SIZE_CLASS_NAMES.get(size);(0,_util_assert__WEBPACK_IMPORTED_MODULE_2__.q8)(sizeClassName,"<Button> size not found");var variantClassName=VARIANT_CLASS_NAMES.get(variant);(0,_util_assert__WEBPACK_IMPORTED_MODULE_2__.q8)(variantClassName,"<Button> variant not found");var buttonElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("button",{"aria-label":ariaLabel,"aria-disabled":ariaDisabled,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-Button",sizeClassName,variantClassName,icon&&`module-Button--icon--${icon}`,className),disabled,onClick,form,ref,style,tabIndex,type,children});return theme?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:(0,_util_theme__WEBPACK_IMPORTED_MODULE_3__.j)(theme),children:buttonElement}):buttonElement}))},"./ts/components/ConfirmationDialog.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>ConfirmationDialog});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_react_spring_web__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@react-spring/web/dist/react-spring-web.esm.js"),_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Button.tsx"),_ModalHost__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/ModalHost.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/Modal.tsx"),_hooks_useAnimated__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/hooks/useAnimated.tsx"),_Spinner__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Spinner.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react/jsx-runtime.js");function focusRef(el){el&&el.focus()}var ConfirmationDialog=react__WEBPACK_IMPORTED_MODULE_0__.memo((function ConfirmationDialogInner(_ref){var _ref$actions=_ref.actions,actions=void 0===_ref$actions?[]:_ref$actions,dialogName=_ref.dialogName,cancelButtonVariant=_ref.cancelButtonVariant,cancelText=_ref.cancelText,children=_ref.children,hasXButton=_ref.hasXButton,i18n=_ref.i18n,isSpinning=_ref.isSpinning,moduleClassName=_ref.moduleClassName,noMouseClose=_ref.noMouseClose,noDefaultCancelButton=_ref.noDefaultCancelButton,onCancel=_ref.onCancel,onClose=_ref.onClose,onTopOfEverything=_ref.onTopOfEverything,theme=_ref.theme,title=_ref.title,_useAnimated=(0,_hooks_useAnimated__WEBPACK_IMPORTED_MODULE_5__.F)(onClose,{getFrom:function(){return{opacity:0,transform:"scale(0.25)"}},getTo:function(isOpen){return{opacity:isOpen?1:0,transform:"scale(1)"}}}),close=_useAnimated.close,overlayStyles=_useAnimated.overlayStyles,modalStyles=_useAnimated.modalStyles,cancelAndClose=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){onCancel&&onCancel(),close()}),[close,onCancel]),handleCancel=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(e){e.target===e.currentTarget&&cancelAndClose()}),[cancelAndClose]),hasActions=Boolean(actions.length),footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:[isSpinning||noDefaultCancelButton?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_2__.zx,{onClick:handleCancel,ref:focusRef,variant:cancelButtonVariant||(hasActions?_Button__WEBPACK_IMPORTED_MODULE_2__.Wu.Secondary:_Button__WEBPACK_IMPORTED_MODULE_2__.Wu.Primary),children:cancelText||i18n("icu:confirmation-dialog--Cancel")}),actions.map((function(action,i){var _action$id,buttonStyle;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_2__.zx,{disabled:action.disabled||isSpinning,"aria-disabled":action["aria-disabled"],onClick:function(){action.action(),!1!==action.autoClose&&close()},"data-action":i,variant:(buttonStyle=action.style,"affirmative"===buttonStyle?_Button__WEBPACK_IMPORTED_MODULE_2__.Wu.Primary:"negative"===buttonStyle?_Button__WEBPACK_IMPORTED_MODULE_2__.Wu.Destructive:_Button__WEBPACK_IMPORTED_MODULE_2__.Wu.Secondary),children:isSpinning?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_6__.$j,{size:"22px",svgSize:"small",direction:"on-primary-button"}):action.text},"string"==typeof action.text?null!==(_action$id=action.id)&&void 0!==_action$id?_action$id:action.text:action.id)}))]}),modalName=`ConfirmationDialog.${dialogName}`;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_ModalHost__WEBPACK_IMPORTED_MODULE_3__.l,{modalName,noMouseClose,onClose:close,onEscape:cancelAndClose,onTopOfEverything,overlayStyles,theme,moduleClassName:moduleClassName?`${moduleClassName}__ModalHost`:void 0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_react_spring_web__WEBPACK_IMPORTED_MODULE_1__.animated.div,{style:modalStyles,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_4__.P2,{modalName,hasXButton,i18n,moduleClassName,onClose:cancelAndClose,title,modalFooter:footer,children})})})}))},"./ts/components/OutgoingGiftBadgeModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>OutgoingGiftBadgeModal});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_badges_getBadgeImageFileLocalPath__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/badges/getBadgeImageFileLocalPath.ts"),_Modal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Modal.tsx"),_badges_BadgeImageTheme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/badges/BadgeImageTheme.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js"),CLASS_NAME="OutgoingGiftBadgeModal";function OutgoingGiftBadgeModal(_ref){var recipientTitle=_ref.recipientTitle,i18n=_ref.i18n,badgeId=_ref.badgeId,hideOutgoingGiftBadgeModal=_ref.hideOutgoingGiftBadgeModal,badge=(0,_ref.getPreferredBadge)([{id:badgeId}]),badgeImagePath=(0,_badges_getBadgeImageFileLocalPath__WEBPACK_IMPORTED_MODULE_2__.p)(badge,140,_badges_BadgeImageTheme__WEBPACK_IMPORTED_MODULE_4__.c.Transparent),badgeElement=badge?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("img",{className:`${CLASS_NAME}__badge`,src:badgeImagePath,alt:badge.name}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(`${CLASS_NAME}__badge`,`${CLASS_NAME}__badge--missing`),"aria-label":i18n("icu:donation--missing")});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_3__.u_,{modalName:"OutgoingGiftBadgeModal",i18n,moduleClassName:`${CLASS_NAME}__container`,onClose:hideOutgoingGiftBadgeModal,hasXButton:!0,useFocusTrap:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:CLASS_NAME,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:`${CLASS_NAME}__title`,children:i18n("icu:modal--donation--title")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:`${CLASS_NAME}__description`,children:i18n("icu:modal--donation--description",{name:recipientTitle})}),badgeElement,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:`${CLASS_NAME}__badge-summary`,children:i18n("icu:message--donation")})]})})}OutgoingGiftBadgeModal.displayName="OutgoingGiftBadgeModal"},"./ts/components/Time.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{q:()=>Time});var moment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/moment/moment.js"),moment__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_0__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/react/jsx-runtime.js")),_excluded=["children","dateOnly","timestamp"];function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function Time(_ref){var dateTime,children=_ref.children,_ref$dateOnly=_ref.dateOnly,dateOnly=void 0!==_ref$dateOnly&&_ref$dateOnly,timestamp=_ref.timestamp,otherProps=_objectWithoutProperties(_ref,_excluded);dateOnly?dateTime=moment__WEBPACK_IMPORTED_MODULE_0___default()(timestamp).format("YYYY-MM-DD"):dateTime=("number"==typeof timestamp?new Date(timestamp):timestamp).toISOString();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("time",Object.assign({dateTime},otherProps,{children}))}Time.displayName="Time"},"./ts/components/UserText.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>UserText});__webpack_require__("./node_modules/react/index.js");var _conversation_Emojify__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/conversation/Emojify.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");function UserText(_ref){var text=_ref.text;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("span",{dir:"auto",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_conversation_Emojify__WEBPACK_IMPORTED_MODULE_1__.u,{text})})}UserText.displayName="UserText"},"./ts/components/_util.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function cleanId(id){return id.replace(/[^\u0020-\u007e\u00a0-\u00ff]/g,"_")}var WidthBreakpoint;__webpack_require__.d(__webpack_exports__,{GA:()=>cleanId,Up:()=>WidthBreakpoint,qW:()=>getConversationListWidthBreakpoint}),function(WidthBreakpoint){WidthBreakpoint.Wide="wide",WidthBreakpoint.Medium="medium",WidthBreakpoint.Narrow="narrow"}(WidthBreakpoint||(WidthBreakpoint={}));var getConversationListWidthBreakpoint=function(width){return width>=150?WidthBreakpoint.Wide:WidthBreakpoint.Narrow}},"./ts/components/conversation/ContactName.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>ContactName});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_Emojify__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/conversation/Emojify.tsx"),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/util/getClassNamesFor.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ContactName(_ref){var text,contactNameColor=_ref.contactNameColor,firstName=_ref.firstName,isSignalConversation=_ref.isSignalConversation,isMe=_ref.isMe,module=_ref.module,preferFirstName=_ref.preferFirstName,title=_ref.title,getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_3__.h)("module-contact-name",module);return text=preferFirstName?firstName||title||"":title||"",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("span",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName(""),contactNameColor?getClassName(`--${contactNameColor}`):null),dir:"auto",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Emojify__WEBPACK_IMPORTED_MODULE_2__.u,{text}),(isSignalConversation||isMe)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span",{className:"ContactModal__official-badge"})]})}ContactName.displayName="ContactName"},"./ts/components/conversation/ExpireTimer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{I:()=>ExpireTimer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_util_timer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/timer.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ExpireTimer(_ref){var deletedForEveryone=_ref.deletedForEveryone,direction=_ref.direction,expirationLength=_ref.expirationLength,expirationTimestamp=_ref.expirationTimestamp,withImageNoCaption=_ref.withImageNoCaption,withSticker=_ref.withSticker,withTapToViewExpired=_ref.withTapToViewExpired,forceUpdate=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useReducer)((function(){return{}}),{}),2)[1];(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){var increment=(0,_util_timer__WEBPACK_IMPORTED_MODULE_2__.R)(expirationLength),updateFrequency=Math.max(increment,500),interval=setInterval(forceUpdate,updateFrequency);return function(){clearInterval(interval)}}),[expirationLength]);var bucket=(0,_util_timer__WEBPACK_IMPORTED_MODULE_2__.e)(expirationTimestamp,expirationLength);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-expire-timer",`module-expire-timer--${bucket}`,direction?`module-expire-timer--${direction}`:null,deletedForEveryone?"module-expire-timer--deleted-for-everyone":null,withTapToViewExpired?`module-expire-timer--${direction}-with-tap-to-view-expired`:null,direction&&withImageNoCaption?"module-expire-timer--with-image-no-caption":null,withSticker?"module-expire-timer--with-sticker":null)})}ExpireTimer.displayName="ExpireTimer"},"./ts/components/conversation/ImageGrid.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>ImageGrid});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_types_Attachment__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/types/Attachment.ts"),_Image__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/Image.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ImageGrid(_ref2){var attachments=_ref2.attachments,bottomOverlay=_ref2.bottomOverlay,direction=_ref2.direction,i18n=_ref2.i18n,isSticker=_ref2.isSticker,stickerSize=_ref2.stickerSize,onError=_ref2.onError,onClick=_ref2.onClick,shouldCollapseAbove=_ref2.shouldCollapseAbove,shouldCollapseBelow=_ref2.shouldCollapseBelow,tabIndex=_ref2.tabIndex,theme=_ref2.theme,withContentAbove=_ref2.withContentAbove,withContentBelow=_ref2.withContentBelow,_getCurves=function getCurves(_ref){var direction=_ref.direction,shouldCollapseAbove=_ref.shouldCollapseAbove,shouldCollapseBelow=_ref.shouldCollapseBelow,withContentAbove=_ref.withContentAbove,withContentBelow=_ref.withContentBelow,curveTopLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None,curveTopRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None,curveBottomLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None,curveBottomRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None;return shouldCollapseAbove&&"incoming"===direction?(curveTopLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,curveTopRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal):shouldCollapseAbove&&"outgoing"===direction?(curveTopLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal,curveTopRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny):withContentAbove||(curveTopLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal,curveTopRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal),shouldCollapseBelow&&"incoming"===direction?(curveBottomLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,curveBottomRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None):shouldCollapseBelow&&"outgoing"===direction?(curveBottomLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.None,curveBottomRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny):withContentBelow||(curveBottomLeft=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal,curveBottomRight=_Image__WEBPACK_IMPORTED_MODULE_3__.v.Normal),{curveTopLeft,curveTopRight,curveBottomLeft,curveBottomRight}}({direction,shouldCollapseAbove,shouldCollapseBelow,withContentAbove,withContentBelow}),curveTopLeft=_getCurves.curveTopLeft,curveTopRight=_getCurves.curveTopRight,curveBottomLeft=_getCurves.curveBottomLeft,curveBottomRight=_getCurves.curveBottomRight,withBottomOverlay=Boolean(bottomOverlay&&!withContentBelow);if(!attachments||!attachments.length)return null;if(1===attachments.length||!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.pU)(attachments)){var _getImageDimensions=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.pz)(attachments[0],isSticker?stickerSize:void 0),height=_getImageDimensions.height,width=_getImageDimensions.width;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-image-grid","module-image-grid--one-image",isSticker?"module-image-grid--with-sticker":null),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[0],i18n),i18n,theme,blurHash:attachments[0].blurHash,bottomOverlay:withBottomOverlay,noBorder:isSticker,noBackground:isSticker,curveTopLeft,curveTopRight,curveBottomLeft,curveBottomRight,attachment:attachments[0],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[0]),height,width,url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.Gr)(attachments[0]),tabIndex,onClick,onError})})}if(2===attachments.length)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[0],i18n),i18n,theme,attachment:attachments[0],blurHash:attachments[0].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveTopLeft,curveBottomLeft,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[0]),height:150,width:150,cropWidth:1,url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[0]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[1],i18n),i18n,theme,blurHash:attachments[1].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveTopRight,curveBottomRight,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[1]),height:150,width:150,attachment:attachments[1],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[1]),onClick,onError})]});if(3===attachments.length)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[0],i18n),i18n,theme,blurHash:attachments[0].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveTopLeft,curveBottomLeft,attachment:attachments[0],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[0]),height:200,width:200,cropWidth:1,url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.Gr)(attachments[0]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__column",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[1],i18n),i18n,theme,blurHash:attachments[1].blurHash,curveTopRight,height:100,width:100,cropHeight:1,attachment:attachments[1],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[1]),url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[1]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[2],i18n),i18n,theme,blurHash:attachments[2].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveBottomRight,height:100,width:100,attachment:attachments[2],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[2]),url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[2]),onClick,onError})]})]});if(4===attachments.length)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-image-grid",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__column",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[0],i18n),i18n,theme,blurHash:attachments[0].blurHash,curveTopLeft,noBorder:!1,attachment:attachments[0],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[0]),height:150,width:150,cropHeight:1,cropWidth:1,url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[0]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[1],i18n),i18n,theme,blurHash:attachments[1].blurHash,curveTopRight,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[1]),noBorder:!1,height:150,width:150,cropHeight:1,attachment:attachments[1],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[1]),onClick,onError})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[2],i18n),i18n,theme,blurHash:attachments[2].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveBottomLeft,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[2]),height:150,width:150,cropWidth:1,attachment:attachments[2],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[2]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[3],i18n),i18n,theme,blurHash:attachments[3].blurHash,bottomOverlay:withBottomOverlay,noBorder:!1,curveBottomRight,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[3]),height:150,width:150,attachment:attachments[3],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[3]),onClick,onError})]})]})});var moreMessagesOverlay=attachments.length>5,moreMessagesOverlayText=moreMessagesOverlay?"+"+(attachments.length-5):void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"module-image-grid",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__column",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[0],i18n),i18n,theme,blurHash:attachments[0].blurHash,curveTopLeft,attachment:attachments[0],playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[0]),height:150,width:150,cropWidth:1,url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[0]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[1],i18n),i18n,theme,blurHash:attachments[1].blurHash,curveTopRight,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[1]),height:150,width:150,attachment:attachments[1],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[1]),onClick,onError})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"module-image-grid__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[2],i18n),i18n,theme,blurHash:attachments[2].blurHash,bottomOverlay:withBottomOverlay,noBorder:isSticker,curveBottomLeft,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[2]),height:100,width:100,cropWidth:1,attachment:attachments[2],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[2]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[3],i18n),i18n,theme,blurHash:attachments[3].blurHash,bottomOverlay:withBottomOverlay,noBorder:isSticker,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[3]),height:100,width:100,cropWidth:1,attachment:attachments[3],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[3]),onClick,onError}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.EQ)(attachments[4],i18n),i18n,theme,blurHash:attachments[4].blurHash,bottomOverlay:withBottomOverlay,noBorder:isSticker,curveBottomRight,playIconOverlay:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.fr)(attachments[4]),height:100,width:100,darkOverlay:moreMessagesOverlay,overlayText:moreMessagesOverlayText,attachment:attachments[4],url:(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_2__.gu)(attachments[4]),onClick,onError})]})]})})}ImageGrid.displayName="ImageGrid"},"./ts/components/conversation/Message.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Yk:()=>GiftBadgeStates,v0:()=>Message,m5:()=>TextDirection});var lodash_unescape=__webpack_require__("./node_modules/lodash/unescape.js"),unescape_default=__webpack_require__.n(lodash_unescape),take=__webpack_require__("./node_modules/lodash/take.js"),take_default=__webpack_require__.n(take),orderBy=__webpack_require__("./node_modules/lodash/orderBy.js"),orderBy_default=__webpack_require__.n(orderBy),noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),groupBy=__webpack_require__("./node_modules/lodash/groupBy.js"),groupBy_default=__webpack_require__.n(groupBy),drop=__webpack_require__("./node_modules/lodash/drop.js"),drop_default=__webpack_require__.n(drop),react=__webpack_require__("./node_modules/react/index.js"),react_dom=__webpack_require__("./node_modules/react-dom/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),node_modules_direction=__webpack_require__("./node_modules/direction/index.js"),direction_default=__webpack_require__.n(node_modules_direction),Manager=__webpack_require__("./node_modules/react-popper/lib/esm/Manager.js"),Reference=__webpack_require__("./node_modules/react-popper/lib/esm/Reference.js"),Popper=__webpack_require__("./node_modules/react-popper/lib/esm/Popper.js"),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function AvatarSpacer(_ref){var size=_ref.size;return(0,jsx_runtime.jsx)("div",{style:{minWidth:size,height:size,width:size}})}AvatarSpacer.displayName="AvatarSpacer";var Spinner=__webpack_require__("./ts/components/Spinner.tsx"),MessageBodyReadMore=__webpack_require__("./ts/components/conversation/MessageBodyReadMore.tsx"),MessageMetadata=__webpack_require__("./ts/components/conversation/MessageMetadata.tsx");function MessageTextMetadataSpacer(_ref){var metadataWidth=_ref.metadataWidth;return(0,jsx_runtime.jsx)("span",{style:{display:"inline-block",width:metadataWidth+10}})}MessageTextMetadataSpacer.displayName="MessageTextMetadataSpacer";var ImageGrid=__webpack_require__("./ts/components/conversation/ImageGrid.tsx"),es=__webpack_require__("./node_modules/react-blurhash/es/index.js"),Attachment=__webpack_require__("./ts/types/Attachment.ts"),errors=__webpack_require__("./ts/types/errors.ts"),log=__webpack_require__("./ts/logging/log.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getReducedMotionQuery(){return window.matchMedia("(prefers-reduced-motion: reduce)")}function GIF_slicedToArray(arr,i){return function GIF_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function GIF_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function GIF_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return GIF_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return GIF_arrayLikeToArray(o,minLen)}(arr,i)||function GIF_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GIF_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function GIF(props){var attachment=props.attachment,size=props.size,tabIndex=props.tabIndex,i18n=props.i18n,theme=props.theme,onError=props.onError,showVisualAttachment=props.showVisualAttachment,kickOffAttachmentDownload=props.kickOffAttachmentDownload,tapToPlay=function useReducedMotion(){var initialQuery=getReducedMotionQuery(),_useState2=_slicedToArray((0,react.useState)(initialQuery.matches),2),prefersReducedMotion=_useState2[0],setPrefersReducedMotion=_useState2[1];return(0,react.useEffect)((function(){var query=getReducedMotionQuery();function changePreference(){setPrefersReducedMotion(query.matches)}return changePreference(),query.addEventListener("change",changePreference),function(){query.removeEventListener("change",changePreference)}})),prefersReducedMotion}(),videoRef=(0,react.useRef)(null),_getImageDimensions=(0,Attachment.pz)(attachment,size),height=_getImageDimensions.height,width=_getImageDimensions.width,_useState2=GIF_slicedToArray((0,react.useState)(0),2),repeatCount=_useState2[0],setRepeatCount=_useState2[1],_useState4=GIF_slicedToArray((0,react.useState)(8),2),playTime=_useState4[0],setPlayTime=_useState4[1],_useState6=GIF_slicedToArray((0,react.useState)(0),2),currentTime=_useState6[0],setCurrentTime=_useState6[1],_useState8=GIF_slicedToArray((0,react.useState)(!0),2),isFocused=_useState8[0],setIsFocused=_useState8[1],_useState10=GIF_slicedToArray((0,react.useState)(!tapToPlay),2),isPlaying=_useState10[0],setIsPlaying=_useState10[1];(0,react.useEffect)((function(){var onFocus=function(){return setIsFocused(!0)},onBlur=function(){return setIsFocused(!1)};return window.addEventListener("focus",onFocus),window.addEventListener("blur",onBlur),function(){window.removeEventListener("focus",onFocus),window.removeEventListener("blur",onBlur)}})),(0,react.useEffect)((function(){var video=videoRef.current;video&&(isPlaying?video.play().catch((function(error){log.info("Failed to match GIF playback to window's state",errors.G(error))})):video.pause())}),[isPlaying,repeatCount]),(0,react.useEffect)((function(){if(videoRef.current){var isTapToPlayPaused=!1;tapToPlay&&(playTime+currentTime>=8||repeatCount>=4)&&(isTapToPlayPaused=!0),setIsPlaying(isFocused&&!isTapToPlayPaused)}}),[isFocused,playTime,currentTime,repeatCount,tapToPlay]);var fileSize,gif,overlay,spinner,isPending=Boolean(attachment.pending),isNotResolved=(0,Attachment.AR)(attachment)&&!isPending;if(isNotResolved&&attachment.fileSize&&(fileSize=(0,jsx_runtime.jsxs)("div",{className:"module-image--gif__filesize",children:[attachment.fileSize," · GIF"]})),gif=isNotResolved||isPending?(0,jsx_runtime.jsx)(es.E,{hash:attachment.blurHash||(0,Attachment.d0)(theme),width,height,style:{display:"block"}}):(0,jsx_runtime.jsx)("video",{ref:videoRef,onTimeUpdate:async function(event){var reportedTime=event.currentTarget.currentTime;Number.isNaN(reportedTime)||setCurrentTime(reportedTime)},onEnded:async function(event){var video=event.currentTarget,duration=video.duration;setRepeatCount(repeatCount+1),Number.isNaN(duration)||(video.currentTime=0,setCurrentTime(0),setPlayTime(playTime+duration))},onError,onClick:function(event){event.preventDefault(),event.stopPropagation(),showVisualAttachment()},className:"module-image--gif__video",autoPlay:!0,playsInline:!0,muted:!0,poster:attachment.screenshot&&attachment.screenshot.url,height,width,src:attachment.url}),tapToPlay&&!isPlaying||isNotResolved){var className=classnames_default()(["module-image__border-overlay","module-image__border-overlay--with-click-handler","module-image--soft-corners",isNotResolved?"module-image--not-downloaded":"module-image--tap-to-play"]);overlay=(0,jsx_runtime.jsx)("button",{type:"button",className,onClick:function(event){event.preventDefault(),event.stopPropagation(),attachment.url?tapToPlay&&(setPlayTime(0),setCurrentTime(0),setRepeatCount(0)):kickOffAttachmentDownload()},onKeyDown:function(event){"Enter"!==event.key&&"Space"!==event.key||(event.preventDefault(),event.stopPropagation(),kickOffAttachmentDownload())},tabIndex,children:(0,jsx_runtime.jsx)("span",{})})}return isPending&&(spinner=(0,jsx_runtime.jsx)("div",{className:"module-image__download-pending--spinner-container",children:(0,jsx_runtime.jsx)("div",{className:"module-image__download-pending--spinner",title:i18n("icu:loading"),children:(0,jsx_runtime.jsx)(Spinner.$j,{moduleClassName:"module-image-spinner",svgSize:"small"})})})),(0,jsx_runtime.jsxs)("div",{className:"module-image module-image--gif",children:[gif,overlay,spinner,fileSize]})}GIF.displayName="GIF";var Image=__webpack_require__("./ts/components/conversation/Image.tsx"),ContactName=__webpack_require__("./ts/components/conversation/ContactName.tsx"),Quote=__webpack_require__("./ts/components/conversation/Quote.tsx"),contactUtil=__webpack_require__("./ts/components/conversation/contactUtil.tsx");function EmbeddedContact(props){var contact=props.contact,i18n=props.i18n,isIncoming=props.isIncoming,onClick=props.onClick,tabIndex=props.tabIndex,withContentAbove=props.withContentAbove,withContentBelow=props.withContentBelow,direction=isIncoming?"incoming":"outgoing";return(0,jsx_runtime.jsxs)("button",{type:"button",className:classnames_default()("module-embedded-contact",`module-embedded-contact--${direction}`,withContentAbove?"module-embedded-contact--with-content-above":null,withContentBelow?"module-embedded-contact--with-content-below":null),onKeyDown:function(event){"Enter"!==event.key&&"Space"!==event.key||onClick&&(event.stopPropagation(),event.preventDefault(),onClick())},onClick:function(event){onClick&&(event.stopPropagation(),event.preventDefault(),onClick())},tabIndex,children:[(0,contactUtil.aQ)({contact,i18n,size:52,direction}),(0,jsx_runtime.jsxs)("div",{className:"module-embedded-contact__text-container",children:[(0,contactUtil.vs)({contact,isIncoming,module:"embedded-contact"}),(0,contactUtil.TF)({contact,isIncoming,module:"embedded-contact"})]})]})}EmbeddedContact.displayName="EmbeddedContact";var ReactionViewer=__webpack_require__("./ts/components/conversation/ReactionViewer.tsx"),Emoji=__webpack_require__("./ts/components/emoji/Emoji.tsx"),LinkPreviewDate=__webpack_require__("./ts/components/conversation/LinkPreviewDate.tsx");function shouldUseFullSizeLinkPreviewImage(_ref){var isStickerPack=_ref.isStickerPack,image=_ref.image;if(isStickerPack||!image||!(0,Attachment.VV)(image))return!1;var width=image.width,height=image.height;return isDimensionFullSize(width)&&isDimensionFullSize(height)&&!function isRoughlySquare(width,height){return Math.abs(1-width/height)<.05}(width,height)}function isDimensionFullSize(dimension){return"number"==typeof dimension&&dimension>=200}var OutgoingGiftBadgeModal=__webpack_require__("./ts/components/OutgoingGiftBadgeModal.tsx"),Stories=__webpack_require__("./ts/types/Stories.ts"),timer=__webpack_require__("./ts/util/timer.ts"),clearTimeoutIfNecessary=__webpack_require__("./ts/util/clearTimeoutIfNecessary.ts"),DANGEROUS_FILE_TYPES=/\.(ADE|ADP|APK|BAT|CAB|CHM|CMD|COM|CPL|DIAGCAB|DLL|DMG|EXE|HTA|INF|INS|ISP|JAR|JS|JSE|LIB|LNK|MDE|MHT|MSC|MSI|MSP|MST|NSH|PIF|PS1|PSC1|PSM1|PSRC|REG|SCR|SCT|SETTINGCONTENT-MS|SHB|SYS|VB|VBE|VBS|VXD|WSC|WSF|WSH)\.?$/i;var missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts"),refMerger=__webpack_require__("./ts/util/refMerger.ts"),lib=__webpack_require__("./ts/components/emoji/lib.ts"),getCustomColorStyle=__webpack_require__("./ts/util/getCustomColorStyle.ts"),durations=__webpack_require__("./ts/util/durations/index.ts"),BadgeImageTheme=__webpack_require__("./ts/badges/BadgeImageTheme.ts"),getBadgeImageFileLocalPath=__webpack_require__("./ts/badges/getBadgeImageFileLocalPath.ts"),handleOutsideClick=__webpack_require__("./ts/util/handleOutsideClick.ts"),Payment=__webpack_require__("./ts/types/Payment.ts"),helpers=__webpack_require__("./ts/messages/helpers.ts"),Panels=__webpack_require__("./ts/types/Panels.ts"),openLinkInWebBrowser=__webpack_require__("./ts/util/openLinkInWebBrowser.ts"),MessageTextRenderer=__webpack_require__("./ts/components/conversation/MessageTextRenderer.tsx"),UserText=__webpack_require__("./ts/components/UserText.tsx");function Message_slicedToArray(arr,i){return function Message_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function Message_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function Message_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Message_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Message_arrayLikeToArray(o,minLen)}(arr,i)||function Message_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Message_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var MetadataPlacement,TextDirection,GUESS_METADATA_WIDTH_OUTGOING_SIZE={delivered:24,error:24,paused:18,"partial-sent":24,read:24,sending:18,sent:24,viewed:24},GROUP_AVATAR_SIZE=Avatar.DZ.TWENTY_EIGHT,SENT_STATUSES=new Set(["delivered","read","sent","viewed"]),GIFT_BADGE_UPDATE_INTERVAL=30*durations.sh;!function(MetadataPlacement){MetadataPlacement[MetadataPlacement.NotRendered=0]="NotRendered",MetadataPlacement[MetadataPlacement.RenderedByMessageAudioComponent=1]="RenderedByMessageAudioComponent",MetadataPlacement[MetadataPlacement.InlineWithText=2]="InlineWithText",MetadataPlacement[MetadataPlacement.Bottom=3]="Bottom"}(MetadataPlacement||(MetadataPlacement={})),function(TextDirection){TextDirection.LeftToRight="LeftToRight",TextDirection.RightToLeft="RightToLeft",TextDirection.Default="Default",TextDirection.None="None"}(TextDirection||(TextDirection={}));var GiftBadgeStates,TextDirectionToDirAttribute={[TextDirection.LeftToRight]:"ltr",[TextDirection.RightToLeft]:"rtl",[TextDirection.Default]:"auto",[TextDirection.None]:"auto"};!function(GiftBadgeStates){GiftBadgeStates.Unopened="Unopened",GiftBadgeStates.Opened="Opened",GiftBadgeStates.Redeemed="Redeemed"}(GiftBadgeStates||(GiftBadgeStates={}));var Message=function(_React$PureComponent){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Message,_React$PureComponent);var _super=_createSuper(Message);function Message(props){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Message),(_this=_super.call(this,props)).focusRef=react.createRef(),_this.audioButtonRef=react.createRef(),_this.reactionsContainerRef=react.createRef(),_this.hasSelectedTextRef={current:!1},_this.reactionsContainerRefMerger=(0,refMerger.d)(),_this.handleFocus=function(){var _this$props=_this.props,interactionMode=_this$props.interactionMode,isTargeted=_this$props.isTargeted;"keyboard"!==interactionMode||isTargeted||_this.setTargeted()},_this.handleImageError=function(){var id=_this.props.id;log.info(`Message ${id}: Image failed to load; failing over to placeholder`),_this.setState({imageBroken:!0})},_this.setTargeted=function(){var _this$props2=_this.props,id=_this$props2.id,conversationId=_this$props2.conversationId,targetMessage=_this$props2.targetMessage;targetMessage&&targetMessage(id,conversationId)},_this.setFocus=function(){var container=_this.focusRef.current;container&&!container.contains(document.activeElement)&&container.focus()},_this.updateMetadataWidth=function(newMetadataWidth){_this.setState((function(_ref){var metadataWidth=_ref.metadataWidth;return{metadataWidth:Math.max(metadataWidth,newMetadataWidth)}}))},_this.handleSelectionChange=function(){var selection=document.getSelection();null==selection||selection.isCollapsed||(_this.hasSelectedTextRef.current=!0)},_this.toggleReactionViewer=function(){var onlyRemove=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_this.setState((function(oldState){var _oldState$reactionVie,reactionViewerRoot=oldState.reactionViewerRoot;if(reactionViewerRoot)return document.body.removeChild(reactionViewerRoot),null===(_oldState$reactionVie=oldState.reactionViewerOutsideClickDestructor)||void 0===_oldState$reactionVie||_oldState$reactionVie.call(oldState),{reactionViewerRoot:null,reactionViewerOutsideClickDestructor:void 0};if(!onlyRemove){var root=document.createElement("div");return document.body.appendChild(root),{reactionViewerRoot:root,reactionViewerOutsideClickDestructor:(0,handleOutsideClick.p)((function(){return _this.toggleReactionViewer(!0),!0}),{containerElements:[root,_this.reactionsContainerRef],name:"Message.reactionViewer"})}}return null}))},_this.handleOpen=function(event){var _this$props3=_this.props,attachments=_this$props3.attachments,contact=_this$props3.contact,showLightboxForViewOnceMedia=_this$props3.showLightboxForViewOnceMedia,direction=_this$props3.direction,giftBadge=_this$props3.giftBadge,id=_this$props3.id,isTapToView=_this$props3.isTapToView,isTapToViewExpired=_this$props3.isTapToViewExpired,kickOffAttachmentDownload=_this$props3.kickOffAttachmentDownload,startConversation=_this$props3.startConversation,openGiftBadge=_this$props3.openGiftBadge,pushPanelForConversation=_this$props3.pushPanelForConversation,showLightbox=_this$props3.showLightbox,showExpiredIncomingTapToViewToast=_this$props3.showExpiredIncomingTapToViewToast,showExpiredOutgoingTapToViewToast=_this$props3.showExpiredOutgoingTapToViewToast,imageBroken=_this.state.imageBroken,isAttachmentPending=_this.isAttachmentPending();if(giftBadge&&giftBadge.state===GiftBadgeStates.Unopened)openGiftBadge(id);else{if(isTapToView)return isAttachmentPending?void log.info("<Message> handleOpen: tap-to-view attachment is pending; not showing the lightbox"):(event.preventDefault(),event.stopPropagation(),isTapToViewExpired?void("outgoing"===direction?showExpiredOutgoingTapToViewToast:showExpiredIncomingTapToViewToast)():attachments&&!(0,Attachment.TG)(attachments[0])?void kickOffAttachmentDownload({attachment:attachments[0],messageId:id}):void showLightboxForViewOnceMedia(id));if(!imageBroken&&attachments&&attachments.length>0&&!isAttachmentPending&&!(0,Attachment.TG)(attachments[0]))return event.preventDefault(),event.stopPropagation(),void kickOffAttachmentDownload({attachment:attachments[0],messageId:id});if(!imageBroken&&attachments&&attachments.length>0&&!isAttachmentPending&&(0,Attachment.cR)(attachments)&&((0,Attachment.Or)(attachments)&&(0,Attachment.UO)(attachments)||(0,Attachment.Wv)(attachments)&&(0,Attachment.O$)(attachments)))return event.preventDefault(),event.stopPropagation(),void showLightbox({attachment:attachments[0],messageId:id});if(attachments&&1===attachments.length&&!isAttachmentPending&&!(0,Attachment.F0)(attachments))return event.preventDefault(),event.stopPropagation(),void _this.openGenericAttachment();if(!isAttachmentPending&&(0,Attachment.F0)(attachments)&&_this.audioButtonRef&&_this.audioButtonRef.current)return event.preventDefault(),event.stopPropagation(),void _this.audioButtonRef.current.click();if(contact&&contact.firstNumber&&contact.uuid)return startConversation(contact.firstNumber,contact.uuid),event.preventDefault(),void event.stopPropagation();if(contact){var signalAccount=contact.firstNumber&&contact.uuid?{phoneNumber:contact.firstNumber,uuid:contact.uuid}:void 0;pushPanelForConversation({type:Panels.w.ContactDetails,args:{contact,signalAccount}}),event.preventDefault(),event.stopPropagation()}}},_this.openGenericAttachment=function(event){var _this$props4=_this.props,id=_this$props4.id,attachments=_this$props4.attachments,saveAttachment=_this$props4.saveAttachment,timestamp=_this$props4.timestamp,kickOffAttachmentDownload=_this$props4.kickOffAttachmentDownload;if(event&&(event.preventDefault(),event.stopPropagation()),attachments&&1===attachments.length){var attachment=attachments[0];(0,Attachment.TG)(attachment)?saveAttachment(attachment,timestamp):kickOffAttachmentDownload({attachment,messageId:id})}},_this.handleClick=function(event){var text=_this.props.text;text&&text.length>0||_this.handleOpen(event)},_this.state={metadataWidth:_this.guessMetadataWidth(),expiring:!1,expired:!1,imageBroken:!1,isTargeted:props.isTargeted,prevTargetedCounter:props.isTargetedCounter,reactionViewerRoot:null,giftBadgeCounter:null,showOutgoingGiftBadgeModal:!1,hasDeleteForEveryoneTimerExpired:_this.getTimeRemainingForDeleteForEveryone()<=0},_this}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Message,[{key:"hasReactions",value:function hasReactions(){var reactions=this.props.reactions;return Boolean(reactions&&reactions.length)}},{key:"componentDidMount",value:function componentDidMount(){var _window$ConversationC,_this2=this,conversationId=this.props.conversationId;null===(_window$ConversationC=window.ConversationController)||void 0===_window$ConversationC||_window$ConversationC.onConvoMessageMount(conversationId),this.startTargetedTimer(),this.startDeleteForEveryoneTimerIfApplicable(),this.startGiftBadgeInterval(),this.props.isTargeted&&this.setFocus();var expirationLength=this.props.expirationLength;if(expirationLength){var increment=(0,timer.R)(expirationLength),checkFrequency=Math.max(2e3,increment);this.checkExpired(),this.expirationCheckInterval=setInterval((function(){_this2.checkExpired()}),checkFrequency)}var _this$props5=this.props,contact=_this$props5.contact,checkForAccount=_this$props5.checkForAccount;contact&&contact.firstNumber&&!contact.uuid&&checkForAccount(contact.firstNumber),document.addEventListener("selectionchange",this.handleSelectionChange)}},{key:"componentWillUnmount",value:function componentWillUnmount(){(0,clearTimeoutIfNecessary.S)(this.targetedTimeout),(0,clearTimeoutIfNecessary.S)(this.expirationCheckInterval),(0,clearTimeoutIfNecessary.S)(this.expiredTimeout),(0,clearTimeoutIfNecessary.S)(this.deleteForEveryoneTimeout),(0,clearTimeoutIfNecessary.S)(this.giftBadgeInterval),this.toggleReactionViewer(!0),document.removeEventListener("selectionchange",this.handleSelectionChange)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this$props6=this.props,isTargeted=_this$props6.isTargeted,status=_this$props6.status,timestamp=_this$props6.timestamp;if(this.startTargetedTimer(),this.startDeleteForEveryoneTimerIfApplicable(),!prevProps.isTargeted&&isTargeted&&this.setFocus(),this.checkExpired(),"sending"===prevProps.status&&("sent"===status||"delivered"===status||"read"===status||"viewed"===status)){var _window$SignalCI,delta=Date.now()-timestamp;null===(_window$SignalCI=window.SignalCI)||void 0===_window$SignalCI||_window$SignalCI.handleEvent("message:send-complete",{timestamp,delta}),log.info(`Message.tsx: Rendered 'send complete' for message ${timestamp}; took ${delta}ms`)}}},{key:"getMetadataPlacement",value:function getMetadataPlacement(){var _ref2=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,attachments=_ref2.attachments,deletedForEveryone=_ref2.deletedForEveryone,direction=_ref2.direction,expirationLength=_ref2.expirationLength,expirationTimestamp=_ref2.expirationTimestamp,giftBadge=_ref2.giftBadge,i18n=_ref2.i18n,shouldHideMetadata=_ref2.shouldHideMetadata,status=_ref2.status,text=_ref2.text;if(!expirationLength&&!expirationTimestamp&&(!status||SENT_STATUSES.has(status))&&shouldHideMetadata)return MetadataPlacement.NotRendered;if(giftBadge){var description=i18n("incoming"===direction?"icu:message--donation--unopened--incoming":"icu:message--donation--unopened--outgoing"),isDescriptionRTL="rtl"===direction_default()(description);return giftBadge.state!==GiftBadgeStates.Unopened||isDescriptionRTL?MetadataPlacement.Bottom:MetadataPlacement.InlineWithText}return text||deletedForEveryone?this.canRenderStickerLikeEmoji()?MetadataPlacement.Bottom:MetadataPlacement.InlineWithText:(0,Attachment.F0)(attachments)?MetadataPlacement.RenderedByMessageAudioComponent:MetadataPlacement.Bottom}},{key:"guessMetadataWidth",value:function guessMetadataWidth(){var _this$props7=this.props,direction=_this$props7.direction,expirationLength=_this$props7.expirationLength,status=_this$props7.status,result=16;return _this$props7.isEditedMessage&&(result+=40),Boolean(expirationLength)&&(result+=18),"outgoing"===direction&&status&&(result+=GUESS_METADATA_WIDTH_OUTGOING_SIZE[status]),result}},{key:"startTargetedTimer",value:function startTargetedTimer(){var _this3=this,_this$props8=this.props,clearTargetedMessage=_this$props8.clearTargetedMessage,interactionMode=_this$props8.interactionMode,isTargeted=this.state.isTargeted;"keyboard"!==interactionMode&&isTargeted&&(this.targetedTimeout||(this.targetedTimeout=setTimeout((function(){_this3.targetedTimeout=void 0,_this3.setState({isTargeted:!1}),clearTargetedMessage()}),1200)))}},{key:"startGiftBadgeInterval",value:function startGiftBadgeInterval(){var _this4=this;this.props.giftBadge&&(this.giftBadgeInterval=setInterval((function(){_this4.updateGiftBadgeCounter()}),GIFT_BADGE_UPDATE_INTERVAL))}},{key:"updateGiftBadgeCounter",value:function updateGiftBadgeCounter(){this.setState((function(state){return{giftBadgeCounter:(state.giftBadgeCounter||0)+1}}))}},{key:"getTimeRemainingForDeleteForEveryone",value:function getTimeRemainingForDeleteForEveryone(){var timestamp=this.props.timestamp;return Math.max(timestamp-Date.now()+108e5,0)}},{key:"startDeleteForEveryoneTimerIfApplicable",value:function startDeleteForEveryoneTimerIfApplicable(){var _this5=this,canDeleteForEveryone=this.props.canDeleteForEveryone,hasDeleteForEveryoneTimerExpired=this.state.hasDeleteForEveryoneTimerExpired;!canDeleteForEveryone||hasDeleteForEveryoneTimerExpired||this.deleteForEveryoneTimeout||(this.deleteForEveryoneTimeout=setTimeout((function(){_this5.setState({hasDeleteForEveryoneTimerExpired:!0}),delete _this5.deleteForEveryoneTimeout}),this.getTimeRemainingForDeleteForEveryone()))}},{key:"checkExpired",value:function checkExpired(){var _this6=this,now=Date.now(),_this$props9=this.props,expirationTimestamp=_this$props9.expirationTimestamp,expirationLength=_this$props9.expirationLength;if(expirationTimestamp&&expirationLength&&!this.expiredTimeout&&now>=expirationTimestamp){this.setState({expiring:!0});this.expiredTimeout=setTimeout((function(){_this6.setState({expired:!0})}),600)}}},{key:"areLinksEnabled",value:function areLinksEnabled(){var _this$props10=this.props,isMessageRequestAccepted=_this$props10.isMessageRequestAccepted,isBlocked=_this$props10.isBlocked;return isMessageRequestAccepted&&!isBlocked}},{key:"shouldRenderAuthor",value:function shouldRenderAuthor(){var _this$props11=this.props,author=_this$props11.author,conversationType=_this$props11.conversationType,direction=_this$props11.direction,shouldCollapseAbove=_this$props11.shouldCollapseAbove;return Boolean("incoming"===direction&&"group"===conversationType&&author.title&&!shouldCollapseAbove)}},{key:"canRenderStickerLikeEmoji",value:function canRenderStickerLikeEmoji(){var _this$props12=this.props,text=_this$props12.text,quote=_this$props12.quote,storyReplyContext=_this$props12.storyReplyContext,attachments=_this$props12.attachments,previews=_this$props12.previews;return Boolean(text&&!(0,lib.Mz)(text)&&(0,lib.J7)(text)<6&&!quote&&!storyReplyContext&&(!attachments||!attachments.length)&&(!previews||!previews.length))}},{key:"renderMetadata",value:function renderMetadata(){var isInline,metadataPlacement=this.getMetadataPlacement();switch(metadataPlacement){case MetadataPlacement.NotRendered:case MetadataPlacement.RenderedByMessageAudioComponent:return null;case MetadataPlacement.InlineWithText:isInline=!0;break;case MetadataPlacement.Bottom:isInline=!1;break;default:log.error((0,missingCaseError.b)(metadataPlacement)),isInline=!1}var _this$props13=this.props,deletedForEveryone=_this$props13.deletedForEveryone,direction=_this$props13.direction,expirationLength=_this$props13.expirationLength,expirationTimestamp=_this$props13.expirationTimestamp,i18n=_this$props13.i18n,id=_this$props13.id,isEditedMessage=_this$props13.isEditedMessage,isSticker=_this$props13.isSticker,isTapToViewExpired=_this$props13.isTapToViewExpired,retryMessageSend=_this$props13.retryMessageSend,pushPanelForConversation=_this$props13.pushPanelForConversation,showEditHistoryModal=_this$props13.showEditHistoryModal,status=_this$props13.status,text=_this$props13.text,textAttachment=_this$props13.textAttachment,timestamp=_this$props13.timestamp,isStickerLike=isSticker||this.canRenderStickerLikeEmoji();return(0,jsx_runtime.jsx)(MessageMetadata.h,{deletedForEveryone,direction,expirationLength,expirationTimestamp,hasText:Boolean(text),i18n,id,isEditedMessage,isInline,isShowingImage:this.isShowingImage(),isSticker:isStickerLike,isTapToViewExpired,onWidthMeasured:isInline?this.updateMetadataWidth:void 0,pushPanelForConversation,retryMessageSend,showEditHistoryModal,status,textPending:null==textAttachment?void 0:textAttachment.pending,timestamp})}},{key:"renderAuthor",value:function renderAuthor(){var _this$props14=this.props,author=_this$props14.author,contactNameColor=_this$props14.contactNameColor,i18n=_this$props14.i18n,isSticker=_this$props14.isSticker,isTapToView=_this$props14.isTapToView,isTapToViewExpired=_this$props14.isTapToViewExpired;if(!this.shouldRenderAuthor())return null;var moduleName=`module-message__author${isSticker?"_with_sticker":""}${isTapToView&&isTapToViewExpired?"--with-tap-to-view-expired":""}`;return(0,jsx_runtime.jsx)("div",{className:moduleName,children:(0,jsx_runtime.jsx)(ContactName.K,{contactNameColor,title:author.isMe?i18n("icu:you"):author.title,module:moduleName})})}},{key:"renderAttachment",value:function renderAttachment(){var _this7=this,_this$props15=this.props,attachments=_this$props15.attachments,conversationId=_this$props15.conversationId,direction=_this$props15.direction,expirationLength=_this$props15.expirationLength,expirationTimestamp=_this$props15.expirationTimestamp,i18n=_this$props15.i18n,id=_this$props15.id,isSticker=_this$props15.isSticker,kickOffAttachmentDownload=_this$props15.kickOffAttachmentDownload,markAttachmentAsCorrupted=_this$props15.markAttachmentAsCorrupted,pushPanelForConversation=_this$props15.pushPanelForConversation,quote=_this$props15.quote,readStatus=_this$props15.readStatus,renderAudioAttachment=_this$props15.renderAudioAttachment,renderingContext=_this$props15.renderingContext,shouldCollapseAbove=_this$props15.shouldCollapseAbove,shouldCollapseBelow=_this$props15.shouldCollapseBelow,showLightbox=_this$props15.showLightbox,status=_this$props15.status,text=_this$props15.text,textAttachment=_this$props15.textAttachment,theme=_this$props15.theme,timestamp=_this$props15.timestamp,imageBroken=this.state.imageBroken,collapseMetadata=this.getMetadataPlacement()===MetadataPlacement.NotRendered;if(!attachments||!attachments[0])return null;var firstAttachment=attachments[0],withContentBelow=Boolean(text),withContentAbove=Boolean(quote)||this.shouldRenderAuthor();if((0,Attachment.cR)(attachments)&&!imageBroken){var prefix=isSticker?"sticker":"attachment",containerClassName=classnames_default()(`module-message__${prefix}-container`,withContentAbove?`module-message__${prefix}-container--with-content-above`:null,withContentBelow?"module-message__attachment-container--with-content-below":null,isSticker&&!collapseMetadata?"module-message__sticker-container--with-content-below":null);if((0,Attachment.DQ)(attachments))return(0,jsx_runtime.jsx)("div",{className:containerClassName,children:(0,jsx_runtime.jsx)(GIF,{attachment:firstAttachment,size:300,theme,i18n,tabIndex:0,onError:this.handleImageError,showVisualAttachment:function(){showLightbox({attachment:firstAttachment,messageId:id})},kickOffAttachmentDownload:function(){kickOffAttachmentDownload({attachment:firstAttachment,messageId:id})}})});if((0,Attachment.Or)(attachments)||(0,Attachment.Wv)(attachments)&&(!(0,Attachment.TG)(attachments[0])||null==attachments||!attachments[0].pending||(0,Attachment.O$)(attachments))){var bottomOverlay=!isSticker&&!collapseMetadata,tabIndex=attachments.length>1?0:-1;return(0,jsx_runtime.jsx)("div",{className:containerClassName,children:(0,jsx_runtime.jsx)(ImageGrid.E,{attachments,direction,withContentAbove:isSticker||withContentAbove,withContentBelow:isSticker||withContentBelow,isSticker,stickerSize:200,bottomOverlay,i18n,onError:this.handleImageError,theme,shouldCollapseAbove,shouldCollapseBelow,tabIndex,onClick:function(attachment){(0,Attachment.TG)(attachment)?showLightbox({attachment,messageId:id}):kickOffAttachmentDownload({attachment,messageId:id})}})})}}if((0,Attachment.F0)(attachments)){var played=(0,Attachment.kU)(direction,status,readStatus);return renderAudioAttachment({i18n,buttonRef:this.audioButtonRef,renderingContext,theme,attachment:firstAttachment,collapseMetadata,withContentAbove,withContentBelow,direction,expirationLength,expirationTimestamp,id,conversationId,played,pushPanelForConversation,status,textPending:null==textAttachment?void 0:textAttachment.pending,timestamp,kickOffAttachmentDownload:function(){kickOffAttachmentDownload({attachment:firstAttachment,messageId:id})},onCorrupted:function(){markAttachmentAsCorrupted({attachment:firstAttachment,messageId:id})}})}var pending=firstAttachment.pending,fileName=firstAttachment.fileName,fileSize=firstAttachment.fileSize,contentType=firstAttachment.contentType,extension=(0,Attachment.Gq)({contentType,fileName}),isDangerous=function isFileDangerous(fileName){return DANGEROUS_FILE_TYPES.test(fileName)}(fileName||"");return(0,jsx_runtime.jsxs)("button",{type:"button",className:classnames_default()("module-message__generic-attachment",withContentBelow?"module-message__generic-attachment--with-content-below":null,withContentAbove?"module-message__generic-attachment--with-content-above":null,firstAttachment.url?null:"module-message__generic-attachment--not-active"),tabIndex:-1,onClick:function(event){event.stopPropagation(),event.preventDefault(),(0,Attachment.TG)(firstAttachment)?_this7.openGenericAttachment():kickOffAttachmentDownload({attachment:firstAttachment,messageId:id})},children:[pending?(0,jsx_runtime.jsx)("div",{className:"module-message__generic-attachment__spinner-container",children:(0,jsx_runtime.jsx)(Spinner.$j,{svgSize:"small",size:"24px",direction})}):(0,jsx_runtime.jsxs)("div",{className:"module-message__generic-attachment__icon-container",children:[(0,jsx_runtime.jsx)("div",{className:"module-message__generic-attachment__icon",children:extension?(0,jsx_runtime.jsx)("div",{className:"module-message__generic-attachment__icon__extension",children:extension}):null}),isDangerous?(0,jsx_runtime.jsx)("div",{className:"module-message__generic-attachment__icon-dangerous-container",children:(0,jsx_runtime.jsx)("div",{className:"module-message__generic-attachment__icon-dangerous"})}):null]}),(0,jsx_runtime.jsxs)("div",{className:"module-message__generic-attachment__text",children:[(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__generic-attachment__file-name",`module-message__generic-attachment__file-name--${direction}`),children:fileName}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__generic-attachment__file-size",`module-message__generic-attachment__file-size--${direction}`),children:fileSize})]})]})}},{key:"renderPreview",value:function renderPreview(){var _this$props16=this.props,attachments=_this$props16.attachments,conversationType=_this$props16.conversationType,direction=_this$props16.direction,i18n=_this$props16.i18n,id=_this$props16.id,kickOffAttachmentDownload=_this$props16.kickOffAttachmentDownload,previews=_this$props16.previews,quote=_this$props16.quote,shouldCollapseAbove=_this$props16.shouldCollapseAbove,theme=_this$props16.theme;if(attachments&&attachments.length)return null;if(!previews||previews.length<1)return null;var first=previews[0];if(!first)return null;var withContentAbove=Boolean(quote)||!shouldCollapseAbove&&"group"===conversationType&&"incoming"===direction,previewHasImage=(0,Attachment.VV)(first.image),isFullSizeImage=shouldUseFullSizeLinkPreviewImage(first),linkPreviewDate=first.date||null,isClickable=this.areLinksEnabled(),className=classnames_default()("module-message__link-preview",`module-message__link-preview--${direction}`,{"module-message__link-preview--with-content-above":withContentAbove,"module-message__link-preview--nonclickable":!isClickable}),onPreviewImageClick=isClickable?function(){!first.image||(0,Attachment.TG)(first.image)?(0,openLinkInWebBrowser.P)(first.url):kickOffAttachmentDownload({attachment:first.image,messageId:id})}:noop_default(),contents=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[first.image&&previewHasImage&&isFullSizeImage?(0,jsx_runtime.jsx)(ImageGrid.E,{attachments:[first.image],withContentAbove,direction,shouldCollapseAbove,withContentBelow:!0,onError:this.handleImageError,i18n,theme,onClick:onPreviewImageClick}):null,(0,jsx_runtime.jsxs)("div",{className:"module-message__link-preview__content",children:[first.image&&first.domain&&previewHasImage&&!isFullSizeImage?(0,jsx_runtime.jsx)("div",{className:"module-message__link-preview__icon_container",children:(0,jsx_runtime.jsx)(Image.E,{noBorder:!0,noBackground:!0,curveBottomLeft:withContentAbove?Image.v.Tiny:Image.v.Small,curveBottomRight:Image.v.Tiny,curveTopRight:Image.v.Tiny,curveTopLeft:Image.v.Tiny,alt:i18n("icu:previewThumbnail",{domain:first.domain}),height:72,width:72,url:first.image.url,attachment:first.image,blurHash:first.image.blurHash,onError:this.handleImageError,i18n,onClick:onPreviewImageClick})}):null,(0,jsx_runtime.jsxs)("div",{dir:"auto",className:classnames_default()("module-message__link-preview__text",previewHasImage&&!isFullSizeImage?"module-message__link-preview__text--with-icon":null),children:[(0,jsx_runtime.jsx)("div",{className:"module-message__link-preview__title",children:first.title}),first.description&&(0,jsx_runtime.jsx)("div",{className:"module-message__link-preview__description",children:unescape_default()(first.description)}),(0,jsx_runtime.jsxs)("div",{className:"module-message__link-preview__footer",children:[(0,jsx_runtime.jsx)("div",{className:"module-message__link-preview__location",children:first.domain}),(0,jsx_runtime.jsx)(LinkPreviewDate.t,{date:linkPreviewDate,className:"module-message__link-preview__date"})]})]})]})]});return isClickable?(0,jsx_runtime.jsx)("div",{role:"link",tabIndex:0,className,onKeyDown:function(event){"Enter"!==event.key&&"Space"!==event.key||(event.stopPropagation(),event.preventDefault(),(0,openLinkInWebBrowser.P)(first.url))},onClick:function(event){event.stopPropagation(),event.preventDefault(),(0,openLinkInWebBrowser.P)(first.url)},children:contents}):(0,jsx_runtime.jsx)("div",{className,children:contents})}},{key:"renderGiftBadge",value:function renderGiftBadge(){var _this8=this,_this$props17=this.props,conversationTitle=_this$props17.conversationTitle,direction=_this$props17.direction,getPreferredBadge=_this$props17.getPreferredBadge,giftBadge=_this$props17.giftBadge,i18n=_this$props17.i18n,showOutgoingGiftBadgeModal=this.state.showOutgoingGiftBadgeModal;if(!giftBadge)return null;if(giftBadge.state===GiftBadgeStates.Unopened){var description=i18n("incoming"===direction?"icu:message--donation--unopened--incoming":"icu:message--donation--unopened--outgoing"),metadataWidth=this.state.metadataWidth;return(0,jsx_runtime.jsxs)("div",{className:"module-message__unopened-gift-badge__container",children:[(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message__unopened-gift-badge",`module-message__unopened-gift-badge--${direction}`),"aria-label":i18n("icu:message--donation--unopened--label",{sender:conversationTitle}),children:[(0,jsx_runtime.jsx)("div",{className:"module-message__unopened-gift-badge__ribbon-horizontal","aria-hidden":!0}),(0,jsx_runtime.jsx)("div",{className:"module-message__unopened-gift-badge__ribbon-vertical","aria-hidden":!0}),(0,jsx_runtime.jsx)("img",{className:"module-message__unopened-gift-badge__bow",src:"images/gift-bow.svg",alt:"","aria-hidden":!0})]}),(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message__unopened-gift-badge__text",`module-message__unopened-gift-badge__text--${direction}`),children:[(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message__text",`module-message__text--${direction}`),children:[description,this.getMetadataPlacement()===MetadataPlacement.InlineWithText&&(0,jsx_runtime.jsx)(MessageTextMetadataSpacer,{metadataWidth})]}),this.renderMetadata()]})]})}if(giftBadge.state===GiftBadgeStates.Redeemed||giftBadge.state===GiftBadgeStates.Opened){var remaining,badgeId=giftBadge.id||`BOOST-${giftBadge.level}`,badge=getPreferredBadge([{id:badgeId}]),badgeImagePath=(0,getBadgeImageFileLocalPath.p)(badge,64,BadgeImageTheme.c.Transparent),duration=giftBadge.expiration-Date.now(),remainingDays=Math.floor(duration/durations.x4),remainingHours=Math.floor(duration/durations.kr),remainingMinutes=Math.floor(duration/durations.EB);remaining=remainingDays>1?i18n("icu:message--donation--remaining--days",{days:remainingDays}):remainingHours>1?i18n("icu:message--donation--remaining--hours",{hours:remainingHours}):remainingMinutes>0?i18n("icu:message--donation--remaining--minutes",{minutes:remainingMinutes}):i18n("icu:message--donation--expired");var wasSent="outgoing"===direction,buttonContents=wasSent?i18n("icu:message--donation--view"):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:classnames_default()("module-message__redeemed-gift-badge__icon-check",`module-message__redeemed-gift-badge__icon-check--${direction}`)})," ",i18n("icu:message--donation--redeemed")]}),badgeElement=badge?(0,jsx_runtime.jsx)("img",{className:"module-message__redeemed-gift-badge__badge",src:badgeImagePath,alt:badge.name}):(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__redeemed-gift-badge__badge",`module-message__redeemed-gift-badge__badge--missing-${direction}`),"aria-label":i18n("icu:donation--missing")});return(0,jsx_runtime.jsxs)("div",{className:"module-message__redeemed-gift-badge__container",children:[(0,jsx_runtime.jsxs)("div",{className:"module-message__redeemed-gift-badge",children:[badgeElement,(0,jsx_runtime.jsxs)("div",{className:"module-message__redeemed-gift-badge__text",children:[(0,jsx_runtime.jsx)("div",{className:"module-message__redeemed-gift-badge__title",children:i18n("icu:message--donation")}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__redeemed-gift-badge__remaining",`module-message__redeemed-gift-badge__remaining--${direction}`),children:remaining})]})]}),(0,jsx_runtime.jsx)("button",{className:classnames_default()("module-message__redeemed-gift-badge__button",`module-message__redeemed-gift-badge__button--${direction}`),disabled:!wasSent,onClick:wasSent?function(){return _this8.setState({showOutgoingGiftBadgeModal:!0})}:void 0,type:"button",children:(0,jsx_runtime.jsx)("div",{className:"module-message__redeemed-gift-badge__button__text",children:buttonContents})}),this.renderMetadata(),showOutgoingGiftBadgeModal?(0,jsx_runtime.jsx)(OutgoingGiftBadgeModal.H,{i18n,recipientTitle:conversationTitle,badgeId,getPreferredBadge,hideOutgoingGiftBadgeModal:function(){return _this8.setState({showOutgoingGiftBadgeModal:!1})}}):null]})}throw(0,missingCaseError.b)(giftBadge.state)}},{key:"renderPayment",value:function renderPayment(){var _this$props18=this.props,payment=_this$props18.payment,direction=_this$props18.direction,author=_this$props18.author,conversationTitle=_this$props18.conversationTitle,conversationColor=_this$props18.conversationColor,i18n=_this$props18.i18n;return null==payment||payment.kind!==Payment.s.Notification?null:(0,jsx_runtime.jsxs)("div",{className:"module-payment-notification__container "+("outgoing"===direction?`module-payment-notification--outgoing module-payment-notification--outgoing-${conversationColor}`:""),children:[(0,jsx_runtime.jsx)("p",{className:"module-payment-notification__label",children:(0,helpers.rW)(payment,author.title,conversationTitle,author.isMe,i18n)}),(0,jsx_runtime.jsx)("p",{className:"module-payment-notification__check_device_box",children:i18n("icu:payment-event-notification-check-primary-device")}),null!=payment.note&&(0,jsx_runtime.jsx)("p",{className:"module-payment-notification__note",children:(0,jsx_runtime.jsx)(UserText.a,{text:payment.note})})]})}},{key:"renderQuote",value:function renderQuote(){var _this$props19=this.props,conversationColor=_this$props19.conversationColor,conversationId=_this$props19.conversationId,conversationTitle=_this$props19.conversationTitle,customColor=_this$props19.customColor,direction=_this$props19.direction,disableScroll=_this$props19.disableScroll,doubleCheckMissingQuoteReference=_this$props19.doubleCheckMissingQuoteReference,i18n=_this$props19.i18n,id=_this$props19.id,quote=_this$props19.quote,scrollToQuotedMessage=_this$props19.scrollToQuotedMessage;if(!quote)return null;var isGiftBadge=quote.isGiftBadge,isViewOnce=quote.isViewOnce,referencedMessageNotFound=quote.referencedMessageNotFound,clickHandler=disableScroll?void 0:function(){scrollToQuotedMessage({authorId:quote.authorId,conversationId,sentAt:quote.sentAt})},isIncoming="incoming"===direction;return(0,jsx_runtime.jsx)(Quote.p,{i18n,onClick:clickHandler,text:quote.text,rawAttachment:quote.rawAttachment,payment:quote.payment,isIncoming,authorTitle:quote.authorTitle,bodyRanges:quote.bodyRanges,conversationColor,conversationTitle,customColor,isViewOnce,isGiftBadge,referencedMessageNotFound,isFromMe:quote.isFromMe,doubleCheckMissingQuoteReference:function(){return doubleCheckMissingQuoteReference(id)}})}},{key:"renderStoryReplyContext",value:function renderStoryReplyContext(){var _this$props20=this.props,conversationTitle=_this$props20.conversationTitle,conversationColor=_this$props20.conversationColor,customColor=_this$props20.customColor,direction=_this$props20.direction,i18n=_this$props20.i18n,storyReplyContext=_this$props20.storyReplyContext,viewStory=_this$props20.viewStory;if(!storyReplyContext)return null;var isIncoming="incoming"===direction;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[storyReplyContext.emoji&&(0,jsx_runtime.jsx)("div",{className:"module-message__quote-story-reaction-header",children:i18n("icu:Quote__story-reaction",{name:storyReplyContext.authorTitle})}),(0,jsx_runtime.jsx)(Quote.p,{authorTitle:storyReplyContext.authorTitle,conversationColor,conversationTitle,customColor,i18n,isFromMe:storyReplyContext.isFromMe,isGiftBadge:!1,isIncoming,isStoryReply:!0,isViewOnce:!1,moduleClassName:"StoryReplyQuote",onClick:function(){storyReplyContext.storyId&&viewStory({storyId:storyReplyContext.storyId,storyViewMode:Stories.bX.Single})},rawAttachment:storyReplyContext.rawAttachment,reactionEmoji:storyReplyContext.emoji,referencedMessageNotFound:!storyReplyContext.storyId,text:storyReplyContext.text})]})}},{key:"renderEmbeddedContact",value:function renderEmbeddedContact(){var _this$props21=this.props,contact=_this$props21.contact,conversationType=_this$props21.conversationType,direction=_this$props21.direction,i18n=_this$props21.i18n,pushPanelForConversation=_this$props21.pushPanelForConversation,text=_this$props21.text;if(!contact)return null;var withCaption=Boolean(text),withContentAbove="group"===conversationType&&"incoming"===direction,withContentBelow=withCaption||this.getMetadataPlacement()!==MetadataPlacement.NotRendered,tabIndex=contact&&contact.firstNumber&&contact.uuid||withCaption?0:-1;return(0,jsx_runtime.jsx)(EmbeddedContact,{contact,isIncoming:"incoming"===direction,i18n,onClick:function(){var signalAccount=contact.firstNumber&&contact.uuid?{phoneNumber:contact.firstNumber,uuid:contact.uuid}:void 0;pushPanelForConversation({type:Panels.w.ContactDetails,args:{contact,signalAccount}})},withContentAbove,withContentBelow,tabIndex})}},{key:"renderSendMessageButton",value:function renderSendMessageButton(){var _this$props22=this.props,contact=_this$props22.contact,direction=_this$props22.direction,shouldCollapseBelow=_this$props22.shouldCollapseBelow,startConversation=_this$props22.startConversation,i18n=_this$props22.i18n,noBottomLeftCurve="incoming"===direction&&shouldCollapseBelow,noBottomRightCurve="outgoing"===direction&&shouldCollapseBelow;if(!contact)return null;var firstNumber=contact.firstNumber,uuid=contact.uuid;return firstNumber&&uuid?(0,jsx_runtime.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),startConversation(firstNumber,uuid)},className:classnames_default()("module-message__send-message-button",noBottomLeftCurve&&"module-message__send-message-button--no-bottom-left-curve",noBottomRightCurve&&"module-message__send-message-button--no-bottom-right-curve"),children:i18n("icu:sendMessageToContact")}):null}},{key:"renderAvatar",value:function renderAvatar(){var _this$props23=this.props,author=_this$props23.author,conversationId=_this$props23.conversationId,conversationType=_this$props23.conversationType,direction=_this$props23.direction,getPreferredBadge=_this$props23.getPreferredBadge,i18n=_this$props23.i18n,shouldCollapseBelow=_this$props23.shouldCollapseBelow,showContactModal=_this$props23.showContactModal,theme=_this$props23.theme;return"group"!==conversationType||"incoming"!==direction?null:(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__author-avatar-container",{"module-message__author-avatar-container--with-reactions":this.hasReactions()}),children:shouldCollapseBelow?(0,jsx_runtime.jsx)(AvatarSpacer,{size:GROUP_AVATAR_SIZE}):(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest:author.acceptedMessageRequest,avatarPath:author.avatarPath,badge:getPreferredBadge(author.badges),color:author.color,conversationType:"direct",i18n,isMe:author.isMe,onClick:function(event){event.stopPropagation(),event.preventDefault(),showContactModal(author.id,conversationId)},phoneNumber:author.phoneNumber,profileName:author.profileName,sharedGroupNames:author.sharedGroupNames,size:GROUP_AVATAR_SIZE,theme,title:author.title,unblurredAvatarPath:author.unblurredAvatarPath})})}},{key:"renderText",value:function renderText(){var _this$props24=this.props,bodyRanges=_this$props24.bodyRanges,deletedForEveryone=_this$props24.deletedForEveryone,direction=_this$props24.direction,displayLimit=_this$props24.displayLimit,i18n=_this$props24.i18n,id=_this$props24.id,isSpoilerExpanded=_this$props24.isSpoilerExpanded,kickOffAttachmentDownload=_this$props24.kickOffAttachmentDownload,messageExpanded=_this$props24.messageExpanded,showConversation=_this$props24.showConversation,showSpoiler=_this$props24.showSpoiler,status=_this$props24.status,text=_this$props24.text,textAttachment=_this$props24.textAttachment,metadataWidth=this.state.metadataWidth,contents=deletedForEveryone?i18n("icu:message--deletedForEveryone"):"incoming"===direction&&"error"===status?i18n("icu:incomingError"):text;return contents?(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message__text",`module-message__text--${direction}`,"error"===status&&"incoming"===direction?"module-message__text--error":null,deletedForEveryone?"module-message__text--delete-for-everyone":null),onDoubleClick:function(event){event.stopPropagation()},children:[(0,jsx_runtime.jsx)(MessageBodyReadMore.M,{bodyRanges,direction,disableLinks:!this.areLinksEnabled(),displayLimit,i18n,id,isSpoilerExpanded:isSpoilerExpanded||!1,kickOffBodyDownload:function(){textAttachment&&kickOffAttachmentDownload({attachment:textAttachment,messageId:id})},messageExpanded,showConversation,renderLocation:MessageTextRenderer.G5.Timeline,onExpandSpoiler:function(){return showSpoiler(id)},text:contents||"",textAttachment}),this.getMetadataPlacement()===MetadataPlacement.InlineWithText&&(0,jsx_runtime.jsx)(MessageTextMetadataSpacer,{metadataWidth})]}):null}},{key:"renderError",value:function renderError(){var _this$props25=this.props,status=_this$props25.status,direction=_this$props25.direction;return"paused"!==status&&"error"!==status&&"partial-sent"!==status?null:(0,jsx_runtime.jsx)("div",{className:"module-message__error-container",children:(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__error",`module-message__error--${direction}`,`module-message__error--${status}`)})})}},{key:"getWidth",value:function getWidth(){var _this$props26=this.props,attachments=_this$props26.attachments,giftBadge=_this$props26.giftBadge,isSticker=_this$props26.isSticker,previews=_this$props26.previews;if(giftBadge)return 240;if(attachments&&attachments.length){if((0,Attachment.DQ)(attachments))return 302;if(isSticker)return 216;var dimensions=(0,Attachment.R3)(attachments);if(dimensions)return dimensions.width}var firstLinkPreview=(previews||[])[0];if(firstLinkPreview&&firstLinkPreview.image&&shouldUseFullSizeLinkPreviewImage(firstLinkPreview)){var _dimensions=(0,Attachment.pz)(firstLinkPreview.image);if(_dimensions)return _dimensions.width}}},{key:"isShowingImage",value:function isShowingImage(){var _this$props27=this.props,isTapToView=_this$props27.isTapToView,attachments=_this$props27.attachments,previews=_this$props27.previews;if(this.state.imageBroken||isTapToView)return!1;if(attachments&&attachments.length)return(0,Attachment.cR)(attachments)&&((0,Attachment.Or)(attachments)||(0,Attachment.Wv)(attachments));if(previews&&previews.length){var image=previews[0].image;return(0,Attachment.VV)(image)}return!1}},{key:"isAttachmentPending",value:function isAttachmentPending(){var attachments=this.props.attachments;if(!attachments||attachments.length<1)return!1;var first=attachments[0];return Boolean(first.pending)}},{key:"renderTapToViewIcon",value:function renderTapToViewIcon(){var _this$props28=this.props,direction=_this$props28.direction,isTapToViewExpired=_this$props28.isTapToViewExpired,isDownloadPending=this.isAttachmentPending();return!isTapToViewExpired&&isDownloadPending?(0,jsx_runtime.jsx)("div",{className:"module-message__tap-to-view__spinner-container",children:(0,jsx_runtime.jsx)(Spinner.$j,{svgSize:"small",size:"20px",direction})}):(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__tap-to-view__icon",`module-message__tap-to-view__icon--${direction}`,isTapToViewExpired?"module-message__tap-to-view__icon--expired":null)})}},{key:"renderTapToViewText",value:function renderTapToViewText(){var _this$props29=this.props,attachments=_this$props29.attachments,direction=_this$props29.direction,i18n=_this$props29.i18n,isTapToViewExpired=_this$props29.isTapToViewExpired,isTapToViewError=_this$props29.isTapToViewError;if(!this.isAttachmentPending())return isTapToViewError?i18n("icu:incomingError"):"outgoing"===direction?i18n("icu:Message--tap-to-view--outgoing"):isTapToViewExpired?i18n("icu:Message--tap-to-view-expired"):(0,Attachment.Wv)(attachments)?i18n("icu:Message--tap-to-view--incoming-video"):i18n("icu:Message--tap-to-view--incoming")}},{key:"renderTapToView",value:function renderTapToView(){var _this$props30=this.props,conversationType=_this$props30.conversationType,direction=_this$props30.direction,isTapToViewExpired=_this$props30.isTapToViewExpired,isTapToViewError=_this$props30.isTapToViewError,collapseMetadata=this.getMetadataPlacement()===MetadataPlacement.NotRendered,withContentBelow=!collapseMetadata,withContentAbove=!collapseMetadata&&"group"===conversationType&&"incoming"===direction;return(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message__tap-to-view",withContentBelow?"module-message__tap-to-view--with-content-below":null,withContentAbove?"module-message__tap-to-view--with-content-above":null),children:[isTapToViewError?null:this.renderTapToViewIcon(),(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-message__tap-to-view__text",`module-message__tap-to-view__text--${direction}`,isTapToViewExpired?`module-message__tap-to-view__text--${direction}-expired`:null,isTapToViewError?`module-message__tap-to-view__text--${direction}-error`:null),children:this.renderTapToViewText()})]})}},{key:"popperPreventOverflowModifier",value:function popperPreventOverflowModifier(){return{name:"preventOverflow",options:{altAxis:!0,boundary:this.props.containerElementRef.current||void 0,padding:{bottom:16,left:8,right:8,top:16}}}}},{key:"renderReactions",value:function renderReactions(outgoing){var _this9=this,_this$props31=this.props,getPreferredBadge=_this$props31.getPreferredBadge,_this$props31$reactio=_this$props31.reactions,reactions=void 0===_this$props31$reactio?[]:_this$props31$reactio,i18n=_this$props31.i18n,theme=_this$props31.theme;if(!this.hasReactions())return null;var reactionsWithEmojiData=reactions.map((function(reaction){return Object.assign({},reaction,(0,lib.PE)(reaction.emoji))})),groupedAndSortedReactions=Object.values(groupBy_default()(reactionsWithEmojiData,"short_name")).map((function(groupedReactions){return orderBy_default()(groupedReactions,[function(reaction){return reaction.from.isMe},"timestamp"],["desc","desc"])})),ordered=orderBy_default()(groupedAndSortedReactions,["length",function(_ref3){return Message_slicedToArray(_ref3,1)[0].timestamp}],["desc","desc"]),toRender=take_default()(ordered,3).map((function(res){return{emoji:res[0].emoji,count:res.length,isMe:res.some((function(re){return Boolean(re.from.isMe)}))}})),someNotRendered=ordered.length>3,maybeNotRendered=drop_default()(ordered,2),maybeNotRenderedTotal=maybeNotRendered.reduce((function(sum,res){return sum+res.length}),0),notRenderedIsMe=someNotRendered&&maybeNotRendered.some((function(res){return res.some((function(re){return Boolean(re.from.isMe)}))})),reactionViewerRoot=this.state.reactionViewerRoot,popperPlacement=outgoing?"bottom-end":"bottom-start";return(0,jsx_runtime.jsxs)(Manager.dK,{children:[(0,jsx_runtime.jsx)(Reference.s,{children:function(_ref5){var popperRef=_ref5.ref;return(0,jsx_runtime.jsx)("div",{ref:_this9.reactionsContainerRefMerger(_this9.reactionsContainerRef,popperRef),className:classnames_default()("module-message__reactions",outgoing?"module-message__reactions--outgoing":"module-message__reactions--incoming"),onDoubleClick:function(ev){ev.stopPropagation()},children:toRender.map((function(re,i){var isMore=i===toRender.length-1&&someNotRendered,isMoreWithMe=isMore&&notRenderedIsMe;return(0,jsx_runtime.jsx)("button",{type:"button",className:classnames_default()("module-message__reactions__reaction",re.count>1?"module-message__reactions__reaction--with-count":null,outgoing?"module-message__reactions__reaction--outgoing":"module-message__reactions__reaction--incoming",isMoreWithMe||re.isMe&&!isMoreWithMe?"module-message__reactions__reaction--is-me":null),onClick:function(e){e.stopPropagation(),e.preventDefault(),_this9.toggleReactionViewer(!1)},onKeyDown:function(e){"Enter"===e.key&&e.stopPropagation()},children:isMore?(0,jsx_runtime.jsxs)("span",{className:classnames_default()("module-message__reactions__reaction__count","module-message__reactions__reaction__count--no-emoji",isMoreWithMe?"module-message__reactions__reaction__count--is-me":null),children:["+",maybeNotRenderedTotal]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Emoji.d,{size:16,emoji:re.emoji}),re.count>1?(0,jsx_runtime.jsx)("span",{className:classnames_default()("module-message__reactions__reaction__count",re.isMe?"module-message__reactions__reaction__count--is-me":null),children:re.count}):null]})},`${re.emoji}-${i}`)}))})}}),reactionViewerRoot&&(0,react_dom.createPortal)((0,jsx_runtime.jsx)(Popper.r,{placement:popperPlacement,strategy:"fixed",modifiers:[this.popperPreventOverflowModifier()],children:function(_ref6){var ref=_ref6.ref,style=_ref6.style;return(0,jsx_runtime.jsx)(ReactionViewer.N,{ref,style:Object.assign({},style,{zIndex:2}),getPreferredBadge,reactions,i18n,onClose:_this9.toggleReactionViewer,theme})}}),reactionViewerRoot)]})}},{key:"renderContents",value:function renderContents(){var _this$props32=this.props,giftBadge=_this$props32.giftBadge,isTapToView=_this$props32.isTapToView;return _this$props32.deletedForEveryone?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[this.renderText(),this.renderMetadata()]}):giftBadge?this.renderGiftBadge():isTapToView?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[this.renderTapToView(),this.renderMetadata()]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[this.renderQuote(),this.renderStoryReplyContext(),this.renderAttachment(),this.renderPreview(),this.renderPayment(),this.renderEmbeddedContact(),this.renderText(),this.renderMetadata(),this.renderSendMessageButton()]})}},{key:"renderContainer",value:function renderContainer(){var _this$props33=this.props,attachments=_this$props33.attachments,conversationColor=_this$props33.conversationColor,customColor=_this$props33.customColor,deletedForEveryone=_this$props33.deletedForEveryone,direction=_this$props33.direction,giftBadge=_this$props33.giftBadge,id=_this$props33.id,isSticker=_this$props33.isSticker,isTapToView=_this$props33.isTapToView,isTapToViewExpired=_this$props33.isTapToViewExpired,isTapToViewError=_this$props33.isTapToViewError,onContextMenu=_this$props33.onContextMenu,onKeyDown=_this$props33.onKeyDown,text=_this$props33.text,textDirection=_this$props33.textDirection,isTargeted=this.state.isTargeted,isAttachmentPending=this.isAttachmentPending(),width=this.getWidth(),shouldUseWidth=Boolean(giftBadge||this.isShowingImage()),isEmojiOnly=this.canRenderStickerLikeEmoji(),isStickerLike=isSticker||isEmojiOnly,lighterSelect=isTargeted&&"incoming"===direction&&!isStickerLike&&(text||!(0,Attachment.Wv)(attachments)&&!(0,Attachment.Or)(attachments)),containerClassnames=classnames_default()("module-message__container",(0,Attachment.DQ)(attachments)?"module-message__container--gif":null,isTargeted?"module-message__container--targeted":null,lighterSelect?"module-message__container--targeted-lighter":null,isStickerLike?null:`module-message__container--${direction}`,isEmojiOnly?"module-message__container--emoji":null,isTapToView?"module-message__container--with-tap-to-view":null,isTapToView&&isTapToViewExpired?"module-message__container--with-tap-to-view-expired":null,isStickerLike||"outgoing"!==direction?null:`module-message__container--outgoing-${conversationColor}`,isTapToView&&isAttachmentPending&&!isTapToViewExpired?"module-message__container--with-tap-to-view-pending":null,isTapToView&&isAttachmentPending&&!isTapToViewExpired?`module-message__container--${direction}-${conversationColor}-tap-to-view-pending`:null,isTapToViewError?"module-message__container--with-tap-to-view-error":null,this.hasReactions()?"module-message__container--with-reactions":null,deletedForEveryone?"module-message__container--deleted-for-everyone":null),containerStyles={width:shouldUseWidth?width:void 0};return isStickerLike||deletedForEveryone||"outgoing"!==direction||Object.assign(containerStyles,(0,getCustomColorStyle.X)(customColor)),(0,jsx_runtime.jsxs)("div",{className:"module-message__container-outer",children:[(0,jsx_runtime.jsxs)("div",{className:containerClassnames,id:`message-accessibility-contents:${id}`,style:containerStyles,onContextMenu,role:"row",onKeyDown,onClick:this.handleClick,onDoubleClick:function(ev){ev.stopPropagation()},tabIndex:-1,children:[this.renderAuthor(),(0,jsx_runtime.jsx)("div",{dir:TextDirectionToDirAttribute[textDirection],children:this.renderContents()})]}),this.renderReactions("outgoing"===direction)]})}},{key:"renderAltAccessibilityTree",value:function renderAltAccessibilityTree(){var _this$props34=this.props,id=_this$props34.id,i18n=_this$props34.i18n,author=_this$props34.author;return(0,jsx_runtime.jsxs)("span",{className:"module-message__alt-accessibility-tree",children:[(0,jsx_runtime.jsx)("span",{id:`message-accessibility-label:${id}`,children:author.isMe?i18n("icu:messageAccessibilityLabel--outgoing"):i18n("icu:messageAccessibilityLabel--incoming",{author:author.title})}),(0,jsx_runtime.jsx)("span",{id:`message-accessibility-description:${id}`,children:this.renderText()})]})}},{key:"render",value:function render(){var wrapperProps,_this10=this,_this$props35=this.props,id=_this$props35.id,attachments=_this$props35.attachments,direction=_this$props35.direction,i18n=_this$props35.i18n,isSticker=_this$props35.isSticker,isSelected=_this$props35.isSelected,isSelectMode=_this$props35.isSelectMode,onKeyDown=_this$props35.onKeyDown,platform=_this$props35.platform,renderMenu=_this$props35.renderMenu,shouldCollapseAbove=_this$props35.shouldCollapseAbove,shouldCollapseBelow=_this$props35.shouldCollapseBelow,timestamp=_this$props35.timestamp,onToggleSelect=_this$props35.onToggleSelect,onReplyToMessage=_this$props35.onReplyToMessage,isMacOS="darwin"===platform,_this$state=this.state,expired=_this$state.expired,expiring=_this$state.expiring,isTargeted=_this$state.isTargeted,imageBroken=_this$state.imageBroken;return expired?null:!isSticker||!imageBroken&&attachments&&attachments.length?(wrapperProps=isSelectMode?{role:"checkbox","aria-checked":isSelected,"aria-labelledby":`message-accessibility-label:${id}`,"aria-describedby":`message-accessibility-description:${id}`,tabIndex:0,onClick:function(event){event.preventDefault(),onToggleSelect(!isSelected,event.shiftKey)},onKeyDown:function(event){"Space"===event.code&&(event.preventDefault(),onToggleSelect(!isSelected,event.shiftKey))}}:{onMouseDown:function(){_this10.hasSelectedTextRef.current=!1},onClickCapture:function(event){if(isMacOS?event.metaKey:event.ctrlKey){if(_this10.hasSelectedTextRef.current)return;var link=event.target.closest("a[href], [role=link]");if(event.currentTarget.contains(link))return;event.preventDefault(),event.stopPropagation(),onToggleSelect(!0,!1)}},onDoubleClick:function(event){event.stopPropagation(),event.preventDefault(),isSelectMode||onReplyToMessage()}},(0,jsx_runtime.jsxs)("div",Object.assign({"aria-labelledby":`message-accessibility-contents:${id}`,"aria-roledescription":i18n("icu:Message__role-description"),className:classnames_default()("module-message__wrapper",isSelectMode&&"module-message__wrapper--select-mode",isSelected&&"module-message__wrapper--selected"),role:"article"},wrapperProps,{children:[isSelectMode&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{role:"presentation",className:"module-message__select-checkbox"}),this.renderAltAccessibilityTree()]}),(0,jsx_runtime.jsxs)("div",{className:classnames_default()("module-message",`module-message--${direction}`,shouldCollapseAbove&&"module-message--collapsed-above",shouldCollapseBelow&&"module-message--collapsed-below",isTargeted?"module-message--targeted":null,expiring?"module-message--expired":null),"data-testid":timestamp,tabIndex:0,role:"row",onKeyDown,onFocus:this.handleFocus,ref:this.focusRef,inert:isSelectMode?"":void 0,children:[this.renderError(),this.renderAvatar(),this.renderContainer(),null==renderMenu?void 0:renderMenu()]})]}))):null}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){return props.isTargeted?props.isTargeted&&props.isTargetedCounter!==state.prevTargetedCounter?Object.assign({},state,{isTargeted:props.isTargeted,prevTargetedCounter:props.isTargetedCounter}):state:Object.assign({},state,{isTargeted:!1,prevTargetedCounter:0})}}]),Message}(react.PureComponent)},"./ts/components/conversation/MessageBody.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D:()=>MessageBody});__webpack_require__("./node_modules/react/index.js");var _types_Attachment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Attachment.ts"),_emoji_lib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/emoji/lib.ts"),_MessageTextRenderer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/MessageTextRenderer.tsx"),_UserText__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function MessageBody(_ref){var pendingContent,author=_ref.author,bodyRanges=_ref.bodyRanges,direction=_ref.direction,disableJumbomoji=_ref.disableJumbomoji,disableLinks=_ref.disableLinks,i18n=_ref.i18n,isSpoilerExpanded=_ref.isSpoilerExpanded,kickOffBodyDownload=_ref.kickOffBodyDownload,onExpandSpoiler=_ref.onExpandSpoiler,onIncreaseTextLength=_ref.onIncreaseTextLength,prefix=_ref.prefix,renderLocation=_ref.renderLocation,showConversation=_ref.showConversation,text=_ref.text,textAttachment=_ref.textAttachment,hasReadMore=Boolean(onIncreaseTextLength),textWithSuffix=null!=textAttachment&&textAttachment.pending||hasReadMore?`${text}...`:text,sizeClass=disableJumbomoji?void 0:(0,_emoji_lib__WEBPACK_IMPORTED_MODULE_2__.Eb)(text);return hasReadMore?pendingContent=null:null!=textAttachment&&textAttachment.pending?pendingContent=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("span",{className:"MessageBody__highlight",children:[" ",i18n("icu:downloading")]}):textAttachment&&(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_1__.u3)(textAttachment)&&kickOffBodyDownload&&(pendingContent=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("span",{children:[" ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{className:"MessageBody__download-body",onClick:function(){kickOffBodyDownload()},onKeyDown:function(ev){"Space"!==ev.key&&"Enter"!==ev.key||kickOffBodyDownload()},tabIndex:0,type:"button",children:i18n("icu:downloadFullMessage")})]})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("span",{children:[author&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{className:"MessageBody__author",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_4__.a,{text:author})}),":"," "]}),prefix&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{className:"MessageBody__prefix",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_4__.a,{text:prefix})})," "]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_MessageTextRenderer__WEBPACK_IMPORTED_MODULE_3__.mI,{bodyRanges:null!=bodyRanges?bodyRanges:[],direction,disableLinks:null!=disableLinks&&disableLinks,emojiSizeClass:sizeClass,i18n,isSpoilerExpanded,messageText:textWithSuffix,onMentionTrigger:function(conversationId){return null==showConversation?void 0:showConversation({conversationId})},onExpandSpoiler,renderLocation,textLength:text.length}),pendingContent,onIncreaseTextLength?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("button",{className:"MessageBody__read-more",onClick:function(){onIncreaseTextLength()},onKeyDown:function(ev){"Space"!==ev.key&&"Enter"!==ev.key||onIncreaseTextLength()},tabIndex:0,type:"button",children:[" ",i18n("icu:MessageBody--read-more")]}):null]})}MessageBody.displayName="MessageBody"},"./ts/components/conversation/MessageBodyReadMore.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M:()=>MessageBodyReadMore,_:()=>doesMessageBodyOverflow});__webpack_require__("./node_modules/react/index.js");var _MessageBody__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/conversation/MessageBody.tsx"),_util_graphemeAndLinkAwareSlice__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/graphemeAndLinkAwareSlice.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function doesMessageBodyOverflow(str){return str.length>900}function MessageBodyReadMore(_ref){var bodyRanges=_ref.bodyRanges,direction=_ref.direction,disableLinks=_ref.disableLinks,displayLimit=_ref.displayLimit,i18n=_ref.i18n,id=_ref.id,isSpoilerExpanded=_ref.isSpoilerExpanded,kickOffBodyDownload=_ref.kickOffBodyDownload,messageExpanded=_ref.messageExpanded,onExpandSpoiler=_ref.onExpandSpoiler,renderLocation=_ref.renderLocation,showConversation=_ref.showConversation,text=_ref.text,textAttachment=_ref.textAttachment,maxLength=displayLimit||800,_graphemeAndLinkAware=(0,_util_graphemeAndLinkAwareSlice__WEBPACK_IMPORTED_MODULE_2__.r)(text,maxLength,100),hasReadMore=_graphemeAndLinkAware.hasReadMore,slicedText=_graphemeAndLinkAware.text,onIncreaseTextLength=hasReadMore?function(){messageExpanded(id,maxLength+3e3)}:void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_MessageBody__WEBPACK_IMPORTED_MODULE_1__.D,{bodyRanges,direction,disableLinks,i18n,isSpoilerExpanded,kickOffBodyDownload,onExpandSpoiler,onIncreaseTextLength,renderLocation,showConversation,text:slicedText,textAttachment})}MessageBodyReadMore.displayName="MessageBodyReadMore"},"./ts/components/conversation/MessageMetadata.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>MessageMetadata});var ConfirmationType,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_measure__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-measure/dist/index.esm.js"),_util_missingCaseError__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/missingCaseError.ts"),_ExpireTimer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/ExpireTimer.tsx"),_MessageTimestamp__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/conversation/MessageTimestamp.tsx"),_types_Panels__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/Panels.ts"),_Spinner__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Spinner.tsx"),_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function MessageMetadata(_ref){var timestampNode,statusInfo,confirmation,deletedForEveryone=_ref.deletedForEveryone,direction=_ref.direction,expirationLength=_ref.expirationLength,expirationTimestamp=_ref.expirationTimestamp,hasText=_ref.hasText,i18n=_ref.i18n,id=_ref.id,isEditedMessage=_ref.isEditedMessage,isInline=_ref.isInline,isShowingImage=_ref.isShowingImage,isSticker=_ref.isSticker,isTapToViewExpired=_ref.isTapToViewExpired,onWidthMeasured=_ref.onWidthMeasured,pushPanelForConversation=_ref.pushPanelForConversation,retryMessageSend=_ref.retryMessageSend,showEditHistoryModal=_ref.showEditHistoryModal,status=_ref.status,textPending=_ref.textPending,timestamp=_ref.timestamp,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(),2),confirmationType=_useState2[0],setConfirmationType=_useState2[1],withImageNoCaption=Boolean(!isSticker&&!hasText&&isShowingImage),metadataDirection=isSticker?void 0:direction,isError="error"===status&&"outgoing"===direction,isPaused="paused"===status;isError||"partial-sent"===status&&"outgoing"===direction||isPaused?(statusInfo=isError?deletedForEveryone?i18n("icu:deleteFailed"):isEditedMessage?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("button",{type:"button",className:"module-message__metadata__tapable",onClick:function(event){event.stopPropagation(),event.preventDefault(),setConfirmationType(ConfirmationType.EditError)},children:i18n("icu:editFailed")}):i18n("icu:sendFailed"):isPaused?i18n("icu:sendPaused"):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("button",{type:"button",className:"module-message__metadata__tapable",onClick:function(event){event.stopPropagation(),event.preventDefault(),pushPanelForConversation({type:_types_Panels__WEBPACK_IMPORTED_MODULE_5__.w.MessageDetails,args:{messageId:id}})},children:i18n(deletedForEveryone?"icu:partiallyDeleted":"icu:partiallySent")}),timestampNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("span",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()({"module-message__metadata__date":!0,"module-message__metadata__date--with-sticker":isSticker,"module-message__metadata__date--deleted-for-everyone":deletedForEveryone,[`module-message__metadata__date--${direction}`]:!isSticker,"module-message__metadata__date--with-image-no-caption":withImageNoCaption}),children:statusInfo})):timestampNode=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_MessageTimestamp__WEBPACK_IMPORTED_MODULE_4__.i,{i18n,timestamp,direction:metadataDirection,deletedForEveryone,withImageNoCaption,withSticker:isSticker,withTapToViewExpired:isTapToViewExpired,module:"module-message__metadata__date"});if(void 0===confirmationType);else{if(confirmationType!==ConfirmationType.EditError)throw(0,_util_missingCaseError__WEBPACK_IMPORTED_MODULE_9__.b)(confirmationType);confirmation=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_ConfirmationDialog__WEBPACK_IMPORTED_MODULE_7__.U,{dialogName:"MessageMetadata.confirmEditResend",actions:[{action:function(){retryMessageSend(id),setConfirmationType(void 0)},style:"negative",text:i18n("icu:ResendMessageEdit__button")}],i18n,onClose:function(){setConfirmationType(void 0)},children:i18n("icu:ResendMessageEdit__body")})}var className=classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-message__metadata",isInline&&"module-message__metadata--inline",withImageNoCaption&&"module-message__metadata--with-image-no-caption",deletedForEveryone&&"module-message__metadata--deleted-for-everyone"),children=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:[isEditedMessage&&showEditHistoryModal&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("button",{className:"module-message__metadata__edited",onClick:function(){return showEditHistoryModal(id)},type:"button",children:i18n("icu:MessageMetadata__edited")}),timestampNode,expirationLength?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_ExpireTimer__WEBPACK_IMPORTED_MODULE_3__.I,{direction:metadataDirection,deletedForEveryone,expirationLength,expirationTimestamp,withImageNoCaption,withSticker:isSticker,withTapToViewExpired:isTapToViewExpired}):null,textPending?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className:"module-message__metadata__spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_6__.$j,{svgSize:"small",size:"14px",direction})}):null,deletedForEveryone&&"sending"!==status||textPending||"outgoing"!==direction||"error"===status||"partial-sent"===status?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-message__metadata__status-icon",`module-message__metadata__status-icon--${status}`,isSticker?"module-message__metadata__status-icon--with-sticker":null,withImageNoCaption?"module-message__metadata__status-icon--with-image-no-caption":null,deletedForEveryone?"module-message__metadata__status-icon--deleted-for-everyone":null,isTapToViewExpired?"module-message__metadata__status-icon--with-tap-to-view-expired":null)}),confirmation]}),onResize=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(_ref2){var bounds=_ref2.bounds;null==onWidthMeasured||onWidthMeasured((null==bounds?void 0:bounds.width)||0)}),[onWidthMeasured]);return onWidthMeasured?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(react_measure__WEBPACK_IMPORTED_MODULE_2__.Z,{bounds:!0,onResize,children:function(_ref3){var measureRef=_ref3.measureRef;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className,ref:measureRef,children})}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className,children})}!function(ConfirmationType){ConfirmationType.EditError="EditError"}(ConfirmationType||(ConfirmationType={})),MessageMetadata.displayName="MessageMetadata"},"./ts/components/conversation/MessageTimestamp.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{i:()=>MessageTimestamp});var react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),util_timestamp=__webpack_require__("./ts/util/timestamp.ts"),Time=__webpack_require__("./ts/components/Time.tsx"),events=__webpack_require__("./node_modules/events/events.js"),durations=__webpack_require__("./ts/util/durations/index.ts");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ev=new events.EventEmitter;ev.setMaxListeners(1/0),setInterval((function(){return ev.emit("tick")}),durations.EB);var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function MessageTimestamp(_ref){var deletedForEveryone=_ref.deletedForEveryone,direction=_ref.direction,i18n=_ref.i18n,isRelativeTime=_ref.isRelativeTime,module=_ref.module,timestamp=_ref.timestamp,withImageNoCaption=_ref.withImageNoCaption,withSticker=_ref.withSticker,withTapToViewExpired=_ref.withTapToViewExpired,now=function useNowThatUpdatesEveryMinute(){var _useState2=_slicedToArray((0,react.useState)(Date.now()),2),now=_useState2[0],setNow=_useState2[1];return(0,react.useEffect)((function(){var updateNow=function(){return setNow(Date.now())};return updateNow(),ev.on("tick",updateNow),function(){ev.off("tick",updateNow)}}),[]),now}(),moduleName=module||"module-timestamp";return(0,jsx_runtime.jsx)(Time.q,{className:classnames_default()(moduleName,direction?`${moduleName}--${direction}`:null,withTapToViewExpired&&direction?`${moduleName}--${direction}-with-tap-to-view-expired`:null,withImageNoCaption?`${moduleName}--with-image-no-caption`:null,withSticker?`${moduleName}--with-sticker`:null,deletedForEveryone?`${moduleName}--deleted-for-everyone`:null),timestamp,children:(0,util_timestamp.mr)(i18n,timestamp,now,isRelativeTime)})}MessageTimestamp.displayName="MessageTimestamp"},"./ts/components/conversation/ReactionViewer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{N:()=>ReactionViewer});var lodash_orderBy__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/orderBy.js"),lodash_orderBy__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_orderBy__WEBPACK_IMPORTED_MODULE_0__),lodash_mapValues__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/mapValues.js"),lodash_mapValues__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_mapValues__WEBPACK_IMPORTED_MODULE_1__),lodash_groupBy__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lodash/groupBy.js"),lodash_groupBy__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash_groupBy__WEBPACK_IMPORTED_MODULE_2__),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_4__),_ContactName__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/conversation/ContactName.tsx"),_Avatar__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Avatar.tsx"),_emoji_Emoji__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/components/emoji/Emoji.tsx"),_hooks_useRestoreFocus__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/hooks/useRestoreFocus.ts"),_emoji_lib__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/components/emoji/lib.ts"),_hooks_useEscapeHandling__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/hooks/useEscapeHandling.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/react/jsx-runtime.js"),_excluded=["getPreferredBadge","i18n","onClose","pickedReaction","reactions","theme"];function _slicedToArray(arr,i){return _arrayWithHoles(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}var DEFAULT_EMOJI_ORDER=["heart","+1","-1","joy","open_mouth","cry","rage"],ReactionViewer=react__WEBPACK_IMPORTED_MODULE_3__.forwardRef((function ReactionViewerInner(_ref,ref){var getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,onClose=_ref.onClose,pickedReaction=_ref.pickedReaction,reactions=_ref.reactions,theme=_ref.theme,rest=_objectWithoutProperties(_ref,_excluded),reactionsWithEmojiData=react__WEBPACK_IMPORTED_MODULE_3__.useMemo((function(){return reactions.map((function(reaction){var emojiData=(0,_emoji_lib__WEBPACK_IMPORTED_MODULE_9__.PE)(reaction.emoji);if(emojiData)return Object.assign({},reaction,emojiData)})).filter((function(reactionWithEmojiData){return Boolean(reactionWithEmojiData)}))}),[reactions]),groupedAndSortedReactions=react__WEBPACK_IMPORTED_MODULE_3__.useMemo((function(){return lodash_mapValues__WEBPACK_IMPORTED_MODULE_1___default()(Object.assign({all:reactionsWithEmojiData},lodash_groupBy__WEBPACK_IMPORTED_MODULE_2___default()(reactionsWithEmojiData,"short_name")),(function(groupedReactions){return lodash_orderBy__WEBPACK_IMPORTED_MODULE_0___default()(groupedReactions,["timestamp"],["desc"])}))}),[reactionsWithEmojiData]),reactionCategories=react__WEBPACK_IMPORTED_MODULE_3__.useMemo((function(){return[{id:"all",index:0,count:reactionsWithEmojiData.length}].concat(_toConsumableArray(Object.entries(groupedAndSortedReactions).filter((function(_ref2){return"all"!==_slicedToArray(_ref2,1)[0]})).map((function(_ref4){var _ref5$=function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest()}(_slicedToArray(_ref4,2)[1]),_ref5$$=_ref5$[0],id=_ref5$$.short_name,emoji=_ref5$$.emoji,otherReactions=_ref5$.slice(1);return{id,index:DEFAULT_EMOJI_ORDER.includes(id)?DEFAULT_EMOJI_ORDER.indexOf(id):1/0,emoji,count:otherReactions.length+1}})))).sort((function(a,b){return a.index-b.index}))}),[reactionsWithEmojiData,groupedAndSortedReactions]),_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_3__.useState(pickedReaction||"all"),2),selectedReactionCategory=_React$useState2[0],setSelectedReactionCategory=_React$useState2[1];(0,_hooks_useEscapeHandling__WEBPACK_IMPORTED_MODULE_10__.w)(onClose);var focusRef=_slicedToArray((0,_hooks_useRestoreFocus__WEBPACK_IMPORTED_MODULE_8__.H)(),1)[0];react__WEBPACK_IMPORTED_MODULE_3__.useEffect((function(){reactionCategories.find((function(_ref6){return _ref6.id===selectedReactionCategory}))||(reactionsWithEmojiData.length>0?setSelectedReactionCategory("all"):onClose&&onClose())}),[reactionCategories,onClose,reactionsWithEmojiData,selectedReactionCategory]);var selectedReactions=groupedAndSortedReactions[selectedReactionCategory]||[];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",Object.assign({},rest,{ref,className:"module-reaction-viewer",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("header",{className:"module-reaction-viewer__header",children:reactionCategories.map((function(_ref7,index){var id=_ref7.id,emoji=_ref7.emoji,count=_ref7.count,isAll=0===index,maybeFocusRef=isAll?focusRef:void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("button",{type:"button",ref:maybeFocusRef,className:classnames__WEBPACK_IMPORTED_MODULE_4___default()("module-reaction-viewer__header__button",selectedReactionCategory===id?"module-reaction-viewer__header__button--selected":null),onClick:function(event){event.stopPropagation(),setSelectedReactionCategory(id)},onKeyDown:function(event){"Enter"!==event.key&&"Space"!==event.key||(event.stopPropagation(),event.preventDefault(),setSelectedReactionCategory(id))},children:isAll?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("span",{className:"module-reaction-viewer__header__button__all",children:[i18n("icu:ReactionsViewer--all")," · ",count]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_emoji_Emoji__WEBPACK_IMPORTED_MODULE_7__.d,{size:18,emoji}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span",{className:"module-reaction-viewer__header__button__count",children:count})]})},id)}))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("main",{className:"module-reaction-viewer__body",children:selectedReactions.map((function(_ref8){var from=_ref8.from,emoji=_ref8.emoji;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"module-reaction-viewer__body__row",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"module-reaction-viewer__body__row__avatar",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_6__.qE,{acceptedMessageRequest:from.acceptedMessageRequest,avatarPath:from.avatarPath,badge:getPreferredBadge(from.badges),conversationType:"direct",sharedGroupNames:from.sharedGroupNames,size:32,isMe:from.isMe,color:from.color,profileName:from.profileName,phoneNumber:from.phoneNumber,theme,title:from.title,i18n})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"module-reaction-viewer__body__row__name",children:from.isMe?i18n("icu:you"):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ContactName__WEBPACK_IMPORTED_MODULE_5__.K,{module:"module-reaction-viewer__body__row__name__contact-name",title:from.title})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"module-reaction-viewer__body__row__emoji",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_emoji_Emoji__WEBPACK_IMPORTED_MODULE_7__.d,{size:18,emoji})})]},`${from.id}-${emoji}`)}))})]}))}))},"./ts/components/conversation/contactUtil.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{TF:()=>renderContactShorthand,aQ:()=>renderAvatar,vs:()=>renderName});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_Avatar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Avatar.tsx"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_types_Colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Colors.ts"),_types_EmbeddedContact__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/EmbeddedContact.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");function renderAvatar(_ref){var contact=_ref.contact,i18n=_ref.i18n,size=_ref.size,direction=_ref.direction,avatar=contact.avatar,avatarPath=avatar&&avatar.avatar&&avatar.avatar.path,pending=avatar&&avatar.avatar&&avatar.avatar.pending,title=(0,_types_EmbeddedContact__WEBPACK_IMPORTED_MODULE_5__.oY)(contact)||"",spinnerSvgSize=size<50?"small":"normal",spinnerSize=size<50?"24px":void 0;return pending?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"module-embedded-contact__spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{svgSize:spinnerSvgSize,size:spinnerSize,direction})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_2__.qE,{acceptedMessageRequest:!1,avatarPath,badge:void 0,blur:_Avatar__WEBPACK_IMPORTED_MODULE_2__.S7.NoBlur,color:_types_Colors__WEBPACK_IMPORTED_MODULE_4__.sj[0],conversationType:"direct",i18n,isMe:!0,title,sharedGroupNames:[],size})}function renderName(_ref2){var contact=_ref2.contact,isIncoming=_ref2.isIncoming,module=_ref2.module;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(`module-${module}__contact-name`,isIncoming?`module-${module}__contact-name--incoming`:null),children:(0,_types_EmbeddedContact__WEBPACK_IMPORTED_MODULE_5__.oY)(contact)})}function renderContactShorthand(_ref3){var contact=_ref3.contact,isIncoming=_ref3.isIncoming,module=_ref3.module,phoneNumber=contact.number,email=contact.email,firstNumber=phoneNumber&&phoneNumber[0]&&phoneNumber[0].value,firstEmail=email&&email[0]&&email[0].value;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(`module-${module}__contact-method`,isIncoming?`module-${module}__contact-method--incoming`:null),children:firstNumber||firstEmail})}renderAvatar.displayName="renderAvatar",renderName.displayName="renderName",renderContactShorthand.displayName="renderContactShorthand"},"./ts/test-both/helpers/getDefaultConversation.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Bj:()=>getDefaultGroupListItem,E$:()=>getDefaultConversation,nS:()=>getDefaultConversationWithUuid,uN:()=>getDefaultGroup});var lodash_sample__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/sample.js"),lodash_sample__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_sample__WEBPACK_IMPORTED_MODULE_0__),casual__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/casual/src/casual.js"),casual__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(casual__WEBPACK_IMPORTED_MODULE_1__),_types_UUID__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/types/UUID.ts"),_getRandomColor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/test-both/helpers/getRandomColor.ts"),_types_Colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Colors.ts"),_types_Stories__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/Stories.ts"),getAvatarPath=function(){return lodash_sample__WEBPACK_IMPORTED_MODULE_0___default()(["/fixtures/kitten-1-64-64.jpg","/fixtures/kitten-2-64-64.jpg","/fixtures/kitten-3-64-64.jpg"])||""};function getDefaultConversation(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},firstName=casual__WEBPACK_IMPORTED_MODULE_1___default().first_name,lastName=casual__WEBPACK_IMPORTED_MODULE_1___default().last_name;return Object.assign({acceptedMessageRequest:!0,avatarPath:getAvatarPath(),badges:[],e164:`+${casual__WEBPACK_IMPORTED_MODULE_1___default().phone.replace(/-/g,"")}`,conversationColor:_types_Colors__WEBPACK_IMPORTED_MODULE_4__.cU[0],color:(0,_getRandomColor__WEBPACK_IMPORTED_MODULE_3__.m)(),firstName,id:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),isMe:!1,lastUpdated:casual__WEBPACK_IMPORTED_MODULE_1___default().unix_time,markedUnread:Boolean(overrideProps.markedUnread),sharedGroupNames:[],title:`${firstName} ${lastName}`,titleNoDefault:`${firstName} ${lastName}`,uuid:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString()},overrideProps,{type:"direct",acknowledgedGroupNameCollisions:void 0,storySendMode:void 0})}function getDefaultGroupListItem(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},getDefaultGroup(),{disabledReason:void 0,membersCount:24,memberships:[]},overrideProps)}function getDefaultGroup(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},memberships=Array.from(Array(casual__WEBPACK_IMPORTED_MODULE_1___default().integer(1,20)),(function(){return{uuid:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),isAdmin:Boolean(casual__WEBPACK_IMPORTED_MODULE_1___default().coin_flip)}}));return Object.assign({acceptedMessageRequest:!0,announcementsOnly:!1,avatarPath:getAvatarPath(),badges:[],color:(0,_getRandomColor__WEBPACK_IMPORTED_MODULE_3__.m)(),conversationColor:_types_Colors__WEBPACK_IMPORTED_MODULE_4__.cU[0],groupDescription:casual__WEBPACK_IMPORTED_MODULE_1___default().sentence,groupId:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),groupLink:casual__WEBPACK_IMPORTED_MODULE_1___default().url,groupVersion:2,id:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),isMe:!1,lastUpdated:casual__WEBPACK_IMPORTED_MODULE_1___default().unix_time,markedUnread:Boolean(overrideProps.markedUnread),membersCount:memberships.length,memberships,sharedGroupNames:[],title:casual__WEBPACK_IMPORTED_MODULE_1___default().title,uuid:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),acknowledgedGroupNameCollisions:{},storySendMode:_types_Stories__WEBPACK_IMPORTED_MODULE_5__.vW.IfActive},overrideProps,{type:"group"})}function getDefaultConversationWithUuid(){var overrideProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},uuid=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString();return Object.assign({},getDefaultConversation(overrideProps),{uuid})}},"./ts/test-both/helpers/getRandomColor.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{m:()=>getRandomColor});var lodash_sample__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/sample.js"),lodash_sample__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_sample__WEBPACK_IMPORTED_MODULE_0__),_types_Colors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Colors.ts");function getRandomColor(){return lodash_sample__WEBPACK_IMPORTED_MODULE_0___default()(_types_Colors__WEBPACK_IMPORTED_MODULE_1__.sj)||_types_Colors__WEBPACK_IMPORTED_MODULE_1__.sj[0]}},"./ts/types/Colors.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A0:()=>ContactNameColors,Cy:()=>DEFAULT_CONVERSATION_COLOR,cU:()=>ConversationColors,hx:()=>getAvatarColor,nE:()=>AvatarColorMap,sj:()=>AvatarColors});var AvatarColorMap=new Map([["A100",{bg:"#e3e3fe",fg:"#3838f5"}],["A110",{bg:"#dde7fc",fg:"#1251d3"}],["A120",{bg:"#d8e8f0",fg:"#086da0"}],["A130",{bg:"#cde4cd",fg:"#067906"}],["A140",{bg:"#eae0fd",fg:"#661aff"}],["A150",{bg:"#f5e3fe",fg:"#9f00f0"}],["A160",{bg:"#f6d8ec",fg:"#b8057c"}],["A170",{bg:"#f5d7d7",fg:"#be0404"}],["A180",{bg:"#fef5d0",fg:"#836b01"}],["A190",{bg:"#eae6d5",fg:"#7d6f40"}],["A200",{bg:"#d2d2dc",fg:"#4f4f6d"}],["A210",{bg:"#d7d7d9",fg:"#5c5c5c"}]]),AvatarColors=Array.from(AvatarColorMap.keys()),ConversationColors=["ultramarine","crimson","vermilion","burlap","forest","wintergreen","teal","blue","indigo","violet","plum","taupe","steel","ember","midnight","infrared","lagoon","fluorescent","basil","sublime","sea","tangerine"],ContactNameColors=["200","120","300","010","210","330","230","180","030","340","270","090","000","150","240","040","160","280","080","320","020","140","260","060","350","100","290","130","220","050","170","250","070","190","310","110"],DEFAULT_CONVERSATION_COLOR={color:"ultramarine"};function getAvatarColor(color){return color||AvatarColors[0]}},"./ts/types/EmbeddedContact.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{DL:()=>AddressType,GP:()=>ContactFormType,oY:()=>getName});__webpack_require__("./node_modules/lodash/omit.js");var ContactFormType,AddressType,_protobuf__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/protobuf/index.ts");__webpack_require__("./ts/types/PhoneNumber.ts"),__webpack_require__("./ts/types/errors.ts");!function(ContactFormType){ContactFormType[ContactFormType.HOME=1]="HOME",ContactFormType[ContactFormType.MOBILE=2]="MOBILE",ContactFormType[ContactFormType.WORK=3]="WORK",ContactFormType[ContactFormType.CUSTOM=4]="CUSTOM"}(ContactFormType||(ContactFormType={})),function(AddressType){AddressType[AddressType.HOME=1]="HOME",AddressType[AddressType.WORK=2]="WORK",AddressType[AddressType.CUSTOM=3]="CUSTOM"}(AddressType||(AddressType={}));_protobuf__WEBPACK_IMPORTED_MODULE_1__.g.DataMessage.Contact.Phone.Type.HOME,_protobuf__WEBPACK_IMPORTED_MODULE_1__.g.DataMessage.Contact.Email.Type.HOME,_protobuf__WEBPACK_IMPORTED_MODULE_1__.g.DataMessage.Contact.PostalAddress.Type.HOME;function getName(contact){var name=contact.name,organization=contact.organization,displayName=name&&name.displayName||void 0,givenName=name&&name.givenName||void 0,familyName=name&&name.familyName||void 0;return displayName||organization||(givenName&&familyName&&`${givenName} ${familyName}`||void 0)||givenName||familyName}},"./ts/types/PhoneNumber.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var memoizee__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/memoizee/index.js"),memoizee__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(memoizee__WEBPACK_IMPORTED_MODULE_0__),_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/libphonenumberInstance.ts");__webpack_require__("./ts/logging/log.ts"),__webpack_require__("./ts/types/errors.ts");memoizee__WEBPACK_IMPORTED_MODULE_0___default()((function _format(phoneNumber,options){try{var ourRegionCode=options.ourRegionCode,parsedNumber=_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.parse(phoneNumber),regionCode=_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.getRegionCodeForNumber(parsedNumber);return ourRegionCode&&regionCode===ourRegionCode?_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.format(parsedNumber,_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.M9.NATIONAL):_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.eE.format(parsedNumber,_util_libphonenumberInstance__WEBPACK_IMPORTED_MODULE_1__.M9.INTERNATIONAL)}catch(error){return phoneNumber}}),{primitive:!0,normalizer:function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return JSON.stringify(args)},max:5e3})},"./ts/util/graphemeAndLinkAwareSlice.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{r:()=>graphemeAndLinkAwareSlice});var linkify_it__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/linkify-it/index.js"),linkify_it__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(linkify_it__WEBPACK_IMPORTED_MODULE_0__);function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function graphemeAndLinkAwareSlice(str,length){var text,buffer=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(str.length<=length+buffer)return{text:str,hasReadMore:!1};var _step,_iterator=_createForOfIteratorHelper((new Intl.Segmenter).segment(str));try{for(_iterator.s();!(_step=_iterator.n()).done;){var _ref=_step.value,index=_ref.index;if(!text&&index>=length&&(text=str.slice(0,index)),text&&index>length)return{text:text=expandToIncludeEntireLink(str,text),hasReadMore:text.length<str.length}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{text:str,hasReadMore:!1}}var expandToIncludeEntireLink=function(original,truncated){var linksInText=(new(linkify_it__WEBPACK_IMPORTED_MODULE_0___default())).match(original);if(!linksInText)return truncated;var truncatedLink=linksInText.map((function(_ref2){return{startIndex:_ref2.index,lastIndex:_ref2.lastIndex}})).filter((function(_ref3){var startIndex=_ref3.startIndex,lastIndex=_ref3.lastIndex;return startIndex<truncated.length&&lastIndex>truncated.length}));return 0===truncatedLink.length?truncated:original.slice(0,truncatedLink[0].lastIndex)}},"./ts/util/libphonenumberInstance.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M9:()=>PhoneNumberFormat,eE:()=>instance,i9:()=>parseAndFormatPhoneNumber});var google_libphonenumber__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/google-libphonenumber/dist/libphonenumber.js"),google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(google_libphonenumber__WEBPACK_IMPORTED_MODULE_0__),instance=google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default().PhoneNumberUtil.getInstance(),PhoneNumberFormat=google_libphonenumber__WEBPACK_IMPORTED_MODULE_0___default().PhoneNumberFormat;function parseAndFormatPhoneNumber(str,regionCode){var result,format=arguments.length>2&&void 0!==arguments[2]?arguments[2]:PhoneNumberFormat.E164;try{result=instance.parse(str,regionCode)}catch(err){return}return{isValid:instance.isValidNumber(result),userInput:str,e164:instance.format(result,format)}}},"./ts/util/openLinkInWebBrowser.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function openLinkInWebBrowser(url){window.location.href=url}__webpack_require__.d(__webpack_exports__,{P:()=>openLinkInWebBrowser})},"./ts/util/timer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{R:()=>getIncrement,e:()=>getTimerBucket});var lodash_padStart__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/padStart.js"),lodash_padStart__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_padStart__WEBPACK_IMPORTED_MODULE_0__);function getIncrement(length){return length<0?1e3:Math.ceil(length/12)}function getTimerBucket(expiration,length){if(!expiration)return"60";var delta=expiration-Date.now();if(delta<0)return"00";if(delta>length)return"60";var bucket=Math.round(delta/length*12);return lodash_padStart__WEBPACK_IMPORTED_MODULE_0___default()(String(5*bucket),2,"0")}},"./ts/util/timestamp.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{N_:()=>isMoreRecentThan,Uj:()=>formatDateTimeShort,Wl:()=>formatDateTimeForAttachment,gD:()=>formatDateTimeLong,mr:()=>formatTime,p6:()=>formatDate,zk:()=>isToday});var moment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/moment/moment.js"),moment__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_0__),_durations__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/durations/index.ts");function isMoreRecentThan(timestamp,delta){return timestamp>Date.now()-delta}var isSameDay=function(a,b){return moment__WEBPACK_IMPORTED_MODULE_0___default()(a).isSame(b,"day")},isToday=function(rawTimestamp){return isSameDay(rawTimestamp,Date.now())},isYesterday=function(rawTimestamp){return isSameDay(rawTimestamp,moment__WEBPACK_IMPORTED_MODULE_0___default()().subtract(1,"day"))};function formatDateTimeShort(i18n,rawTimestamp){var timestamp=rawTimestamp.valueOf(),now=Date.now(),diff=now-timestamp,locale=window.getPreferredSystemLocales();if(diff<_durations__WEBPACK_IMPORTED_MODULE_1__.kr||isToday(timestamp))return formatTime(i18n,rawTimestamp,now);var m=moment__WEBPACK_IMPORTED_MODULE_0___default()(timestamp);return diff<_durations__WEBPACK_IMPORTED_MODULE_1__.ps&&m.isSame(now,"month")?new Intl.DateTimeFormat(locale,{weekday:"short"}).format(timestamp):m.isSame(now,"year")?new Intl.DateTimeFormat(locale,{day:"numeric",month:"short"}).format(timestamp):new Intl.DateTimeFormat(locale,{day:"numeric",month:"short",year:"numeric"}).format(timestamp)}function formatDateTimeForAttachment(i18n,rawTimestamp){var timestamp=rawTimestamp.valueOf(),now=Date.now(),diff=now-timestamp,locale=window.getPreferredSystemLocales();if(diff<_durations__WEBPACK_IMPORTED_MODULE_1__.kr||isToday(timestamp))return formatTime(i18n,rawTimestamp,now);var m=moment__WEBPACK_IMPORTED_MODULE_0___default()(timestamp);return diff<_durations__WEBPACK_IMPORTED_MODULE_1__.ps&&m.isSame(now,"month")?new Intl.DateTimeFormat(locale,{weekday:"short",hour:"numeric",minute:"numeric"}).format(timestamp):m.isSame(now,"year")?new Intl.DateTimeFormat(locale,{day:"numeric",month:"short",hour:"numeric",minute:"numeric"}).format(timestamp):new Intl.DateTimeFormat(locale,{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}).format(timestamp)}function formatDateTimeLong(i18n,rawTimestamp){var locale=window.getPreferredSystemLocales(),timestamp=rawTimestamp.valueOf();return isToday(rawTimestamp)?i18n("icu:timestampFormat__long--today",{time:new Intl.DateTimeFormat(locale,{hour:"numeric",minute:"numeric"}).format(timestamp)}):isYesterday(rawTimestamp)?i18n("icu:timestampFormat__long--yesterday",{time:new Intl.DateTimeFormat(locale,{hour:"numeric",minute:"numeric"}).format(timestamp)}):new Intl.DateTimeFormat(locale,{day:"numeric",hour:"numeric",minute:"numeric",month:"short",year:"numeric"}).format(timestamp)}function formatTime(i18n,rawTimestamp,now,isRelativeTime){var timestamp=rawTimestamp.valueOf(),diff=now.valueOf()-timestamp;return diff<_durations__WEBPACK_IMPORTED_MODULE_1__.EB?i18n("icu:justNow"):diff<_durations__WEBPACK_IMPORTED_MODULE_1__.kr?i18n("icu:minutesAgo",{minutes:Math.floor(diff/_durations__WEBPACK_IMPORTED_MODULE_1__.EB)}):isRelativeTime?i18n("icu:hoursAgo",{hours:Math.floor(diff/_durations__WEBPACK_IMPORTED_MODULE_1__.kr)}):new Date(timestamp).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function formatDate(i18n,rawTimestamp){if(isToday(rawTimestamp))return i18n("icu:today");if(isYesterday(rawTimestamp))return i18n("icu:yesterday");var locale=window.getPreferredSystemLocales(),m=moment__WEBPACK_IMPORTED_MODULE_0___default()(rawTimestamp),timestamp=rawTimestamp.valueOf();return Math.abs(m.diff(Date.now()))<6*_durations__WEBPACK_IMPORTED_MODULE_1__.vc?new Intl.DateTimeFormat(locale,{day:"numeric",month:"short",weekday:"short"}).format(timestamp):new Intl.DateTimeFormat(locale,{day:"numeric",month:"short",year:"numeric"}).format(timestamp)}},"./node_modules/casual/src/providers sync recursive ^\\.\\/.*$":(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./address":"./node_modules/casual/src/providers/address.js","./address.js":"./node_modules/casual/src/providers/address.js","./ar_SY/address":"./node_modules/casual/src/providers/ar_SY/address.js","./ar_SY/address.js":"./node_modules/casual/src/providers/ar_SY/address.js","./ar_SY/color":"./node_modules/casual/src/providers/ar_SY/color.js","./ar_SY/color.js":"./node_modules/casual/src/providers/ar_SY/color.js","./ar_SY/date":"./node_modules/casual/src/providers/ar_SY/date.js","./ar_SY/date.js":"./node_modules/casual/src/providers/ar_SY/date.js","./ar_SY/person":"./node_modules/casual/src/providers/ar_SY/person.js","./ar_SY/person.js":"./node_modules/casual/src/providers/ar_SY/person.js","./ar_SY/text":"./node_modules/casual/src/providers/ar_SY/text.js","./ar_SY/text.js":"./node_modules/casual/src/providers/ar_SY/text.js","./bg_BG/address":"./node_modules/casual/src/providers/bg_BG/address.js","./bg_BG/address.js":"./node_modules/casual/src/providers/bg_BG/address.js","./bg_BG/date":"./node_modules/casual/src/providers/bg_BG/date.js","./bg_BG/date.js":"./node_modules/casual/src/providers/bg_BG/date.js","./bg_BG/internet":"./node_modules/casual/src/providers/bg_BG/internet.js","./bg_BG/internet.js":"./node_modules/casual/src/providers/bg_BG/internet.js","./bg_BG/person":"./node_modules/casual/src/providers/bg_BG/person.js","./bg_BG/person.js":"./node_modules/casual/src/providers/bg_BG/person.js","./bg_BG/text":"./node_modules/casual/src/providers/bg_BG/text.js","./bg_BG/text.js":"./node_modules/casual/src/providers/bg_BG/text.js","./color":"./node_modules/casual/src/providers/color.js","./color.js":"./node_modules/casual/src/providers/color.js","./da_DK/address":"./node_modules/casual/src/providers/da_DK/address.js","./da_DK/address.js":"./node_modules/casual/src/providers/da_DK/address.js","./da_DK/person":"./node_modules/casual/src/providers/da_DK/person.js","./da_DK/person.js":"./node_modules/casual/src/providers/da_DK/person.js","./da_DK/text":"./node_modules/casual/src/providers/da_DK/text.js","./da_DK/text.js":"./node_modules/casual/src/providers/da_DK/text.js","./date":"./node_modules/casual/src/providers/date.js","./date.js":"./node_modules/casual/src/providers/date.js","./de_DE/address":"./node_modules/casual/src/providers/de_DE/address.js","./de_DE/address.js":"./node_modules/casual/src/providers/de_DE/address.js","./de_DE/date":"./node_modules/casual/src/providers/de_DE/date.js","./de_DE/date.js":"./node_modules/casual/src/providers/de_DE/date.js","./de_DE/person":"./node_modules/casual/src/providers/de_DE/person.js","./de_DE/person.js":"./node_modules/casual/src/providers/de_DE/person.js","./de_DE/text":"./node_modules/casual/src/providers/de_DE/text.js","./de_DE/text.js":"./node_modules/casual/src/providers/de_DE/text.js","./en_CA/address":"./node_modules/casual/src/providers/en_CA/address.js","./en_CA/address.js":"./node_modules/casual/src/providers/en_CA/address.js","./en_US/address":"./node_modules/casual/src/providers/en_US/address.js","./en_US/address.js":"./node_modules/casual/src/providers/en_US/address.js","./fr_FR/address":"./node_modules/casual/src/providers/fr_FR/address.js","./fr_FR/address.js":"./node_modules/casual/src/providers/fr_FR/address.js","./fr_FR/person":"./node_modules/casual/src/providers/fr_FR/person.js","./fr_FR/person.js":"./node_modules/casual/src/providers/fr_FR/person.js","./id_ID/address":"./node_modules/casual/src/providers/id_ID/address.js","./id_ID/address.js":"./node_modules/casual/src/providers/id_ID/address.js","./internet":"./node_modules/casual/src/providers/internet.js","./internet.js":"./node_modules/casual/src/providers/internet.js","./it_CH/address":"./node_modules/casual/src/providers/it_CH/address.js","./it_CH/address.js":"./node_modules/casual/src/providers/it_CH/address.js","./it_CH/date":"./node_modules/casual/src/providers/it_CH/date.js","./it_CH/date.js":"./node_modules/casual/src/providers/it_CH/date.js","./it_CH/person":"./node_modules/casual/src/providers/it_CH/person.js","./it_CH/person.js":"./node_modules/casual/src/providers/it_CH/person.js","./it_IT/address":"./node_modules/casual/src/providers/it_IT/address.js","./it_IT/address.js":"./node_modules/casual/src/providers/it_IT/address.js","./it_IT/date":"./node_modules/casual/src/providers/it_IT/date.js","./it_IT/date.js":"./node_modules/casual/src/providers/it_IT/date.js","./it_IT/person":"./node_modules/casual/src/providers/it_IT/person.js","./it_IT/person.js":"./node_modules/casual/src/providers/it_IT/person.js","./ja_JP/address":"./node_modules/casual/src/providers/ja_JP/address.js","./ja_JP/address.js":"./node_modules/casual/src/providers/ja_JP/address.js","./ja_JP/date":"./node_modules/casual/src/providers/ja_JP/date.js","./ja_JP/date.js":"./node_modules/casual/src/providers/ja_JP/date.js","./ja_JP/internet":"./node_modules/casual/src/providers/ja_JP/internet.js","./ja_JP/internet.js":"./node_modules/casual/src/providers/ja_JP/internet.js","./ja_JP/person":"./node_modules/casual/src/providers/ja_JP/person.js","./ja_JP/person.js":"./node_modules/casual/src/providers/ja_JP/person.js","./misc":"./node_modules/casual/src/providers/misc.js","./misc.js":"./node_modules/casual/src/providers/misc.js","./nb_NO/address":"./node_modules/casual/src/providers/nb_NO/address.js","./nb_NO/address.js":"./node_modules/casual/src/providers/nb_NO/address.js","./nb_NO/color":"./node_modules/casual/src/providers/nb_NO/color.js","./nb_NO/color.js":"./node_modules/casual/src/providers/nb_NO/color.js","./nb_NO/date":"./node_modules/casual/src/providers/nb_NO/date.js","./nb_NO/date.js":"./node_modules/casual/src/providers/nb_NO/date.js","./nb_NO/person":"./node_modules/casual/src/providers/nb_NO/person.js","./nb_NO/person.js":"./node_modules/casual/src/providers/nb_NO/person.js","./nl_NL/address":"./node_modules/casual/src/providers/nl_NL/address.js","./nl_NL/address.js":"./node_modules/casual/src/providers/nl_NL/address.js","./nl_NL/person":"./node_modules/casual/src/providers/nl_NL/person.js","./nl_NL/person.js":"./node_modules/casual/src/providers/nl_NL/person.js","./number":"./node_modules/casual/src/providers/number.js","./number.js":"./node_modules/casual/src/providers/number.js","./payment":"./node_modules/casual/src/providers/payment.js","./payment.js":"./node_modules/casual/src/providers/payment.js","./person":"./node_modules/casual/src/providers/person.js","./person.js":"./node_modules/casual/src/providers/person.js","./pt_BR/address":"./node_modules/casual/src/providers/pt_BR/address.js","./pt_BR/address.js":"./node_modules/casual/src/providers/pt_BR/address.js","./pt_BR/color":"./node_modules/casual/src/providers/pt_BR/color.js","./pt_BR/color.js":"./node_modules/casual/src/providers/pt_BR/color.js","./pt_BR/person":"./node_modules/casual/src/providers/pt_BR/person.js","./pt_BR/person.js":"./node_modules/casual/src/providers/pt_BR/person.js","./ro_RO/address":"./node_modules/casual/src/providers/ro_RO/address.js","./ro_RO/address.js":"./node_modules/casual/src/providers/ro_RO/address.js","./ro_RO/date":"./node_modules/casual/src/providers/ro_RO/date.js","./ro_RO/date.js":"./node_modules/casual/src/providers/ro_RO/date.js","./ro_RO/person":"./node_modules/casual/src/providers/ro_RO/person.js","./ro_RO/person.js":"./node_modules/casual/src/providers/ro_RO/person.js","./ru_RU/address":"./node_modules/casual/src/providers/ru_RU/address.js","./ru_RU/address.js":"./node_modules/casual/src/providers/ru_RU/address.js","./ru_RU/color":"./node_modules/casual/src/providers/ru_RU/color.js","./ru_RU/color.js":"./node_modules/casual/src/providers/ru_RU/color.js","./ru_RU/internet":"./node_modules/casual/src/providers/ru_RU/internet.js","./ru_RU/internet.js":"./node_modules/casual/src/providers/ru_RU/internet.js","./ru_RU/person":"./node_modules/casual/src/providers/ru_RU/person.js","./ru_RU/person.js":"./node_modules/casual/src/providers/ru_RU/person.js","./ru_RU/text":"./node_modules/casual/src/providers/ru_RU/text.js","./ru_RU/text.js":"./node_modules/casual/src/providers/ru_RU/text.js","./sv_SE/address":"./node_modules/casual/src/providers/sv_SE/address.js","./sv_SE/address.js":"./node_modules/casual/src/providers/sv_SE/address.js","./sv_SE/person":"./node_modules/casual/src/providers/sv_SE/person.js","./sv_SE/person.js":"./node_modules/casual/src/providers/sv_SE/person.js","./sv_SE/text":"./node_modules/casual/src/providers/sv_SE/text.js","./sv_SE/text.js":"./node_modules/casual/src/providers/sv_SE/text.js","./text":"./node_modules/casual/src/providers/text.js","./text.js":"./node_modules/casual/src/providers/text.js","./uk_UA/address":"./node_modules/casual/src/providers/uk_UA/address.js","./uk_UA/address.js":"./node_modules/casual/src/providers/uk_UA/address.js","./uk_UA/color":"./node_modules/casual/src/providers/uk_UA/color.js","./uk_UA/color.js":"./node_modules/casual/src/providers/uk_UA/color.js","./uk_UA/text":"./node_modules/casual/src/providers/uk_UA/text.js","./uk_UA/text.js":"./node_modules/casual/src/providers/uk_UA/text.js"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./node_modules/casual/src/providers sync recursive ^\\.\\/.*$"},"./node_modules/casual/src sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/casual/src sync recursive",module.exports=webpackEmptyContext}}]);