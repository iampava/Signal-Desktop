/*! For license information please see StoryViewer-stories.8d2f2387.iframe.bundle.js.LICENSE.txt */
(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[1511],{"./ts/components/Alert.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>Alert});__webpack_require__("./node_modules/react/index.js");var _Button__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/Button.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Modal.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Alert(_ref){var body=_ref.body,i18n=_ref.i18n,onClose=_ref.onClose,theme=_ref.theme,title=_ref.title;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_2__.u_,{i18n,modalFooter:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Button__WEBPACK_IMPORTED_MODULE_1__.zx,{onClick:onClose,children:i18n("icu:Confirmation--confirm")}),modalName:"Alert",onClose,theme,title,children:body})}Alert.displayName="Alert"},"./ts/components/AnimatedEmojiGalore.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{w:()=>AnimatedEmojiGalore});var lodash_random__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/random.js"),lodash_random__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_random__WEBPACK_IMPORTED_MODULE_0__),_react_spring_web__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/@react-spring/web/dist/react-spring-web.esm.js")),_conversation_Emojify__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/Emojify.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function transform(y,scale,rotate){return`translateY(${y}px) scale(${scale}) rotate(${rotate}deg)`}function AnimatedEmojiGalore(_ref){var emoji=_ref.emoji,onAnimationEnd=_ref.onAnimationEnd,springs=_slicedToArray((0,_react_spring_web__WEBPACK_IMPORTED_MODULE_2__.useSprings)(16,(function(i){return Object.assign({},function(i,f){return{delay:i*lodash_random__WEBPACK_IMPORTED_MODULE_0___default()(80,120),rotate:lodash_random__WEBPACK_IMPORTED_MODULE_0___default()(-24,24),scale:lodash_random__WEBPACK_IMPORTED_MODULE_0___default()(.5,1,!0),y:-144,onRest:15===i?f:void 0}}(i,onAnimationEnd),{from:{rotate:0,scale:1,y:1280},config:{mass:20,tension:120,friction:80,clamp:!0}})})),1)[0];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment,{children:springs.map((function(styles,index){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_react_spring_web__WEBPACK_IMPORTED_MODULE_2__.animated.div,{style:{left:`${lodash_random__WEBPACK_IMPORTED_MODULE_0___default()(0,100)}%`,position:"absolute",transform:(0,_react_spring_web__WEBPACK_IMPORTED_MODULE_2__.to)([styles.y,styles.scale,styles.rotate],transform)},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_conversation_Emojify__WEBPACK_IMPORTED_MODULE_3__.u,{sizeClass:"extra-large",text:emoji})},index)}))})}},"./ts/components/Intl.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{R:()=>Intl});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_logging_log__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/logging/log.ts"),_util_assert__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/assert.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var defaultRenderText=function(_ref){var text=_ref.text,key=_ref.key;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:text},key)};defaultRenderText.displayName="defaultRenderText";var Intl=function(_React$Component){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Intl,_React$Component);var _super=_createSuper(Intl);function Intl(){return _classCallCheck(this,Intl),_super.apply(this,arguments)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Intl,[{key:"getComponent",value:function getComponent(index,placeholderName,key){var _this$props=this.props,id=_this$props.id,components=_this$props.components;if(!components)return _logging_log__WEBPACK_IMPORTED_MODULE_1__.error(`Error: Intl component prop not provided; Metadata: id '${id}', index ${index}, placeholder '${placeholderName}'`),null;if(Array.isArray(components))return!components||!components.length||components.length<=index?(_logging_log__WEBPACK_IMPORTED_MODULE_1__.error(`Error: Intl missing provided component for id '${id}', index ${index}`),null):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:components[index]},key);var value=components[placeholderName];return value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:value},key):(_logging_log__WEBPACK_IMPORTED_MODULE_1__.error(`Error: Intl missing provided component for id '${id}', placeholder '${placeholderName}'`),null)}},{key:"render",value:function render(){var _this$props2=this.props,components=_this$props2.components,id=_this$props2.id,localizer=_this$props2.i18n,_this$props2$renderTe=_this$props2.renderText,renderText=void 0===_this$props2$renderTe?defaultRenderText:_this$props2$renderTe;if(!id)return _logging_log__WEBPACK_IMPORTED_MODULE_1__.error("Error: Intl id prop not provided"),null;if(!localizer.isLegacyFormat(id))return(0,_util_assert__WEBPACK_IMPORTED_MODULE_2__.Yj)(!Array.isArray(components),`components cannot be an array for ICU message ${id}`),localizer.getIntl().formatMessage({id},components);var text=localizer(id),results=[],FIND_REPLACEMENTS=/\$([^$]+)\$/g;if(Array.isArray(components)&&components.length>1)throw new Error("Array syntax is not supported with more than one placeholder");var componentIndex=0,key=0,lastTextIndex=0,match=FIND_REPLACEMENTS.exec(text);if(!match)return renderText({text,key:0});for(;match;){if(lastTextIndex<match.index){var textWithNoReplacements=text.slice(lastTextIndex,match.index);results.push(renderText({text:textWithNoReplacements,key})),key+=1}var placeholderName=match[1];results.push(this.getComponent(componentIndex,placeholderName,key)),componentIndex+=1,key+=1,lastTextIndex=FIND_REPLACEMENTS.lastIndex,match=FIND_REPLACEMENTS.exec(text)}return lastTextIndex<text.length&&(results.push(renderText({text:text.slice(lastTextIndex),key})),key+=1),results}}]),Intl}(react__WEBPACK_IMPORTED_MODULE_0__.Component)},"./ts/components/StoryDetailsModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{P:()=>StoryDetailsModal});__webpack_require__("./node_modules/react/index.js");var filesize__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/filesize/lib/filesize.js"),filesize__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(filesize__WEBPACK_IMPORTED_MODULE_1__),_Avatar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/Avatar.tsx"),_conversation_ContactName__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/ContactName.tsx"),_ContextMenu__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/ContextMenu.tsx"),_Intl__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/Intl.tsx"),_Modal__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/Modal.tsx"),_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/messages/MessageSendState.ts"),_util_theme__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/theme.ts"),_util_timestamp__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/timestamp.ts"),_util_durations__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./ts/util/durations/index.ts"),_types_Util__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./ts/types/Util.ts"),_Time__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./ts/components/Time.tsx"),_util_mapUtil__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./ts/util/mapUtil.ts"),_util_expirationTimer__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./ts/util/expirationTimer.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var contactSortCollator=new window.Intl.Collator;function StoryDetailsModal(_ref){var content,attachment=_ref.attachment,getPreferredBadge=_ref.getPreferredBadge,i18n=_ref.i18n,isInternalUser=_ref.isInternalUser,onClose=_ref.onClose,saveAttachment=_ref.saveAttachment,sender=_ref.sender,sendState=_ref.sendState,timestamp=_ref.timestamp,expirationTimestamp=_ref.expirationTimestamp,actualRecipientsSendState=null==sendState?void 0:sendState.filter((function(s){return s.recipient.id!==sender.id})),contactsBySendStatus=actualRecipientsSendState?(0,_util_mapUtil__WEBPACK_IMPORTED_MODULE_13__.v)(actualRecipientsSendState,(function(contact){return contact.status})):void 0;content=contactsBySendStatus?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact-container",children:[_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Failed,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Viewed,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Read,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Delivered,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Sent,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Pending].map((function(sendStatus){var contacts=contactsBySendStatus.get(sendStatus);if(!contacts)return null;var sendStatusLabel=function getSendStatusLabel(sendStatus,i18n){return sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Failed?i18n("icu:MessageDetailsHeader--Failed"):sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Viewed?i18n("icu:MessageDetailsHeader--Viewed"):sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Read?i18n("icu:MessageDetailsHeader--Read"):sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Delivered?i18n("icu:MessageDetailsHeader--Delivered"):sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Sent?i18n("icu:MessageDetailsHeader--Sent"):sendStatus===_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_7__.fq.Pending?i18n("icu:MessageDetailsHeader--Pending"):i18n("icu:from")}(sendStatus,i18n),sortedContacts=_toConsumableArray(contacts).sort((function(a,b){return contactSortCollator.compare(a.recipient.title,b.recipient.title)}));return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div",{className:"StoryDetailsModal__contact-group",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact-group__header",children:sendStatusLabel}),sortedContacts.map((function(status){var contact=status.recipient;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div",{className:"StoryDetailsModal__contact",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_2__.qE,{acceptedMessageRequest:contact.acceptedMessageRequest,avatarPath:contact.avatarPath,badge:getPreferredBadge(contact.badges),color:contact.color,conversationType:"direct",i18n,isMe:contact.isMe,phoneNumber:contact.phoneNumber,profileName:contact.profileName,sharedGroupNames:contact.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_2__.DZ.THIRTY_TWO,theme:_types_Util__WEBPACK_IMPORTED_MODULE_11__.f8.dark,title:contact.title,unblurredAvatarPath:contact.unblurredAvatarPath}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact__text",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_conversation_ContactName__WEBPACK_IMPORTED_MODULE_3__.K,{title:contact.title})}),status.updatedAt&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Time__WEBPACK_IMPORTED_MODULE_12__.q,{className:"StoryDetailsModal__status-timestamp",timestamp:status.updatedAt,children:(0,_util_timestamp__WEBPACK_IMPORTED_MODULE_9__.gD)(i18n,status.updatedAt)})]},contact.id)}))]},sendStatusLabel)}))}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div",{className:"StoryDetailsModal__contact-group",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact-group__header",children:i18n("icu:sent")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div",{className:"StoryDetailsModal__contact",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_2__.qE,{acceptedMessageRequest:sender.acceptedMessageRequest,avatarPath:sender.avatarPath,badge:getPreferredBadge(sender.badges),color:sender.color,conversationType:"direct",i18n,isMe:sender.isMe,profileName:sender.profileName,sharedGroupNames:sender.sharedGroupNames,size:_Avatar__WEBPACK_IMPORTED_MODULE_2__.DZ.THIRTY_TWO,theme:_types_Util__WEBPACK_IMPORTED_MODULE_11__.f8.dark,title:sender.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact__text",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{className:"StoryDetailsModal__contact__name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_conversation_ContactName__WEBPACK_IMPORTED_MODULE_3__.K,{title:sender.title})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Time__WEBPACK_IMPORTED_MODULE_12__.q,{className:"StoryDetailsModal__status-timestamp",timestamp,children:(0,_util_timestamp__WEBPACK_IMPORTED_MODULE_9__.gD)(i18n,timestamp)})]})]})});var timeRemaining=expirationTimestamp?_util_durations__WEBPACK_IMPORTED_MODULE_10__.kC.fromMillis(expirationTimestamp-Date.now()):void 0,menuOptions=[{icon:"StoryDetailsModal__copy-icon",label:i18n("icu:StoryDetailsModal__copy-timestamp"),onClick:function(){window.navigator.clipboard.writeText(String(timestamp))}}];return isInternalUser&&attachment&&menuOptions.push({icon:"StoryDetailsModal__download-icon",label:i18n("icu:StoryDetailsModal__download-attachment"),onClick:function(){saveAttachment(attachment)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Modal__WEBPACK_IMPORTED_MODULE_6__.u_,{modalName:"StoryDetailsModal",hasXButton:!0,i18n,moduleClassName:"StoryDetailsModal",onClose,useFocusTrap:!1,theme:_util_theme__WEBPACK_IMPORTED_MODULE_8__.Q.Dark,title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ContextMenu__WEBPACK_IMPORTED_MODULE_4__.x,{i18n,menuOptions,moduleClassName:"StoryDetailsModal__debugger",popperOptions:{placement:"bottom",strategy:"absolute"},theme:_util_theme__WEBPACK_IMPORTED_MODULE_8__.Q.Dark,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_5__.R,{i18n,id:"icu:StoryDetailsModal__sent-time",components:{time:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Time__WEBPACK_IMPORTED_MODULE_12__.q,{className:"StoryDetailsModal__debugger__button__text",timestamp,children:(0,_util_timestamp__WEBPACK_IMPORTED_MODULE_9__.gD)(i18n,timestamp)})}})}),attachment&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_5__.R,{i18n,id:"icu:StoryDetailsModal__file-size",components:{size:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("span",{className:"StoryDetailsModal__debugger__button__text",children:filesize__WEBPACK_IMPORTED_MODULE_1___default()(attachment.size)})}})}),timeRemaining&&timeRemaining>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_Intl__WEBPACK_IMPORTED_MODULE_5__.R,{i18n,id:"icu:StoryDetailsModal__disappears-in",components:{countdown:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("span",{className:"StoryDetailsModal__debugger__button__text",children:(0,_util_expirationTimer__WEBPACK_IMPORTED_MODULE_14__.WU)(i18n,timeRemaining,{largest:2})})}})})]}),children:content})}StoryDetailsModal.displayName="StoryDetailsModal"},"./ts/components/StoryDistributionListName.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>StoryDistributionListName});__webpack_require__("./node_modules/react/index.js");var _types_Stories__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/types/Stories.ts"),_UserText__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/UserText.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js");function StoryDistributionListName(_ref){var i18n=_ref.i18n,id=_ref.id,name=_ref.name;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_UserText__WEBPACK_IMPORTED_MODULE_2__.a,{text:(0,_types_Stories__WEBPACK_IMPORTED_MODULE_1__.HH)(i18n,id,name)})}StoryDistributionListName.displayName="StoryDistributionListName"},"./ts/components/StoryImage.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{s:()=>StoryImage});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_blurhash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-blurhash/es/index.js"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_TextAttachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/components/TextAttachment.tsx"),_types_Util__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/Util.ts"),_types_Attachment__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/types/Attachment.ts"),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/getClassNamesFor.ts"),_util_GoogleChrome__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/GoogleChrome.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function StoryImage(_ref){var _attachment$thumbnail,attachment=_ref.attachment,children=_ref.children,firstName=_ref.firstName,i18n=_ref.i18n,isMe=_ref.isMe,isMuted=_ref.isMuted,isPaused=_ref.isPaused,isThumbnail=_ref.isThumbnail,label=_ref.label,moduleClassName=_ref.moduleClassName,queueStoryDownload=_ref.queueStoryDownload,storyId=_ref.storyId,onMediaPlaybackStart=_ref.onMediaPlaybackStart,shouldDownloadAttachment=!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.TG)(attachment)&&!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.XN)(attachment)||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.AR)(attachment),_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),2),hasImgError=_useState2[0],setHasImgError=_useState2[1],videoRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);if((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){shouldDownloadAttachment&&queueStoryDownload(storyId)}),[queueStoryDownload,shouldDownloadAttachment,storyId]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){videoRef.current&&(isPaused?videoRef.current.pause():(onMediaPlaybackStart(),videoRef.current.play()))}),[isPaused,onMediaPlaybackStart]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){setHasImgError(!1)}),[null==attachment?void 0:attachment.url,null==attachment||null===(_attachment$thumbnail=attachment.thumbnail)||void 0===_attachment$thumbnail?void 0:_attachment$thumbnail.url]),!attachment)return null;var storyElement,overlay,hasError=hasImgError||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.uw)(attachment),isPending=Boolean(attachment.pending)&&!attachment.textAttachment&&!hasError,isNotReadyToShow=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.AR)(attachment)||isPending||hasError,isSupportedVideo=(0,_util_GoogleChrome__WEBPACK_IMPORTED_MODULE_8__.eq)(attachment.contentType),getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_7__.h)("StoryImage",moduleClassName);if(attachment.textAttachment)storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_TextAttachment__WEBPACK_IMPORTED_MODULE_4__.S,{i18n,isThumbnail,textAttachment:attachment.textAttachment});else if(isNotReadyToShow)storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:attachment.blurHash||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.d0)(_types_Util__WEBPACK_IMPORTED_MODULE_5__.f8.dark),height:attachment.height,width:attachment.width});else if(!isThumbnail&&isSupportedVideo){var shouldLoop=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_6__.DQ)(attachment?[attachment]:void 0);storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("video",{autoPlay:!0,className:getClassName("__image"),controls:!1,loop:shouldLoop,muted:isMuted,ref:videoRef,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("source",{src:attachment.url})},attachment.url)}else storyElement=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("img",{alt:label,className:getClassName("__image"),onError:function(){return setHasImgError(!0)},src:isThumbnail&&attachment.thumbnail?attachment.thumbnail.url:attachment.url});if(isPending)overlay=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__overlay-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__spinner-bubble",title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{moduleClassName:"StoryImage__spinner",svgSize:"small"})})});else if(hasError){var content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__error"});isThumbnail||(content=isMe?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:i18n("icu:StoryImage__error--you")}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:i18n("icu:StoryImage__error2",{name:firstName})})),overlay=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"StoryImage__overlay-container",children:content})}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName(""),isThumbnail?getClassName("--thumbnail"):void 0),children:[storyElement,overlay,children]})}StoryImage.displayName="StoryImage"},"./ts/components/StoryViewer.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Caption:()=>Caption,EmojiCaption:()=>EmojiCaption,InAGroup:()=>InAGroup,LongCaption:()=>LongCaption,MultiStory:()=>MultiStory,ReadReceiptsOff:()=>ReadReceiptsOff,SomeonesStory:()=>SomeonesStory,WideStory:()=>WideStory,YourStory:()=>YourStory,YourStoryFailed:()=>YourStoryFailed,__namedExportsOrder:()=>__namedExportsOrder,default:()=>StoryViewer_stories});var react=__webpack_require__("./node_modules/react/index.js"),messages=__webpack_require__("./_locales/en/messages.json"),MessageSendState=__webpack_require__("./ts/messages/MessageSendState.ts"),Stories=__webpack_require__("./ts/types/Stories.ts"),focus_trap_react=__webpack_require__("./node_modules/focus-trap-react/dist/focus-trap-react.js"),focus_trap_react_default=__webpack_require__.n(focus_trap_react),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),log=__webpack_require__("./ts/logging/log.ts"),AnimatedEmojiGalore=__webpack_require__("./ts/components/AnimatedEmojiGalore.tsx"),Avatar=__webpack_require__("./ts/components/Avatar.tsx"),ConfirmationDialog=__webpack_require__("./ts/components/ConfirmationDialog.tsx"),ContextMenu=__webpack_require__("./ts/components/ContextMenu.tsx"),Intl=__webpack_require__("./ts/components/Intl.tsx"),MessageTimestamp=__webpack_require__("./ts/components/conversation/MessageTimestamp.tsx"),Spinner=__webpack_require__("./ts/components/Spinner.tsx"),StoryDetailsModal=__webpack_require__("./ts/components/StoryDetailsModal.tsx"),StoryDistributionListName=__webpack_require__("./ts/components/StoryDistributionListName.tsx"),StoryImage=__webpack_require__("./ts/components/StoryImage.tsx"),StoryViewsNRepliesModal=__webpack_require__("./ts/components/StoryViewsNRepliesModal.tsx"),theme=__webpack_require__("./ts/util/theme.ts"),Toast=__webpack_require__("./ts/types/Toast.tsx"),Colors=__webpack_require__("./ts/types/Colors.ts"),getStoryBackground=__webpack_require__("./ts/util/getStoryBackground.ts"),Attachment=__webpack_require__("./ts/types/Attachment.ts"),grapheme=__webpack_require__("./ts/util/grapheme.ts"),durations=__webpack_require__("./ts/util/durations/index.ts"),DEFAULT_DURATION=5*durations.sh,MAX_VIDEO_DURATION=30*durations.sh;var graphemeAndLinkAwareSlice=__webpack_require__("./ts/util/graphemeAndLinkAwareSlice.ts"),useEscapeHandling=__webpack_require__("./ts/hooks/useEscapeHandling.ts"),useRetryStorySend=__webpack_require__("./ts/hooks/useRetryStorySend.tsx"),resolveStorySendStatus=__webpack_require__("./ts/util/resolveStorySendStatus.ts"),assert=__webpack_require__("./ts/util/assert.ts"),MessageBody=__webpack_require__("./ts/components/conversation/MessageBody.tsx"),MessageTextRenderer=__webpack_require__("./ts/components/conversation/MessageTextRenderer.tsx"),keyboard=__webpack_require__("./ts/util/keyboard.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function renderStrong(parts){return(0,jsx_runtime.jsx)("strong",{children:parts})}renderStrong.displayName="renderStrong";var Arrow;function StoryViewer(_ref){var currentIndex=_ref.currentIndex,deleteGroupStoryReply=_ref.deleteGroupStoryReply,deleteGroupStoryReplyForEveryone=_ref.deleteGroupStoryReplyForEveryone,deleteStoryForEveryone=_ref.deleteStoryForEveryone,distributionList=_ref.distributionList,getPreferredBadge=_ref.getPreferredBadge,group=_ref.group,hasActiveCall=_ref.hasActiveCall,hasAllStoriesUnmuted=_ref.hasAllStoriesUnmuted,hasViewReceiptSetting=_ref.hasViewReceiptSetting,i18n=_ref.i18n,isFormattingEnabled=_ref.isFormattingEnabled,isFormattingFlagEnabled=_ref.isFormattingFlagEnabled,isFormattingSpoilersFlagEnabled=_ref.isFormattingSpoilersFlagEnabled,isInternalUser=_ref.isInternalUser,isSignalConversation=_ref.isSignalConversation,isWindowActive=_ref.isWindowActive,loadStoryReplies=_ref.loadStoryReplies,markStoryRead=_ref.markStoryRead,numStories=_ref.numStories,onGoToConversation=_ref.onGoToConversation,onHideStory=_ref.onHideStory,onReactToStory=_ref.onReactToStory,onReplyToStory=_ref.onReplyToStory,onSetSkinTone=_ref.onSetSkinTone,onTextTooLong=_ref.onTextTooLong,onUseEmoji=_ref.onUseEmoji,onMediaPlaybackStart=_ref.onMediaPlaybackStart,platform=_ref.platform,preferredReactionEmoji=_ref.preferredReactionEmoji,queueStoryDownload=_ref.queueStoryDownload,recentEmojis=_ref.recentEmojis,renderEmojiPicker=_ref.renderEmojiPicker,replyState=_ref.replyState,retryMessageSend=_ref.retryMessageSend,saveAttachment=_ref.saveAttachment,setHasAllStoriesUnmuted=_ref.setHasAllStoriesUnmuted,showContactModal=_ref.showContactModal,showToast=_ref.showToast,skinTone=_ref.skinTone,story=_ref.story,storyViewMode=_ref.storyViewMode,viewStory=_ref.viewStory,viewTarget=_ref.viewTarget,_useState2=_slicedToArray((0,react.useState)(!1),2),isShowingContextMenu=_useState2[0],setIsShowingContextMenu=_useState2[1],_useState4=_slicedToArray((0,react.useState)(),2),storyDuration=_useState4[0],setStoryDuration=_useState4[1],_useState6=_slicedToArray((0,react.useState)(!1),2),hasConfirmHideStory=_useState6[0],setHasConfirmHideStory=_useState6[1],_useState8=_slicedToArray((0,react.useState)(),2),reactionEmoji=_useState8[0],setReactionEmoji=_useState8[1],_useState10=_slicedToArray((0,react.useState)(),2),confirmDeleteStory=_useState10[0],setConfirmDeleteStory=_useState10[1],attachment=story.attachment,bodyRanges=story.bodyRanges,canReply=story.canReply,isHidden=story.isHidden,messageId=story.messageId,messageIdForLogging=story.messageIdForLogging,sendState=story.sendState,timestamp=story.timestamp,_story$sender=story.sender,acceptedMessageRequest=_story$sender.acceptedMessageRequest,avatarPath=_story$sender.avatarPath,color=_story$sender.color,isMe=_story$sender.isMe,firstName=_story$sender.firstName,profileName=_story$sender.profileName,sharedGroupNames=_story$sender.sharedGroupNames,title=_story$sender.title,conversationId=(null==group?void 0:group.id)||story.sender.id,sendStatus=sendState?(0,resolveStorySendStatus.Z)(sendState):void 0,_useRetryStorySend=(0,useRetryStorySend.X)(i18n,sendStatus),renderAlert=_useRetryStorySend.renderAlert,setWasManuallyRetried=_useRetryStorySend.setWasManuallyRetried,wasManuallyRetried=_useRetryStorySend.wasManuallyRetried,_useState12=_slicedToArray((0,react.useState)(null!=viewTarget?viewTarget:null),2),currentViewTarget=_useState12[0],setCurrentViewTarget=_useState12[1];(0,react.useEffect)((function(){setCurrentViewTarget(null!=viewTarget?viewTarget:null)}),[viewTarget]);var onClose=(0,react.useCallback)((function(){viewStory({closeViewer:!0})}),[viewStory]),onEscape=(0,react.useCallback)((function(){null!=currentViewTarget?setCurrentViewTarget(null):onClose()}),[currentViewTarget,onClose]);(0,useEscapeHandling.w)(onEscape);var _useState14=_slicedToArray((0,react.useState)(!1),2),hasExpandedCaption=_useState14[0],setHasExpandedCaption=_useState14[1],_useState16=_slicedToArray((0,react.useState)({}),2),isSpoilerExpanded=_useState16[0],setIsSpoilerExpanded=_useState16[1],caption=(0,react.useMemo)((function(){if(null!=attachment&&attachment.caption)return(0,graphemeAndLinkAwareSlice.r)(attachment.caption,hasExpandedCaption?700:200,20)}),[null==attachment?void 0:attachment.caption,hasExpandedCaption]);(0,react.useEffect)((function(){setHasExpandedCaption(!1),setIsSpoilerExpanded({})}),[messageId]),(0,react.useEffect)((function(){var shouldCancel=!1;return async function hydrateStoryDuration(){if(attachment){var duration=await async function getStoryDuration(attachment){if((0,Attachment.uw)(attachment))return DEFAULT_DURATION;if(attachment.textAttachment){var length=attachment.textAttachment.text?(0,grapheme.QX)(attachment.textAttachment.text):0,additionalSeconds=(Math.ceil(length/15)-1)*durations.sh,linkPreviewSeconds=attachment.textAttachment.preview?2*durations.sh:0;return DEFAULT_DURATION+additionalSeconds+linkPreviewSeconds}if((0,Attachment.TG)(attachment)&&!(0,Attachment.AR)(attachment)){if((0,Attachment.DQ)([attachment])||(0,Attachment.Wv)([attachment])){var videoEl=document.createElement("video");if(!attachment.url)return DEFAULT_DURATION;videoEl.src=attachment.url,await new Promise((function(resolve){videoEl.addEventListener("loadedmetadata",(function resolveAndRemove(){resolve(),videoEl.removeEventListener("loadedmetadata",resolveAndRemove)}))}));var duration=Math.ceil(videoEl.duration*durations.sh);return(0,Attachment.DQ)([attachment])?Math.min(Math.max(3*duration,DEFAULT_DURATION),MAX_VIDEO_DURATION):Math.min(duration,MAX_VIDEO_DURATION)}if(attachment.caption){var _length=(0,grapheme.QX)(attachment.caption),_additionalSeconds=(Math.ceil(_length/15)-1)*durations.sh;return DEFAULT_DURATION+_additionalSeconds}return DEFAULT_DURATION}}(attachment);shouldCancel||(log.info("stories.setStoryDuration",{contentType:attachment.textAttachment?"text":attachment.contentType,duration}),setStoryDuration(duration))}}(),function(){shouldCancel=!0}}),[attachment,messageId]);var progressBarRef=(0,react.useRef)(null),animationRef=(0,react.useRef)(null),onFinishRef=(0,react.useRef)(null);(0,react.useEffect)((function(){onFinishRef.current=function(){viewStory({storyId:story.messageId,storyViewMode,viewDirection:Stories.FT.Next})}}),[story.messageId,storyViewMode,viewStory]),(0,assert.Yj)(null!=currentIndex,"StoryViewer: currentIndex can't be null"),(0,react.useEffect)((function(){if(storyDuration){(0,assert.Yj)(null!=progressBarRef.current,"progressBarRef can't be null");var animation=progressBarRef.current.animate([{transform:"translateX(-100%)"},{transform:"translateX(0%)"}],{id:"story-progress-bar",duration:storyDuration,easing:"linear",fill:"forwards"});return animationRef.current=animation,animation.addEventListener("finish",onFinish),setConfirmDeleteStory(void 0),setHasConfirmHideStory(!1),setHasExpandedCaption(!1),setIsSpoilerExpanded({}),setIsShowingContextMenu(!1),setPauseStory(!1),function(){animation.removeEventListener("finish",onFinish),animation.cancel()}}function onFinish(){var _onFinishRef$current;null===(_onFinishRef$current=onFinishRef.current)||void 0===_onFinishRef$current||_onFinishRef$current.call(onFinishRef)}}),[story.messageId,storyDuration]);var _useState18=_slicedToArray((0,react.useState)(!1),2),pauseStory=_useState18[0],setPauseStory=_useState18[1];(0,react.useEffect)((function(){isWindowActive||setPauseStory(!0)}),[isWindowActive]);var alertElement=renderAlert(),shouldPauseViewing=Boolean(alertElement)||Boolean(confirmDeleteStory)||null!=currentViewTarget||hasActiveCall||hasConfirmHideStory||hasExpandedCaption||isShowingContextMenu||pauseStory||Boolean(reactionEmoji);(0,react.useEffect)((function(){var _animationRef$current,_animationRef$current2;shouldPauseViewing?null===(_animationRef$current=animationRef.current)||void 0===_animationRef$current||_animationRef$current.pause():null===(_animationRef$current2=animationRef.current)||void 0===_animationRef$current2||_animationRef$current2.play()}),[shouldPauseViewing,story.messageId,storyDuration]),(0,react.useEffect)((function(){markStoryRead(messageId),log.info("stories.markStoryRead",{message:messageIdForLogging})}),[markStoryRead,messageId,messageIdForLogging]);var canFreelyNavigateStories=storyViewMode===Stories.bX.All||storyViewMode===Stories.bX.Hidden||storyViewMode===Stories.bX.MyStories||storyViewMode===Stories.bX.Unread,canNavigateLeft=storyViewMode===Stories.bX.User&&currentIndex>0||canFreelyNavigateStories,canNavigateRight=storyViewMode===Stories.bX.User&&currentIndex<numStories-1||canFreelyNavigateStories,navigateStories=(0,react.useCallback)((function(ev){null==currentViewTarget&&(canNavigateRight&&ev.key===(0,keyboard.x)("end")?(viewStory({storyId:story.messageId,storyViewMode,viewDirection:Stories.FT.Next}),ev.preventDefault(),ev.stopPropagation()):canNavigateLeft&&ev.key===(0,keyboard.x)("start")&&(viewStory({storyId:story.messageId,storyViewMode,viewDirection:Stories.FT.Previous}),ev.preventDefault(),ev.stopPropagation()))}),[currentViewTarget,canNavigateLeft,canNavigateRight,story.messageId,storyViewMode,viewStory]);(0,react.useEffect)((function(){return document.addEventListener("keydown",navigateStories),function(){document.removeEventListener("keydown",navigateStories)}}),[navigateStories]);var groupId=null==group?void 0:group.id,isGroupStory=Boolean(groupId);(0,react.useEffect)((function(){groupId&&loadStoryReplies(groupId,messageId)}),[groupId,loadStoryReplies,messageId]);var _useState20=_slicedToArray((0,react.useState)(Arrow.None),2),arrowToShow=_useState20[0],setArrowToShow=_useState20[1];(0,react.useEffect)((function(){var mouseMoveExpiration,timer;if(arrowToShow!==Arrow.None)return document.addEventListener("mousemove",updateLastMouseMove),function(){void 0!==timer&&clearTimeout(timer),mouseMoveExpiration=void 0,timer=void 0,document.removeEventListener("mousemove",updateLastMouseMove)};function updateLastMouseMove(){mouseMoveExpiration=Date.now()+3e3,void 0===timer&&checkMouseIdle()}function checkMouseIdle(){if(timer=void 0,void 0!==mouseMoveExpiration){var remaining=mouseMoveExpiration-Date.now();remaining<=0?setArrowToShow(Arrow.None):timer=setTimeout(checkMouseIdle,remaining)}}}),[arrowToShow]);var muteClassName,muteAriaLabel,replies=replyState&&replyState.messageId===messageId?replyState.replies:[],views=sendState?sendState.filter((function(_ref2){return _ref2.status===MessageSendState.fq.Viewed})):[],replyCount=replies.length,viewCount=views.length,hasAudio=(0,Attachment.fr)(attachment),isStoryMuted=!hasAllStoriesUnmuted||!hasAudio;hasAudio?(muteAriaLabel=i18n(hasAllStoriesUnmuted?"icu:StoryViewer__mute":"icu:StoryViewer__unmute"),muteClassName=hasAllStoriesUnmuted?"StoryViewer__mute":"StoryViewer__unmute"):(muteAriaLabel=i18n("icu:Stories__toast--hasNoSound"),muteClassName="StoryViewer__soundless");var contextMenuOptions,isSent=Boolean(sendState);function doRetryMessageSend(){wasManuallyRetried||sendStatus!==Stories.Ox.Failed&&sendStatus!==Stories.Ox.PartiallySent||(setWasManuallyRetried(!0),retryMessageSend(messageId))}return isSent?contextMenuOptions=[{icon:"StoryListItem__icon--info",label:i18n("icu:StoryListItem__info"),onClick:function(){return setCurrentViewTarget(Stories.Zk.Details)}},{icon:"StoryListItem__icon--delete",label:i18n("icu:StoryListItem__delete"),onClick:function(){return setConfirmDeleteStory(story)}}]:isSignalConversation||(contextMenuOptions=[{icon:"StoryListItem__icon--info",label:i18n("icu:StoryListItem__info"),onClick:function(){return setCurrentViewTarget(Stories.Zk.Details)}},{icon:"StoryListItem__icon--hide",label:i18n(isHidden?"icu:StoryListItem__unhide":"icu:StoryListItem__hide"),onClick:function(){isHidden?onHideStory(conversationId):setHasConfirmHideStory(!0)}},{icon:"StoryListItem__icon--chat",label:i18n("icu:StoryListItem__go-to-chat"),onClick:function(){onGoToConversation(conversationId)}}]),(0,jsx_runtime.jsx)(focus_trap_react_default(),{focusTrapOptions:{clickOutsideDeactivates:!0},children:(0,jsx_runtime.jsxs)("div",{className:"StoryViewer",children:[alertElement,(0,jsx_runtime.jsx)("div",{className:"StoryViewer__overlay",style:{background:(0,getStoryBackground.t_)(attachment)}}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__content",children:[canNavigateLeft&&(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:back"),className:classnames_default()("StoryViewer__arrow StoryViewer__arrow--left",{"StoryViewer__arrow--visible":arrowToShow===Arrow.Left}),onClick:function(){return viewStory({storyId:story.messageId,storyViewMode,viewDirection:Stories.FT.Previous})},onMouseMove:function(){return setArrowToShow(Arrow.Left)},type:"button"}),(0,jsx_runtime.jsx)("div",{className:"StoryViewer__protection StoryViewer__protection--top"}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__container",onDoubleClick:function(){return setCurrentViewTarget(Stories.Zk.Replies)},children:[(0,jsx_runtime.jsx)(StoryImage.s,{attachment,firstName:firstName||title,isMe,i18n,isPaused:shouldPauseViewing,isMuted:isStoryMuted,label:i18n("icu:lightboxImageAlt"),moduleClassName:"StoryViewer__story",queueStoryDownload,storyId:messageId,onMediaPlaybackStart,children:reactionEmoji&&(0,jsx_runtime.jsx)("div",{className:"StoryViewer__animated-emojis",children:(0,jsx_runtime.jsx)(AnimatedEmojiGalore.w,{emoji:reactionEmoji,onAnimationEnd:function(){setReactionEmoji(void 0)}})})}),hasExpandedCaption&&(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:close-popup"),className:"StoryViewer__CAPTION__overlay",onClick:function(){return setHasExpandedCaption(!1)},type:"button"})]}),(0,jsx_runtime.jsx)("div",{className:"StoryViewer__protection StoryViewer__protection--bottom"}),canNavigateRight&&(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:forward"),className:classnames_default()("StoryViewer__arrow StoryViewer__arrow--right",{"StoryViewer__arrow--visible":arrowToShow===Arrow.Right}),onClick:function(){return viewStory({storyId:story.messageId,storyViewMode,viewDirection:Stories.FT.Next})},onMouseMove:function(){return setArrowToShow(Arrow.Right)},type:"button"}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__meta",children:[caption&&(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__caption",children:[(0,jsx_runtime.jsx)(MessageBody.D,{bodyRanges,i18n,isSpoilerExpanded,onExpandSpoiler:function(data){return setIsSpoilerExpanded(data)},renderLocation:MessageTextRenderer.G5.StoryViewer,text:caption.text}),caption.hasReadMore&&!hasExpandedCaption&&(0,jsx_runtime.jsxs)("button",{className:"MessageBody__read-more",onClick:function(){setHasExpandedCaption(!0)},onKeyDown:function(ev){"Space"!==ev.key&&"Enter"!==ev.key||setHasExpandedCaption(!0)},type:"button",children:["...",i18n("icu:MessageBody--read-more")]})]}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__meta__playback-bar",children:[(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__meta__playback-bar__container",children:[(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest,avatarPath,badge:void 0,color:(0,Colors.hx)(color),conversationType:"direct",i18n,isMe:Boolean(isMe),profileName,sharedGroupNames,size:Avatar.DZ.TWENTY_EIGHT,title}),group&&(0,jsx_runtime.jsx)(Avatar.qE,{acceptedMessageRequest:group.acceptedMessageRequest,avatarPath:group.avatarPath,badge:void 0,className:"StoryViewer__meta--group-avatar",color:(0,Colors.hx)(group.color),conversationType:"group",i18n,isMe:!1,profileName:group.profileName,sharedGroupNames:group.sharedGroupNames,size:Avatar.DZ.TWENTY_EIGHT,title:group.title}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__meta--title-container",children:[(0,jsx_runtime.jsx)("div",{className:"StoryViewer__meta--title",children:group&&i18n("icu:Stories__from-to-group",{name:isMe?i18n("icu:you"):title,group:group.title})||(isMe?i18n("icu:you"):title)}),(0,jsx_runtime.jsx)(MessageTimestamp.i,{i18n,isRelativeTime:!0,module:"StoryViewer__meta--timestamp",timestamp}),distributionList&&(0,jsx_runtime.jsx)("div",{className:"StoryViewer__meta__list",children:(0,jsx_runtime.jsx)(StoryDistributionListName.e,{id:distributionList.id,name:distributionList.name,i18n})})]})]}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__meta__playback-controls",children:[(0,jsx_runtime.jsx)("button",{"aria-label":i18n(pauseStory?"icu:StoryViewer__play":"icu:StoryViewer__pause"),className:pauseStory?"StoryViewer__play":"StoryViewer__pause",onClick:function(){return setPauseStory(!pauseStory)},type:"button"}),(0,jsx_runtime.jsx)("button",{"aria-label":muteAriaLabel,className:muteClassName,onClick:hasAudio?function(){return setHasAllStoriesUnmuted(!hasAllStoriesUnmuted)}:function(){return showToast({toastType:Toast.p.StoryMuted})},type:"button"}),contextMenuOptions&&(0,jsx_runtime.jsx)(ContextMenu.x,{"aria-label":i18n("icu:MyStories__more"),i18n,menuOptions:contextMenuOptions,moduleClassName:"StoryViewer__more",onMenuShowingChanged:setIsShowingContextMenu,theme:theme.Q.Dark})]})]}),(0,jsx_runtime.jsx)("div",{className:"StoryViewer__progress",children:Array.from(Array(numStories),(function(_,index){return(0,jsx_runtime.jsx)("div",{className:"StoryViewer__progress--container",children:currentIndex===index?(0,jsx_runtime.jsx)("div",{ref:progressBarRef,className:"StoryViewer__progress--bar"}):(0,jsx_runtime.jsx)("div",{className:"StoryViewer__progress--bar",style:currentIndex<index?{}:{transform:"translateX(0%)"}})},index)}))}),(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__actions",children:[sendStatus===Stories.Ox.Failed&&!wasManuallyRetried&&(0,jsx_runtime.jsx)("button",{className:"StoryViewer__actions__failed",onClick:doRetryMessageSend,type:"button",children:i18n("icu:StoryViewer__failed")}),sendStatus===Stories.Ox.PartiallySent&&!wasManuallyRetried&&(0,jsx_runtime.jsx)("button",{className:"StoryViewer__actions__failed",onClick:doRetryMessageSend,type:"button",children:i18n("icu:StoryViewer__partial-fail")}),sendStatus===Stories.Ox.Sending&&(0,jsx_runtime.jsxs)("div",{className:"StoryViewer__sending",children:[(0,jsx_runtime.jsx)(Spinner.$j,{moduleClassName:"StoryViewer__sending__spinner",svgSize:"small"}),i18n("icu:StoryViewer__sending")]}),(canReply||isSent&&sendStatus===Stories.Ox.Sent)&&(0,jsx_runtime.jsxs)("button",{className:"StoryViewer__reply",onClick:function(){return setCurrentViewTarget(Stories.Zk.Replies)},tabIndex:0,type:"button",children:[isSent||replyCount>0?(0,jsx_runtime.jsx)("span",{className:"StoryViewer__reply__chevron",children:(0,jsx_runtime.jsxs)("span",{children:[isSent&&!hasViewReceiptSetting&&!replyCount&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:i18n("icu:StoryViewer__views-off")}),isSent&&hasViewReceiptSetting&&(0,jsx_runtime.jsx)(Intl.R,{i18n,id:"icu:MyStories__views--strong",components:{views:viewCount,strong:renderStrong}}),(isSent||viewCount>0)&&replyCount>0&&" ",replyCount>0&&(0,jsx_runtime.jsx)(Intl.R,{i18n,id:"icu:MyStories__replies",components:{replyCount,strong:renderStrong}})]})}):null,!isSent&&!replyCount&&(0,jsx_runtime.jsx)("span",{className:"StoryViewer__reply__arrow",children:i18n(isGroupStory?"icu:StoryViewer__reply-group":"icu:StoryViewer__reply")})]})]})]}),(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:close"),className:"StoryViewer__close-button",onClick:onClose,tabIndex:0,type:"button"})]}),currentViewTarget===Stories.Zk.Details&&(0,jsx_runtime.jsx)(StoryDetailsModal.P,{attachment,getPreferredBadge,i18n,isInternalUser,onClose:function(){return setCurrentViewTarget(null)},saveAttachment,sender:story.sender,sendState,timestamp,expirationTimestamp:story.expirationTimestamp}),(currentViewTarget===Stories.Zk.Replies||currentViewTarget===Stories.Zk.Views)&&(0,jsx_runtime.jsx)(StoryViewsNRepliesModal.p,{authorTitle:firstName||title,canReply:Boolean(canReply),getPreferredBadge,hasViewReceiptSetting,hasViewsCapability:isSent,i18n,platform,isFormattingEnabled,isFormattingFlagEnabled,isFormattingSpoilersFlagEnabled,isInternalUser,group,onClose:function(){return setCurrentViewTarget(null)},onReact:function(emoji){onReactToStory(emoji,story),isGroupStory||(setCurrentViewTarget(null),showToast({toastType:Toast.p.StoryReact})),setReactionEmoji(emoji)},onReply:function(message,replyBodyRanges,replyTimestamp){isGroupStory||(setCurrentViewTarget(null),showToast({toastType:Toast.p.StoryReply})),onReplyToStory(message,replyBodyRanges,replyTimestamp,story)},onSetSkinTone,onTextTooLong,onUseEmoji,preferredReactionEmoji,recentEmojis,renderEmojiPicker,replies,showContactModal,skinTone,sortedGroupMembers:null==group?void 0:group.sortedGroupMembers,views,viewTarget:currentViewTarget,onChangeViewTarget:setCurrentViewTarget,deleteGroupStoryReply,deleteGroupStoryReplyForEveryone}),hasConfirmHideStory&&(0,jsx_runtime.jsx)(ConfirmationDialog.U,{dialogName:"StoryViewer.confirmHideStory",actions:[{action:function(){onHideStory(conversationId),onClose()},style:"affirmative",text:i18n("icu:StoryListItem__hide-modal--confirm")}],i18n,onClose:function(){setHasConfirmHideStory(!1)},children:i18n("icu:StoryListItem__hide-modal--body",{name:String(firstName)})}),confirmDeleteStory&&(0,jsx_runtime.jsx)(ConfirmationDialog.U,{dialogName:"StoryViewer.deleteStory",actions:[{text:i18n("icu:delete"),action:function(){return deleteStoryForEveryone(confirmDeleteStory)},style:"negative"}],i18n,onClose:function(){return setConfirmDeleteStory(void 0)},children:i18n("icu:MyStories__delete")})]})})}!function(Arrow){Arrow[Arrow.None=0]="None",Arrow[Arrow.Left=1]="Left",Arrow[Arrow.Right=2]="Right"}(Arrow||(Arrow={})),StoryViewer.displayName="StoryViewer";var MIME=__webpack_require__("./ts/types/MIME.ts"),fakeAttachment=__webpack_require__("./ts/test-both/helpers/fakeAttachment.ts"),getDefaultConversation=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),getFakeStory=__webpack_require__("./ts/test-both/helpers/getFakeStory.tsx");const StoryViewer_stories={title:"Components/StoryViewer",component:StoryViewer,argTypes:{currentIndex:{defaultvalue:0},getPreferredBadge:{action:!0},group:{defaultValue:void 0},hasAllStoriesMuted:{control:"boolean",defaultValue:!1},hasViewReceiptSetting:{control:"boolean",defaultValue:!0},i18n:{defaultValue:(0,__webpack_require__("./ts/util/setupI18n.ts").E5)("en",messages)},platform:{defaultValue:"darwin"},loadStoryReplies:{action:!0},markStoryRead:{action:!0},numStories:{defaultValue:1},onGoToConversation:{action:!0},onHideStory:{action:!0},onReactToStory:{action:!0},onReplyToStory:{action:!0},onSetSkinTone:{action:!0},onTextTooLong:{action:!0},onUseEmoji:{action:!0},preferredReactionEmoji:{defaultValue:["❤️","👍","👎","😂","😮","😢"]},queueStoryDownload:{action:!0},renderEmojiPicker:{action:!0},retryMessageSend:{action:!0},showToast:{action:!0},skinTone:{defaultValue:0},story:{defaultValue:(0,getFakeStory.Mh)()},storyViewMode:{defaultValue:Stories.bX.All},toggleHasAllStoriesMuted:{action:!0},viewStory:{action:!0},isWindowActive:{defaultValue:!0}},args:{currentIndex:0}};var Template=function(args){return(0,jsx_runtime.jsx)(StoryViewer,Object.assign({},args))};Template.displayName="Template";var SomeonesStory=Template.bind({});SomeonesStory.args={},SomeonesStory.story={name:"Someone's story"};var WideStory=Template.bind({});WideStory.args={story:(0,getFakeStory.Mh)("/fixtures/nathan-anderson-316188-unsplash.jpg")},WideStory.story={name:"Wide story"};var InAGroup=Template.bind({});InAGroup.args={group:(0,getDefaultConversation.E$)({avatarPath:"/fixtures/kitten-4-112-112.jpg",title:"Family Group",type:"group"})},InAGroup.story={name:"In a group"};var MultiStory=Template.bind({});MultiStory.args={currentIndex:2,numStories:7,story:Object.assign({},(0,getFakeStory.Mh)(),{attachment:(0,fakeAttachment.dh)({contentType:MIME.ml,fileName:"pixabay-Soap-Bubble-7141.mp4",url:"/fixtures/kitten-4-112-112.jpg",screenshotPath:"/fixtures/kitten-4-112-112.jpg"})})},MultiStory.story={name:"Multi story"};var Caption=Template.bind({});Caption.args={story:Object.assign({},(0,getFakeStory.Mh)(),{attachment:(0,fakeAttachment.dh)({caption:"This place looks lovely",path:"file.jpg",url:"/fixtures/nathan-anderson-316188-unsplash.jpg"})})};var EmojiCaption=Template.bind({});EmojiCaption.args={story:Object.assign({},(0,getFakeStory.Mh)(),{attachment:(0,fakeAttachment.dh)({caption:"WOOOOOOOOW 🥰",path:"file.jpg",url:"/fixtures/nathan-anderson-316188-unsplash.jpg"})})};var LongCaption=Template.bind({});LongCaption.args={story:Object.assign({},(0,getFakeStory.Mh)(),{attachment:(0,fakeAttachment.dh)({caption:"Snowycle, snowycle, snowycle\nI want to ride my snowycle, snowycle, snowycle\nI want to ride my snowycle\nI want to ride my snow\nI want to ride my snowycle\nI want to ride it where I like\nSnowycle, snowycle, snowycle\nI want to ride my snowycle, snowycle, snowycle\nI want to ride my snowycle\nI want to ride my snow\nI want to ride my snowycle\nI want to ride it where I like\nSnowycle, snowycle, snowycle\nI want to ride my snowycle, snowycle, snowycle\nI want to ride my snowycle\nI want to ride my snow\nI want to ride my snowycle\nI want to ride it where I like",path:"file.jpg",url:"/fixtures/snow.jpg"})})};var YourStory=Template.bind({}),storyView=(0,getFakeStory.Mh)("/fixtures/nathan-anderson-316188-unsplash.jpg");YourStory.args={distributionList:{id:"123",name:"Close Friends"},story:Object.assign({},storyView,{sender:Object.assign({},storyView.sender,{isMe:!0}),sendState:[{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Viewed},{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Delivered},{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Pending}]})},YourStory.storyName="Your story";var YourStoryFailed=Template.bind({}),_storyView=(0,getFakeStory.Mh)("/fixtures/nathan-anderson-316188-unsplash.jpg");YourStoryFailed.args={distributionList:{id:"123",name:"Close Friends"},story:Object.assign({},_storyView,{sender:Object.assign({},_storyView.sender,{isMe:!0}),sendState:[{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Viewed},{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Failed}]})},YourStory.storyName="Your story";var ReadReceiptsOff=Template.bind({}),_storyView2=(0,getFakeStory.Mh)("/fixtures/nathan-anderson-316188-unsplash.jpg");ReadReceiptsOff.args={hasViewReceiptSetting:!1,story:Object.assign({},_storyView2,{sender:Object.assign({},_storyView2.sender,{isMe:!0}),sendState:[{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Viewed},{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Delivered},{recipient:(0,getDefaultConversation.E$)(),status:MessageSendState.fq.Pending}]})},ReadReceiptsOff.storyName="Read receipts turned off";var __namedExportsOrder=["SomeonesStory","WideStory","InAGroup","MultiStory","Caption","EmojiCaption","LongCaption","YourStory","YourStoryFailed","ReadReceiptsOff"]},"./ts/hooks/useRetryStorySend.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{X:()=>useRetryStorySend});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_components_Alert__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/components/Alert.tsx"),_types_Stories__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/types/Stories.ts"),_usePrevious__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/hooks/usePrevious.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function useRetryStorySend(i18n,sendStatus){var _useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),2),hasSendFailedAlert=_useState2[0],setHasSendFailedAlert=_useState2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),2),wasManuallyRetried=_useState4[0],setWasManuallyRetried=_useState4[1],previousSendStatus=(0,_usePrevious__WEBPACK_IMPORTED_MODULE_3__.D)(sendStatus,sendStatus);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){wasManuallyRetried&&previousSendStatus!==sendStatus&&(sendStatus!==_types_Stories__WEBPACK_IMPORTED_MODULE_2__.Ox.Failed&&sendStatus!==_types_Stories__WEBPACK_IMPORTED_MODULE_2__.Ox.PartiallySent||setHasSendFailedAlert(!0))}),[previousSendStatus,sendStatus,wasManuallyRetried]),{renderAlert:function renderAlert(){return hasSendFailedAlert?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_components_Alert__WEBPACK_IMPORTED_MODULE_1__.b,{body:i18n("icu:Stories__failed-send"),i18n,onClose:function(){return setHasSendFailedAlert(!1)}}):null},setWasManuallyRetried,wasManuallyRetried}}},"./ts/test-both/helpers/fakeAttachment.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C4:()=>fakeDraftAttachment,Jh:()=>fakeThumbnail,dh:()=>fakeAttachment});var _types_MIME__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/MIME.ts"),fakeAttachment=function(){var overrides=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,width:800,height:600,size:10304},overrides)},fakeThumbnail=function(url){return{contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,height:100,path:url,url,width:100}},fakeDraftAttachment=function(){var overrides=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({pending:!1,contentType:_types_MIME__WEBPACK_IMPORTED_MODULE_0__._l,path:"file.jpg",size:10304},overrides)}},"./ts/test-both/helpers/getFakeStory.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{GS:()=>getFakeMyStory,Mh:()=>getFakeStoryView,U6:()=>getFakeStory});var casual__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/casual/src/casual.js"),casual__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(casual__WEBPACK_IMPORTED_MODULE_0__),_util_durations__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/durations/index.ts"),_types_UUID__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/types/UUID.ts"),_getDefaultConversation__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/test-both/helpers/getDefaultConversation.ts"),_fakeAttachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/test-both/helpers/fakeAttachment.ts"),_types_Stories__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/Stories.ts");function getFakeMyStory(id,name){var storyCount=casual__WEBPACK_IMPORTED_MODULE_0___default().integer(2,6);return{id:id||_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString(),name:name||id===_types_Stories__WEBPACK_IMPORTED_MODULE_5__.qn?"My Stories":casual__WEBPACK_IMPORTED_MODULE_0___default().catch_phrase,reducedSendStatus:_types_Stories__WEBPACK_IMPORTED_MODULE_5__.Ox.Sent,stories:Array.from(Array(storyCount),(function(){return Object.assign({},getFakeStoryView(),{sendState:[],views:casual__WEBPACK_IMPORTED_MODULE_0___default().integer(1,20)})}))}}function getFakeStoryView(attachmentUrl,timestamp){var url,sender=(0,_getDefaultConversation__WEBPACK_IMPORTED_MODULE_3__.E$)(),messageId=_types_UUID__WEBPACK_IMPORTED_MODULE_2__.hb.generate().toString();return{attachment:(url=attachmentUrl||"/fixtures/tina-rolf-269345-unsplash.jpg",(0,_fakeAttachment__WEBPACK_IMPORTED_MODULE_4__.dh)({path:url,thumbnail:(0,_fakeAttachment__WEBPACK_IMPORTED_MODULE_4__.Jh)(url),url})),isUnread:Boolean(casual__WEBPACK_IMPORTED_MODULE_0___default().coin_flip),messageId,messageIdForLogging:`${messageId} (for logging)`,sender,timestamp:timestamp||Date.now()-2*_util_durations__WEBPACK_IMPORTED_MODULE_1__.EB,expirationTimestamp:void 0}}function getFakeStory(_ref){var attachmentUrl=_ref.attachmentUrl,group=_ref.group,storyView=getFakeStoryView(attachmentUrl,_ref.timestamp),hasReplies=!!group&&Boolean(casual__WEBPACK_IMPORTED_MODULE_0___default().coin_flip),hasRepliesFromSelf=!(!group||!hasReplies)&&Boolean(casual__WEBPACK_IMPORTED_MODULE_0___default().coin_flip);return{conversationId:storyView.sender.id,hasReplies,hasRepliesFromSelf,group,storyView}}},"./ts/types/Toast.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var ToastType;__webpack_require__.d(__webpack_exports__,{p:()=>ToastType}),function(ToastType){ToastType.AddingUserToGroup="AddingUserToGroup",ToastType.AlreadyGroupMember="AlreadyGroupMember",ToastType.AlreadyRequestedToJoin="AlreadyRequestedToJoin",ToastType.Blocked="Blocked",ToastType.BlockedGroup="BlockedGroup",ToastType.CannotEditMessage="CannotEditMessage",ToastType.CannotForwardEmptyMessage="CannotForwardEmptyMessage",ToastType.CannotMixMultiAndNonMultiAttachments="CannotMixMultiAndNonMultiAttachments",ToastType.CannotOpenGiftBadgeIncoming="CannotOpenGiftBadgeIncoming",ToastType.CannotOpenGiftBadgeOutgoing="CannotOpenGiftBadgeOutgoing",ToastType.CannotStartGroupCall="CannotStartGroupCall",ToastType.ConversationArchived="ConversationArchived",ToastType.ConversationMarkedUnread="ConversationMarkedUnread",ToastType.ConversationRemoved="ConversationRemoved",ToastType.ConversationUnarchived="ConversationUnarchived",ToastType.CopiedUsername="CopiedUsername",ToastType.CopiedUsernameLink="CopiedUsernameLink",ToastType.DangerousFileType="DangerousFileType",ToastType.DeleteForEveryoneFailed="DeleteForEveryoneFailed",ToastType.Error="Error",ToastType.Expired="Expired",ToastType.FailedToDeleteUsername="FailedToDeleteUsername",ToastType.FileSaved="FileSaved",ToastType.FileSize="FileSize",ToastType.InvalidConversation="InvalidConversation",ToastType.LeftGroup="LeftGroup",ToastType.MaxAttachments="MaxAttachments",ToastType.MessageBodyTooLong="MessageBodyTooLong",ToastType.OriginalMessageNotFound="OriginalMessageNotFound",ToastType.PinnedConversationsFull="PinnedConversationsFull",ToastType.ReactionFailed="ReactionFailed",ToastType.ReportedSpamAndBlocked="ReportedSpamAndBlocked",ToastType.StoryMuted="StoryMuted",ToastType.StoryReact="StoryReact",ToastType.StoryReply="StoryReply",ToastType.StoryVideoError="StoryVideoError",ToastType.StoryVideoUnsupported="StoryVideoUnsupported",ToastType.TapToViewExpiredIncoming="TapToViewExpiredIncoming",ToastType.TapToViewExpiredOutgoing="TapToViewExpiredOutgoing",ToastType.TooManyMessagesToDeleteForEveryone="TooManyMessagesToDeleteForEveryone",ToastType.TooManyMessagesToForward="TooManyMessagesToForward",ToastType.UnableToLoadAttachment="UnableToLoadAttachment",ToastType.UnsupportedMultiAttachment="UnsupportedMultiAttachment",ToastType.UnsupportedOS="UnsupportedOS",ToastType.UserAddedToGroup="UserAddedToGroup"}(ToastType||(ToastType={}))},"./ts/util/expirationTimer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{UD:()=>DEFAULT_DURATIONS_IN_SECONDS,WU:()=>format,h5:()=>DEFAULT_DURATIONS_SET});__webpack_require__("./node_modules/lodash/isNumber.js");var humanize_duration__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/humanize-duration/humanize-duration.js"),humanize_duration__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(humanize_duration__WEBPACK_IMPORTED_MODULE_1__),_durations__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/durations/index.ts"),DEFAULT_DURATIONS_IN_SECONDS=[_durations__WEBPACK_IMPORTED_MODULE_2__.kC.ZERO,_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromWeeks(4),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromWeeks(1),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromDays(1),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromHours(8),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromHours(1),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromMinutes(5),_durations__WEBPACK_IMPORTED_MODULE_2__.kC.fromSeconds(30)],DEFAULT_DURATIONS_SET=new Set(DEFAULT_DURATIONS_IN_SECONDS);function format(i18n,dirtySeconds){var _ref=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},_ref$capitalizeOff=_ref.capitalizeOff,capitalizeOff=void 0!==_ref$capitalizeOff&&_ref$capitalizeOff,largest=_ref.largest,seconds=Math.abs(dirtySeconds||0);if(!seconds)return i18n(capitalizeOff?"icu:off":"icu:disappearingMessages__off");seconds=Math.max(Math.floor(seconds),1);var locale=i18n.getLocale().replace(/-/g,"_"),localeWithoutRegion=locale.split("_",1)[0],fallbacks=[];localeWithoutRegion!==locale&&fallbacks.push(localeWithoutRegion),"nb"!==localeWithoutRegion&&"nn"!==localeWithoutRegion||fallbacks.push("no"),"en"!==localeWithoutRegion&&fallbacks.push("en"),"zh_HK"===locale&&fallbacks.push("zh_TW");var allUnits=["y","mo","w","d","h","m","s"],defaultUnits=seconds%604800==0?["w"]:["d","h","m","s"];return humanize_duration__WEBPACK_IMPORTED_MODULE_1___default()(seconds*_durations__WEBPACK_IMPORTED_MODULE_2__.sh,Object.assign({units:largest?allUnits:defaultUnits,largest,language:locale},fallbacks.length?{fallbacks}:{}))}},"./ts/util/keyboard.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{x:()=>arrow});var logicalArrows={start:{ltr:"ArrowLeft",rtl:"ArrowRight"},end:{ltr:"ArrowRight",rtl:"ArrowLeft"}};function arrow(logicalDirection){var localeDirection=window.getResolvedMessagesLocaleDirection();return logicalArrows[logicalDirection][localeDirection]}},"./ts/util/mapUtil.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{v:()=>groupBy});var _iterables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/iterables.ts");var groupBy=function(iterable,fn){return(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.u4)(iterable,(function(result,value){var key=fn(value),existingGroup=result.get(key);return existingGroup?existingGroup.push(value):result.set(key,[value]),result}),new Map)}},"./ts/util/resolveStorySendStatus.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>reduceStorySendStatus,Z:()=>resolveStorySendStatus});var _types_Stories__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/types/Stories.ts"),_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/messages/MessageSendState.ts"),_assert__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/assert.ts");function resolveStorySendStatus(sendStates){var anyPending=!1,anySent=!1,anyFailed=!1;return sendStates.forEach((function(_ref){var status=_ref.status;(0,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_1__.zR)(status)&&(anyPending=!0),(0,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_1__.vB)(status)&&(anySent=!0),(0,_messages_MessageSendState__WEBPACK_IMPORTED_MODULE_1__.gO)(status)&&(anyFailed=!0)})),anyPending?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sending:anyFailed&&anySent?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.PartiallySent:!anyFailed&&anySent?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sent:anyFailed&&!anySent?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Failed:((0,_assert__WEBPACK_IMPORTED_MODULE_2__.wN)(anySent&&sendStates.length,"resolveStorySendStatus no sends, no failures, nothing pending?"),_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sent)}function reduceStorySendStatus(currentSendStatus,nextSendStatus){return currentSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sending||nextSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sending?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sending:currentSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Failed||nextSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Failed?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Failed:currentSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.PartiallySent||nextSendStatus===_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.PartiallySent?_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.PartiallySent:_types_Stories__WEBPACK_IMPORTED_MODULE_0__.Ox.Sent}},"./node_modules/filesize/lib/filesize.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";!function(global){var b=/^(b|B)$/,symbol={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};function filesize(arg){var descriptor=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},result=[],val=0,e=void 0,base=void 0,bits=void 0,ceil=void 0,full=void 0,fullforms=void 0,neg=void 0,num=void 0,output=void 0,round=void 0,unix=void 0,separator=void 0,spacer=void 0,standard=void 0,symbols=void 0;if(isNaN(arg))throw new Error("Invalid arguments");return bits=!0===descriptor.bits,unix=!0===descriptor.unix,base=descriptor.base||2,round=void 0!==descriptor.round?descriptor.round:unix?1:2,separator=void 0!==descriptor.separator&&descriptor.separator||"",spacer=void 0!==descriptor.spacer?descriptor.spacer:unix?"":" ",symbols=descriptor.symbols||descriptor.suffixes||{},standard=2===base&&descriptor.standard||"jedec",output=descriptor.output||"string",full=!0===descriptor.fullform,fullforms=descriptor.fullforms instanceof Array?descriptor.fullforms:[],e=void 0!==descriptor.exponent?descriptor.exponent:-1,ceil=base>2?1e3:1024,(neg=(num=Number(arg))<0)&&(num=-num),(-1===e||isNaN(e))&&(e=Math.floor(Math.log(num)/Math.log(ceil)))<0&&(e=0),e>8&&(e=8),0===num?(result[0]=0,result[1]=unix?"":symbol[standard][bits?"bits":"bytes"][e]):(val=num/(2===base?Math.pow(2,10*e):Math.pow(1e3,e)),bits&&(val*=8)>=ceil&&e<8&&(val/=ceil,e++),result[0]=Number(val.toFixed(e>0?round:0)),result[1]=10===base&&1===e?bits?"kb":"kB":symbol[standard][bits?"bits":"bytes"][e],unix&&(result[1]="jedec"===standard?result[1].charAt(0):e>0?result[1].replace(/B$/,""):result[1],b.test(result[1])&&(result[0]=Math.floor(result[0]),result[1]=""))),neg&&(result[0]=-result[0]),result[1]=symbols[result[1]]||result[1],"array"===output?result:"exponent"===output?e:"object"===output?{value:result[0],suffix:result[1],symbol:result[1]}:(full&&(result[1]=fullforms[e]?fullforms[e]:fullform[standard][e]+(bits?"bit":"byte")+(1===result[0]?"":"s")),separator.length>0&&(result[0]=result[0].toString().replace(".",separator)),result.join(spacer))}filesize.partial=function(opt){return function(arg){return filesize(arg,opt)}},module.exports=filesize}("undefined"!=typeof window?window:__webpack_require__.g)},"./node_modules/lodash/random.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseRandom=__webpack_require__("./node_modules/lodash/_baseRandom.js"),isIterateeCall=__webpack_require__("./node_modules/lodash/_isIterateeCall.js"),toFinite=__webpack_require__("./node_modules/lodash/toFinite.js"),freeParseFloat=parseFloat,nativeMin=Math.min,nativeRandom=Math.random;module.exports=function random(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=void 0),void 0===floating&&("boolean"==typeof upper?(floating=upper,upper=void 0):"boolean"==typeof lower&&(floating=lower,lower=void 0)),void 0===lower&&void 0===upper?(lower=0,upper=1):(lower=toFinite(lower),void 0===upper?(upper=lower,lower=0):upper=toFinite(upper)),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}}}]);