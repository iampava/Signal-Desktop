"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[4320],{"./ts/components/AvatarEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>AvatarEditor});var react=__webpack_require__("./node_modules/react/index.js"),AvatarIconEditor=__webpack_require__("./ts/components/AvatarIconEditor.tsx"),AvatarModalButtons=__webpack_require__("./ts/components/AvatarModalButtons.tsx"),AvatarPreview=__webpack_require__("./ts/components/AvatarPreview.tsx"),AvatarTextEditor=__webpack_require__("./ts/components/AvatarTextEditor.tsx"),AvatarUploadButton=__webpack_require__("./ts/components/AvatarUploadButton.tsx"),BetterAvatar=__webpack_require__("./ts/components/BetterAvatar.tsx"),avatarDataToBytes=__webpack_require__("./ts/util/avatarDataToBytes.ts"),createAvatarData=__webpack_require__("./ts/util/createAvatarData.ts");function isSameAvatarData(a,b){return!(!a||!b)&&(a.buffer&&b.buffer?a.buffer===b.buffer:a.imagePath&&b.imagePath?a.imagePath===b.imagePath:a.id===b.id)}var EditMode,missingCaseError=__webpack_require__("./ts/util/missingCaseError.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function AvatarEditor(_ref){var avatarColor=_ref.avatarColor,avatarPath=_ref.avatarPath,avatarValue=_ref.avatarValue,conversationId=_ref.conversationId,conversationTitle=_ref.conversationTitle,deleteAvatarFromDisk=_ref.deleteAvatarFromDisk,i18n=_ref.i18n,isGroup=_ref.isGroup,onCancel=_ref.onCancel,onSave=_ref.onSave,userAvatarData=_ref.userAvatarData,replaceAvatar=_ref.replaceAvatar,saveAvatarToDisk=_ref.saveAvatarToDisk,_useState2=_slicedToArray((0,react.useState)(),2),provisionalSelectedAvatar=_useState2[0],setProvisionalSelectedAvatar=_useState2[1],_useState4=_slicedToArray((0,react.useState)(avatarValue),2),avatarPreview=_useState4[0],setAvatarPreview=_useState4[1],_useState6=_slicedToArray((0,react.useState)(avatarValue),2),initialAvatar=_useState6[0],setInitialAvatar=_useState6[1],_useState8=_slicedToArray((0,react.useState)(userAvatarData.slice()),2),localAvatarData=_useState8[0],setLocalAvatarData=_useState8[1],_useState10=_slicedToArray((0,react.useState)(!1),2),pendingClear=_useState10[0],setPendingClear=_useState10[1],_useState12=_slicedToArray((0,react.useState)(EditMode.Main),2),editMode=_useState12[0],setEditMode=_useState12[1],selectedAvatar=(0,react.useCallback)((function(avatarToFind){return localAvatarData.find((function(avatarData){return isSameAvatarData(avatarData,avatarToFind)}))}),[localAvatarData])(provisionalSelectedAvatar);(0,react.useEffect)((function(){var shouldCancel=!1;return async function cacheAvatars(){var newAvatarData=await Promise.all(userAvatarData.map((async function(avatarData){if(avatarData.buffer)return avatarData;var buffer=await(0,avatarDataToBytes.u)(avatarData);return Object.assign({},avatarData,{buffer})})));shouldCancel||setLocalAvatarData(newAvatarData)}(),function(){shouldCancel=!0}}),[setLocalAvatarData,userAvatarData]);var content,updateAvatarDataList=(0,react.useCallback)((function(newAvatarData,staleAvatarData){var existingAvatarData=staleAvatarData?localAvatarData.filter((function(avatarData){return avatarData!==staleAvatarData})):localAvatarData;newAvatarData?(setAvatarPreview(newAvatarData.buffer),setLocalAvatarData([newAvatarData].concat(_toConsumableArray(existingAvatarData))),setProvisionalSelectedAvatar(newAvatarData)):(setLocalAvatarData(existingAvatarData),isSameAvatarData(selectedAvatar,staleAvatarData)&&(setAvatarPreview(void 0),setProvisionalSelectedAvatar(void 0)))}),[localAvatarData,selectedAvatar,setAvatarPreview,setLocalAvatarData,setProvisionalSelectedAvatar]),handleAvatarLoaded=(0,react.useCallback)((function(avatarBuffer){setAvatarPreview(avatarBuffer),setInitialAvatar(avatarBuffer)}),[]),hasChanges=initialAvatar!==avatarPreview||Boolean(pendingClear&&avatarPath);if(editMode===EditMode.Main)content=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"AvatarEditor__preview",children:[(0,jsx_runtime.jsx)(AvatarPreview.B,{avatarColor,avatarPath:pendingClear?void 0:avatarPath,avatarValue:avatarPreview,conversationTitle,i18n,isGroup,onAvatarLoaded:handleAvatarLoaded,onClear:function(){setPendingClear(!0),setAvatarPreview(void 0),setProvisionalSelectedAvatar(void 0)}}),(0,jsx_runtime.jsxs)("div",{className:"AvatarEditor__top-buttons",children:[(0,jsx_runtime.jsx)(AvatarUploadButton.h,{className:"AvatarEditor__button AvatarEditor__button--photo",i18n,onChange:function(newAvatar){var avatarData=(0,createAvatarData.s)({buffer:newAvatar,imagePath:"TMP"});saveAvatarToDisk(avatarData,conversationId),updateAvatarDataList(avatarData)}}),(0,jsx_runtime.jsx)("button",{className:"AvatarEditor__button AvatarEditor__button--text",onClick:function(){setProvisionalSelectedAvatar(void 0),setEditMode(EditMode.Text)},type:"button",children:i18n("icu:text")})]})]}),(0,jsx_runtime.jsx)("hr",{className:"AvatarEditor__divider"}),(0,jsx_runtime.jsx)("div",{className:"AvatarEditor__avatar-selector-title",children:i18n("icu:AvatarEditor--choose")}),(0,jsx_runtime.jsx)("div",{className:"AvatarEditor__avatars",children:localAvatarData.map((function(avatarData){return(0,jsx_runtime.jsx)(BetterAvatar.Y,{avatarData,i18n,isSelected:isSameAvatarData(avatarData,selectedAvatar),onClick:function(avatarBuffer){isSameAvatarData(avatarData,selectedAvatar)?avatarData.text?setEditMode(EditMode.Text):avatarData.icon&&setEditMode(EditMode.Custom):(setAvatarPreview(avatarBuffer),setProvisionalSelectedAvatar(avatarData))},onDelete:function(){updateAvatarDataList(void 0,avatarData),deleteAvatarFromDisk(avatarData,conversationId)}},avatarData.id)}))}),(0,jsx_runtime.jsx)(AvatarModalButtons.T,{hasChanges,i18n,onCancel,onSave:function(){selectedAvatar&&replaceAvatar(selectedAvatar,selectedAvatar,conversationId),onSave(avatarPreview)}})]});else if(editMode===EditMode.Text)content=(0,jsx_runtime.jsx)(AvatarTextEditor.g,{avatarData:selectedAvatar,i18n,onCancel:function(){if(setEditMode(EditMode.Main),!selectedAvatar){var actualAvatarSelected=localAvatarData.find((function(avatarData){return avatarData.buffer===avatarPreview}));actualAvatarSelected&&setProvisionalSelectedAvatar(actualAvatarSelected)}},onDone:function(avatarBuffer,avatarData){var newAvatarData=Object.assign({},avatarData,{buffer:avatarBuffer});updateAvatarDataList(newAvatarData,selectedAvatar),setEditMode(EditMode.Main),replaceAvatar(newAvatarData,selectedAvatar,conversationId)}});else{if(editMode!==EditMode.Custom)throw(0,missingCaseError.b)(editMode);if(!selectedAvatar)throw new Error("No selected avatar and editMode is custom");content=(0,jsx_runtime.jsx)(AvatarIconEditor.J,{avatarData:selectedAvatar,i18n,onClose:function(avatarData){avatarData&&(updateAvatarDataList(avatarData,selectedAvatar),replaceAvatar(avatarData,selectedAvatar,conversationId)),setEditMode(EditMode.Main)}})}return(0,jsx_runtime.jsx)("div",{className:"AvatarEditor",children:content})}!function(EditMode){EditMode.Main="Main",EditMode.Custom="Custom",EditMode.Text="Text"}(EditMode||(EditMode={})),AvatarEditor.displayName="AvatarEditor"},"./ts/components/AvatarTextEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>AvatarTextEditor});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_util_grapheme__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/grapheme.ts"),_AvatarColorPicker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/AvatarColorPicker.tsx"),_types_Colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Colors.ts"),_AvatarModalButtons__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/components/AvatarModalButtons.tsx"),_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./ts/components/BetterAvatarBubble.tsx"),_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./ts/util/avatarDataToBytes.ts"),_util_createAvatarData__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./ts/util/createAvatarData.ts"),_util_avatarTextSizeCalculator__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./ts/util/avatarTextSizeCalculator.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function AvatarTextEditor(_ref){var avatarData=_ref.avatarData,i18n=_ref.i18n,onCancel=_ref.onCancel,onDone=_ref.onDone,initialText=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){return(null==avatarData?void 0:avatarData.text)||""}),[avatarData]),initialColor=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){return(null==avatarData?void 0:avatarData.color)||_types_Colors__WEBPACK_IMPORTED_MODULE_4__.sj[0]}),[avatarData]),_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(initialText),2),inputText=_useState2[0],setInputText=_useState2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((0,_util_avatarTextSizeCalculator__WEBPACK_IMPORTED_MODULE_9__.$)(120).text),2),fontSize=_useState4[0],setFontSize=_useState4[1],_useState6=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(initialColor),2),selectedColor=_useState6[0],setSelectedColor=_useState6[1],inputRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),focusInput=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(){var inputEl=null==inputRef?void 0:inputRef.current;inputEl&&inputEl.focus()}),[]),handleChange=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var value=ev.target.value;_util_grapheme__WEBPACK_IMPORTED_MODULE_2__.QX(value)<=3&&setInputText(ev.target.value)}),[setInputText]),handlePaste=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((function(ev){var inputEl=ev.currentTarget,selectionStart=inputEl.selectionStart||0,selectionEnd=inputEl.selectionEnd||inputEl.selectionStart||0,textBeforeSelection=inputText.slice(0,selectionStart),textAfterSelection=inputText.slice(selectionEnd),pastedText=ev.clipboardData.getData("Text");_util_grapheme__WEBPACK_IMPORTED_MODULE_2__.QX(textBeforeSelection)+_util_grapheme__WEBPACK_IMPORTED_MODULE_2__.QX(pastedText)+_util_grapheme__WEBPACK_IMPORTED_MODULE_2__.QX(textAfterSelection)>3&&ev.preventDefault()}),[inputText]),onDoneRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(onDone);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){onDoneRef.current=onDone}),[onDone]);var handleDone=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((async function(){var newAvatarData=(0,_util_createAvatarData__WEBPACK_IMPORTED_MODULE_8__.s)({color:selectedColor,text:inputText}),buffer=await(0,_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_7__.u)(newAvatarData);onDoneRef.current(buffer,newAvatarData)}),[inputText,selectedColor]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){return function(){onDoneRef.current=lodash_noop__WEBPACK_IMPORTED_MODULE_0___default()}}),[]);var measureElRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){var measureEl=measureElRef.current;if(measureEl){var nextFontSize=(0,_util_avatarTextSizeCalculator__WEBPACK_IMPORTED_MODULE_9__.Z)(120,inputText,(function(candidateFontSize){measureEl.style.fontSize=`${candidateFontSize}px`;var _measureEl$getBoundin=measureEl.getBoundingClientRect(),width=_measureEl$getBoundin.width;return{height:_measureEl$getBoundin.height,width}}));setFontSize(nextFontSize)}}),[inputText]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){focusInput()}),[focusInput]);var hasChanges=initialText!==inputText||selectedColor!==initialColor;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"AvatarEditor__preview",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_6__.p,{color:selectedColor,i18n,onSelect:focusInput,style:{height:120,width:120},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("input",{className:"AvatarTextEditor__input",onChange:handleChange,onPaste:handlePaste,ref:inputRef,style:{fontSize},type:"text",dir:"auto",value:inputText})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("hr",{className:"AvatarEditor__divider"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_AvatarColorPicker__WEBPACK_IMPORTED_MODULE_3__.n,{i18n,onColorSelected:function(color){setSelectedColor(color),focusInput()},selectedColor}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_AvatarModalButtons__WEBPACK_IMPORTED_MODULE_5__.T,{hasChanges,i18n,onCancel,onSave:handleDone}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"AvatarTextEditor__measure",ref:measureElRef,children:inputText})]})}},"./ts/components/AvatarUploadButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>AvatarUploadButton});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),react=__webpack_require__("./node_modules/react/index.js"),js=__webpack_require__("./node_modules/blueimp-load-image/js/index.js"),js_default=__webpack_require__.n(js),canvasToBytes=__webpack_require__("./ts/util/canvasToBytes.ts");var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function AvatarUploadButton(_ref){var className=_ref.className,i18n=_ref.i18n,onChange=_ref.onChange,fileInputRef=(0,react.useRef)(null),_useState2=_slicedToArray((0,react.useState)(),2),processingFile=_useState2[0],setProcessingFile=_useState2[1];(0,react.useEffect)((function(){if(!processingFile)return noop_default();var shouldCancel=!1;return async function(){var newAvatar;try{newAvatar=await async function processImageFile(file){var image=(await js_default()(file,{canvas:!0,cover:!0,crop:!0,imageSmoothingQuality:"medium",maxHeight:512,maxWidth:512,minHeight:2,minWidth:2})).image;if(!(image instanceof HTMLCanvasElement))throw new Error("Loaded image was not a canvas");return(0,canvasToBytes.E)(image)}(processingFile)}catch(err){return}shouldCancel||(setProcessingFile(void 0),onChange(newAvatar))}(),function(){shouldCancel=!0}}),[onChange,processingFile]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("button",{className,onClick:function(){var fileInput=fileInputRef.current;fileInput&&(fileInput.value="",fileInput.click())},type:"button",children:i18n("icu:photo")}),(0,jsx_runtime.jsx)("input",{accept:".gif,.jpg,.jpeg,.png,.webp,image/gif,image/jpeg,image/png,image/webp",hidden:!0,onChange:function(event){var file=event.target.files&&event.target.files[0];file&&setProcessingFile(file)},ref:fileInputRef,type:"file"})]})}},"./ts/components/BetterAvatar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>BetterAvatar});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/components/BetterAvatarBubble.tsx"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/util/avatarDataToBytes.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function BetterAvatar(_ref){var avatarData=_ref.avatarData,i18n=_ref.i18n,isSelected=_ref.isSelected,onClick=_ref.onClick,onDelete=_ref.onDelete,_ref$size=_ref.size,size=void 0===_ref$size?48:_ref$size,_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(avatarData.buffer),2),avatarBuffer=_useState2[0],setAvatarBuffer=_useState2[1],_useState4=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),2),avatarURL=_useState4[0],setAvatarURL=_useState4[1];(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){var shouldCancel=!1;return avatarBuffer?lodash_noop__WEBPACK_IMPORTED_MODULE_0___default():(async function makeAvatar(){var buffer=await(0,_util_avatarDataToBytes__WEBPACK_IMPORTED_MODULE_4__.u)(avatarData);shouldCancel||setAvatarBuffer(buffer)}(),function(){shouldCancel=!0})}),[avatarBuffer,avatarData]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){if(avatarBuffer){var url=URL.createObjectURL(new Blob([avatarBuffer]));setAvatarURL(url)}}),[avatarBuffer]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){return function(){avatarURL&&URL.revokeObjectURL(avatarURL)}}),[avatarURL]);var isEditable=Boolean(avatarData.color),handleDelete=avatarData.icon?void 0:function(ev){ev.preventDefault(),ev.stopPropagation(),onDelete()};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(_BetterAvatarBubble__WEBPACK_IMPORTED_MODULE_2__.p,{i18n,isSelected,onDelete:handleDelete,onSelect:function(){onClick(avatarBuffer)},style:{backgroundImage:avatarURL?`url(${avatarURL})`:void 0,backgroundSize:size,height:size+8,width:size+8},children:[isEditable&&isSelected&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"BetterAvatarBubble--editable"}),!avatarURL&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-Avatar__spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{size:size-8+"px",svgSize:"small",direction:"on-avatar"})})]})}BetterAvatar.displayName="BetterAvatar"},"./ts/util/grapheme.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QX:()=>count,Rc:()=>truncateAndSize,i3:()=>isSingleGrapheme});var _iterables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/iterables.ts");function count(str){var segments=(new Intl.Segmenter).segment(str);return(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments)}function truncateAndSize(str,toSize){var segments=(new Intl.Segmenter).segment(str),originalSize=(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments);return void 0===toSize||originalSize<=toSize?[str,originalSize]:[(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.v_)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.UI)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.qn)(segments,toSize),(function(s){return s.segment})),""),toSize]}function isSingleGrapheme(str){return""!==str&&(new Intl.Segmenter).segment(str).containing(0).segment===str}}}]);