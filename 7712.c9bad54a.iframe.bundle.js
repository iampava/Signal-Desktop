"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[7712],{"./ts/badges/BadgeImageTheme.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>BadgeImageTheme,t:()=>parseBadgeImageTheme});var BadgeImageTheme,_util_enum__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/enum.ts");!function(BadgeImageTheme){BadgeImageTheme.Light="light",BadgeImageTheme.Dark="dark",BadgeImageTheme.Transparent="transparent"}(BadgeImageTheme||(BadgeImageTheme={}));var parseBadgeImageTheme=(0,_util_enum__WEBPACK_IMPORTED_MODULE_0__.m)(BadgeImageTheme,BadgeImageTheme.Transparent)},"./ts/badges/getBadgeImageFileLocalPath.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>getBadgeImageFileLocalPath});var lodash_last__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/last.js"),lodash_last__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_last__WEBPACK_IMPORTED_MODULE_0__),lodash_first__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/first.js"),lodash_first__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_first__WEBPACK_IMPORTED_MODULE_1__),lodash_findLast__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lodash/findLast.js"),lodash_findLast__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash_findLast__WEBPACK_IMPORTED_MODULE_2__),lodash_find__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lodash/find.js"),lodash_find__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_find__WEBPACK_IMPORTED_MODULE_3__),_BadgeImageTheme__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/badges/BadgeImageTheme.ts");function getBadgeImageFileLocalPath(badge,size,theme){if(badge){var localPathsForTheme=badge.images.map((function(image){var _image$theme;return null===(_image$theme=image[theme])||void 0===_image$theme?void 0:_image$theme.localPath}));return theme===_BadgeImageTheme__WEBPACK_IMPORTED_MODULE_4__.c.Transparent?(size<36?lodash_find__WEBPACK_IMPORTED_MODULE_3___default():lodash_findLast__WEBPACK_IMPORTED_MODULE_2___default())(localPathsForTheme,Boolean):size<24?lodash_first__WEBPACK_IMPORTED_MODULE_1___default()(localPathsForTheme):size<36?localPathsForTheme[1]:size<160?localPathsForTheme[2]:lodash_last__WEBPACK_IMPORTED_MODULE_0___default()(localPathsForTheme)||localPathsForTheme[2]}}},"./ts/components/Avatar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{qE:()=>Avatar,S7:()=>AvatarBlur,DZ:()=>AvatarSize});var AvatarBlur,AvatarSize,noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),log=__webpack_require__("./ts/logging/log.ts"),BadgeImageTheme=__webpack_require__("./ts/badges/BadgeImageTheme.ts"),Stories=__webpack_require__("./ts/types/Stories.ts"),Spinner=__webpack_require__("./ts/components/Spinner.tsx"),Util=__webpack_require__("./ts/types/Util.ts"),assert=__webpack_require__("./ts/util/assert.ts"),getBadgeImageFileLocalPath=__webpack_require__("./ts/badges/getBadgeImageFileLocalPath.ts"),getInitials=__webpack_require__("./ts/util/getInitials.ts"),shouldBlurAvatar=__webpack_require__("./ts/util/shouldBlurAvatar.ts"),SignalConversation=__webpack_require__("./ts/types/SignalConversation.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(AvatarBlur){AvatarBlur[AvatarBlur.NoBlur=0]="NoBlur",AvatarBlur[AvatarBlur.BlurPicture=1]="BlurPicture",AvatarBlur[AvatarBlur.BlurPictureWithClickToView=2]="BlurPictureWithClickToView"}(AvatarBlur||(AvatarBlur={})),function(AvatarSize){AvatarSize[AvatarSize.TWENTY=20]="TWENTY",AvatarSize[AvatarSize.TWENTY_EIGHT=28]="TWENTY_EIGHT",AvatarSize[AvatarSize.THIRTY_TWO=32]="THIRTY_TWO",AvatarSize[AvatarSize.FORTY_EIGHT=48]="FORTY_EIGHT",AvatarSize[AvatarSize.FIFTY_TWO=52]="FIFTY_TWO",AvatarSize[AvatarSize.EIGHTY=80]="EIGHTY"}(AvatarSize||(AvatarSize={}));var BADGE_PLACEMENT_BY_SIZE=new Map([[28,{bottom:-4,right:-2}],[32,{bottom:-4,right:-2}],[36,{bottom:-3,right:0}],[40,{bottom:-6,right:-4}],[48,{bottom:-6,right:-4}],[52,{bottom:-6,right:-2}],[56,{bottom:-6,right:0}],[64,{bottom:-6,right:0}],[80,{bottom:-8,right:0}],[88,{bottom:-4,right:3}],[112,{bottom:-4,right:3}]]);function Avatar(_ref){var acceptedMessageRequest=_ref.acceptedMessageRequest,avatarPath=_ref.avatarPath,badge=_ref.badge,className=_ref.className,_ref$color=_ref.color,color=void 0===_ref$color?"A200":_ref$color,conversationType=_ref.conversationType,i18n=_ref.i18n,isMe=_ref.isMe,innerRef=_ref.innerRef,loading=_ref.loading,noteToSelf=_ref.noteToSelf,onClick=_ref.onClick,onClickBadge=_ref.onClickBadge,sharedGroupNames=_ref.sharedGroupNames,size=_ref.size,theme=_ref.theme,title=_ref.title,unblurredAvatarPath=_ref.unblurredAvatarPath,searchResult=_ref.searchResult,storyRing=_ref.storyRing,_ref$blur=_ref.blur,blur=void 0===_ref$blur?function(){return shouldBlurAvatar.Y.apply(void 0,arguments)?AvatarBlur.BlurPicture:AvatarBlur.NoBlur}({acceptedMessageRequest,avatarPath,isMe,sharedGroupNames,unblurredAvatarPath}):_ref$blur,_useState2=_slicedToArray((0,react.useState)(!1),2),imageBroken=_useState2[0],setImageBroken=_useState2[1];(0,react.useEffect)((function(){setImageBroken(!1)}),[avatarPath]),(0,react.useEffect)((function(){if(!avatarPath)return noop_default();var image=new Image;return image.src=avatarPath,image.onerror=function(){log.warn("Avatar: Image failed to load; failing over to placeholder"),setImageBroken(!0)},function(){image.onerror=noop_default()}}),[avatarPath]);var contentsChildren,contents,initials=(0,getInitials.Q)(title),hasImage=!noteToSelf&&avatarPath&&!imageBroken,shouldUseInitials=!hasImage&&"direct"===conversationType&&Boolean(initials);if(loading){var svgSize=size<40?"small":"normal";contentsChildren=(0,jsx_runtime.jsx)("div",{className:"module-Avatar__spinner-container",children:(0,jsx_runtime.jsx)(Spinner.$j,{size:size-8+"px",svgSize,direction:"on-avatar"})})}else if(hasImage){(0,assert.q8)(avatarPath,"avatarPath should be defined here"),(0,assert.q8)(blur!==AvatarBlur.BlurPictureWithClickToView||size>=AvatarSize.EIGHTY,'Rendering "click to view" for a small avatar. This may not render correctly');var isBlurred=blur===AvatarBlur.BlurPicture||blur===AvatarBlur.BlurPictureWithClickToView;contentsChildren=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"module-Avatar__image",style:Object.assign({backgroundImage:`url('${encodeURI(avatarPath)}')`},isBlurred?{filter:`blur(${Math.ceil(size/2)}px)`}:{})}),blur===AvatarBlur.BlurPictureWithClickToView&&(0,jsx_runtime.jsx)("div",{className:"module-Avatar__click-to-view",children:i18n("icu:view")})]})}else contentsChildren=searchResult?(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-Avatar__icon","module-Avatar__icon--search-result")}):noteToSelf?(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-Avatar__icon","module-Avatar__icon--note-to-self")}):shouldUseInitials?(0,jsx_runtime.jsx)("div",{"aria-hidden":"true",className:"module-Avatar__label",style:{fontSize:Math.ceil(.45*size)},children:initials}):(0,jsx_runtime.jsx)("div",{className:classnames_default()("module-Avatar__icon",`module-Avatar__icon--${conversationType}`)});var badgeNode,contentsClassName=classnames_default()("module-Avatar__contents",`module-Avatar__contents--${color}`);contents=onClick?(0,jsx_runtime.jsx)("button",{className:contentsClassName,type:"button",onClick,children:contentsChildren}):(0,jsx_runtime.jsx)("div",{className:contentsClassName,children:contentsChildren});var badgeSize=function _getBadgeSize(avatarSize){if(avatarSize<24)return;if(avatarSize<=36)return 16;if(avatarSize<=64)return 24;if(avatarSize<=112)return 36;return Math.round(.4*avatarSize)}(size);if(badge&&theme&&!noteToSelf&&badgeSize&&function(badge){return!("isVisible"in badge)||badge.isVisible}(badge)){var badgePlacement=function _getBadgePlacement(avatarSize){return BADGE_PLACEMENT_BY_SIZE.get(avatarSize)||{bottom:0,right:0}}(size),badgeTheme=theme===Util.f8.light?BadgeImageTheme.c.Light:BadgeImageTheme.c.Dark,badgeImagePath=(0,getBadgeImageFileLocalPath.p)(badge,badgeSize,badgeTheme);if(badgeImagePath){var positionStyles=Object.assign({width:badgeSize,height:badgeSize},badgePlacement);badgeNode=onClickBadge?(0,jsx_runtime.jsx)("button",{"aria-label":badge.name,className:"module-Avatar__badge module-Avatar__badge--button",onClick:onClickBadge,style:Object.assign({backgroundImage:`url('${encodeURI(badgeImagePath)}')`},positionStyles),type:"button"}):(0,jsx_runtime.jsx)("img",{alt:badge.name,className:"module-Avatar__badge module-Avatar__badge--static",src:badgeImagePath,style:positionStyles})}}return(0,jsx_runtime.jsxs)("div",{"aria-label":i18n("icu:contactAvatarAlt",{name:title}),className:classnames_default()("module-Avatar",Boolean(storyRing)&&"module-Avatar--with-story",storyRing===Stories.$q.Unread&&"module-Avatar--with-story--unread",className,avatarPath===SignalConversation.d?"module-Avatar--signal-official":void 0),style:{minWidth:size,width:size,height:size},ref:innerRef,children:[contents,badgeNode]})}Avatar.displayName="Avatar"},"./ts/components/Spinner.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$j:()=>Spinner,me:()=>SpinnerSvgSizes,sX:()=>SpinnerDirections});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ts/util/getClassNamesFor.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/jsx-runtime.js"),SpinnerSvgSizes=["small","normal"],SpinnerDirections=["outgoing","incoming","on-background","on-primary-button","on-progress-dialog","on-avatar"];function Spinner(_ref){var ariaLabel=_ref.ariaLabel,direction=_ref.direction,moduleClassName=_ref.moduleClassName,role=_ref.role,size=_ref.size,svgSize=_ref.svgSize,getClassName=(0,_util_getClassNamesFor__WEBPACK_IMPORTED_MODULE_2__.h)("module-spinner",moduleClassName);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName("__container"),getClassName(`__container--${svgSize}`),getClassName(direction&&`__container--${direction}`),getClassName(direction&&`__container--${svgSize}-${direction}`)),role,"aria-label":ariaLabel,style:{height:size,width:size},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName("__circle"),getClassName(`__circle--${svgSize}`),getClassName(direction&&`__circle--${direction}`),getClassName(direction&&`__circle--${svgSize}-${direction}`))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()(getClassName("__arc"),getClassName(`__arc--${svgSize}`),getClassName(direction&&`__arc--${direction}`),getClassName(direction&&`__arc--${svgSize}-${direction}`))})]})}Spinner.displayName="Spinner"},"./ts/types/SignalConversation.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>SIGNAL_ACI,d:()=>SIGNAL_AVATAR_PATH});var SIGNAL_ACI=__webpack_require__("./ts/types/UUID.ts").hb.cast("11111111-1111-4111-8111-111111111111"),SIGNAL_AVATAR_PATH="images/profile-avatar.svg"},"./ts/types/Stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$q:()=>HasStories,FT:()=>StoryViewDirectionType,HH:()=>getStoryDistributionListName,Ox:()=>ResolvedSendStatus,Zk:()=>StoryViewTargetType,bX:()=>StoryViewModeType,qn:()=>MY_STORY_ID,vW:()=>StorySendMode});var StoryViewDirectionType,StoryViewTargetType,StoryViewModeType,HasStories,StorySendMode,ResolvedSendStatus,MY_STORY_ID="00000000-0000-0000-0000-000000000000";function getStoryDistributionListName(i18n,id,name){return id===MY_STORY_ID?i18n("icu:Stories__mine"):name}!function(StoryViewDirectionType){StoryViewDirectionType.Next="Next",StoryViewDirectionType.Previous="Previous"}(StoryViewDirectionType||(StoryViewDirectionType={})),function(StoryViewTargetType){StoryViewTargetType.Details="Details",StoryViewTargetType.Views="Views",StoryViewTargetType.Replies="Replies"}(StoryViewTargetType||(StoryViewTargetType={})),function(StoryViewModeType){StoryViewModeType.All="All",StoryViewModeType.Hidden="Hidden",StoryViewModeType.MyStories="MyStories",StoryViewModeType.Single="Single",StoryViewModeType.Unread="Unread",StoryViewModeType.User="User"}(StoryViewModeType||(StoryViewModeType={})),function(HasStories){HasStories.Read="Read",HasStories.Unread="Unread"}(HasStories||(HasStories={})),function(StorySendMode){StorySendMode.IfActive="IfActive",StorySendMode.Always="Always",StorySendMode.Never="Never"}(StorySendMode||(StorySendMode={})),function(ResolvedSendStatus){ResolvedSendStatus.Failed="Failed",ResolvedSendStatus.PartiallySent="PartiallySent",ResolvedSendStatus.Sending="Sending",ResolvedSendStatus.Sent="Sent"}(ResolvedSendStatus||(ResolvedSendStatus={}))},"./ts/types/UUID.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{TP:()=>isValidUuid,hb:()=>UUID});var UUIDKind,uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/uuid-browser/index.js"),_util_assert__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ts/util/assert.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}!function(UUIDKind){UUIDKind.ACI="ACI",UUIDKind.PNI="PNI",UUIDKind.Unknown="Unknown"}(UUIDKind||(UUIDKind={}));var UUID_REGEXP=/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,isValidUuid=function(value){return"string"==typeof value&&("00000000-0000-0000-0000-000000000000"===value||UUID_REGEXP.test(value))},UUID=function(){function UUID(value){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UUID),this.value=value,(0,_util_assert__WEBPACK_IMPORTED_MODULE_1__.Yj)(isValidUuid(value),`Invalid UUID: ${value}`)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(UUID,[{key:"toString",value:function toString(){return this.value}},{key:"isEqual",value:function isEqual(other){return this.value===other.value}}],[{key:"parse",value:function parse(value){return new UUID(value)}},{key:"lookup",value:function lookup(identifier){var conversation=window.ConversationController.get(identifier),uuid=null==conversation?void 0:conversation.get("uuid");if(void 0!==uuid)return new UUID(uuid)}},{key:"checkedLookup",value:function checkedLookup(identifier){var uuid=UUID.lookup(identifier);return(0,_util_assert__WEBPACK_IMPORTED_MODULE_1__.Yj)(void 0!==uuid,`Conversation ${identifier} not found or has no uuid`),uuid}},{key:"generate",value:function generate(){return new UUID((0,uuid__WEBPACK_IMPORTED_MODULE_0__.v4)())}},{key:"cast",value:function cast(value){return new UUID(value.toLowerCase()).toString()}},{key:"fromPrefix",value:function fromPrefix(value){for(var padded=value;padded.length<8;)padded+="0";return new UUID(`${padded}-0000-4000-8000-${"0".repeat(12)}`)}}]),UUID}()},"./ts/util/getInitials.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getInitials(name){if(name){var parsedName=name.replace(/[^\p{L}\p{Z}]+/gu,"").replace(/\p{Z}+/gu," ").trim();if(parsedName){if(2===parsedName.length&&parsedName===parsedName.toUpperCase())return parsedName;var parts=parsedName.toUpperCase().split(" "),partsLen=parts.length;return 1===partsLen?parts[0].charAt(0):parts[0].charAt(0)+parts[partsLen-1].charAt(0)}}}__webpack_require__.d(__webpack_exports__,{Q:()=>getInitials})},"./ts/util/shouldBlurAvatar.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>shouldBlurAvatar});var shouldBlurAvatar=function(_ref){var acceptedMessageRequest=_ref.acceptedMessageRequest,avatarPath=_ref.avatarPath,isMe=_ref.isMe,sharedGroupNames=_ref.sharedGroupNames,unblurredAvatarPath=_ref.unblurredAvatarPath;return Boolean(!isMe&&!acceptedMessageRequest&&!sharedGroupNames.length&&avatarPath&&avatarPath!==unblurredAvatarPath)}}}]);