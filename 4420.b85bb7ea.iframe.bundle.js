"use strict";(globalThis.webpackChunksignal_desktop=globalThis.webpackChunksignal_desktop||[]).push([[4420],{"./ts/components/StoryLinkPreview.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>StoryLinkPreview});var lodash_unescape__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/unescape.js"),lodash_unescape__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_unescape__WEBPACK_IMPORTED_MODULE_0__),classnames__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/classnames/index.js")),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),_conversation_Image__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/conversation/Image.tsx"),_types_Attachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Attachment.ts"),_types_LinkPreview__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ts/types/LinkPreview.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");function StoryLinkPreview(_ref){var content,description=_ref.description,domain=_ref.domain,forceCompactMode=_ref.forceCompactMode,i18n=_ref.i18n,image=_ref.image,title=_ref.title,url=_ref.url,isImage=(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.VV)(image),location=domain||(0,_types_LinkPreview__WEBPACK_IMPORTED_MODULE_5__.ge)(String(url)),isCompact=forceCompactMode||!image;content=title||description?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"StoryLinkPreview__content",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__title",children:title}),description&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__description",children:lodash_unescape__WEBPACK_IMPORTED_MODULE_0___default()(description)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__footer",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__location",children:location})})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("StoryLinkPreview__content","StoryLinkPreview__content--only-url"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__title",children:location})});var imageWidth=isCompact?176:560,imageHeight=!isCompact&&image?imageWidth/((image.width||1)/(image.height||1)):176;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("StoryLinkPreview",{"StoryLinkPreview--tall":!isCompact,"StoryLinkPreview--tiny":!title&&!description&&!image}),children:[isImage&&image?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__icon-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_conversation_Image__WEBPACK_IMPORTED_MODULE_3__.E,{alt:i18n("icu:stagedPreviewThumbnail",{domain:location}),attachment:image,curveBottomLeft:_conversation_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,curveBottomRight:_conversation_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,curveTopLeft:_conversation_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,curveTopRight:_conversation_Image__WEBPACK_IMPORTED_MODULE_3__.v.Tiny,height:imageHeight,i18n,url:image.url,width:imageWidth})}):null,!isImage&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"StoryLinkPreview__no-image"}),content]})}StoryLinkPreview.displayName="StoryLinkPreview"},"./ts/components/TextAttachment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>TextAttachment});var index_esm=__webpack_require__("./node_modules/react-measure/dist/index.esm.js"),react=__webpack_require__("./node_modules/react/index.js"),react_textarea_autosize_browser_esm=__webpack_require__("./node_modules/react-textarea-autosize/dist/react-textarea-autosize.browser.esm.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),AddNewLines=__webpack_require__("./ts/components/conversation/AddNewLines.tsx"),Emojify=__webpack_require__("./ts/components/conversation/Emojify.tsx"),StoryLinkPreview=__webpack_require__("./ts/components/StoryLinkPreview.tsx"),Attachment=__webpack_require__("./ts/types/Attachment.ts"),grapheme=__webpack_require__("./ts/util/grapheme.ts"),LinkPreview=__webpack_require__("./ts/types/LinkPreview.ts"),assert=__webpack_require__("./ts/util/assert.ts"),FONT_MAP={base:["sans-serif","sans-serif","sans-serif","serif","serif","sans-serif"],latin:["Inter","Inter","Inter",'"EB Garamond"',"Parisienne",'"Barlow Condensed"'],cyrillic:["Inter","Inter","Inter",'"EB Garamond"','"American Typewriter Semibold", "Cambria Bold"','"SF Pro Light (System Light)", "Calibri Light"'],devanagari:['"Kohinoor Devanagari Regular", "Utsaah Regular"','"Kohinoor Devanagari Regular", "Utsaah Regular"','"Kohinoor Devanagari Semibold", "Utsaah Bold"','"Devanagari Sangam MN Regular", "Kokila Regular"','"Devanagari Sangam MN Bold", "Kokila Bold"','"Kohinoor Devanagari Light", "Utsaah Regular"'],arabic:['"SF Arabic Regular", "Segoe UI Arabic Regular"','"SF Arabic Regular", "Segoe UI Arabic Regular"','"SF Arabic Bold", "Segoe UI Arabic Bold"','"Geeza Pro Regular", "Sakkal Majalla Regular"','"Geeza Pro Bold", "Sakkal Majalla Bold"','"SF Arabic Black", "Segoe UI Arabic Bold"'],japanese:['"Hiragino Sans W3"','"Hiragino Sans W3"','"Hiragino Sans W7"','"Hiragino Mincho Pro W3"','"Hiragino Mincho Pro W6"','"Hiragino Maru Gothic Pro N"'],zhhk:['"PingFang HK Regular", "MingLiU Regular"','"PingFang HK Regular", "MingLiU Regular"','"PingFang HK Semibold", "MingLiU Regular"','"PingFang HK Ultralight", "MingLiU Regular"','"PingFang HK Thin", "MingLiU Regular"','"PingFang HK Light", "MingLiU Regular"'],zhtc:['"PingFang TC Regular", "JhengHei TC Regular"','"PingFang TC Regular", "JhengHei TC Regular"','"PingFang TC Semibold", "JhengHei TC Bold"','"PingFang TC Ultralight", "JhengHei TC Light"','"PingFang TC Thin", "JhengHei TC Regular"','"PingFang TC Light", "JhengHei TC Bold"'],zhsc:['"PingFang SC Regular", SimHei','"PingFang SC Regular", SimHei','"PingFang SC Semibold", SimHei','"PingFang SC Ultralight", SimHei','"PingFang SC Thin", SimHei','"PingFang SC Light", SimHei']},rxArabic=/\p{Script=Arab}/u,rxCJK=/\p{Script=Han}/u,rxCyrillic=/\p{Script=Cyrl}/u,rxDevanagari=/\p{Script=Deva}/u,rxJapanese=/\p{Script=Hira}|\p{Script=Kana}/u,rxLatin=/\p{Script=Latn}/u,fontSniffer_hasArabic=function(text){return rxArabic.test(text)},fontSniffer_hasCJK=function(text){return rxCJK.test(text)},fontSniffer_hasCyrillic=function(text){return rxCyrillic.test(text)},fontSniffer_hasDevanagari=function(text){return rxDevanagari.test(text)},fontSniffer_hasJapanese=function(text){return rxJapanese.test(text)},fontSniffer_hasLatin=function(text){return rxLatin.test(text)};var getStoryBackground=__webpack_require__("./ts/util/getStoryBackground.ts"),durations=__webpack_require__("./ts/util/durations/index.ts"),useRefMerger=__webpack_require__("./ts/hooks/useRefMerger.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var renderNewLines=function(_ref){var textWithNewLines=_ref.text,key=_ref.key;return(0,jsx_runtime.jsx)(AddNewLines.K,{text:textWithNewLines},key)};renderNewLines.displayName="renderNewLines";var TextSize;function getTextSize(text){var length=(0,grapheme.QX)(text);return length<50?TextSize.Large:length<200?TextSize.Medium:TextSize.Small}function getFont(text,textSize,textStyle,i18n){var fontName=function getFontNameByTextScript(text,textStyleIndex,i18n){(0,assert.Yj)(textStyleIndex>=0&&textStyleIndex<=5,"text style is not between 0-5");var fonts=[FONT_MAP.base[textStyleIndex]];if(fontSniffer_hasArabic(text)&&fonts.push(FONT_MAP.arabic[textStyleIndex]),fontSniffer_hasCJK(text)){var locale=null==i18n?void 0:i18n.getLocale();"zh-TW"===locale?fonts.push(FONT_MAP.zhtc[textStyleIndex]):"zh-HK"===locale?fonts.push(FONT_MAP.zhhk[textStyleIndex]):fonts.push(FONT_MAP.zhsc[textStyleIndex])}return fontSniffer_hasCyrillic(text)&&fonts.push(FONT_MAP.cyrillic[textStyleIndex]),fontSniffer_hasDevanagari(text)&&fonts.push(FONT_MAP.devanagari[textStyleIndex]),fontSniffer_hasJapanese(text)&&fonts.push(FONT_MAP.japanese[textStyleIndex]),fontSniffer_hasLatin(text)&&fonts.push(FONT_MAP.latin[textStyleIndex]),fonts.reverse().join(", ")}(text,Number(textStyle)||0,i18n),fontSize=32;switch(textSize){case TextSize.Large:fontSize=59;break;case TextSize.Medium:fontSize=42;break;default:fontSize=32}return`${textStyle===Attachment.uN.BOLD?"bold ":""}${fontSize}px ${fontName}`}function getTextStyles(textContent,textForegroundColor,textStyle,i18n){return{color:(0,getStoryBackground.Ju)(textForegroundColor||getStoryBackground.Pl),font:getFont(textContent,getTextSize(textContent),textStyle,i18n),textAlign:getTextSize(textContent)===TextSize.Small?"left":"center"}}!function(TextSize){TextSize[TextSize.Small=0]="Small",TextSize[TextSize.Medium=1]="Medium",TextSize[TextSize.Large=2]="Large"}(TextSize||(TextSize={}));var TextAttachment=(0,react.forwardRef)((function TextAttachmentForwarded(_ref2,forwardedTextEditorRef){var _textAttachment$previ,disableLinkPreviewPopup=_ref2.disableLinkPreviewPopup,i18n=_ref2.i18n,isEditingText=_ref2.isEditingText,isThumbnail=_ref2.isThumbnail,onChange=_ref2.onChange,onClick=_ref2.onClick,onRemoveLinkPreview=_ref2.onRemoveLinkPreview,textAttachment=_ref2.textAttachment,linkPreview=(0,react.useRef)(null),_useState2=_slicedToArray((0,react.useState)(),2),linkPreviewOffsetTop=_useState2[0],setLinkPreviewOffsetTop=_useState2[1],textContent=textAttachment.text||"",textEditorRef=(0,react.useRef)(null),refMerger=(0,useRefMerger.T)();(0,react.useEffect)((function(){var node=null==textEditorRef?void 0:textEditorRef.current;node&&(node.focus(),node.setSelectionRange(node.value.length,node.value.length))}),[isEditingText]),(0,react.useEffect)((function(){setLinkPreviewOffsetTop(void 0)}),[null===(_textAttachment$previ=textAttachment.preview)||void 0===_textAttachment$previ?void 0:_textAttachment$previ.url]);var _useState4=_slicedToArray((0,react.useState)(!1),2),isHoveringOverTooltip=_useState4[0],setIsHoveringOverTooltip=_useState4[1];function showTooltip(){var _linkPreview$current;disableLinkPreviewPopup||(setIsHoveringOverTooltip(!0),setLinkPreviewOffsetTop(null==linkPreview||null===(_linkPreview$current=linkPreview.current)||void 0===_linkPreview$current?void 0:_linkPreview$current.offsetTop))}(0,react.useEffect)((function(){var timeout=setTimeout((function(){isHoveringOverTooltip||setLinkPreviewOffsetTop(void 0)}),5*durations.sh);return function(){clearTimeout(timeout)}}),[isHoveringOverTooltip]);var storyBackgroundColor={background:(0,getStoryBackground.dF)(textAttachment)};return(0,jsx_runtime.jsx)(index_esm.Z,{bounds:!0,children:function(_ref3){var _contentRect$bounds,contentRect=_ref3.contentRect,measureRef=_ref3.measureRef,scaleFactor=((null===(_contentRect$bounds=contentRect.bounds)||void 0===_contentRect$bounds?void 0:_contentRect$bounds.height)||1)/1280;return(0,jsx_runtime.jsxs)("div",{className:"TextAttachment",onClick:function(){linkPreviewOffsetTop&&setLinkPreviewOffsetTop(void 0),null==onClick||onClick()},onKeyUp:function(ev){"Escape"===ev.key&&linkPreviewOffsetTop&&setLinkPreviewOffsetTop(void 0)},ref:measureRef,style:isThumbnail?storyBackgroundColor:void 0,children:[textAttachment.preview&&textAttachment.preview.url&&linkPreviewOffsetTop&&!isThumbnail&&(0,jsx_runtime.jsxs)("a",{className:"TextAttachment__preview__tooltip",href:textAttachment.preview.url,rel:"noreferrer",style:{top:linkPreviewOffsetTop*scaleFactor-89},target:"_blank",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"TextAttachment__preview__tooltip__title",children:i18n("icu:TextAttachment__preview__link")}),(0,jsx_runtime.jsx)("div",{className:"TextAttachment__preview__tooltip__url",children:textAttachment.preview.url})]}),(0,jsx_runtime.jsx)("div",{className:"TextAttachment__preview__tooltip__arrow"})]}),(0,jsx_runtime.jsxs)("div",{className:"TextAttachment__story",style:Object.assign({},isThumbnail?{}:storyBackgroundColor,{transform:`scale(${scaleFactor})`}),children:[(textContent||onChange)&&(0,jsx_runtime.jsx)("div",{className:classnames_default()("TextAttachment__text",{"TextAttachment__text--with-bg":Boolean(textAttachment.textBackgroundColor)}),style:{backgroundColor:textAttachment.textBackgroundColor?(0,getStoryBackground.Ju)(textAttachment.textBackgroundColor):"transparent"},children:onChange?(0,jsx_runtime.jsx)(react_textarea_autosize_browser_esm.Z,{dir:"auto",className:"TextAttachment__text__container TextAttachment__text__textarea",disabled:!isEditingText,onChange:function(ev){return onChange(ev.currentTarget.value)},placeholder:i18n("icu:TextAttachment__placeholder"),ref:refMerger(forwardedTextEditorRef,textEditorRef),style:getTextStyles(textContent,textAttachment.textForegroundColor,textAttachment.textStyle,i18n),value:textContent}):(0,jsx_runtime.jsx)("div",{className:"TextAttachment__text__container",style:getTextStyles(textContent,textAttachment.textForegroundColor,textAttachment.textStyle,i18n),children:(0,jsx_runtime.jsx)(Emojify.u,{text:textContent,renderNonEmoji:renderNewLines})})}),textAttachment.preview&&textAttachment.preview.url&&(0,jsx_runtime.jsxs)("div",{className:classnames_default()("TextAttachment__preview-container",{"TextAttachment__preview-container--large":Boolean(textAttachment.preview.title)}),ref:linkPreview,onBlur:function(){return setIsHoveringOverTooltip(!1)},onFocus:showTooltip,onMouseOut:function(){return setIsHoveringOverTooltip(!1)},onMouseOver:showTooltip,children:[onRemoveLinkPreview&&(0,jsx_runtime.jsx)("div",{className:"TextAttachment__preview__remove",children:(0,jsx_runtime.jsx)("button",{"aria-label":i18n("icu:Keyboard--remove-draft-link-preview"),type:"button",onClick:onRemoveLinkPreview})}),(0,jsx_runtime.jsx)(StoryLinkPreview.Q,Object.assign({},textAttachment.preview,{domain:(0,LinkPreview.ge)(String(textAttachment.preview.url)),forceCompactMode:getTextSize(textContent)!==TextSize.Large,i18n,title:textAttachment.preview.title||void 0,url:textAttachment.preview.url}))]})]})]})}})}))},"./ts/components/conversation/Image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>Image,v:()=>CurveType});var CurveType,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_blurhash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-blurhash/es/index.js"),_Spinner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ts/components/Spinner.tsx"),_types_Attachment__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ts/types/Attachment.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/react/jsx-runtime.js");function Image(_ref){var alt=_ref.alt,attachment=_ref.attachment,blurHash=_ref.blurHash,bottomOverlay=_ref.bottomOverlay,className=_ref.className,closeButton=_ref.closeButton,curveBottomLeft=_ref.curveBottomLeft,curveBottomRight=_ref.curveBottomRight,curveTopLeft=_ref.curveTopLeft,curveTopRight=_ref.curveTopRight,darkOverlay=_ref.darkOverlay,isDownloaded=_ref.isDownloaded,_ref$height=_ref.height,height=void 0===_ref$height?0:_ref$height,i18n=_ref.i18n,noBackground=_ref.noBackground,noBorder=_ref.noBorder,onClick=_ref.onClick,onClickClose=_ref.onClickClose,onError=_ref.onError,overlayText=_ref.overlayText,playIconOverlay=_ref.playIconOverlay,tabIndex=_ref.tabIndex,theme=_ref.theme,url=_ref.url,_ref$width=_ref.width,width=void 0===_ref$width?0:_ref$width,_ref$cropWidth=_ref.cropWidth,cropWidth=void 0===_ref$cropWidth?0:_ref$cropWidth,_ref$cropHeight=_ref.cropHeight,cropHeight=void 0===_ref$cropHeight?0:_ref$cropHeight,_ref2=attachment||{caption:null,pending:!0},caption=_ref2.caption,pending=_ref2.pending,imgNotDownloaded=!isDownloaded&&!(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.TG)(attachment),resolvedBlurHash=blurHash||(0,_types_Attachment__WEBPACK_IMPORTED_MODULE_4__.d0)(theme),curveStyles={borderTopLeftRadius:curveTopLeft||CurveType.None,borderTopRightRadius:curveTopRight||CurveType.None,borderBottomLeftRadius:curveBottomLeft||CurveType.None,borderBottomRightRadius:curveBottomRight||CurveType.None},canClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return null!=onClick&&!pending}),[pending,onClick]),handleClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(event){if(!canClick)return event.preventDefault(),void event.stopPropagation();onClick&&(event.preventDefault(),event.stopPropagation(),onClick(attachment))}),[attachment,canClick,onClick]),handleKeyDown=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(event){if(!canClick)return event.preventDefault(),void event.stopPropagation();!onClick||"Enter"!==event.key&&"Space"!==event.key||(event.preventDefault(),event.stopPropagation(),onClick(attachment))}),[attachment,canClick,onClick]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-image",className,noBackground?null:"module-image--with-background",cropWidth||cropHeight?"module-image--cropped":null),style:Object.assign({width:width-cropWidth,height:height-cropHeight},curveStyles),children:[pending?blurHash?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"module-image__download-pending",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:blurHash,width,height,style:{display:"block"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__download-pending--spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__download-pending--spinner",title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{moduleClassName:"module-image-spinner",svgSize:"small"})})})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__loading-placeholder",style:{height:`${height}px`,width:`${width}px`,lineHeight:`${height}px`,textAlign:"center"},title:i18n("icu:loading"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_Spinner__WEBPACK_IMPORTED_MODULE_3__.$j,{svgSize:"normal"})}):url?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("img",{onError,className:"module-image__image",alt,height,width,src:url}):resolvedBlurHash?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_blurhash__WEBPACK_IMPORTED_MODULE_2__.E,{hash:resolvedBlurHash,width,height,style:{display:"block"}}):null,caption?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("img",{className:"module-image__caption-icon",src:"images/caption-shadow.svg",alt:i18n("icu:imageCaptionIconAlt")}):null,bottomOverlay?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__bottom-overlay",style:{borderBottomLeftRadius:curveBottomLeft||CurveType.None,borderBottomRightRadius:curveBottomRight||CurveType.None}}):null,pending||imgNotDownloaded||!playIconOverlay?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__play-overlay__circle",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__play-overlay__icon"})}),overlayText?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"module-image__text-container",style:{lineHeight:`${height}px`},children:overlayText}):null,canClick?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{type:"button",className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("module-image__border-overlay",{"module-image__border-overlay--with-border":!noBorder,"module-image__border-overlay--with-click-handler":canClick,"module-image__border-overlay--dark":darkOverlay,"module-image--not-downloaded":imgNotDownloaded}),style:curveStyles,onClick:handleClick,onKeyDown:handleKeyDown,tabIndex,children:imgNotDownloaded?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{}):null}):null,closeButton?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),onClickClose&&onClickClose(attachment)},className:"module-image__close-button",title:i18n("icu:remove-attachment"),"aria-label":i18n("icu:remove-attachment")}):null]})}!function(CurveType){CurveType[CurveType.None=0]="None",CurveType[CurveType.Tiny=4]="Tiny",CurveType[CurveType.Small=10]="Small",CurveType[CurveType.Normal=18]="Normal"}(CurveType||(CurveType={})),Image.displayName="Image"},"./ts/util/getStoryBackground.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ju:()=>getHexFromNumber,Pl:()=>COLOR_WHITE_INT,dF:()=>getBackgroundColor,p6:()=>COLOR_BLACK_INT,t_:()=>getStoryBackground});var COLOR_BLACK_INT=4278190080,COLOR_WHITE_INT=4294704123;function getHexFromNumber(color){return`#${color.toString(16).slice(2)}`}function getBackgroundColor(_ref){var color=_ref.color,gradient=_ref.gradient;return gradient?`linear-gradient(${gradient.angle}deg, ${getHexFromNumber(gradient.startColor||COLOR_WHITE_INT)}, ${getHexFromNumber(gradient.endColor||COLOR_WHITE_INT)}) border-box`:getHexFromNumber(color||COLOR_WHITE_INT)}function getStoryBackground(attachment){return attachment?attachment.textAttachment?getBackgroundColor(attachment.textAttachment):attachment.screenshot&&attachment.screenshot.url?`url("${attachment.screenshot.url}")`:attachment.url?`url("${attachment.url}")`:"rgba(0, 0, 0, 0.9)":"rgba(0, 0, 0, 0.9)"}},"./ts/util/grapheme.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QX:()=>count,Rc:()=>truncateAndSize,i3:()=>isSingleGrapheme});var _iterables__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ts/util/iterables.ts");function count(str){var segments=(new Intl.Segmenter).segment(str);return(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments)}function truncateAndSize(str,toSize){var segments=(new Intl.Segmenter).segment(str),originalSize=(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.dp)(segments);return void 0===toSize||originalSize<=toSize?[str,originalSize]:[(0,_iterables__WEBPACK_IMPORTED_MODULE_0__.v_)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.UI)((0,_iterables__WEBPACK_IMPORTED_MODULE_0__.qn)(segments,toSize),(function(s){return s.segment})),""),toSize]}function isSingleGrapheme(str){return""!==str&&(new Intl.Segmenter).segment(str).containing(0).segment===str}}}]);